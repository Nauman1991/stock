import{__decorate as t}from"tslib";import{LitElement as i,html as e}from"lit";import{I18nService as n,onKey as a,isVisible as o,setAttributes as s,syncPropsForAllItems as r,syncProps as d,baseStyles as c,property as v,event as l,state as h,i18n as p,querySlot as g,querySlotAll as m,animate as u,reverseAnimation as A}from"@cds/core/internal";import I from"./navigation.element.scss.js";import{setFocus as f,visibleElement as y,removeFocus as x,getNextFocusElement as N,getPreviousFocusElement as b,DEFAULT_NAVIGATION_LAYOUT as E}from"./utils/index.js";import{CdsNavigationGroup as S}from"./navigation-group.element.js";import{AnimationNavigationOpenName as C}from"../internal/motion/animations/cds-navigation-open.js";const D="cds-navigation";let R=class extends i{constructor(){super(...arguments),this.expandedRoot=!1,this.cdsMotion="on",this.groupItem=!0,this.expanded=!1,this.i18n=n.keys.navigation}initAriaActiveDescendant(){const t=this.currentActiveItem?this.currentActiveItem:this.allNavigationElements[0];f(t),this.ariaActiveDescendant=t.id}keyboardNavigationHandler(t){const i=Array.from(this.allNavigationElements).filter(y);a("arrow-down",t,(()=>{if(this.currentActiveItem){x(this.currentActiveItem);const t=N(this.currentActiveItem,i);this.ariaActiveDescendant=t.id,f(t)}})),a("arrow-up",t,(()=>{if(this.currentActiveItem){x(this.currentActiveItem);const t=b(this.currentActiveItem,i);this.ariaActiveDescendant=t.id,f(t)}})),a("arrow-right",t,(()=>{var t,i;const e=null===(t=this.currentActiveItem)||void 0===t?void 0:t.closest("cds-navigation-group");e||"CDS-NAVIGATION-START"!==(null===(i=this.currentActiveItem)||void 0===i?void 0:i.tagName)||this.expanded?!e||e.expanded||e.expandedChange.emit(!e.expanded):this.toggle()})),a("arrow-left",t,(()=>{var t,i,e;const n=null===(t=this.currentActiveItem)||void 0===t?void 0:t.closest("cds-navigation-group");if(n||"CDS-NAVIGATION-START"!==(null===(i=this.currentActiveItem)||void 0===i?void 0:i.tagName)||!this.expanded){if("CDS-NAVIGATION-ITEM"===(null===(e=this.currentActiveItem)||void 0===e?void 0:e.tagName)&&n){const t=null==n?void 0:n.querySelector("cds-navigation-start");return x(this.currentActiveItem),this.ariaActiveDescendant=null==t?void 0:t.id,void f(t)}n&&n.expanded&&n.expandedChange.emit(!n.expanded)}else this.toggle()})),a("home",t,(()=>{if(this.currentActiveItem){x(this.currentActiveItem);const t=i[0];this.ariaActiveDescendant=t.id,f(t)}})),a("end",t,(()=>{if(this.currentActiveItem){x(this.currentActiveItem);const t=i[i.length-1];this.ariaActiveDescendant=t.id,f(t)}})),a("enter",t,(()=>{var t,i;(null===(t=this.currentActiveItem)||void 0===t?void 0:t.focusElement)&&(null===(i=this.currentActiveItem)||void 0===i||i.focusElement.click())})),a("space",t,(()=>{var t,i;(null===(t=this.currentActiveItem)||void 0===t?void 0:t.focusElement)&&(null===(i=this.currentActiveItem)||void 0===i||i.focusElement.click())}))}toggle(){this.expandedChange.emit(!this.expanded)}get currentActiveItem(){return this.visibleChildren.find((t=>t.id===this.ariaActiveDescendant))}get endTemplate(){return this.navigationEnd?e`<div role="region" class="navigation-end" cds-layout="vertical align:horizontal-stretch"><slot name="cds-navigation-end"></slot></div>`:""}get startTemplate(){let t;return t=this.rootNavigationStart?e`<div role="region" class="navigation-start" cds-layout="vertical align:horizontal-stretch"><slot @slotchange="${()=>this.addStartEventListener()}" name="navigation-start"></slot><cds-divider class="start-divider"></cds-divider></div>`:"",t}get visibleChildren(){return Array.from(this.allNavigationElements).filter((t=>o(t)))}addStartEventListener(){this.rootNavigationStart&&this.rootNavigationStart.addEventListener("click",this.toggle.bind(this))}firstUpdated(t){super.firstUpdated(t),this.allNavigationElements.forEach((t=>{s(t,["tabindex","-1"])}))}connectedCallback(){super.connectedCallback(),this.tabIndex=0,this.addEventListener("focus",this.initAriaActiveDescendant),this.addEventListener("keydown",this.keyboardNavigationHandler),this.addEventListener("blur",(()=>{this.currentActiveItem&&this.currentActiveItem.hasFocus&&x(this.currentActiveItem)})),this.addEventListener("expandedChange",this.setActiveItemFocus)}disconnectedCallback(){super.disconnectedCallback(),this.rootNavigationStart&&this.rootNavigationStart.removeEventListener("click",this.toggle.bind(this))}setActiveItemFocus(t){this.currentActiveItem&&t.target instanceof S&&f(this.currentActiveItem)}render(){return e`<nav class="private-host" aria-label="${this.i18n.navigationLabel}" cds-layout="${E}
                  wrap:none
                  align:horizontal-center">${this.startTemplate}<slot name="cds-navigation-substart"></slot><div class="navigation-body-wrapper" role="list" cds-layout="p-y:xxs"><div class="navigation-body" role="presentation" cds-layout="vertical wrap:none align:horizontal-stretch"><slot></slot></div></div>${this.endTemplate}</nav>`}updated(t){super.updated(t),t.has("expanded")&&(this.expandedRoot=this.expanded),this.updateChildrenProps()}updateChildrenProps(){this.navigationGroupItems&&r(Array.from(this.navigationGroupItems),this,{groupItem:!0}),this.navigationItemRefs&&r(Array.from(this.navigationItemRefs),this,{expanded:!0}),this.navigationStartRefs&&r(Array.from(this.navigationStartRefs),this,{expandedRoot:!0}),this.rootNavigationStart&&d(this.rootNavigationStart,this,{expanded:this.expanded}),this.rootNavigationItems.length>0&&r(Array.from(this.rootNavigationItems),this,{expanded:this.expanded}),this.navigationGroupRefs.length>0&&r(Array.from(this.navigationGroupRefs),this,{layout:!0})}static get styles(){return[c,I]}};t([v({type:String})],R.prototype,"cdsMotion",void 0),t([l()],R.prototype,"expandedChange",void 0),t([l()],R.prototype,"cdsMotionChange",void 0),t([h({type:Boolean})],R.prototype,"groupItem",void 0),t([v({type:String,reflect:!0,attribute:"aria-activedescendant"})],R.prototype,"ariaActiveDescendant",void 0),t([v({type:Boolean})],R.prototype,"expanded",void 0),t([p()],R.prototype,"i18n",void 0),t([g('[slot="cds-navigation-end"]',{assign:"cds-navigation-end"})],R.prototype,"navigationEnd",void 0),t([m("cds-navigation-start, cds-navigation-item:not([disabled])")],R.prototype,"allNavigationElements",void 0),t([m("cds-navigation-start")],R.prototype,"navigationStartRefs",void 0),t([m(":scope > cds-divider")],R.prototype,"rootDividers",void 0),t([m(":scope > cds-navigation-group")],R.prototype,"rootNavigationGroups",void 0),t([m(":scope > cds-navigation-item")],R.prototype,"rootNavigationItems",void 0),t([g(":scope > cds-navigation-start",{assign:"navigation-start"})],R.prototype,"rootNavigationStart",void 0),t([m(":scope > cds-navigation-group > cds-navigation-item")],R.prototype,"navigationGroupItems",void 0),t([m("cds-navigation-item")],R.prototype,"navigationItemRefs",void 0),t([m("cds-navigation-group")],R.prototype,"navigationGroupRefs",void 0),R=t([u({expanded:{true:C,false:A(C)}})],R);export{R as CdsNavigation,D as CdsNavigationTagName};
//# sourceMappingURL=navigation.element.js.map
