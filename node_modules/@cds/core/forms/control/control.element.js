import{__decorate as t}from"tslib";import{LitElement as e,html as i}from"lit";import{query as s}from"lit/decorators/query.js";import{getElementLanguageDirection as o,baseStyles as a,hasAriaLabelTypeAttr as l,syncProps as r,describeElementByElements as n,getElementUpdates as d,childrenUpdateComplete as p,pxToRem as u,updateComponentLayout as h,property as c,state as y,querySlot as f,querySlotAll as v,id as m,event as g}from"@cds/core/internal";import{ClarityIcons as b}from"@cds/core/icon/icon.service.js";import{exclamationCircleIcon as L}from"@cds/core/icon/shapes/exclamation-circle.js";import{checkCircleIcon as x}from"@cds/core/icon/shapes/check-circle.js";import C from"./control.element.scss.js";import{syncHTML5Validation as A}from"../utils/validate.js";import{defaultControlWidth as T,defaultFormLayout as $,getStatusIcon as S,associateInputAndLabel as k,associateInputToDatalist as I,getCurrentMessageStatus as B,controlIsWrapped as R,formLayouts as w}from"../utils/index.js";var z;!function(t){t.default="default",t.ariaLabel="aria-label",t.inputGroup="input-group",t.hiddenLabel="hidden-label"}(z||(z={}));class D extends e{constructor(){super(),this.status="neutral",this.controlWidth=T,this.validate=!1,this.responsive=!0,this._layout=$,this.focused=!1,this.disabled=!1,this.readonly=!1,this.fixedControlWidth=!1,this.supportsPrefixSuffixActions=!0,this.labelLayout=z.default,this.observers=[],b.addIcons(L,x)}get layout(){return this._layout}set layout(t){const e=this._layout;this._layout=t?t.replace("-inline",""):$,this.requestUpdate("layout",e)}get isRTL(){return"rtl"===o(this)}static get styles(){return[a,C]}get hasAriaLabelTypeAttr(){return l(this.inputControl)}get hasStatusIcon(){return this.labelLayout!==z.inputGroup&&("error"===this.status||"success"===this.status)}render(){var t;return i`${this.labelLayout===z.hiddenLabel||this.labelLayout===z.inputGroup?i`<span cds-layout="display:screen-reader-only"><slot name="label"></slot></span>`:""}<div cds-layout="${"vertical"===this.layout?"vertical gap:sm":"horizontal gap:lg"} align:stretch" class="private-host ${this.isRTL?"rtl":""}">${this.primaryLabelTemplate}<div class="input-message-container" cds-layout="
          wrap:none
          ${"compact"===this.layout?"horizontal":"vertical"}
          ${"stretch"!==this.controlWidth||this.fixedControlWidth?"":"align:horizontal-stretch"}
          ${(null===(t=this.messages)||void 0===t?void 0:t.length)?"gap:sm":""}"><div cds-layout="horizontal gap:sm wrap:none"><div cds-layout="horizontal align:top wrap:none ${"shrink"===this.controlWidth||this.fixedControlWidth?"align:shrink":"align:horizontal-stretch"}" class="${this.hasStatusIcon?"input-container with-status-icon":"input-container"}">${this.inputTemplate} ${this.prefixTemplate}<slot name="input"></slot>${this.suffixTemplate}</div>${this.hasStatusIcon?S(this.status):""}</div>${this.messagesTemplate}</div></div>`}get inputTemplate(){return i``}get prefixDefaultTemplate(){return null}get suffixDefaultTemplate(){return null}get isGenericControl(){return"cds-control"===this.tagName.toLowerCase()}get hasControlActions(){return this.controlActions.length>0||this.prefixDefaultTemplate||this.suffixDefaultTemplate}get primaryLabelTemplate(){return i`${this.labelLayout===z.default?i`<cds-internal-control-label .disabled="${this.disabled}" cds-layout="align:shrink align:top" action="primary"><slot name="label"></slot></cds-internal-control-label>`:""}`}get messagesTemplate(){return i`<div cds-layout="${"compact"===this.layout?"align:shrink":""}" class="messages"><slot name="message"></slot></div>`}get prefixTemplate(){return i`<div cds-layout="align:shrink align:vertical-center" class="prefix"><div cds-layout="horizontal gap:xs">${this.prefixDefaultTemplate}<slot name="prefix"></slot></div></div>`}get suffixTemplate(){return i`<div cds-layout="align:shrink align:vertical-center" class="suffix"><div cds-layout="horizontal gap:xs"><slot name="suffix"></slot>${this.suffixDefaultTemplate}</div></div>`}connectedCallback(){super.connectedCallback(),this.setAttribute("cds-control","")}firstUpdated(t){super.firstUpdated(t),k(this.inputControl,this.label,this.inputControlId),I(this.inputControl,this.datalistControl),this.setupHostAttributes(),this.setupHTML5Validation(),this.setActionOffsetPadding(),this.setupResponsive(),this.setupDescribedByUpdates(),this.setupLabelLayout(),this.assignSlotIfInControlGroup()}updated(t){super.updated(t),this.messages.forEach((e=>r(e,this,{disabled:t.has("disabled")}))),r(this.inputControl,this,{disabled:t.has("disabled")})}disconnectedCallback(){super.disconnectedCallback(),this.observers.forEach((t=>t.disconnect()))}setupDescribedByUpdates(){var t;null===(t=this.messageSlot)||void 0===t||t.addEventListener("slotchange",(async()=>{n(this.inputControl,Array.from(this.messages)),B(Array.from(this.messages)).then((t=>this.status=t))}))}setupHostAttributes(){this.inputControl.addEventListener("focusin",(()=>this.focused=!0)),this.inputControl.addEventListener("focusout",(()=>this.focused=!1)),this.observers.push(d(this.inputControl,"disabled",(t=>this.disabled=""===t||t)),d(this.inputControl,"aria-disabled",(t=>this.disabled="true"===t)),d(this.inputControl,"readonly",(t=>this.readonly=""===t||t)))}setupHTML5Validation(){var t,e;!(null===(e=null===(t=this.inputControl)||void 0===t?void 0:t.form)||void 0===e?void 0:e.noValidate)&&this.validate&&A(this,Array.from(this.messages))}async setActionOffsetPadding(){if(await p(this.controlActions),!this.isGenericControl&&this.supportsPrefixSuffixActions&&this.hasControlActions){const t=u(this.prefixAction.getBoundingClientRect().width+6),e=u(this.suffixAction.getBoundingClientRect().width+6);this.inputControl.style.setProperty("padding-left",this.isRTL?e:t,"important"),this.inputControl.style.setProperty("padding-right",this.isRTL?t:e,"important")}}get layoutStable(){return this.labelLayout!==z.default||!R(this.inputControl,this.controlLabel,this.layout)}setupResponsive(){if(this.responsive&&this.labelLayout===z.default&&this.controlLabel){const t={layouts:w,initialLayout:this.layout},e=h(this,t,(()=>this.layoutChange.emit(this.layout,{bubbles:!0})));this.observers.push(e)}}setupLabelLayout(){var t,e;(null===(e=null===(t=this.label)||void 0===t?void 0:t.getAttribute("cds-layout"))||void 0===e?void 0:e.includes("display:screen-reader-only"))&&(this.labelLayout=z.hiddenLabel),this.hasAriaLabelTypeAttr&&(this.labelLayout=z.ariaLabel)}assignSlotIfInControlGroup(){var t;(null===(t=this.parentElement)||void 0===t?void 0:t.hasAttribute("cds-control-group"))&&this.setAttribute("slot","controls")}}t([c({type:String})],D.prototype,"status",void 0),t([c({type:String})],D.prototype,"controlWidth",void 0),t([c({type:Boolean})],D.prototype,"validate",void 0),t([c({type:Boolean})],D.prototype,"responsive",void 0),t([c({type:String})],D.prototype,"layout",null),t([y({type:Boolean,reflect:!0})],D.prototype,"focused",void 0),t([y({type:Boolean,reflect:!0})],D.prototype,"disabled",void 0),t([y({type:Boolean,reflect:!0})],D.prototype,"readonly",void 0),t([y()],D.prototype,"fixedControlWidth",void 0),t([y()],D.prototype,"supportsPrefixSuffixActions",void 0),t([y()],D.prototype,"isRTL",null),t([y()],D.prototype,"labelLayout",void 0),t([f("input, select, textarea, [cds-control]",{required:"error",requiredMessage:"input element is missing",assign:"input"})],D.prototype,"inputControl",void 0),t([f("label",{required:"error",requiredMessage:"To meet a11y standards either a <label> or input[aria-label] should be provided.",assign:"label",exemptOn:t=>t.hasAriaLabelTypeAttr})],D.prototype,"label",void 0),t([s("cds-internal-control-label[action=primary]")],D.prototype,"controlLabel",void 0),t([f("datalist")],D.prototype,"datalistControl",void 0),t([v("cds-control-message")],D.prototype,"messages",void 0),t([v("cds-control-action")],D.prototype,"controlActions",void 0),t([m()],D.prototype,"inputControlId",void 0),t([s(".prefix")],D.prototype,"prefixAction",void 0),t([s(".suffix")],D.prototype,"suffixAction",void 0),t([s(".messages")],D.prototype,"messageSlot",void 0),t([g()],D.prototype,"layoutChange",void 0);export{D as CdsControl,z as ControlLabelLayout};
//# sourceMappingURL=control.element.js.map
