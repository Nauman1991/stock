!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("@vendure/admin-ui/core"),require("@angular/forms"),require("@angular/router"),require("rxjs"),require("rxjs/operators"),require("@biesbjerg/ngx-translate-extract-marker")):"function"==typeof define&&define.amd?define("@vendure/admin-ui/system",["exports","@angular/core","@vendure/admin-ui/core","@angular/forms","@angular/router","rxjs","rxjs/operators","@biesbjerg/ngx-translate-extract-marker"],r):r(((e="undefined"!=typeof globalThis?globalThis:e||self).vendure=e.vendure||{},e.vendure["admin-ui"]=e.vendure["admin-ui"]||{},e.vendure["admin-ui"].system={}),e.ng.core,e.vendure["admin-ui"].core,e.ng.forms,e.ng.router,e.rxjs,e.rxjs.operators,e.ngxTranslateExtractMarker)}(this,(function(e,r,t,n,a,o,s,l){"use strict";var c=function(e){this.healthCheckService=e};c.decorators=[{type:r.Component,args:[{selector:"vdr-health-check",template:'<vdr-action-bar>\r\n    <vdr-ab-left>\r\n        <div class="system-status-header" *ngIf="healthCheckService.status$ | async as status">\r\n            <div class="status-icon">\r\n                <clr-icon\r\n                    [attr.shape]="status === \'ok\' ? \'check-circle\' : \'exclamation-circle\'"\r\n                    [ngClass]="{ \'is-success\': status === \'ok\', \'is-danger\': status !== \'ok\' }"\r\n                    size="48"\r\n                ></clr-icon>\r\n            </div>\r\n            <div class="status-detail">\r\n                <ng-container *ngIf="status === \'ok\'; else error">\r\n                    {{ \'system.health-all-systems-up\' | translate }}\r\n                </ng-container>\r\n                <ng-template #error>\r\n                    {{ \'system.health-error\' | translate }}\r\n                </ng-template>\r\n                <div class="last-checked">\r\n                    {{ \'system.health-last-checked\' | translate }}:\r\n                    {{ healthCheckService.lastCheck$ | async | localeDate: \'mediumTime\' }}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </vdr-ab-left>\r\n    <vdr-ab-right>\r\n        <vdr-action-bar-items locationId="system-status"></vdr-action-bar-items>\r\n        <button class="btn btn-secondary" (click)="healthCheckService.refresh()">\r\n            <clr-icon shape="refresh"></clr-icon> {{ \'system.health-refresh\' | translate }}\r\n        </button>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n\r\n<table class="table">\r\n    <thead>\r\n        <tr>\r\n            <th class="left">\r\n                {{ \'common.name\' | translate }}\r\n            </th>\r\n            <th class="left">\r\n                {{ \'system.health-status\' | translate }}\r\n            </th>\r\n            <th class="left">\r\n                {{ \'system.health-message\' | translate }}\r\n            </th>\r\n        </tr>\r\n    </thead>\r\n    <tbody>\r\n        <tr *ngFor="let row of healthCheckService.details$ | async">\r\n            <td class="align-middle left">{{ row.key }}</td>\r\n            <td class="align-middle left">\r\n                <vdr-chip [colorType]="row.result.status === \'up\' ? \'success\' : \'error\'">\r\n                    <ng-container *ngIf="row.result.status === \'up\'; else down">\r\n                        <clr-icon shape="check-circle"></clr-icon>\r\n                        {{ \'system.health-status-up\' | translate }}\r\n                    </ng-container>\r\n                    <ng-template #down>\r\n                        <clr-icon shape="exclamation-circle"></clr-icon>\r\n                        {{ \'system.health-status-down\' | translate }}\r\n                    </ng-template>\r\n                </vdr-chip>\r\n            </td>\r\n            <td class="align-middle left">{{ row.result.message }}</td>\r\n        </tr>\r\n    </tbody>\r\n</table>\r\n',changeDetection:r.ChangeDetectionStrategy.OnPush,styles:[".system-status-header{display:flex;justify-content:space-between;align-items:flex-start}.system-status-header .status-detail{font-weight:700}.system-status-header .last-checked{font-weight:400;color:var(--color-grey-500)}"]}]}],c.ctorParameters=function(){return[{type:t.HealthCheckService}]};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var i=function(e,r){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])})(e,r)};Object.create;function d(e,r){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var n,a,o=t.call(e),s=[];try{for(;(void 0===r||r-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){a={error:e}}finally{try{n&&!n.done&&(t=o.return)&&t.call(o)}finally{if(a)throw a.error}}return s}function u(){for(var e=[],r=0;r<arguments.length;r++)e=e.concat(d(arguments[r]));return e}Object.create;var m=function(e){function r(r,a,o,s,l){var c=e.call(this,s,l)||this;return c.dataService=r,c.modalService=a,c.notificationService=o,c.liveUpdate=new n.FormControl(!0),c.hideSettled=new n.FormControl(!0),c.queueFilter=new n.FormControl("all"),e.prototype.setQueryFn.call(c,(function(){for(var e,r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return(e=c.dataService.settings).getAllJobs.apply(e,u(r))}),(function(e){return e.jobs}),(function(e,r){var n="all"===c.queueFilter.value?null:{queueName:{eq:c.queueFilter.value}},a=c.hideSettled.value;return{options:{skip:e,take:r,filter:Object.assign(Object.assign({},n),a?{isSettled:{eq:!1}}:{}),sort:{createdAt:t.SortOrder.DESC}}}})),c}return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function t(){this.constructor=e}i(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}(r,e),r.prototype.ngOnInit=function(){var r=this;e.prototype.ngOnInit.call(this),o.timer(5e3,2e3).pipe(s.takeUntil(this.destroy$),s.filter((function(){return r.liveUpdate.value}))).subscribe((function(){r.refresh()})),this.queues$=this.dataService.settings.getJobQueues().mapStream((function(e){return e.jobQueues})).pipe(s.map((function(e){return u([{name:"all",running:!0}],e)})))},r.prototype.hasResult=function(e){var r=e.result;return null!=r&&("object"!=typeof r||Object.keys(r).length>0)},r.prototype.cancelJob=function(e){var r=this;this.dataService.settings.cancelJob(e).subscribe((function(){return r.refresh()}))},r}(t.BaseListComponent);m.decorators=[{type:r.Component,args:[{selector:"vdr-job-list",template:'<vdr-action-bar>\r\n    <vdr-ab-left>\r\n        <clr-checkbox-container>\r\n            <clr-checkbox-wrapper>\r\n                <input type="checkbox" clrCheckbox [formControl]="liveUpdate" name="live-update"/>\r\n                <label>{{ \'common.live-update\' | translate }}</label>\r\n            </clr-checkbox-wrapper>\r\n            <clr-checkbox-wrapper>\r\n                <input\r\n                    type="checkbox"\r\n                    clrCheckbox\r\n                    [formControl]="hideSettled"\r\n                    name="hide-settled"\r\n                    (change)="refresh()"\r\n                />\r\n                <label>{{ \'system.hide-settled-jobs\' | translate }}</label>\r\n            </clr-checkbox-wrapper>\r\n        </clr-checkbox-container>\r\n    </vdr-ab-left>\r\n    <vdr-ab-right>\r\n        <ng-select\r\n            [addTag]="false"\r\n            [items]="queues$ | async"\r\n            [hideSelected]="true"\r\n            [multiple]="false"\r\n            [markFirst]="false"\r\n            [clearable]="false"\r\n            [searchable]="false"\r\n            bindValue="name"\r\n            [formControl]="queueFilter"\r\n            (change)="refresh()"\r\n        >\r\n            <ng-template ng-label-tmp ng-option-tmp let-item="item">\r\n                <ng-container *ngIf="item.name === \'all\'; else others">\r\n                    {{ \'system.all-job-queues\' | translate }}\r\n                </ng-container>\r\n                <ng-template #others>\r\n                    <vdr-chip [colorFrom]="item.name">{{ item.name }}</vdr-chip>\r\n                </ng-template>\r\n            </ng-template>\r\n        </ng-select>\r\n        <vdr-action-bar-items locationId="job-list"></vdr-action-bar-items>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n\r\n<vdr-data-table\r\n    [items]="items$ | async"\r\n    [itemsPerPage]="itemsPerPage$ | async"\r\n    [totalItems]="totalItems$ | async"\r\n    [currentPage]="currentPage$ | async"\r\n    (pageChange)="setPageNumber($event)"\r\n    (itemsPerPageChange)="setItemsPerPage($event)"\r\n>\r\n    <vdr-dt-column></vdr-dt-column>\r\n    <vdr-dt-column>{{ \'system.job-queue-name\' | translate }}</vdr-dt-column>\r\n    <vdr-dt-column>{{ \'common.created-at\' | translate }}</vdr-dt-column>\r\n    <vdr-dt-column>{{ \'system.job-state\' | translate }}</vdr-dt-column>\r\n    <vdr-dt-column>{{ \'system.job-duration\' | translate }}</vdr-dt-column>\r\n    <vdr-dt-column>{{ \'system.job-result\' | translate }}</vdr-dt-column>\r\n    <vdr-dt-column></vdr-dt-column>\r\n    <ng-template let-job="item">\r\n        <td class="left align-middle">\r\n            <vdr-entity-info [entity]="job"></vdr-entity-info>\r\n        </td>\r\n        <td class="left align-middle">\r\n            <vdr-dropdown *ngIf="job.data">\r\n                <button\r\n                    class="btn btn-link btn-icon"\r\n                    vdrDropdownTrigger\r\n                    [title]="\'system.job-data\' | translate"\r\n                >\r\n                    <clr-icon shape="details"></clr-icon>\r\n                </button>\r\n                <vdr-dropdown-menu>\r\n                    <div class="result-detail">\r\n                        <vdr-object-tree [value]="job.data"></vdr-object-tree>\r\n                    </div>\r\n                </vdr-dropdown-menu>\r\n            </vdr-dropdown>\r\n            <vdr-chip [colorFrom]="job.queueName">{{ job.queueName }}</vdr-chip>\r\n        </td>\r\n\r\n        <td class="left align-middle">{{ job.createdAt | timeAgo }}</td>\r\n        <td class="left align-middle">\r\n            <vdr-job-state-label [job]="job"></vdr-job-state-label>\r\n        </td>\r\n        <td class="left align-middle">{{ job.duration | duration }}</td>\r\n        <td class="left align-middle">\r\n            <vdr-dropdown *ngIf="hasResult(job)">\r\n                <button class="btn btn-link btn-sm details-button" vdrDropdownTrigger>\r\n                    <clr-icon shape="details"></clr-icon>\r\n                    {{ \'system.job-result\' | translate }}\r\n                </button>\r\n                <vdr-dropdown-menu>\r\n                    <div class="result-detail">\r\n                        <vdr-object-tree [value]="job.result"></vdr-object-tree>\r\n                    </div>\r\n                </vdr-dropdown-menu>\r\n            </vdr-dropdown>\r\n            <vdr-dropdown *ngIf="job.error">\r\n                <button class="btn btn-link btn-sm details-button" vdrDropdownTrigger>\r\n                    <clr-icon shape="exclamation-circle"></clr-icon>\r\n                    {{ \'system.job-error\' | translate }}\r\n                </button>\r\n                <vdr-dropdown-menu>\r\n                    <div class="result-detail">\r\n                        {{ job.error }}\r\n                    </div>\r\n                </vdr-dropdown-menu>\r\n            </vdr-dropdown>\r\n        </td>\r\n        <td class="right align-middle">\r\n            <vdr-dropdown *ngIf="!job.isSettled && job.state !== \'FAILED\'">\r\n                <button class="icon-button" vdrDropdownTrigger>\r\n                    <clr-icon shape="ellipsis-vertical"></clr-icon>\r\n                </button>\r\n                <vdr-dropdown-menu vdrPosition="bottom-right">\r\n                    <button\r\n                        type="button"\r\n                        class="delete-button"\r\n                        (click)="cancelJob(job.id)"\r\n                        [disabled]="!([\'DeleteSettings\', \'DeleteSystem\'] | hasPermission)"\r\n                        vdrDropdownItem\r\n                    >\r\n                        <clr-icon shape="ban" class="is-danger"></clr-icon>\r\n                        {{ \'common.cancel\' | translate }}\r\n                    </button>\r\n                </vdr-dropdown-menu>\r\n            </vdr-dropdown>\r\n        </td>\r\n    </ng-template>\r\n</vdr-data-table>\r\n',changeDetection:r.ChangeDetectionStrategy.OnPush,styles:[".result-detail{margin:0 12px}"]}]}],m.ctorParameters=function(){return[{type:t.DataService},{type:t.ModalService},{type:t.NotificationService},{type:a.Router},{type:a.ActivatedRoute}]};var b=function(){function e(){}return Object.defineProperty(e.prototype,"iconShape",{get:function(){switch(this.job.state){case t.JobState.COMPLETED:return"check-circle";case t.JobState.FAILED:return"exclamation-circle";case t.JobState.CANCELLED:return"ban";case t.JobState.PENDING:case t.JobState.RETRYING:return"hourglass";case t.JobState.RUNNING:return"sync"}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorType",{get:function(){switch(this.job.state){case t.JobState.COMPLETED:return"success";case t.JobState.FAILED:case t.JobState.CANCELLED:return"error";case t.JobState.PENDING:case t.JobState.RETRYING:return"";case t.JobState.RUNNING:return"warning"}},enumerable:!1,configurable:!0}),e}();b.decorators=[{type:r.Component,args:[{selector:"vdr-job-state-label",template:'<vdr-chip [colorType]="colorType">\r\n    <clr-icon [attr.shape]="iconShape"></clr-icon>\r\n    {{ job.state | titlecase }}\r\n    <span *ngIf="job.state === \'RUNNING\'" class="progress">\r\n        {{ (job.progress / 100) | percent }}\r\n    </span>\r\n</vdr-chip>\r\n',changeDetection:r.ChangeDetectionStrategy.OnPush,styles:[".progress{margin-left:3px}clr-icon{min-width:12px}"]}]}],b.propDecorators={job:[{type:r.Input}]};var p={breadcrumb:l.marker("breadcrumb.job-queue")},h={breadcrumb:l.marker("breadcrumb.system-status")},v=[{path:"jobs",component:m,data:p},{path:"system-status",component:c,data:h}],g=function(){};g.decorators=[{type:r.NgModule,args:[{declarations:[c,m,b],imports:[t.SharedModule,a.RouterModule.forChild(v)]}]}],e.HealthCheckComponent=c,e.JobListComponent=m,e.JobStateLabelComponent=b,e.SystemModule=g,e.systemRoutes=v,e.ɵ0=p,e.ɵ1=h,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=vendure-admin-ui-system.umd.min.js.map