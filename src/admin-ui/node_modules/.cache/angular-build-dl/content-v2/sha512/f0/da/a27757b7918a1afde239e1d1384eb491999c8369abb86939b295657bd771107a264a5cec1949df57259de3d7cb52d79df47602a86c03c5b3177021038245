(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"2VDt":function(e,t,c){"use strict";c.r(t),c.d(t,"AddManualPaymentDialogComponent",function(){return sn}),c.d(t,"CancelOrderDialogComponent",function(){return un}),c.d(t,"FulfillOrderDialogComponent",function(){return fn}),c.d(t,"FulfillmentCardComponent",function(){return mn}),c.d(t,"FulfillmentDetailComponent",function(){return bn}),c.d(t,"FulfillmentStateLabelComponent",function(){return pn}),c.d(t,"LineFulfillmentComponent",function(){return gn}),c.d(t,"LineRefundsComponent",function(){return yn}),c.d(t,"ModificationDetailComponent",function(){return hn}),c.d(t,"NODE_HEIGHT",function(){return An}),c.d(t,"OrderCustomFieldsCardComponent",function(){return vn}),c.d(t,"OrderDetailComponent",function(){return In}),c.d(t,"OrderEditResultType",function(){return En}),c.d(t,"OrderEditorComponent",function(){return Pn}),c.d(t,"OrderEditsPreviewDialogComponent",function(){return Sn}),c.d(t,"OrderHistoryComponent",function(){return Mn}),c.d(t,"OrderListComponent",function(){return Fn}),c.d(t,"OrderModule",function(){return Gn}),c.d(t,"OrderPaymentCardComponent",function(){return wn}),c.d(t,"OrderProcessEdgeComponent",function(){return _n}),c.d(t,"OrderProcessGraphComponent",function(){return jn}),c.d(t,"OrderProcessGraphDialogComponent",function(){return Cn}),c.d(t,"OrderProcessNodeComponent",function(){return zn}),c.d(t,"OrderResolver",function(){return $n}),c.d(t,"OrderStateSelectDialogComponent",function(){return Tn}),c.d(t,"OrderTableComponent",function(){return Zn}),c.d(t,"OrderTransitionService",function(){return kn}),c.d(t,"PaymentDetailComponent",function(){return Dn}),c.d(t,"PaymentStateLabelComponent",function(){return Ln}),c.d(t,"RefundOrderDialogComponent",function(){return On}),c.d(t,"RefundStateLabelComponent",function(){return Rn}),c.d(t,"SettleRefundDialogComponent",function(){return xn}),c.d(t,"SimpleItemListComponent",function(){return Nn}),c.d(t,"modifyingOrderBreadcrumb",function(){return Un}),c.d(t,"orderBreadcrumb",function(){return Hn}),c.d(t,"orderRoutes",function(){return Qn}),c.d(t,"\u02750",function(){return qn}),c.d(t,"\u02751",function(){return Vn}),c.d(t,"\u02752",function(){return Wn});var n=c("EM62"),r=c("nIj0"),i=c("ixhn"),o=c("OxKu"),d=c("hG4v"),l=c("sEIs"),a=c("6Oco"),s=c("ZTXN"),u=c("ROBh"),f=c("g6G6"),m=c("C05f"),b=c("TLy2"),p=c("4e/d"),g=c("uCWR");class y{constructor(e,t){this.notifier=e,this.source=t}call(e,t){return t.subscribe(new h(e,this.notifier,this.source))}}class h extends g.b{constructor(e,t,c){super(e),this.notifier=t,this.source=c}error(e){if(!this.isStopped){let c=this.errors,n=this.retries,r=this.retriesSubscription;if(n)this.errors=void 0,this.retriesSubscription=void 0;else{c=new s.a;try{const{notifier:e}=this;n=e(c)}catch(t){return super.error(t)}r=Object(g.c)(n,new g.a(this))}this._unsubscribeAndRecycle(),this.errors=c,this.retries=n,this.retriesSubscription=r,c.next(e)}}_unsubscribe(){const{errors:e,retriesSubscription:t}=this;e&&(e.unsubscribe(),this.errors=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0}notifyNext(){const{_unsubscribe:e}=this;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=e,this.source.subscribe(this)}}var v=c("BwBJ"),T=c("J+dc"),k=c("YtkY"),C=c("jIqt"),O=c("7SLS"),x=c("kuMc"),I=c("wqq/"),E=c("Ohay"),S=c("xVbo"),P=c("mWib"),M=c("8j5Y"),F=c("jY47"),w=c("s2Ay"),A=c("2kYt"),z=c("Kej3"),_=c("E5oP");function j(e,t){1&e&&(n.bd(0),n.yc(1,"translate")),2&e&&n.cd(n.zc(1,1,"order.add-payment-to-order"))}function Z(e,t){if(1&e){const e=n.mc();n.lc(0,"button",7),n.vc("click",function(){n.Sc(e);return n.xc().cancel()}),n.bd(1),n.yc(2,"translate"),n.kc(),n.lc(3,"button",8),n.vc("click",function(){n.Sc(e);return n.xc().submit()}),n.bd(4),n.yc(5,"translate"),n.yc(6,"localeCurrency"),n.kc()}if(2&e){const e=n.xc();n.Tb(1),n.cd(n.zc(2,4,"common.cancel")),n.Tb(2),n.Ec("disabled",e.form.invalid||e.form.pristine),n.Tb(1),n.ed(" ",n.zc(5,6,"order.add-payment")," (",n.Ac(6,8,e.outstandingAmount,e.currencyCode),") ")}}function D(e,t){1&e&&(n.bd(0),n.yc(1,"translate")),2&e&&n.cd(n.zc(1,1,"order.cancel-order"))}function L(e,t){if(1&e){const e=n.mc();n.lc(0,"input",18),n.vc("ngModelChange",function(t){n.Sc(e);const c=n.xc().$implicit;return n.xc().lineQuantities[c.id]=t}),n.kc()}if(2&e){const e=n.xc().$implicit,t=n.xc();n.Ec("ngModel",t.lineQuantities[e.id])("max",e.quantity)}}function R(e,t){if(1&e&&n.bd(0),2&e){const e=n.xc().$implicit;n.cd(e.quantity)}}function N(e,t){if(1&e&&(n.lc(0,"tr",9),n.lc(1,"td",10),n.gc(2,"img",11),n.yc(3,"assetPreview"),n.kc(),n.lc(4,"td",12),n.bd(5),n.kc(),n.lc(6,"td",13),n.bd(7),n.kc(),n.lc(8,"td",14),n.bd(9),n.kc(),n.lc(10,"td",14),n.bd(11),n.yc(12,"localeCurrency"),n.kc(),n.lc(13,"td",15),n.Zc(14,L,1,2,"input",16),n.Zc(15,R,1,1,"ng-template",null,17,n.ad),n.kc(),n.kc()),2&e){const e=t.$implicit,c=n.Oc(16),r=n.xc();n.Xb("is-cancelled",0===e.quantity),n.Tb(2),n.Ec("src",n.Ac(3,9,e.featuredAsset,"tiny"),n.Uc),n.Tb(3),n.cd(e.productVariant.name),n.Tb(2),n.cd(e.productVariant.sku),n.Tb(2),n.cd(e.quantity),n.Tb(2),n.dd(" ",n.Ac(12,12,e.unitPriceWithTax,r.order.currencyCode)," "),n.Tb(3),n.Ec("ngIf",e.quantity>0&&!r.order.active)("ngIfElse",c)}}function $(e,t){1&e&&(n.jc(0),n.bd(1),n.yc(2,"translate"),n.ic()),2&e&&(n.Tb(1),n.dd(" ",n.zc(2,1,"order.cancel-selected-items")," "))}function q(e,t){1&e&&(n.jc(0),n.bd(1),n.yc(2,"translate"),n.ic()),2&e&&(n.Tb(1),n.dd(" ",n.zc(2,1,"order.cancel-order")," "))}function V(e,t){if(1&e){const e=n.mc();n.lc(0,"button",19),n.vc("click",function(){n.Sc(e);return n.xc().cancel()}),n.bd(1),n.yc(2,"translate"),n.kc(),n.lc(3,"button",20),n.vc("click",function(){n.Sc(e);return n.xc().select()}),n.Zc(4,$,3,3,"ng-container",21),n.Zc(5,q,3,3,"ng-container",21),n.kc()}if(2&e){const e=n.xc();n.Tb(1),n.cd(n.zc(2,4,"common.cancel")),n.Tb(2),n.Ec("disabled",!e.reason||!e.order.active&&0===e.selectionCount),n.Tb(1),n.Ec("ngIf",!e.order.active),n.Tb(1),n.Ec("ngIf",e.order.active)}}function W(e,t){1&e&&(n.bd(0),n.yc(1,"translate")),2&e&&n.cd(n.zc(1,1,"order.fulfill-order"))}function Q(e,t){if(1&e&&(n.gc(0,"img",17),n.yc(1,"assetPreview")),2&e){const e=n.xc().$implicit;n.Ec("src",n.Ac(1,1,e.featuredAsset,"tiny"),n.Uc)}}function H(e,t){if(1&e){const e=n.mc();n.lc(0,"input",18),n.vc("ngModelChange",function(t){n.Sc(e);const c=n.xc().$implicit;return n.xc().fulfillmentQuantities[c.id].fulfillCount=t}),n.kc()}if(2&e){const e=n.xc().$implicit,t=n.xc();n.Ec("disabled",0===t.getUnfulfilledCount(e))("ngModel",t.fulfillmentQuantities[e.id].fulfillCount)("max",t.fulfillmentQuantities[e.id].max)}}function U(e,t){if(1&e&&(n.lc(0,"tr",9),n.lc(1,"td",10),n.Zc(2,Q,2,4,"img",11),n.kc(),n.lc(3,"td",12),n.bd(4),n.kc(),n.lc(5,"td",13),n.bd(6),n.kc(),n.lc(7,"td",14),n.bd(8),n.kc(),n.lc(9,"td",14),n.bd(10),n.kc(),n.lc(11,"td",15),n.Zc(12,H,1,3,"input",16),n.kc(),n.kc()),2&e){const e=t.$implicit,c=n.xc();n.Xb("ignore",0===c.getUnfulfilledCount(e)),n.Tb(2),n.Ec("ngIf",e.featuredAsset),n.Tb(2),n.cd(e.productVariant.name),n.Tb(2),n.cd(e.productVariant.sku),n.Tb(2),n.cd(c.getUnfulfilledCount(e)),n.Tb(2),n.cd(e.productVariant.stockOnHand),n.Tb(2),n.Ec("ngIf",c.fulfillmentQuantities[e.id])}}function G(e,t){if(1&e){const e=n.mc();n.lc(0,"button",19),n.vc("click",function(){n.Sc(e);return n.xc().cancel()}),n.bd(1),n.yc(2,"translate"),n.kc(),n.lc(3,"button",20),n.vc("click",function(){n.Sc(e);return n.xc().select()}),n.bd(4),n.yc(5,"translate"),n.kc()}if(2&e){const e=n.xc();n.Tb(1),n.cd(n.zc(2,3,"common.cancel")),n.Tb(2),n.Ec("disabled",!e.canSubmit()),n.Tb(1),n.dd(" ",n.zc(5,5,"order.create-fulfillment")," ")}}function B(e,t){if(1&e&&n.gc(0,"vdr-fulfillment-detail",7),2&e){const e=n.xc();n.Ec("fulfillmentId",null==e.fulfillment?null:e.fulfillment.id)("order",e.order)}}const J=function(e){return{state:e}};function X(e,t){if(1&e){const e=n.mc();n.jc(0),n.lc(1,"button",14),n.vc("click",function(){n.Sc(e);const c=t.ngIf;return n.xc(2).transitionState.emit(c)}),n.bd(2),n.yc(3,"translate"),n.yc(4,"translate"),n.yc(5,"stateI18nToken"),n.kc(),n.ic()}if(2&e){const e=t.ngIf;n.Tb(2),n.dd(" ",n.Ac(3,1,"order.set-fulfillment-state",n.Ic(8,J,n.zc(4,4,n.zc(5,6,e))))," ")}}function Y(e,t){if(1&e&&(n.jc(0),n.gc(1,"clr-icon",18),n.bd(2),n.yc(3,"translate"),n.yc(4,"translate"),n.yc(5,"stateI18nToken"),n.ic()),2&e){const e=n.xc().$implicit;n.Tb(2),n.dd(" ",n.Ac(3,1,"order.transition-to-state",n.Ic(8,J,n.zc(4,4,n.zc(5,6,e))))," ")}}function K(e,t){1&e&&(n.gc(0,"clr-icon",19),n.bd(1),n.yc(2,"translate")),2&e&&(n.Tb(1),n.dd(" ",n.zc(2,1,"order.cancel-fulfillment")," "))}function ee(e,t){if(1&e){const e=n.mc();n.jc(0),n.lc(1,"button",15),n.vc("click",function(){n.Sc(e);const c=t.$implicit;return n.xc(2).transitionState.emit(c)}),n.Zc(2,Y,6,10,"ng-container",16),n.Zc(3,K,3,3,"ng-template",null,17,n.ad),n.kc(),n.ic()}if(2&e){const e=t.$implicit,c=n.Oc(4);n.Tb(2),n.Ec("ngIf","Cancelled"!==e)("ngIfElse",c)}}function te(e,t){if(1&e&&(n.lc(0,"div",8),n.Zc(1,X,6,10,"ng-container",9),n.lc(2,"vdr-dropdown"),n.lc(3,"button",10),n.gc(4,"clr-icon",11),n.kc(),n.lc(5,"vdr-dropdown-menu",12),n.Zc(6,ee,5,2,"ng-container",13),n.kc(),n.kc(),n.kc()),2&e){const e=n.xc();n.Tb(1),n.Ec("ngIf",e.nextSuggestedState()),n.Tb(5),n.Ec("ngForOf",e.nextOtherStates())}}function ce(e,t){if(1&e&&(n.lc(0,"vdr-labeled-data",0),n.yc(1,"translate"),n.bd(2),n.kc()),2&e){const e=n.xc();n.Ec("label",n.zc(1,2,"order.tracking-code")),n.Tb(2),n.dd(" ",null==e.fulfillment?null:e.fulfillment.trackingCode,"\n")}}function ne(e,t){if(1&e&&n.gc(0,"vdr-custom-field-control",5),2&e){const e=n.xc().$implicit,t=n.xc();n.Ec("readonly",!0)("compact",!0)("customField",e)("customFieldsFormGroup",t.customFieldFormGroup)}}function re(e,t){if(1&e&&(n.jc(0),n.Zc(1,ne,1,4,"vdr-custom-field-control",4),n.ic()),2&e){const e=t.$implicit,c=n.xc();n.Tb(1),n.Ec("ngIf",c.customFieldFormGroup.get(e.name))}}function ie(e,t){1&e&&n.gc(0,"clr-icon",2)}function oe(e,t){1&e&&n.gc(0,"clr-icon",9)}function de(e,t){1&e&&n.gc(0,"clr-icon",10)}function le(e,t){1&e&&n.gc(0,"clr-icon",11)}function ae(e,t){1&e&&(n.lc(0,"label",12),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.dd(" ",n.zc(2,1,"order.line-fulfillment-all")," "))}const se=function(e,t){return{total:e,count:t}};function ue(e,t){if(1&e&&(n.lc(0,"label",12),n.bd(1),n.yc(2,"translate"),n.kc()),2&e){const e=n.xc(2);n.Tb(1),n.dd(" ",n.Ac(2,1,"order.line-fulfillment-partial",n.Jc(4,se,e.line.quantity,e.fulfilledCount))," ")}}function fe(e,t){1&e&&(n.lc(0,"label",12),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.dd(" ",n.zc(2,1,"order.line-fulfillment-none")," "))}function me(e,t){if(1&e&&(n.lc(0,"vdr-labeled-data",15),n.yc(1,"translate"),n.bd(2),n.kc()),2&e){const e=n.xc().$implicit;n.Ec("label",n.zc(1,2,"order.tracking-code")),n.Tb(2),n.dd(" ",e.fulfillment.trackingCode," ")}}const be=function(e){return{count:e}};function pe(e,t){if(1&e&&(n.lc(0,"div",13),n.lc(1,"div",14),n.bd(2),n.yc(3,"translate"),n.yc(4,"translate"),n.kc(),n.lc(5,"vdr-labeled-data",15),n.yc(6,"translate"),n.bd(7),n.yc(8,"localeDate"),n.kc(),n.lc(9,"vdr-labeled-data",15),n.yc(10,"translate"),n.bd(11),n.kc(),n.Zc(12,me,3,4,"vdr-labeled-data",16),n.kc()),2&e){const e=t.$implicit;n.Tb(2),n.fd(" ",n.zc(3,8,"order.fulfillment")," #",e.fulfillment.id," (",n.Ac(4,10,"order.item-count",n.Ic(20,be,e.count)),") "),n.Tb(3),n.Ec("label",n.zc(6,13,"common.created-at")),n.Tb(2),n.dd(" ",n.Ac(8,15,e.fulfillment.createdAt,"medium")," "),n.Tb(2),n.Ec("label",n.zc(10,18,"order.fulfillment-method")),n.Tb(2),n.dd(" ",e.fulfillment.method," "),n.Tb(1),n.Ec("ngIf",e.fulfillment.trackingCode)}}function ge(e,t){if(1&e&&(n.lc(0,"vdr-dropdown",1),n.lc(1,"button",2),n.Zc(2,oe,1,0,"clr-icon",3),n.Zc(3,de,1,0,"clr-icon",4),n.Zc(4,le,1,0,"clr-icon",5),n.kc(),n.lc(5,"vdr-dropdown-menu",6),n.Zc(6,ae,3,3,"label",7),n.Zc(7,ue,3,7,"label",7),n.Zc(8,fe,3,3,"label",7),n.Zc(9,pe,13,22,"div",8),n.kc(),n.kc()),2&e){const e=n.xc();n.Tb(2),n.Ec("ngIf","full"===e.fulfillmentStatus),n.Tb(1),n.Ec("ngIf","partial"===e.fulfillmentStatus),n.Tb(1),n.Ec("ngIf","none"===e.fulfillmentStatus),n.Tb(2),n.Ec("ngIf","full"===e.fulfillmentStatus),n.Tb(1),n.Ec("ngIf","partial"===e.fulfillmentStatus),n.Tb(1),n.Ec("ngIf","none"===e.fulfillmentStatus),n.Tb(1),n.Ec("ngForOf",e.fulfillments)}}function ye(e,t){if(1&e&&(n.lc(0,"span",1),n.yc(1,"translate"),n.gc(2,"clr-icon",2),n.kc()),2&e){const e=n.xc();n.Ec("title",n.Ac(1,1,"order.refunded-count",n.Ic(4,be,e.getRefundedCount())))}}function he(e,t){if(1&e&&(n.lc(0,"vdr-labeled-data",0),n.yc(1,"translate"),n.bd(2),n.kc()),2&e){const e=n.xc();n.Ec("label",n.zc(1,2,"order.note")),n.Tb(2),n.cd(e.modification.note)}}function ve(e,t){if(1&e&&(n.lc(0,"vdr-labeled-data",0),n.yc(1,"translate"),n.bd(2),n.yc(3,"localeCurrency"),n.kc()),2&e){const e=t.$implicit,c=n.xc();let r=null;n.Ec("label",n.zc(1,3,"order.surcharges")),n.Tb(2),n.ed(" ",null==(r=c.getSurcharge(e.id))?null:r.description," ",n.Ac(3,5,null==(r=c.getSurcharge(e.id))?null:r.priceWithTax,c.order.currencyCode),"")}}function Te(e,t){if(1&e&&(n.lc(0,"vdr-labeled-data",0),n.yc(1,"translate"),n.gc(2,"vdr-simple-item-list",3),n.kc()),2&e){const e=n.xc();n.Ec("label",n.zc(1,2,"order.added-items")),n.Tb(2),n.Ec("items",e.getAddedItems())}}function ke(e,t){if(1&e&&(n.lc(0,"vdr-labeled-data",0),n.yc(1,"translate"),n.gc(2,"vdr-simple-item-list",3),n.kc()),2&e){const e=n.xc();n.Ec("label",n.zc(1,2,"order.removed-items")),n.Tb(2),n.Ec("items",e.getRemovedItems())}}function Ce(e,t){if(1&e&&(n.jc(0),n.gc(1,"vdr-custom-field-control",9),n.ic()),2&e){const e=t.$implicit,c=n.xc(2);n.Tb(1),n.Ec("customFieldsFormGroup",c.customFieldForm)("compact",!0)("readonly",e.readonly||!c.editable)("customField",e)}}function Oe(e,t){if(1&e){const e=n.mc();n.lc(0,"button",10),n.vc("click",function(){n.Sc(e);return n.xc(2).editable=!0}),n.gc(1,"clr-icon",11),n.bd(2),n.yc(3,"translate"),n.kc()}2&e&&(n.Tb(2),n.dd(" ",n.zc(3,1,"common.edit")," "))}function xe(e,t){if(1&e){const e=n.mc();n.lc(0,"button",12),n.vc("click",function(){n.Sc(e);return n.xc(2).onUpdateClick()}),n.gc(1,"clr-icon",13),n.bd(2),n.yc(3,"translate"),n.kc()}if(2&e){const e=n.xc(2);n.Ec("disabled",e.customFieldForm.pristine||e.customFieldForm.invalid),n.Tb(2),n.dd(" ",n.zc(3,2,"common.update")," ")}}function Ie(e,t){if(1&e&&(n.lc(0,"div",1),n.lc(1,"div",2),n.bd(2),n.yc(3,"translate"),n.kc(),n.lc(4,"div",3),n.lc(5,"div",4),n.Zc(6,Ce,2,4,"ng-container",5),n.kc(),n.kc(),n.lc(7,"div",6),n.Zc(8,Oe,4,3,"button",7),n.Zc(9,xe,4,4,"button",8),n.kc(),n.kc()),2&e){const e=n.xc();n.Tb(2),n.dd(" ",n.zc(3,6,"common.custom-fields")," "),n.Tb(3),n.Xb("editable",e.editable),n.Tb(1),n.Ec("ngForOf",e.customFieldsConfig),n.Tb(2),n.Ec("ngIf",!e.editable),n.Tb(1),n.Ec("ngIf",e.editable)}}function Ee(e,t){1&e&&(n.bd(0),n.yc(1,"translate")),2&e&&n.cd(n.zc(1,1,"order.select-state"))}function Se(e,t){if(1&e&&(n.lc(0,"option",4),n.bd(1),n.yc(2,"translate"),n.yc(3,"stateI18nToken"),n.kc()),2&e){const e=t.$implicit;n.Ec("value",e),n.Tb(1),n.dd(" ",n.zc(2,2,n.zc(3,4,e))," ")}}function Pe(e,t){if(1&e){const e=n.mc();n.lc(0,"button",7),n.vc("click",function(){n.Sc(e);return n.xc(2).cancel()}),n.bd(1),n.yc(2,"translate"),n.kc()}2&e&&(n.Tb(1),n.dd(" ",n.zc(2,1,"common.cancel")," "))}function Me(e,t){if(1&e){const e=n.mc();n.Zc(0,Pe,3,3,"button",5),n.lc(1,"button",6),n.vc("click",function(){n.Sc(e);return n.xc().select()}),n.bd(2),n.yc(3,"translate"),n.yc(4,"translate"),n.yc(5,"stateI18nToken"),n.kc()}if(2&e){const e=n.xc();n.Ec("ngIf",e.cancellable),n.Tb(1),n.Ec("disabled",!e.selectedState),n.Tb(1),n.dd(" ",n.Ac(3,3,"order.transition-to-state",n.Ic(10,J,n.zc(4,6,n.zc(5,8,e.selectedState))))," ")}}function Fe(e,t){1&e&&(n.bd(0),n.yc(1,"translate")),2&e&&n.cd(n.zc(1,1,"order.order-state-diagram"))}function we(e,t){1&e&&(n.bd(0),n.yc(1,"translate")),2&e&&n.cd(n.zc(1,1,"order.refund-and-cancel-order"))}function Ae(e,t){if(1&e&&(n.lc(0,"div",36),n.bd(1),n.lc(2,"div",37),n.bd(3),n.yc(4,"currency"),n.yc(5,"number"),n.kc(),n.kc()),2&e){const e=t.$implicit,c=n.xc(3).$implicit,r=n.xc();n.Tb(1),n.dd(" ",e.description," "),n.Tb(2),n.dd(" ",n.Ac(4,2,n.Ac(5,5,e.amount/100/c.quantity,"1.0-2"),r.order.currencyCode)," ")}}function ze(e,t){if(1&e&&(n.lc(0,"vdr-dropdown"),n.lc(1,"div",32),n.lc(2,"button",33),n.gc(3,"clr-icon",34),n.kc(),n.kc(),n.lc(4,"vdr-dropdown-menu"),n.Zc(5,Ae,6,8,"div",35),n.kc(),n.kc()),2&e){const e=n.xc().ngIf;n.Tb(5),n.Ec("ngForOf",e)}}function _e(e,t){if(1&e&&(n.jc(0),n.Zc(1,ze,6,1,"vdr-dropdown",26),n.ic()),2&e){const e=t.ngIf;n.Tb(1),n.Ec("ngIf",e.length)}}function je(e,t){if(1&e){const e=n.mc();n.lc(0,"input",38),n.vc("ngModelChange",function(t){n.Sc(e);const c=n.xc().$implicit;return n.xc().lineQuantities[c.id].quantity=t})("input",function(){n.Sc(e);const t=n.xc().$implicit,c=n.xc();return c.handleZeroQuantity(c.lineQuantities[t.id])}),n.kc()}if(2&e){const e=n.xc().$implicit,t=n.xc();n.Ec("ngModel",t.lineQuantities[e.id].quantity)("max",e.quantity)}}function Ze(e,t){if(1&e){const e=n.mc();n.lc(0,"input",39),n.vc("ngModelChange",function(t){n.Sc(e);const c=n.xc().$implicit;return n.xc().lineQuantities[c.id].refund=t}),n.kc()}if(2&e){const e=n.xc().$implicit,t=n.xc();n.Ec("disabled",0===t.lineQuantities[e.id].quantity)("ngModel",t.lineQuantities[e.id].refund)}}function De(e,t){if(1&e){const e=n.mc();n.lc(0,"input",39),n.vc("ngModelChange",function(t){n.Sc(e);const c=n.xc().$implicit;return n.xc().lineQuantities[c.id].cancel=t}),n.kc()}if(2&e){const e=n.xc().$implicit,t=n.xc();n.Ec("disabled",0===t.lineQuantities[e.id].quantity)("ngModel",t.lineQuantities[e.id].cancel)}}function Le(e,t){if(1&e&&(n.lc(0,"tr",18),n.lc(1,"td",19),n.gc(2,"img",20),n.yc(3,"assetPreview"),n.kc(),n.lc(4,"td",21),n.bd(5),n.kc(),n.lc(6,"td",22),n.bd(7),n.kc(),n.lc(8,"td",23),n.bd(9),n.gc(10,"vdr-line-refunds",24),n.kc(),n.lc(11,"td",23),n.bd(12),n.yc(13,"localeCurrency"),n.kc(),n.lc(14,"td",23),n.lc(15,"div",25),n.bd(16),n.yc(17,"localeCurrency"),n.Zc(18,_e,2,1,"ng-container",26),n.kc(),n.kc(),n.lc(19,"td",27),n.Zc(20,je,1,2,"input",28),n.kc(),n.lc(21,"td",29),n.lc(22,"div",30),n.Zc(23,Ze,1,2,"input",31),n.kc(),n.kc(),n.lc(24,"td",29),n.lc(25,"div",30),n.Zc(26,De,1,2,"input",31),n.kc(),n.kc(),n.kc()),2&e){const e=t.$implicit,c=n.xc();n.Tb(2),n.Ec("src",n.Ac(3,12,e.featuredAsset,"tiny"),n.Uc),n.Tb(3),n.cd(e.productVariant.name),n.Tb(2),n.cd(e.productVariant.sku),n.Tb(2),n.dd(" ",e.quantity," "),n.Tb(1),n.Ec("line",e)("payments",c.order.payments),n.Tb(2),n.dd(" ",n.Ac(13,15,e.unitPriceWithTax,c.order.currencyCode)," "),n.Tb(4),n.dd(" ",n.Ac(17,18,e.proratedUnitPriceWithTax,c.order.currencyCode)," "),n.Tb(2),n.Ec("ngIf",e.discounts),n.Tb(2),n.Ec("ngIf",c.lineCanBeRefundedOrCancelled(e)),n.Tb(3),n.Ec("ngIf",c.lineCanBeRefundedOrCancelled(e)),n.Tb(3),n.Ec("ngIf",c.lineCanBeRefundedOrCancelled(e))}}function Re(e,t){if(1&e&&(n.lc(0,"option",40),n.bd(1),n.yc(2,"localeCurrency"),n.kc()),2&e){const e=t.$implicit,c=n.xc();n.Ec("ngValue",e)("disabled","Settled"!==e.state),n.Tb(1),n.fd(" #",e.id," ",e.method,": ",n.Ac(2,5,e.amount,c.order.currencyCode)," ")}}const Ne=function(e,t){return{min:e,max:t}};function $e(e,t){if(1&e&&(n.lc(0,"div",41),n.bd(1),n.yc(2,"translate"),n.yc(3,"currency"),n.yc(4,"localeCurrency"),n.kc()),2&e){const e=n.xc();n.Tb(1),n.dd(" ",n.Ac(2,1,"order.refund-total-error",n.Jc(10,Ne,n.Ac(3,4,0,e.order.currencyCode),n.Ac(4,7,e.settledPaymentsTotal,e.order.currencyCode)))," ")}}function qe(e,t){1&e&&(n.lc(0,"div",42),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.dd(" ",n.zc(2,1,"order.refund-total-warning")," "))}const Ve=function(e){return{amount:e}};function We(e,t){if(1&e&&(n.jc(0),n.bd(1),n.yc(2,"translate"),n.yc(3,"localeCurrency"),n.ic()),2&e){const e=n.xc(2);n.Tb(1),n.dd(" ",n.Ac(2,1,"order.refund-with-amount",n.Ic(7,Ve,n.Ac(3,4,e.refundTotal,e.order.currencyCode)))," ")}}function Qe(e,t){1&e&&(n.bd(0),n.yc(1,"translate")),2&e&&n.dd(" ",n.zc(1,1,"order.cancel-selected-items")," ")}function He(e,t){if(1&e){const e=n.mc();n.lc(0,"button",43),n.vc("click",function(){n.Sc(e);return n.xc().cancel()}),n.bd(1),n.yc(2,"translate"),n.kc(),n.lc(3,"button",44),n.vc("click",function(){n.Sc(e);return n.xc().select()}),n.Zc(4,We,4,9,"ng-container",45),n.Zc(5,Qe,2,3,"ng-template",null,46,n.ad),n.kc()}if(2&e){const e=n.Oc(6),t=n.xc();n.Tb(1),n.cd(n.zc(2,4,"common.cancel")),n.Tb(2),n.Ec("disabled",!t.canSubmit()),n.Tb(1),n.Ec("ngIf",t.isRefunding())("ngIfElse",e)}}function Ue(e,t){1&e&&(n.bd(0),n.yc(1,"translate")),2&e&&n.cd(n.zc(1,1,"order.settle-refund"))}function Ge(e,t){if(1&e){const e=n.mc();n.lc(0,"button",4),n.vc("click",function(){n.Sc(e);return n.xc().cancel()}),n.bd(1),n.yc(2,"translate"),n.kc(),n.lc(3,"button",5),n.vc("click",function(){n.Sc(e);return n.xc().submit()}),n.bd(4),n.yc(5,"translate"),n.kc()}if(2&e){const e=n.xc();n.Tb(1),n.cd(n.zc(2,3,"common.cancel")),n.Tb(2),n.Ec("disabled",!e.transactionId),n.Tb(1),n.dd(" ",n.zc(5,5,"order.settle-refund")," ")}}const Be=function(e){return{method:e}};function Je(e,t){if(1&e){const e=n.mc();n.lc(0,"button",16),n.vc("click",function(){n.Sc(e);const t=n.xc().ngIf;return n.xc().addManualPayment(t)}),n.bd(1),n.yc(2,"translate"),n.yc(3,"localeCurrency"),n.kc()}if(2&e){const e=n.xc().ngIf,t=n.xc();n.Tb(1),n.ed(" ",n.zc(2,2,"order.add-payment-to-order")," (",n.Ac(3,4,t.outstandingPaymentAmount(e),e.currencyCode),") ")}}function Xe(e,t){if(1&e){const e=n.mc();n.lc(0,"button",16),n.vc("click",function(){n.Sc(e);return n.xc(2).transitionToState("ArrangingAdditionalPayment")}),n.bd(1),n.yc(2,"translate"),n.kc()}2&e&&(n.Tb(1),n.dd(" ",n.zc(2,1,"order.arrange-additional-payment")," "))}function Ye(e,t){if(1&e){const e=n.mc();n.jc(0),n.lc(1,"button",14),n.vc("click",function(){n.Sc(e);return n.xc(2).transitionToModifying()}),n.gc(2,"clr-icon",17),n.bd(3),n.yc(4,"translate"),n.kc(),n.gc(5,"div",13),n.ic()}2&e&&(n.Tb(3),n.dd(" ",n.zc(4,1,"order.modify-order")," "))}function Ke(e,t){1&e&&(n.jc(0),n.bd(1),n.yc(2,"translate"),n.ic()),2&e&&(n.Tb(1),n.dd(" ",n.zc(2,1,"order.refund-and-cancel-order")," "))}function et(e,t){1&e&&(n.bd(0),n.yc(1,"translate")),2&e&&n.dd(" ",n.zc(1,1,"order.cancel-order")," ")}function tt(e,t){if(1&e){const e=n.mc();n.lc(0,"button",14),n.vc("click",function(){n.Sc(e);const t=n.xc().ngIf;return n.xc().cancelOrRefund(t)}),n.gc(1,"clr-icon",18),n.Zc(2,Ke,3,3,"ng-container",19),n.Zc(3,et,2,3,"ng-template",null,20,n.ad),n.kc()}if(2&e){const e=n.Oc(4),t=n.xc().ngIf,c=n.xc();n.Tb(2),n.Ec("ngIf",c.orderHasSettledPayments(t))("ngIfElse",e)}}function ct(e,t){if(1&e){const e=n.mc();n.lc(0,"button",14),n.vc("click",function(){n.Sc(e);const c=t.$implicit;return n.xc(3).transitionToState(c)}),n.gc(1,"clr-icon",22),n.bd(2),n.yc(3,"translate"),n.yc(4,"translate"),n.yc(5,"stateI18nToken"),n.kc()}if(2&e){const e=t.$implicit;n.Tb(2),n.dd(" ",n.Ac(3,1,"order.transition-to-state",n.Ic(8,J,n.zc(4,4,n.zc(5,6,e))))," ")}}function nt(e,t){if(1&e&&(n.jc(0),n.gc(1,"div",13),n.Zc(2,ct,6,10,"button",21),n.yc(3,"async"),n.ic()),2&e){const e=n.xc(2);n.Tb(2),n.Ec("ngForOf",n.zc(3,1,e.nextStates$))}}function rt(e,t){if(1&e){const e=n.mc();n.lc(0,"vdr-action-bar"),n.lc(1,"vdr-ab-left"),n.lc(2,"div",1),n.gc(3,"vdr-entity-info",2),n.yc(4,"async"),n.lc(5,"vdr-order-state-label",3),n.lc(6,"button",4),n.vc("click",function(){n.Sc(e);return n.xc().openStateDiagram()}),n.yc(7,"translate"),n.gc(8,"clr-icon",5),n.kc(),n.kc(),n.kc(),n.kc(),n.lc(9,"vdr-ab-right"),n.gc(10,"vdr-action-bar-items",6),n.Zc(11,Je,4,7,"button",7),n.Zc(12,Xe,3,3,"button",7),n.lc(13,"button",8),n.vc("click",function(){n.Sc(e);return n.xc().fulfillOrder()}),n.bd(14),n.yc(15,"translate"),n.kc(),n.lc(16,"vdr-dropdown"),n.lc(17,"button",9),n.gc(18,"clr-icon",10),n.kc(),n.lc(19,"vdr-dropdown-menu",11),n.Zc(20,Ye,6,3,"ng-container",0),n.Zc(21,tt,5,2,"button",12),n.Zc(22,nt,4,3,"ng-container",0),n.yc(23,"async"),n.gc(24,"div",13),n.lc(25,"button",14),n.vc("click",function(){n.Sc(e);const c=t.ngIf;return n.xc().manuallyTransitionToState(c)}),n.gc(26,"clr-icon",15),n.bd(27),n.yc(28,"translate"),n.kc(),n.kc(),n.kc(),n.kc(),n.kc()}if(2&e){const e=t.ngIf,c=n.xc();let r=null;n.Tb(3),n.Ec("entity",n.zc(4,11,c.entity$)),n.Tb(2),n.Ec("state",e.state),n.Tb(1),n.Ec("title",n.zc(7,13,"order.order-state-diagram")),n.Tb(5),n.Ec("ngIf","ArrangingAdditionalPayment"===e.state&&(c.hasUnsettledModifications(e)||0<c.outstandingPaymentAmount(e))),n.Tb(1),n.Ec("ngIf","ArrangingAdditionalPayment"!==e.state&&0<c.outstandingPaymentAmount(e)),n.Tb(1),n.Ec("disabled",!c.canAddFulfillment(e)),n.Tb(1),n.dd(" ",n.zc(15,15,"order.fulfill-order")," "),n.Tb(6),n.Ec("ngIf",e.nextStates.includes("Modifying")),n.Tb(1),n.Ec("ngIf",e.nextStates.includes("Cancelled")),n.Tb(1),n.Ec("ngIf",null==(r=n.zc(23,17,c.nextStates$))?null:r.length),n.Tb(5),n.dd(" ",n.zc(28,19,"order.manually-transition-to-state")," ")}}function it(e,t){if(1&e&&(n.lc(0,"tr"),n.lc(1,"td"),n.bd(2),n.kc(),n.lc(3,"td"),n.bd(4),n.yc(5,"percent"),n.kc(),n.lc(6,"td"),n.bd(7),n.yc(8,"localeCurrency"),n.kc(),n.lc(9,"td"),n.bd(10),n.yc(11,"localeCurrency"),n.kc(),n.kc()),2&e){const e=t.$implicit,c=n.xc().ngIf;n.Tb(2),n.cd(e.description),n.Tb(2),n.cd(n.zc(5,4,e.taxRate/100)),n.Tb(3),n.cd(n.Ac(8,6,e.taxBase,c.currencyCode)),n.Tb(3),n.cd(n.Ac(11,9,e.taxTotal,c.currencyCode))}}function ot(e,t){1&e&&(n.lc(0,"h6"),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.dd(" ",n.zc(2,1,"order.shipping-address")," "))}function dt(e,t){1&e&&(n.lc(0,"h6"),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.dd(" ",n.zc(2,1,"order.billing-address")," "))}function lt(e,t){if(1&e){const e=n.mc();n.lc(0,"vdr-order-payment-card",38),n.vc("settlePayment",function(t){n.Sc(e);return n.xc(3).settlePayment(t)})("transitionPaymentState",function(t){n.Sc(e);return n.xc(3).transitionPaymentState(t)})("settleRefund",function(t){n.Sc(e);return n.xc(3).settleRefund(t)}),n.kc()}if(2&e){const e=t.$implicit,c=n.xc(2).ngIf;n.Ec("currencyCode",c.currencyCode)("payment",e)}}function at(e,t){if(1&e&&(n.jc(0),n.Zc(1,lt,1,2,"vdr-order-payment-card",37),n.ic()),2&e){const e=n.xc().ngIf;n.Tb(1),n.Ec("ngForOf",e.payments)}}function st(e,t){if(1&e){const e=n.mc();n.jc(0),n.lc(1,"vdr-fulfillment-card",39),n.vc("transitionState",function(c){n.Sc(e);const r=t.$implicit;return n.xc(2).transitionFulfillment(r.id,c)}),n.kc(),n.ic()}if(2&e){const e=t.$implicit,c=n.xc().ngIf;n.Tb(1),n.Ec("fulfillment",e)("order",c)}}function ut(e,t){if(1&e){const e=n.mc();n.lc(0,"div"),n.lc(1,"div",23),n.lc(2,"div",24),n.gc(3,"vdr-order-table",25),n.lc(4,"h4"),n.bd(5),n.yc(6,"translate"),n.kc(),n.lc(7,"table",26),n.lc(8,"thead"),n.lc(9,"tr"),n.lc(10,"th"),n.bd(11),n.yc(12,"translate"),n.kc(),n.lc(13,"th"),n.bd(14),n.yc(15,"translate"),n.kc(),n.lc(16,"th"),n.bd(17),n.yc(18,"translate"),n.kc(),n.lc(19,"th"),n.bd(20),n.yc(21,"translate"),n.kc(),n.kc(),n.kc(),n.lc(22,"tbody"),n.Zc(23,it,12,12,"tr",27),n.kc(),n.kc(),n.lc(24,"vdr-order-history",28),n.vc("addNote",function(t){n.Sc(e);return n.xc().addNote(t)})("updateNote",function(t){n.Sc(e);return n.xc().updateNote(t)})("deleteNote",function(t){n.Sc(e);return n.xc().deleteNote(t)}),n.yc(25,"async"),n.kc(),n.kc(),n.lc(26,"div",29),n.lc(27,"vdr-order-custom-fields-card",30),n.vc("updateClick",function(t){n.Sc(e);return n.xc().updateCustomFields(t)}),n.kc(),n.lc(28,"div",31),n.lc(29,"div",32),n.bd(30),n.yc(31,"translate"),n.kc(),n.lc(32,"div",33),n.lc(33,"div",34),n.gc(34,"vdr-customer-label",35),n.Zc(35,ot,3,3,"h6",0),n.gc(36,"vdr-formatted-address",36),n.Zc(37,dt,3,3,"h6",0),n.gc(38,"vdr-formatted-address",36),n.kc(),n.kc(),n.kc(),n.Zc(39,at,2,1,"ng-container",0),n.Zc(40,st,2,2,"ng-container",27),n.kc(),n.kc(),n.kc()}if(2&e){const e=t.ngIf,c=n.xc();n.Tb(3),n.Ec("order",e)("orderLineCustomFields",c.orderLineCustomFields),n.Tb(2),n.cd(n.zc(6,20,"order.tax-summary")),n.Tb(6),n.cd(n.zc(12,22,"common.description")),n.Tb(3),n.cd(n.zc(15,24,"order.tax-rate")),n.Tb(3),n.cd(n.zc(18,26,"order.tax-base")),n.Tb(3),n.cd(n.zc(21,28,"order.tax-total")),n.Tb(3),n.Ec("ngForOf",e.taxSummary),n.Tb(1),n.Ec("order",e)("history",n.zc(25,30,c.history$)),n.Tb(3),n.Ec("customFieldsConfig",c.customFields)("customFieldValues",e.customFields),n.Tb(3),n.dd(" ",n.zc(31,32,"order.customer")," "),n.Tb(4),n.Ec("customer",e.customer),n.Tb(1),n.Ec("ngIf",c.getOrderAddressLines(e.shippingAddress).length),n.Tb(1),n.Ec("address",e.shippingAddress),n.Tb(1),n.Ec("ngIf",c.getOrderAddressLines(e.billingAddress).length),n.Tb(1),n.Ec("address",e.billingAddress),n.Tb(1),n.Ec("ngIf",e.payments&&e.payments.length),n.Tb(1),n.Ec("ngForOf",e.fulfillments)}}function ft(e,t){1&e&&(n.bd(0),n.yc(1,"translate")),2&e&&n.cd(n.zc(1,1,"order.confirm-modifications"))}function mt(e,t){if(1&e&&(n.lc(0,"option",9),n.bd(1),n.yc(2,"localeCurrency"),n.kc()),2&e){const e=t.$implicit,c=n.xc(2);n.Ec("ngValue",e),n.Tb(1),n.fd(" #",e.id," ",e.method,": ",n.Ac(2,4,e.amount,c.order.currencyCode)," ")}}function bt(e,t){if(1&e){const e=n.mc();n.lc(0,"div"),n.lc(1,"clr-select-container"),n.lc(2,"label"),n.bd(3),n.yc(4,"translate"),n.kc(),n.lc(5,"select",5),n.vc("ngModelChange",function(t){n.Sc(e);return n.xc().selectedPayment=t}),n.Zc(6,mt,3,7,"option",6),n.kc(),n.kc(),n.lc(7,"label",7),n.bd(8),n.yc(9,"translate"),n.kc(),n.lc(10,"textarea",8),n.vc("ngModelChange",function(t){n.Sc(e);return n.xc().refundNote=t}),n.kc(),n.kc()}if(2&e){const e=n.xc();n.Tb(3),n.cd(n.zc(4,5,"order.payment-to-refund")),n.Tb(2),n.Ec("ngModel",e.selectedPayment),n.Tb(1),n.Ec("ngForOf",e.order.payments),n.Tb(2),n.cd(n.zc(9,7,"order.refund-cancellation-reason")),n.Tb(2),n.Ec("ngModel",e.refundNote)}}function pt(e,t){if(1&e){const e=n.mc();n.lc(0,"button",10),n.vc("click",function(){n.Sc(e);return n.xc().cancel()}),n.bd(1),n.yc(2,"translate"),n.kc(),n.lc(3,"button",11),n.vc("click",function(){n.Sc(e);return n.xc().submit()}),n.bd(4),n.yc(5,"translate"),n.kc()}if(2&e){const e=n.xc();n.Tb(1),n.cd(n.zc(2,3,"common.cancel")),n.Tb(2),n.Ec("disabled",e.priceDifference<0&&!e.selectedPayment),n.Tb(1),n.dd(" ",n.zc(5,5,"common.confirm")," ")}}function gt(e,t){if(1&e){const e=n.mc();n.lc(0,"vdr-action-bar"),n.lc(1,"vdr-ab-left"),n.lc(2,"div",1),n.gc(3,"vdr-entity-info",2),n.yc(4,"async"),n.gc(5,"vdr-order-state-label",3),n.kc(),n.kc(),n.lc(6,"vdr-ab-right"),n.lc(7,"button",4),n.vc("click",function(){n.Sc(e);const c=t.ngIf;return n.xc().transitionToPriorState(c)}),n.bd(8),n.yc(9,"translate"),n.kc(),n.kc(),n.kc()}if(2&e){const e=t.ngIf,c=n.xc();n.Tb(3),n.Ec("entity",n.zc(4,3,c.entity$)),n.Tb(2),n.Ec("state",e.state),n.Tb(3),n.dd(" ",n.zc(9,5,"order.cancel-modification")," ")}}function yt(e,t){1&e&&(n.lc(0,"th"),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.cd(n.zc(2,1,"common.custom-fields")))}function ht(e,t){if(1&e&&(n.gc(0,"img",41),n.yc(1,"assetPreview")),2&e){const e=n.xc().$implicit;n.Ec("src",n.Ac(1,1,e.featuredAsset,"tiny"),n.Uc)}}const vt=function(e){return[e]};function Tt(e,t){if(1&e&&(n.jc(0),n.gc(1,"vdr-custom-field-control",44),n.ic()),2&e){const e=t.$implicit,c=n.xc(2).index,r=n.xc(2);n.Tb(1),n.Ec("customField",e)("customFieldsFormGroup",r.orderLineCustomFieldsFormArray.get(n.Ic(3,vt,c)))("compact",!0)}}function kt(e,t){if(1&e&&(n.lc(0,"td",42),n.Zc(1,Tt,2,5,"ng-container",43),n.kc()),2&e){const e=n.xc(3);n.Tb(1),n.Ec("ngForOf",e.orderLineCustomFields)}}function Ct(e,t){if(1&e){const e=n.mc();n.lc(0,"tr",29),n.lc(1,"td",30),n.Zc(2,ht,2,4,"img",31),n.kc(),n.lc(3,"td",32),n.bd(4),n.kc(),n.lc(5,"td",33),n.bd(6),n.kc(),n.lc(7,"td",34),n.bd(8),n.yc(9,"localeCurrency"),n.lc(10,"div",16),n.yc(11,"translate"),n.bd(12),n.yc(13,"localeCurrency"),n.kc(),n.kc(),n.lc(14,"td",35),n.lc(15,"input",36),n.vc("input",function(c){n.Sc(e);const r=t.$implicit;return n.xc(2).updateLineQuantity(r,c.target.value)}),n.kc(),n.gc(16,"vdr-line-refunds",37),n.gc(17,"vdr-line-fulfillment",38),n.kc(),n.Zc(18,kt,2,1,"td",39),n.lc(19,"td",40),n.bd(20),n.yc(21,"localeCurrency"),n.lc(22,"div",16),n.yc(23,"translate"),n.bd(24),n.yc(25,"localeCurrency"),n.kc(),n.kc(),n.kc()}if(2&e){const e=t.$implicit,c=n.xc().ngIf,r=n.xc();n.Xb("is-cancelled",0===e.quantity)("modified",r.isLineModified(e)),n.Tb(2),n.Ec("ngIf",e.featuredAsset),n.Tb(2),n.cd(e.productVariant.name),n.Tb(2),n.cd(e.productVariant.sku),n.Tb(2),n.dd(" ",n.Ac(9,19,e.unitPriceWithTax,c.currencyCode)," "),n.Tb(2),n.Ec("title",n.zc(11,22,"order.net-price")),n.Tb(2),n.dd(" ",n.Ac(13,24,e.unitPrice,c.currencyCode)," "),n.Tb(3),n.Ec("value",e.quantity),n.Tb(1),n.Ec("line",e)("payments",c.payments),n.Tb(1),n.Ec("line",e)("orderState",c.state),n.Tb(1),n.Ec("ngIf",r.orderLineCustomFields.length),n.Tb(2),n.dd(" ",n.Ac(21,27,e.linePriceWithTax,c.currencyCode)," "),n.Tb(2),n.Ec("title",n.zc(23,30,"order.net-price")),n.Tb(2),n.dd(" ",n.Ac(25,32,e.linePrice,c.currencyCode)," ")}}function Ot(e,t){if(1&e&&(n.gc(0,"img",41),n.yc(1,"assetPreview")),2&e){const e=n.xc().$implicit;n.Ec("src",n.Ac(1,1,e.productAsset,"tiny"),n.Uc)}}function xt(e,t){if(1&e&&(n.jc(0),n.gc(1,"vdr-custom-field-control",44),n.ic()),2&e){const e=t.$implicit,c=n.xc(2).index,r=n.xc(2);n.Tb(1),n.Ec("customField",e)("customFieldsFormGroup",r.addItemCustomFieldsFormArray.get(n.Ic(3,vt,c)))("compact",!0)}}function It(e,t){if(1&e&&(n.lc(0,"td",42),n.Zc(1,xt,2,5,"ng-container",43),n.kc()),2&e){const e=n.xc(3);n.Tb(1),n.Ec("ngForOf",e.orderLineCustomFields)}}function Et(e,t){if(1&e){const e=n.mc();n.lc(0,"tr",45),n.lc(1,"td",30),n.Zc(2,Ot,2,4,"img",31),n.kc(),n.lc(3,"td",32),n.bd(4),n.kc(),n.lc(5,"td",33),n.bd(6),n.kc(),n.lc(7,"td",34),n.bd(8),n.yc(9,"localeCurrency"),n.lc(10,"div",16),n.yc(11,"translate"),n.bd(12),n.yc(13,"localeCurrency"),n.kc(),n.kc(),n.lc(14,"td",35),n.lc(15,"input",36),n.vc("input",function(c){n.Sc(e);const r=t.$implicit;return n.xc(2).updateAddedItemQuantity(r,c.target.value)}),n.kc(),n.lc(16,"button",46),n.vc("click",function(){n.Sc(e);const c=t.index;return n.xc(2).removeAddedItem(c)}),n.gc(17,"clr-icon",47),n.kc(),n.kc(),n.Zc(18,It,2,1,"td",39),n.lc(19,"td",40),n.bd(20),n.yc(21,"currency"),n.lc(22,"div",16),n.yc(23,"translate"),n.bd(24),n.yc(25,"currency"),n.kc(),n.kc(),n.kc()}if(2&e){const e=t.$implicit,c=n.xc().ngIf,r=n.xc();n.Tb(2),n.Ec("ngIf",e.productAsset),n.Tb(2),n.cd(e.productVariantName),n.Tb(2),n.cd(e.sku),n.Tb(2),n.dd(" ",n.Ac(9,11,e.priceWithTax,c.currencyCode)," "),n.Tb(2),n.Ec("title",n.zc(11,14,"order.net-price")),n.Tb(2),n.dd(" ",n.Ac(13,16,e.price,c.currencyCode)," "),n.Tb(3),n.Ec("value",e.quantity),n.Tb(3),n.Ec("ngIf",r.orderLineCustomFields.length),n.Tb(2),n.dd(" ",n.Ac(21,19,e.priceWithTax*e.quantity/100,c.currencyCode)," "),n.Tb(2),n.Ec("title",n.zc(23,22,"order.net-price")),n.Tb(2),n.dd(" ",n.Ac(25,24,e.price*e.quantity/100,c.currencyCode)," ")}}function St(e,t){1&e&&n.gc(0,"td")}function Pt(e,t){if(1&e&&(n.lc(0,"tr",48),n.lc(1,"td",49),n.bd(2),n.kc(),n.lc(3,"td",33),n.bd(4),n.kc(),n.gc(5,"td",50),n.gc(6,"td"),n.Zc(7,St,1,0,"td",0),n.lc(8,"td",40),n.bd(9),n.yc(10,"localeCurrency"),n.lc(11,"div",16),n.yc(12,"translate"),n.bd(13),n.yc(14,"localeCurrency"),n.kc(),n.kc(),n.kc()),2&e){const e=t.$implicit,c=n.xc().ngIf,r=n.xc();n.Tb(2),n.cd(e.description),n.Tb(2),n.cd(e.sku),n.Tb(3),n.Ec("ngIf",r.orderLineCustomFields.length),n.Tb(2),n.dd(" ",n.Ac(10,6,e.priceWithTax,c.currencyCode)," "),n.Tb(2),n.Ec("title",n.zc(12,9,"order.net-price")),n.Tb(2),n.dd(" ",n.Ac(14,11,e.price,c.currencyCode)," ")}}function Mt(e,t){1&e&&n.gc(0,"td")}function Ft(e,t){if(1&e&&(n.jc(0),n.bd(1),n.yc(2,"localeCurrency"),n.lc(3,"div",16),n.yc(4,"translate"),n.bd(5),n.yc(6,"localeCurrency"),n.kc(),n.ic()),2&e){const e=t.ngIf,c=n.xc(2).ngIf;n.Tb(1),n.dd(" ",n.Ac(2,3,e.priceWithTax,c.currencyCode)," "),n.Tb(2),n.Ec("title",n.zc(4,6,"order.net-price")),n.Tb(2),n.dd(" ",n.Ac(6,8,e.price,c.currencyCode)," ")}}function wt(e,t){if(1&e){const e=n.mc();n.lc(0,"tr",51),n.lc(1,"td",49),n.bd(2),n.lc(3,"button",46),n.vc("click",function(){n.Sc(e);const c=t.index;return n.xc(2).removeSurcharge(c)}),n.gc(4,"clr-icon",47),n.kc(),n.kc(),n.lc(5,"td",33),n.bd(6),n.kc(),n.gc(7,"td",50),n.gc(8,"td"),n.Zc(9,Mt,1,0,"td",0),n.lc(10,"td",40),n.Zc(11,Ft,7,11,"ng-container",0),n.kc(),n.kc()}if(2&e){const e=t.$implicit,c=n.xc(2);n.Tb(2),n.dd(" ",e.description," "),n.Tb(4),n.cd(e.sku),n.Tb(3),n.Ec("ngIf",c.orderLineCustomFields.length),n.Tb(2),n.Ec("ngIf",c.getSurchargePrices(e))}}function At(e,t){1&e&&n.gc(0,"td")}function zt(e,t){if(1&e&&(n.gc(0,"img",58),n.yc(1,"assetPreview")),2&e){const e=t.ngIf;n.Ec("src",n.Ac(1,1,e,"tiny"),n.Uc)}}function _t(e,t){if(1&e&&(n.lc(0,"div",55),n.Zc(1,zt,2,4,"img",56),n.lc(2,"div"),n.lc(3,"strong",57),n.bd(4),n.kc(),n.lc(5,"small"),n.bd(6),n.kc(),n.lc(7,"div"),n.bd(8),n.yc(9,"localeCurrency"),n.kc(),n.kc(),n.kc()),2&e){const e=n.xc(2).ngIf,t=n.xc();n.Tb(1),n.Ec("ngIf",t.addItemSelectedVariant.productAsset),n.Tb(3),n.cd(t.addItemSelectedVariant.productVariantName),n.Tb(2),n.cd(t.addItemSelectedVariant.sku),n.Tb(2),n.dd(" ",n.Ac(9,4,t.getSelectedItemPrice(t.addItemSelectedVariant),e.currencyCode)," ")}}function jt(e,t){if(1&e&&(n.jc(0),n.gc(1,"vdr-custom-field-control",59),n.ic()),2&e){const e=t.$implicit,c=n.xc(3);n.Tb(1),n.Ec("readonly",!c.addItemSelectedVariant)("customField",e)("customFieldsFormGroup",c.addItemCustomFieldsForm)("compact",!0)}}function Zt(e,t){if(1&e){const e=n.mc();n.lc(0,"clr-accordion-content"),n.lc(1,"vdr-product-selector",52),n.vc("productSelected",function(t){n.Sc(e);return n.xc(2).addItemSelectedVariant=t}),n.kc(),n.Zc(2,_t,10,7,"div",53),n.Zc(3,jt,2,4,"ng-container",43),n.lc(4,"button",54),n.vc("click",function(){n.Sc(e);const t=n.xc(2);return t.addItemToOrder(t.addItemSelectedVariant)}),n.bd(5),n.yc(6,"translate"),n.kc(),n.kc()}if(2&e){const e=n.xc(2);n.Tb(2),n.Ec("ngIf",e.addItemSelectedVariant),n.Tb(1),n.Ec("ngForOf",e.orderLineCustomFields),n.Tb(1),n.Ec("disabled",!e.addItemSelectedVariant||e.addItemCustomFieldsForm.invalid),n.Tb(1),n.dd(" ",n.zc(6,4,"order.add-item-to-order")," ")}}const Dt=function(e){return{rate:e}};function Lt(e,t){if(1&e){const e=n.mc();n.lc(0,"clr-accordion-content"),n.lc(1,"form",60),n.vc("submit",function(){n.Sc(e);const t=n.xc(2);return t.addSurcharge(t.surchargeForm.value)}),n.lc(2,"vdr-form-field",61),n.yc(3,"translate"),n.gc(4,"input",62),n.kc(),n.lc(5,"vdr-form-field",63),n.yc(6,"translate"),n.gc(7,"input",64),n.kc(),n.lc(8,"vdr-form-field",65),n.yc(9,"translate"),n.gc(10,"vdr-currency-input",66),n.kc(),n.lc(11,"vdr-form-field",67),n.yc(12,"translate"),n.gc(13,"input",68),n.kc(),n.lc(14,"vdr-form-field",69),n.yc(15,"translate"),n.lc(16,"vdr-affixed-input",70),n.gc(17,"input",71),n.kc(),n.kc(),n.lc(18,"vdr-form-field",72),n.yc(19,"translate"),n.gc(20,"input",73),n.kc(),n.lc(21,"button",74),n.bd(22),n.yc(23,"translate"),n.kc(),n.kc(),n.kc()}if(2&e){const e=n.xc().ngIf,t=n.xc();let c=null,r=null;n.Tb(1),n.Ec("formGroup",t.surchargeForm),n.Tb(1),n.Ec("label",n.zc(3,10,"common.description")),n.Tb(3),n.Ec("label",n.zc(6,12,"order.product-sku")),n.Tb(3),n.Ec("label",n.zc(9,14,"common.price")),n.Tb(2),n.Ec("currencyCode",e.currencyCode),n.Tb(1),n.Ec("label",n.Ac(12,16,"catalog.price-includes-tax-at",n.Ic(25,Dt,null==(c=t.surchargeForm.get("taxRate"))?null:c.value))),n.Tb(3),n.Ec("label",n.zc(15,19,"order.tax-rate")),n.Tb(4),n.Ec("label",n.zc(19,21,"order.tax-description")),n.Tb(3),n.Ec("disabled",t.surchargeForm.invalid||t.surchargeForm.pristine||0===(null==(r=t.surchargeForm.get("price"))?null:r.value)),n.Tb(1),n.dd(" ",n.zc(23,23,"order.add-surcharge")," ")}}function Rt(e,t){if(1&e&&(n.lc(0,"clr-accordion-content"),n.gc(1,"vdr-address-form",75),n.yc(2,"async"),n.kc()),2&e){const e=n.xc(2);n.Tb(1),n.Ec("formGroup",e.shippingAddressForm)("availableCountries",n.zc(2,3,e.availableCountries$))("customFields",e.addressCustomFields)}}function Nt(e,t){if(1&e&&(n.lc(0,"clr-accordion-content"),n.gc(1,"vdr-address-form",75),n.yc(2,"async"),n.kc()),2&e){const e=n.xc(2);n.Tb(1),n.Ec("formGroup",e.billingAddressForm)("availableCountries",n.zc(2,3,e.availableCountries$))("customFields",e.addressCustomFields)}}function $t(e,t){if(1&e&&(n.lc(0,"li"),n.bd(1),n.yc(2,"translate"),n.kc()),2&e){const e=n.xc(2);n.Tb(1),n.dd(" ",n.Ac(2,1,"order.modification-adding-items",n.Ic(4,be,null==e.modifyOrderInput.addItems?null:e.modifyOrderInput.addItems.length))," ")}}function qt(e,t){if(1&e&&(n.lc(0,"li"),n.bd(1),n.yc(2,"translate"),n.kc()),2&e){const e=n.xc(2);n.Tb(1),n.dd(" ",n.Ac(2,1,"order.modification-adjusting-lines",n.Ic(4,be,null==e.modifyOrderInput.adjustOrderLines?null:e.modifyOrderInput.adjustOrderLines.length))," ")}}function Vt(e,t){if(1&e&&(n.lc(0,"li"),n.bd(1),n.yc(2,"translate"),n.kc()),2&e){const e=n.xc(2);n.Tb(1),n.dd(" ",n.Ac(2,1,"order.modification-adding-surcharges",n.Ic(4,be,null==e.modifyOrderInput.surcharges?null:e.modifyOrderInput.surcharges.length))," ")}}function Wt(e,t){1&e&&(n.lc(0,"li"),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.dd(" ",n.zc(2,1,"order.modification-updating-shipping-address")," "))}function Qt(e,t){1&e&&(n.lc(0,"li"),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.dd(" ",n.zc(2,1,"order.modification-updating-billing-address")," "))}function Ht(e,t){if(1&e){const e=n.mc();n.lc(0,"div"),n.lc(1,"div",5),n.lc(2,"div",6),n.lc(3,"table",7),n.lc(4,"thead"),n.lc(5,"tr"),n.gc(6,"th"),n.lc(7,"th"),n.bd(8),n.yc(9,"translate"),n.kc(),n.lc(10,"th"),n.bd(11),n.yc(12,"translate"),n.kc(),n.lc(13,"th"),n.bd(14),n.yc(15,"translate"),n.kc(),n.lc(16,"th"),n.bd(17),n.yc(18,"translate"),n.kc(),n.Zc(19,yt,3,3,"th",0),n.lc(20,"th"),n.bd(21),n.yc(22,"translate"),n.kc(),n.kc(),n.kc(),n.lc(23,"tbody"),n.Zc(24,Ct,26,35,"tr",8),n.Zc(25,Et,26,27,"tr",9),n.Zc(26,Pt,15,14,"tr",10),n.Zc(27,wt,12,4,"tr",11),n.lc(28,"tr",12),n.lc(29,"td",13),n.bd(30),n.yc(31,"translate"),n.kc(),n.lc(32,"td",14),n.bd(33),n.kc(),n.gc(34,"td",15),n.Zc(35,At,1,0,"td",0),n.lc(36,"td",14),n.bd(37),n.yc(38,"localeCurrency"),n.lc(39,"div",16),n.yc(40,"translate"),n.bd(41),n.yc(42,"localeCurrency"),n.kc(),n.kc(),n.kc(),n.kc(),n.kc(),n.lc(43,"h4",17),n.bd(44),n.yc(45,"translate"),n.kc(),n.lc(46,"clr-accordion"),n.lc(47,"clr-accordion-panel"),n.lc(48,"clr-accordion-title"),n.bd(49),n.yc(50,"translate"),n.kc(),n.Zc(51,Zt,7,6,"clr-accordion-content",18),n.kc(),n.lc(52,"clr-accordion-panel"),n.lc(53,"clr-accordion-title"),n.bd(54),n.yc(55,"translate"),n.kc(),n.Zc(56,Lt,24,27,"clr-accordion-content",18),n.kc(),n.lc(57,"clr-accordion-panel"),n.lc(58,"clr-accordion-title"),n.bd(59),n.yc(60,"translate"),n.kc(),n.Zc(61,Rt,3,5,"clr-accordion-content",18),n.kc(),n.lc(62,"clr-accordion-panel"),n.lc(63,"clr-accordion-title"),n.bd(64),n.yc(65,"translate"),n.kc(),n.Zc(66,Nt,3,5,"clr-accordion-content",18),n.kc(),n.kc(),n.kc(),n.lc(67,"div",19),n.lc(68,"div",20),n.lc(69,"div",21),n.bd(70),n.yc(71,"translate"),n.kc(),n.lc(72,"div",22),n.lc(73,"ul"),n.Zc(74,$t,3,6,"li",0),n.Zc(75,qt,3,6,"li",0),n.Zc(76,Vt,3,6,"li",0),n.Zc(77,Wt,3,3,"li",0),n.Zc(78,Qt,3,3,"li",0),n.kc(),n.kc(),n.lc(79,"div",22),n.lc(80,"label",23),n.bd(81),n.yc(82,"translate"),n.kc(),n.lc(83,"textarea",24),n.vc("ngModelChange",function(t){n.Sc(e);return n.xc().note=t}),n.kc(),n.lc(84,"clr-checkbox-wrapper",25),n.lc(85,"input",26),n.vc("ngModelChange",function(t){n.Sc(e);return n.xc().recalculateShipping=t}),n.kc(),n.lc(86,"label"),n.bd(87),n.yc(88,"translate"),n.kc(),n.kc(),n.kc(),n.lc(89,"div",27),n.lc(90,"button",28),n.vc("click",function(){n.Sc(e);const c=t.ngIf;return n.xc().previewAndModify(c)}),n.bd(91),n.yc(92,"translate"),n.kc(),n.kc(),n.kc(),n.kc(),n.kc(),n.kc()}if(2&e){const e=t.ngIf,c=n.xc();n.Tb(8),n.cd(n.zc(9,34,"order.product-name")),n.Tb(3),n.cd(n.zc(12,36,"order.product-sku")),n.Tb(3),n.cd(n.zc(15,38,"order.unit-price")),n.Tb(3),n.cd(n.zc(18,40,"order.quantity")),n.Tb(2),n.Ec("ngIf",c.orderLineCustomFields.length),n.Tb(2),n.cd(n.zc(22,42,"order.total")),n.Tb(3),n.Ec("ngForOf",e.lines),n.Tb(1),n.Ec("ngForOf",c.addedLines)("ngForTrackBy",c.trackByProductVariantId),n.Tb(1),n.Ec("ngForOf",e.surcharges),n.Tb(1),n.Ec("ngForOf",c.modifyOrderInput.surcharges),n.Tb(3),n.cd(n.zc(31,44,"order.shipping")),n.Tb(3),n.cd(null==e.shippingLines[0]||null==e.shippingLines[0].shippingMethod?null:e.shippingLines[0].shippingMethod.name),n.Tb(2),n.Ec("ngIf",c.orderLineCustomFields.length),n.Tb(2),n.dd(" ",n.Ac(38,46,e.shippingWithTax,e.currencyCode)," "),n.Tb(2),n.Ec("title",n.zc(40,49,"order.net-price")),n.Tb(2),n.dd(" ",n.Ac(42,51,e.shipping,e.currencyCode)," "),n.Tb(3),n.cd(n.zc(45,54,"order.modifications")),n.Tb(5),n.cd(n.zc(50,56,"order.add-item-to-order")),n.Tb(5),n.cd(n.zc(55,58,"order.add-surcharge")),n.Tb(5),n.cd(n.zc(60,60,"order.edit-shipping-address")),n.Tb(5),n.cd(n.zc(65,62,"order.edit-billing-address")),n.Tb(6),n.dd(" ",n.zc(71,64,"order.modification-summary")," "),n.Tb(4),n.Ec("ngIf",null==c.modifyOrderInput.addItems?null:c.modifyOrderInput.addItems.length),n.Tb(1),n.Ec("ngIf",null==c.modifyOrderInput.adjustOrderLines?null:c.modifyOrderInput.adjustOrderLines.length),n.Tb(1),n.Ec("ngIf",null==c.modifyOrderInput.surcharges?null:c.modifyOrderInput.surcharges.length),n.Tb(1),n.Ec("ngIf",c.shippingAddressForm.dirty),n.Tb(1),n.Ec("ngIf",c.billingAddressForm.dirty),n.Tb(3),n.cd(n.zc(82,66,"order.note")),n.Tb(2),n.Ec("ngModel",c.note),n.Tb(2),n.Ec("ngModel",c.recalculateShipping),n.Tb(2),n.cd(n.zc(88,68,"order.modification-recalculate-shipping")),n.Tb(3),n.Ec("disabled",!c.canPreviewChanges()),n.Tb(1),n.dd(" ",n.zc(92,70,"order.preview-changes")," ")}}function Ut(e,t){1&e&&(n.lc(0,"span",12),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.dd(" ",n.zc(2,1,"order.note-only-visible-to-administrators")," "))}function Gt(e,t){1&e&&(n.lc(0,"span",13),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.dd(" ",n.zc(2,1,"order.note-visible-to-customer")," "))}function Bt(e,t){1&e&&(n.lc(0,"div",11),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.dd(" ",n.zc(2,1,"order.history-order-fulfilled")," "))}function Jt(e,t){1&e&&(n.lc(0,"div",11),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.dd(" ",n.zc(2,1,"order.history-order-cancelled")," "))}const Xt=function(e,t){return{from:e,to:t}};function Yt(e,t){if(1&e&&(n.bd(0),n.yc(1,"translate")),2&e){const e=n.xc(2).$implicit;n.dd(" ",n.Ac(1,1,"order.history-order-transition",n.Jc(4,Xt,e.data.from,e.data.to))," ")}}function Kt(e,t){if(1&e&&(n.jc(0),n.Zc(1,Bt,3,3,"div",17),n.Zc(2,Jt,3,3,"div",17),n.Zc(3,Yt,2,7,"ng-template",18),n.ic()),2&e){const e=n.xc().$implicit;n.Tb(1),n.Ec("ngIf","Delivered"===e.data.to),n.Tb(1),n.Ec("ngIf","Cancelled"===e.data.to),n.Tb(1),n.Ec("ngIf","Cancelled"!==e.data.to&&"Delivered"!==e.data.to)}}function ec(e,t){1&e&&(n.lc(0,"vdr-chip",23),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.cd(n.zc(2,1,"order.modification-settled")))}function tc(e,t){1&e&&(n.lc(0,"vdr-chip",24),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.cd(n.zc(2,1,"order.modification-not-settled")))}function cc(e,t){if(1&e&&(n.jc(0),n.bd(1),n.yc(2,"translate"),n.lc(3,"strong"),n.bd(4),n.yc(5,"localeCurrency"),n.kc(),n.Zc(6,ec,3,3,"vdr-chip",20),n.Zc(7,tc,3,3,"vdr-chip",21),n.lc(8,"vdr-history-entry-detail"),n.gc(9,"vdr-modification-detail",22),n.kc(),n.ic()),2&e){const e=t.ngIf,c=n.xc(3);n.Tb(1),n.dd(" ",n.zc(2,6,"order.modify-order-price-difference"),": "),n.Tb(3),n.cd(n.Ac(5,8,e.priceChange,c.order.currencyCode)),n.Tb(2),n.Ec("ngIf",e.isSettled),n.Tb(1),n.Ec("ngIf",!e.isSettled),n.Tb(2),n.Ec("order",c.order)("modification",e)}}function nc(e,t){if(1&e&&(n.jc(0),n.lc(1,"div",11),n.bd(2),n.yc(3,"translate"),n.kc(),n.Zc(4,cc,10,11,"ng-container",19),n.ic()),2&e){const e=n.xc().$implicit,t=n.xc();n.Tb(2),n.dd(" ",n.zc(3,2,"order.history-order-modified")," "),n.Tb(2),n.Ec("ngIf",t.getModification(e.data.modificationId))}}function rc(e,t){if(1&e&&(n.lc(0,"vdr-history-entry-detail"),n.gc(1,"vdr-payment-detail",27),n.kc()),2&e){const e=t.ngIf,c=n.xc(4);n.Tb(1),n.Ec("payment",e)("currencyCode",c.order.currencyCode)}}function ic(e,t){if(1&e&&(n.jc(0),n.lc(1,"div",11),n.bd(2),n.yc(3,"translate"),n.kc(),n.bd(4),n.yc(5,"translate"),n.Zc(6,rc,2,2,"vdr-history-entry-detail",19),n.ic()),2&e){const e=n.xc(2).$implicit,t=n.xc();let c=null;n.Tb(2),n.dd(" ",n.zc(3,4,"order.history-payment-settled")," "),n.Tb(2),n.ed(" ",n.zc(5,6,"order.transaction-id"),": ",null==(c=t.getPayment(e))?null:c.transactionId," "),n.Tb(2),n.Ec("ngIf",t.getPayment(e))}}const oc=function(e,t,c){return{from:e,to:t,id:c}};function dc(e,t){if(1&e&&(n.bd(0),n.yc(1,"translate")),2&e){const e=n.xc(2).$implicit,t=n.xc();let c=null;n.dd(" ",n.Ac(1,1,"order.history-payment-transition",n.Kc(4,oc,e.data.from,e.data.to,null==(c=t.getPayment(e))?null:c.transactionId))," ")}}function lc(e,t){if(1&e&&(n.jc(0),n.Zc(1,ic,7,8,"ng-container",25),n.Zc(2,dc,2,8,"ng-template",null,26,n.ad),n.ic()),2&e){const e=n.Oc(3),t=n.xc().$implicit;n.Tb(1),n.Ec("ngIf","Settled"===t.data.to)("ngIfElse",e)}}function ac(e,t){if(1&e&&(n.jc(0),n.bd(1),n.yc(2,"translate"),n.ic()),2&e){const e=n.xc().$implicit;n.Tb(1),n.dd(" ",n.Ac(2,1,"order.history-refund-transition",n.Kc(4,oc,e.data.from,e.data.to,e.data.refundId))," ")}}function sc(e,t){if(1&e&&(n.lc(0,"vdr-history-entry-detail"),n.lc(1,"vdr-labeled-data",28),n.yc(2,"translate"),n.bd(3),n.kc(),n.lc(4,"vdr-labeled-data",28),n.yc(5,"translate"),n.gc(6,"vdr-simple-item-list",29),n.kc(),n.kc()),2&e){const e=t.ngIf,c=n.xc(2).$implicit;n.Tb(1),n.Ec("label",n.zc(2,4,"order.cancellation-reason")),n.Tb(2),n.dd(" ",c.data.reason," "),n.Tb(1),n.Ec("label",n.zc(5,6,"order.contents")),n.Tb(2),n.Ec("items",e)}}function uc(e,t){if(1&e&&(n.jc(0),n.bd(1),n.yc(2,"translate"),n.Zc(3,sc,7,8,"vdr-history-entry-detail",19),n.ic()),2&e){const e=n.xc().$implicit,t=n.xc();n.Tb(1),n.dd(" ",n.Ac(2,2,"order.history-items-cancelled",n.Ic(5,be,e.data.orderItemIds.length))," "),n.Tb(2),n.Ec("ngIf",t.getCancelledItems(e))}}function fc(e,t){if(1&e&&(n.lc(0,"vdr-history-entry-detail"),n.gc(1,"vdr-fulfillment-detail",30),n.kc()),2&e){const e=t.ngIf,c=n.xc(3);n.Tb(1),n.Ec("fulfillmentId",e.id)("order",c.order)}}function mc(e,t){if(1&e&&(n.jc(0),n.bd(1),n.yc(2,"translate"),n.Zc(3,fc,2,2,"vdr-history-entry-detail",19),n.ic()),2&e){const e=n.xc().$implicit,t=n.xc();n.Tb(1),n.dd(" ",n.zc(2,2,"order.history-fulfillment-created")," "),n.Tb(2),n.Ec("ngIf",t.getFulfillment(e))}}function bc(e,t){if(1&e&&(n.jc(0),n.lc(1,"div",11),n.bd(2),n.yc(3,"translate"),n.kc(),n.bd(4),n.yc(5,"translate"),n.ic()),2&e){const e=n.xc(2).$implicit,t=n.xc();let c=null;n.Tb(2),n.dd(" ",n.zc(3,3,"order.history-fulfillment-delivered")," "),n.Tb(2),n.ed(" ",n.zc(5,5,"order.tracking-code"),": ",null==(c=t.getFulfillment(e))?null:c.trackingCode," ")}}function pc(e,t){if(1&e&&(n.jc(0),n.lc(1,"div",11),n.bd(2),n.yc(3,"translate"),n.kc(),n.bd(4),n.yc(5,"translate"),n.ic()),2&e){const e=n.xc(2).$implicit,t=n.xc();let c=null;n.Tb(2),n.dd(" ",n.zc(3,3,"order.history-fulfillment-shipped")," "),n.Tb(2),n.ed(" ",n.zc(5,5,"order.tracking-code"),": ",null==(c=t.getFulfillment(e))?null:c.trackingCode," ")}}function gc(e,t){if(1&e&&(n.jc(0),n.bd(1),n.yc(2,"translate"),n.ic()),2&e){const e=n.xc(2).$implicit;n.Tb(1),n.dd(" ",n.Ac(2,1,"order.history-fulfillment-transition",n.Jc(4,Xt,e.data.from,e.data.to))," ")}}function yc(e,t){if(1&e&&(n.lc(0,"vdr-history-entry-detail"),n.gc(1,"vdr-fulfillment-detail",30),n.kc()),2&e){const e=t.ngIf,c=n.xc(3);n.Tb(1),n.Ec("fulfillmentId",e.id)("order",c.order)}}function hc(e,t){if(1&e&&(n.jc(0),n.Zc(1,bc,6,7,"ng-container",19),n.Zc(2,pc,6,7,"ng-container",19),n.Zc(3,gc,3,7,"ng-container",19),n.Zc(4,yc,2,2,"vdr-history-entry-detail",19),n.ic()),2&e){const e=n.xc().$implicit,t=n.xc();n.Tb(1),n.Ec("ngIf","Delivered"===e.data.to),n.Tb(1),n.Ec("ngIf","Shipped"===e.data.to),n.Tb(1),n.Ec("ngIf","Delivered"!==e.data.to&&"Shipped"!==e.data.to),n.Tb(1),n.Ec("ngIf",t.getFulfillment(e))}}function vc(e,t){1&e&&(n.lc(0,"span",43),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.cd(n.zc(2,1,"common.public")))}function Tc(e,t){1&e&&(n.lc(0,"span",44),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.cd(n.zc(2,1,"common.private")))}function kc(e,t){if(1&e){const e=n.mc();n.jc(0),n.lc(1,"div",31),n.lc(2,"div",32),n.Zc(3,vc,3,3,"span",33),n.Zc(4,Tc,3,3,"span",34),n.bd(5),n.kc(),n.gc(6,"div",35),n.lc(7,"vdr-dropdown"),n.lc(8,"button",36),n.gc(9,"clr-icon",37),n.kc(),n.lc(10,"vdr-dropdown-menu",38),n.lc(11,"button",39),n.vc("click",function(){n.Sc(e);const t=n.xc().$implicit;return n.xc().updateNote.emit(t)}),n.yc(12,"hasPermission"),n.gc(13,"clr-icon",40),n.bd(14),n.yc(15,"translate"),n.kc(),n.gc(16,"div",41),n.lc(17,"button",39),n.vc("click",function(){n.Sc(e);const t=n.xc().$implicit;return n.xc().deleteNote.emit(t)}),n.yc(18,"hasPermission"),n.gc(19,"clr-icon",42),n.bd(20),n.yc(21,"translate"),n.kc(),n.kc(),n.kc(),n.kc(),n.ic()}if(2&e){const e=n.xc().$implicit;n.Tb(3),n.Ec("ngIf",e.isPublic),n.Tb(1),n.Ec("ngIf",!e.isPublic),n.Tb(1),n.dd(" ",e.data.note," "),n.Tb(6),n.Ec("disabled",!n.zc(12,7,"UpdateOrder")),n.Tb(3),n.dd(" ",n.zc(15,9,"common.edit")," "),n.Tb(3),n.Ec("disabled",!n.zc(18,11,"UpdateOrder")),n.Tb(3),n.dd(" ",n.zc(21,13,"common.delete")," ")}}const Cc=function(e){return["/marketing","promotions",e]};function Oc(e,t){if(1&e&&(n.jc(0),n.bd(1),n.yc(2,"translate"),n.lc(3,"vdr-chip"),n.lc(4,"a",45),n.bd(5),n.kc(),n.kc(),n.ic()),2&e){const e=n.xc().$implicit;n.Tb(1),n.dd(" ",n.zc(2,3,"order.history-coupon-code-applied"),": "),n.Tb(3),n.Ec("routerLink",n.Ic(5,Cc,e.data.promotionId)),n.Tb(1),n.cd(e.data.couponCode)}}function xc(e,t){if(1&e&&(n.jc(0),n.bd(1),n.yc(2,"translate"),n.lc(3,"vdr-chip"),n.lc(4,"span",46),n.bd(5),n.kc(),n.kc(),n.ic()),2&e){const e=n.xc().$implicit;n.Tb(1),n.dd(" ",n.zc(2,2,"order.history-coupon-code-removed"),": "),n.Tb(4),n.cd(e.data.couponCode)}}function Ic(e,t){if(1&e){const e=n.mc();n.lc(0,"vdr-timeline-entry",14),n.vc("expandClick",function(){n.Sc(e);const t=n.xc();return t.expanded=!t.expanded}),n.jc(1,15),n.Zc(2,Kt,4,3,"ng-container",16),n.Zc(3,nc,5,4,"ng-container",16),n.Zc(4,lc,4,2,"ng-container",16),n.Zc(5,ac,3,8,"ng-container",16),n.Zc(6,uc,4,7,"ng-container",16),n.Zc(7,mc,4,4,"ng-container",16),n.Zc(8,hc,5,4,"ng-container",16),n.Zc(9,kc,22,15,"ng-container",16),n.Zc(10,Oc,6,7,"ng-container",16),n.Zc(11,xc,6,4,"ng-container",16),n.ic(),n.kc()}if(2&e){const e=t.$implicit,c=n.xc();n.Ec("displayType",c.getDisplayType(e))("iconShape",c.getTimelineIcon(e))("createdAt",e.createdAt)("name",c.getName(e))("featured",c.isFeatured(e))("collapsed",!c.expanded&&!c.isFeatured(e)),n.Tb(1),n.Ec("ngSwitch",e.type),n.Tb(1),n.Ec("ngSwitchCase",c.type.ORDER_STATE_TRANSITION),n.Tb(1),n.Ec("ngSwitchCase",c.type.ORDER_MODIFIED),n.Tb(1),n.Ec("ngSwitchCase",c.type.ORDER_PAYMENT_TRANSITION),n.Tb(1),n.Ec("ngSwitchCase",c.type.ORDER_REFUND_TRANSITION),n.Tb(1),n.Ec("ngSwitchCase",c.type.ORDER_CANCELLATION),n.Tb(1),n.Ec("ngSwitchCase",c.type.ORDER_FULFILLMENT),n.Tb(1),n.Ec("ngSwitchCase",c.type.ORDER_FULFILLMENT_TRANSITION),n.Tb(1),n.Ec("ngSwitchCase",c.type.ORDER_NOTE),n.Tb(1),n.Ec("ngSwitchCase",c.type.ORDER_COUPON_APPLIED),n.Tb(1),n.Ec("ngSwitchCase",c.type.ORDER_COUPON_REMOVED)}}function Ec(e,t){if(1&e){const e=n.mc();n.lc(0,"button",18),n.vc("click",function(){n.Sc(e);const c=t.$implicit;return n.xc(2).selectFilterPreset(c.name)}),n.bd(1),n.yc(2,"translate"),n.kc()}if(2&e){const e=t.$implicit,c=n.xc().ngIf;n.Xb("btn-primary",c===e.name),n.Tb(1),n.dd(" ",n.zc(2,3,e.label)," ")}}function Sc(e,t){if(1&e){const e=n.mc();n.lc(0,"div",16),n.Zc(1,Ec,3,5,"button",17),n.lc(2,"button",18),n.vc("click",function(){n.Sc(e);return n.xc().selectFilterPreset("custom")}),n.bd(3),n.yc(4,"translate"),n.gc(5,"clr-icon",19),n.kc(),n.kc()}if(2&e){const e=t.ngIf,c=n.xc();n.Tb(1),n.Ec("ngForOf",c.filterPresets),n.Tb(1),n.Xb("btn-primary","custom"===e),n.Tb(1),n.dd(" ",n.zc(4,4,"order.filter-custom")," ")}}function Pc(e,t){if(1&e&&(n.bd(0),n.yc(1,"translate"),n.yc(2,"stateI18nToken")),2&e){const e=t.item;n.cd(n.zc(1,1,n.zc(2,3,e)))}}function Mc(e,t){if(1&e&&(n.lc(0,"span",20),n.bd(1),n.yc(2,"translate"),n.yc(3,"stateI18nToken"),n.kc(),n.lc(4,"span",21),n.vc("click",function(){const e=t.item;return(0,t.clear)(e)}),n.bd(5,"\xd7"),n.kc()),2&e){const e=t.item;n.Tb(1),n.dd(" ",n.zc(2,1,n.zc(3,3,e)),"")}}const Fc=function(e){return["./",e,"modify"]},wc=function(e){return["./",e]};function Ac(e,t){if(1&e&&(n.lc(0,"td",22),n.bd(1),n.kc(),n.lc(2,"td",22),n.gc(3,"vdr-customer-label",23),n.kc(),n.lc(4,"td",22),n.gc(5,"vdr-order-state-label",24),n.kc(),n.lc(6,"td",22),n.bd(7),n.yc(8,"localeCurrency"),n.kc(),n.lc(9,"td",22),n.bd(10),n.yc(11,"timeAgo"),n.kc(),n.lc(12,"td",22),n.bd(13),n.yc(14,"localeDate"),n.kc(),n.lc(15,"td",22),n.bd(16),n.kc(),n.lc(17,"td",25),n.gc(18,"vdr-table-row-action",26),n.yc(19,"translate"),n.kc()),2&e){const e=t.item,c=n.xc();n.Tb(1),n.cd(e.code),n.Tb(2),n.Ec("customer",e.customer),n.Tb(2),n.Ec("state",e.state),n.Tb(2),n.cd(n.Ac(8,9,e.total,e.currencyCode)),n.Tb(3),n.cd(n.zc(11,12,e.updatedAt)),n.Tb(3),n.cd(n.Ac(14,14,e.orderPlacedAt,"medium")),n.Tb(3),n.cd(c.getShippingNames(e)),n.Tb(2),n.Ec("label",n.zc(19,17,"common.open"))("linkTo","Modifying"===e.state?n.Ic(19,Fc,e.id):n.Ic(21,wc,e.id))}}function zc(e,t){if(1&e&&(n.jc(0),n.bd(1),n.ic()),2&e){const e=n.xc();n.Tb(1),n.dd("#",e.payment.transactionId,"")}}function _c(e,t){if(1&e&&(n.lc(0,"vdr-labeled-data",11),n.yc(1,"translate"),n.bd(2),n.kc()),2&e){const e=n.xc().$implicit;n.Ec("label",n.zc(1,2,"order.transaction-id")),n.Tb(2),n.dd(" ",e.transactionId," ")}}function jc(e,t){if(1&e&&(n.lc(0,"vdr-labeled-data",11),n.yc(1,"translate"),n.bd(2),n.kc()),2&e){const e=n.xc().$implicit;n.Ec("label",n.zc(1,2,"order.refund-reason")),n.Tb(2),n.dd(" ",e.reason," ")}}function Zc(e,t){if(1&e&&(n.lc(0,"vdr-labeled-data",11),n.yc(1,"translate"),n.gc(2,"vdr-object-tree",13),n.kc()),2&e){const e=n.xc().$implicit;n.Ec("label",n.zc(1,2,"order.refund-metadata")),n.Tb(2),n.Ec("value",e.metadata)}}function Dc(e,t){if(1&e){const e=n.mc();n.lc(0,"div",14),n.lc(1,"button",15),n.vc("click",function(){n.Sc(e);const t=n.xc().$implicit;return n.xc().settleRefund.emit(t)}),n.bd(2),n.yc(3,"translate"),n.kc(),n.kc()}2&e&&(n.Tb(2),n.dd(" ",n.zc(3,1,"order.settle-refund")," "))}function Lc(e,t){if(1&e&&(n.jc(0),n.lc(1,"div",1),n.gc(2,"clr-icon",9),n.bd(3),n.yc(4,"translate"),n.gc(5,"div",10),n.gc(6,"vdr-refund-state-label",4),n.kc(),n.lc(7,"div",5),n.lc(8,"vdr-labeled-data",11),n.yc(9,"translate"),n.bd(10),n.yc(11,"localeDate"),n.kc(),n.lc(12,"vdr-labeled-data",11),n.yc(13,"translate"),n.bd(14),n.yc(15,"localeCurrency"),n.kc(),n.Zc(16,_c,3,4,"vdr-labeled-data",12),n.Zc(17,jc,3,4,"vdr-labeled-data",12),n.Zc(18,Zc,3,4,"vdr-labeled-data",12),n.kc(),n.Zc(19,Dc,4,3,"div",8),n.ic()),2&e){const e=t.$implicit,c=n.xc();n.Tb(3),n.ed(" ",n.zc(4,11,"order.refund")," #",e.id," "),n.Tb(3),n.Ec("state",e.state),n.Tb(2),n.Ec("label",n.zc(9,13,"common.created-at")),n.Tb(2),n.dd(" ",n.Ac(11,15,e.createdAt,"medium")," "),n.Tb(2),n.Ec("label",n.zc(13,18,"order.refund-total")),n.Tb(2),n.dd(" ",n.Ac(15,20,e.total,c.currencyCode)," "),n.Tb(2),n.Ec("ngIf",e.transactionId),n.Tb(1),n.Ec("ngIf",e.reason),n.Tb(1),n.Ec("ngIf",c.refundHasMetadata(e)),n.Tb(1),n.Ec("ngIf","Pending"===e.state)}}function Rc(e,t){if(1&e){const e=n.mc();n.lc(0,"button",15),n.vc("click",function(){n.Sc(e);const t=n.xc(2);return t.settlePayment.emit(t.payment)}),n.bd(1),n.yc(2,"translate"),n.kc()}2&e&&(n.Tb(1),n.dd(" ",n.zc(2,1,"order.settle-payment")," "))}function Nc(e,t){if(1&e&&(n.jc(0),n.gc(1,"clr-icon",23),n.bd(2),n.yc(3,"translate"),n.yc(4,"translate"),n.yc(5,"stateI18nToken"),n.ic()),2&e){const e=n.xc().$implicit;n.Tb(2),n.dd(" ",n.Ac(3,1,"order.transition-to-state",n.Ic(8,J,n.zc(4,4,n.zc(5,6,e))))," ")}}function $c(e,t){1&e&&(n.gc(0,"clr-icon",24),n.bd(1),n.yc(2,"translate")),2&e&&(n.Tb(1),n.dd(" ",n.zc(2,1,"order.cancel-payment")," "))}function qc(e,t){if(1&e){const e=n.mc();n.jc(0),n.lc(1,"button",20),n.vc("click",function(){n.Sc(e);const c=t.$implicit,r=n.xc(2);return r.transitionPaymentState.emit({payment:r.payment,state:c})}),n.Zc(2,Nc,6,10,"ng-container",21),n.Zc(3,$c,3,3,"ng-template",null,22,n.ad),n.kc(),n.ic()}if(2&e){const e=t.$implicit,c=n.Oc(4);n.Tb(2),n.Ec("ngIf","Cancelled"!==e)("ngIfElse",c)}}function Vc(e,t){if(1&e&&(n.lc(0,"div",14),n.Zc(1,Rc,3,3,"button",16),n.lc(2,"vdr-dropdown"),n.lc(3,"button",17),n.gc(4,"clr-icon",18),n.kc(),n.lc(5,"vdr-dropdown-menu",19),n.Zc(6,qc,5,2,"ng-container",7),n.kc(),n.kc(),n.kc()),2&e){const e=n.xc();n.Tb(1),n.Ec("ngIf",e.payment.nextStates.includes("Settled")),n.Tb(5),n.Ec("ngForOf",e.nextOtherStates())}}function Wc(e,t){if(1&e&&(n.lc(0,"div",3),n.gc(1,"div",4),n.gc(2,"clr-icon",5),n.lc(3,"div",6),n.bd(4),n.yc(5,"translate"),n.yc(6,"stateI18nToken"),n.kc(),n.kc()),2&e){const e=n.xc();n.Tb(4),n.dd(" ",n.zc(5,1,n.zc(6,3,e.cancelledState))," ")}}function Qc(e,t){if(1&e){const e=n.mc();n.jc(0),n.lc(1,"vdr-order-process-node",1),n.vc("mouseenter",function(){n.Sc(e);const c=t.$implicit;return n.xc().onMouseOver(c.name)})("mouseleave",function(){n.Sc(e);return n.xc().onMouseOut()}),n.yc(2,"async"),n.kc(),n.ic()}if(2&e){const e=t.$implicit,c=t.index,r=n.xc();n.Tb(1),n.Ec("node",e)("index",c)("active",n.zc(2,3,r.activeState$)===e.name)}}function Hc(e,t){if(1&e&&(n.jc(0),n.gc(1,"vdr-order-process-edge",2),n.ic()),2&e){const e=t.$implicit;n.Tb(1),n.Ec("from",e.from)("to",e.to)("index",e.index)}}function Uc(e,t){if(1&e&&(n.gc(0,"img",23),n.yc(1,"assetPreview")),2&e){const e=n.xc().$implicit;n.Ec("src",n.Ac(1,1,e.featuredAsset,"tiny"),n.Uc)}}function Gc(e,t){if(1&e&&(n.lc(0,"div",26),n.lc(1,"a",27),n.bd(2),n.kc(),n.lc(3,"div",28),n.bd(4),n.yc(5,"localeCurrency"),n.lc(6,"div",8),n.yc(7,"translate"),n.bd(8),n.yc(9,"localeCurrency"),n.kc(),n.kc(),n.kc()),2&e){const e=t.$implicit,c=n.xc(4);n.Tb(1),n.Ec("routerLink",c.getPromotionLink(e)),n.Tb(1),n.cd(e.description),n.Tb(2),n.dd(" ",n.Ac(5,5,e.amountWithTax,c.order.currencyCode)," "),n.Tb(2),n.Ec("title",n.zc(7,8,"order.net-price")),n.Tb(2),n.dd(" ",n.Ac(9,10,e.amount,c.order.currencyCode)," ")}}function Bc(e,t){if(1&e&&(n.lc(0,"vdr-dropdown"),n.lc(1,"div",24),n.bd(2),n.yc(3,"translate"),n.kc(),n.lc(4,"vdr-dropdown-menu"),n.Zc(5,Gc,10,13,"div",25),n.kc(),n.kc()),2&e){const e=n.xc().ngIf;n.Tb(2),n.dd(" ",n.zc(3,2,"order.promotions-applied")," "),n.Tb(3),n.Ec("ngForOf",e)}}function Jc(e,t){if(1&e&&(n.jc(0),n.Zc(1,Bc,6,4,"vdr-dropdown",22),n.ic()),2&e){const e=t.ngIf;n.Tb(1),n.Ec("ngIf",e.length)}}function Xc(e,t){if(1&e&&(n.lc(0,"div",32),n.gc(1,"vdr-custom-field-control",33),n.kc()),2&e){const e=t.$implicit;n.Tb(1),n.Ec("compact",!0)("readonly",!0)("customField",e.config)("customFieldsFormGroup",e.formGroup)}}function Yc(e,t){if(1&e&&(n.lc(0,"tr"),n.lc(1,"td",29),n.lc(2,"div",30),n.Zc(3,Xc,2,4,"div",31),n.kc(),n.kc(),n.kc()),2&e){const e=n.xc().ngIf;n.Tb(3),n.Ec("ngForOf",e)}}function Kc(e,t){if(1&e&&(n.jc(0),n.Zc(1,Yc,4,1,"tr",22),n.ic()),2&e){const e=t.ngIf;n.Tb(1),n.Ec("ngIf",e.length)}}function en(e,t){if(1&e&&(n.jc(0),n.lc(1,"tr",12),n.lc(2,"td",13),n.Zc(3,Uc,2,4,"img",14),n.kc(),n.lc(4,"td",15),n.bd(5),n.kc(),n.lc(6,"td",16),n.bd(7),n.kc(),n.lc(8,"td",17),n.bd(9),n.yc(10,"localeCurrency"),n.lc(11,"div",8),n.yc(12,"translate"),n.bd(13),n.yc(14,"localeCurrency"),n.kc(),n.kc(),n.lc(15,"td",18),n.bd(16),n.gc(17,"vdr-line-refunds",19),n.gc(18,"vdr-line-fulfillment",20),n.kc(),n.lc(19,"td",21),n.bd(20),n.yc(21,"localeCurrency"),n.lc(22,"div",8),n.yc(23,"translate"),n.bd(24),n.yc(25,"localeCurrency"),n.kc(),n.Zc(26,Jc,2,1,"ng-container",22),n.kc(),n.kc(),n.Zc(27,Kc,2,1,"ng-container",22),n.ic()),2&e){const e=t.$implicit,c=n.xc();n.Tb(1),n.Xb("is-cancelled",0===e.quantity),n.Tb(2),n.Ec("ngIf",e.featuredAsset),n.Tb(2),n.cd(e.productVariant.name),n.Tb(2),n.cd(e.productVariant.sku),n.Tb(2),n.dd(" ",n.Ac(10,18,e.unitPriceWithTax,c.order.currencyCode)," "),n.Tb(2),n.Ec("title",n.zc(12,21,"order.net-price")),n.Tb(2),n.dd(" ",n.Ac(14,23,e.unitPrice,c.order.currencyCode)," "),n.Tb(3),n.dd(" ",e.quantity," "),n.Tb(1),n.Ec("line",e)("payments",c.order.payments),n.Tb(1),n.Ec("line",e)("orderState",c.order.state),n.Tb(2),n.dd(" ",n.Ac(21,26,e.linePriceWithTax,c.order.currencyCode)," "),n.Tb(2),n.Ec("title",n.zc(23,29,"order.net-price")),n.Tb(2),n.dd(" ",n.Ac(25,31,e.linePrice,c.order.currencyCode)," "),n.Tb(2),n.Ec("ngIf",c.getLineDiscounts(e)),n.Tb(1),n.Ec("ngIf",c.customFieldsForLine[e.id])}}function tn(e,t){if(1&e&&(n.lc(0,"tr",34),n.lc(1,"td",35),n.bd(2),n.kc(),n.lc(3,"td",16),n.bd(4),n.kc(),n.gc(5,"td",36),n.lc(6,"td",21),n.bd(7),n.yc(8,"localeCurrency"),n.lc(9,"div",8),n.yc(10,"translate"),n.bd(11),n.yc(12,"localeCurrency"),n.kc(),n.kc(),n.kc()),2&e){const e=t.$implicit,c=n.xc();n.Tb(2),n.cd(e.description),n.Tb(2),n.cd(e.sku),n.Tb(3),n.dd(" ",n.Ac(8,5,e.priceWithTax,c.order.currencyCode)," "),n.Tb(2),n.Ec("title",n.zc(10,8,"order.net-price")),n.Tb(2),n.dd(" ",n.Ac(12,10,e.price,c.order.currencyCode)," ")}}function cn(e,t){if(1&e&&(n.lc(0,"vdr-chip"),n.bd(1),n.kc()),2&e){const e=t.ngIf;n.Tb(1),n.cd(e)}}function nn(e,t){if(1&e&&(n.lc(0,"tr",37),n.lc(1,"td",38),n.lc(2,"a",39),n.bd(3),n.kc(),n.Zc(4,cn,2,1,"vdr-chip",22),n.kc(),n.lc(5,"td",7),n.bd(6),n.yc(7,"localeCurrency"),n.lc(8,"div",8),n.yc(9,"translate"),n.bd(10),n.yc(11,"localeCurrency"),n.kc(),n.kc(),n.kc()),2&e){const e=t.$implicit,c=n.xc();n.Tb(2),n.Ec("routerLink",c.getPromotionLink(e)),n.Tb(1),n.cd(e.description),n.Tb(1),n.Ec("ngIf",c.getCouponCodeForAdjustment(c.order,e)),n.Tb(2),n.dd(" ",n.Ac(7,6,e.amountWithTax,c.order.currencyCode)," "),n.Tb(2),n.Ec("title",n.zc(9,9,"order.net-price")),n.Tb(2),n.dd(" ",n.Ac(11,11,e.amount,c.order.currencyCode)," ")}}function rn(e,t){if(1&e&&(n.lc(0,"vdr-labeled-data",0),n.yc(1,"translate"),n.bd(2),n.kc()),2&e){const e=n.xc();n.Ec("label",n.zc(1,2,"order.error-message")),n.Tb(2),n.dd(" ",e.payment.errorMessage,"\n")}}function on(e,t){if(1&e&&(n.lc(0,"vdr-labeled-data",0),n.yc(1,"translate"),n.bd(2),n.kc()),2&e){const e=n.xc();n.Ec("label",n.zc(1,2,"order.transaction-id")),n.Tb(2),n.dd(" ",e.payment.transactionId,"\n")}}function dn(e,t){1&e&&n.gc(0,"clr-icon",2)}function ln(e,t){1&e&&n.gc(0,"clr-icon",2)}function an(e,t){if(1&e&&(n.lc(0,"li",2),n.lc(1,"div",3),n.bd(2),n.kc(),n.gc(3,"clr-icon",4),n.bd(4),n.kc()),2&e){const e=t.$implicit;n.Ec("title",e.name),n.Tb(2),n.cd(e.quantity),n.Tb(2),n.dd(" ",e.name," ")}}class sn{constructor(e){this.dataService=e,this.form=new r.i({method:new r.f("",r.C.required),transactionId:new r.f("",r.C.required)})}ngOnInit(){this.paymentMethods$=this.dataService.settings.getPaymentMethods(999).mapSingle(e=>e.paymentMethods.items)}submit(){const e=this.form.value;this.resolveWith({method:e.method,transactionId:e.transactionId})}cancel(){this.resolveWith()}}sn.\u0275fac=function(e){return new(e||sn)(n.fc(i.L))},sn.\u0275cmp=n.Zb({type:sn,selectors:[["vdr-add-manual-payment-dialog"]],decls:10,vars:11,consts:[["vdrDialogTitle",""],[3,"formGroup"],["for","method",3,"label"],["bindLabel","code","autofocus","","bindValue","code","formControlName","method",3,"items","addTag"],["for","transactionId",3,"label"],["id","transactionId","type","text","formControlName","transactionId"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(n.Zc(0,j,2,3,"ng-template",0),n.lc(1,"form",1),n.lc(2,"vdr-form-field",2),n.yc(3,"translate"),n.gc(4,"ng-select",3),n.yc(5,"async"),n.kc(),n.lc(6,"vdr-form-field",4),n.yc(7,"translate"),n.gc(8,"input",5),n.kc(),n.kc(),n.Zc(9,Z,7,11,"ng-template",6)),2&e&&(n.Tb(1),n.Ec("formGroup",t.form),n.Tb(1),n.Ec("label",n.zc(3,5,"order.payment-method")),n.Tb(2),n.Ec("items",n.zc(5,7,t.paymentMethods$))("addTag",!0),n.Tb(2),n.Ec("label",n.zc(7,9,"order.transaction-id")))},directives:[i.R,r.E,r.q,r.j,i.db,F.a,r.p,r.h,i.eb,r.b,i.Q],pipes:[w.d,A.b,i.zb],styles:[".ng-select[_ngcontent-%COMP%]{min-width:100%}"],changeDetection:0}),sn.ctorParameters=()=>[{type:i.L}];class un{constructor(e){this.i18nService=e,this.lineQuantities={},this.reasons=[Object(o.a)("order.cancel-reason-customer-request"),Object(o.a)("order.cancel-reason-not-available")],this.reasons=this.reasons.map(e=>this.i18nService.translate(e))}get selectionCount(){return Object.values(this.lineQuantities).reduce((e,t)=>e+t,0)}ngOnInit(){this.lineQuantities=this.order.lines.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.id]:0}),{})}select(){this.resolveWith({orderId:this.order.id,lines:this.getLineInputs(),reason:this.reason})}cancel(){this.resolveWith()}getLineInputs(){if(!this.order.active)return Object.entries(this.lineQuantities).map(([e,t])=>({orderLineId:e,quantity:t})).filter(e=>0<e.quantity)}}un.\u0275fac=function(e){return new(e||un)(n.fc(i.nb))},un.\u0275cmp=n.Zb({type:un,selectors:[["vdr-cancel-order-dialog"]],decls:29,vars:22,consts:[["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-lines"],[1,"table"],["class","order-line",3,"is-cancelled",4,"ngFor","ngForOf"],[1,"cancellation-details"],[1,"clr-control-label"],["bindLabel","name","autofocus","","bindValue","id",3,"items","addTag","ngModel","ngModelChange"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"ngModel","max","ngModelChange",4,"ngIf","ngIfElse"],["nonEditable",""],["type","number","min","0",3,"ngModel","max","ngModelChange"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf"]],template:function(e,t){1&e&&(n.Zc(0,D,2,3,"ng-template",0),n.lc(1,"div",1),n.lc(2,"div",2),n.lc(3,"table",3),n.lc(4,"thead"),n.lc(5,"tr"),n.gc(6,"th"),n.lc(7,"th"),n.bd(8),n.yc(9,"translate"),n.kc(),n.lc(10,"th"),n.bd(11),n.yc(12,"translate"),n.kc(),n.lc(13,"th"),n.bd(14),n.yc(15,"translate"),n.kc(),n.lc(16,"th"),n.bd(17),n.yc(18,"translate"),n.kc(),n.lc(19,"th"),n.bd(20),n.yc(21,"translate"),n.kc(),n.kc(),n.kc(),n.Zc(22,N,17,15,"tr",4),n.kc(),n.kc(),n.lc(23,"div",5),n.lc(24,"label",6),n.bd(25),n.yc(26,"translate"),n.kc(),n.lc(27,"ng-select",7),n.vc("ngModelChange",function(e){return t.reason=e}),n.kc(),n.kc(),n.kc(),n.Zc(28,V,6,6,"ng-template",8)),2&e&&(n.Tb(8),n.cd(n.zc(9,10,"order.product-name")),n.Tb(3),n.cd(n.zc(12,12,"order.product-sku")),n.Tb(3),n.cd(n.zc(15,14,"order.quantity")),n.Tb(3),n.cd(n.zc(18,16,"order.unit-price")),n.Tb(3),n.cd(n.zc(21,18,"order.cancel")),n.Tb(2),n.Ec("ngForOf",t.order.lines),n.Tb(3),n.cd(n.zc(26,20,"order.cancellation-reason")),n.Tb(2),n.Ec("items",t.reasons)("addTag",!0)("ngModel",t.reason))},directives:[i.R,A.n,z.u,F.a,r.p,r.s,i.Q,A.o,i.eb,r.v,r.b],pipes:[w.d,i.r,i.zb],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .cancellation-details[_ngcontent-%COMP%]{margin-top:0;margin-left:24px;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}.fulfillment-wrapper[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}"],changeDetection:0}),un.ctorParameters=()=>[{type:i.nb}];class fn{constructor(e,t){this.dataService=e,this.changeDetector=t,this.fulfillmentHandlerControl=new r.f,this.fulfillmentQuantities={}}ngOnInit(){this.dataService.settings.getGlobalSettings().single$.subscribe(({globalSettings:e})=>{this.fulfillmentQuantities=this.order.lines.reduce((t,c)=>{const n=this.getFulfillableCount(c,e.trackInventory);return Object.assign(Object.assign({},t),{[c.id]:{fulfillCount:n,max:n}})},{}),this.changeDetector.markForCheck()}),this.dataService.shippingMethod.getShippingMethodOperations().mapSingle(e=>e.fulfillmentHandlers).subscribe(e=>{this.fulfillmentHandlerDef=e.find(e=>{var t,c;return e.code===(null===(c=null===(t=this.order.shippingLines[0])||void 0===t?void 0:t.shippingMethod)||void 0===c?void 0:c.fulfillmentHandlerCode)})||e[0],this.fulfillmentHandler=Object(i.Yb)(this.fulfillmentHandlerDef),this.fulfillmentHandlerControl.patchValue(this.fulfillmentHandler),this.changeDetector.markForCheck()})}getFulfillableCount(e,t){const{trackInventory:c,stockOnHand:n}=e.productVariant,r=c===i.hb.INHERIT?t:c===i.hb.TRUE,o=this.getUnfulfilledCount(e);return r?Math.min(o,n):o}getUnfulfilledCount(e){const t=e.items.reduce((e,t)=>e+(t.fulfillment?1:0),0);return e.quantity-t}canSubmit(){const e=Object.values(this.fulfillmentQuantities).reduce((e,{fulfillCount:t})=>e+t,0);return Object(i.Zb)(this.fulfillmentHandlerDef,this.fulfillmentHandlerControl.value)&&this.fulfillmentHandlerControl.valid&&0<e}select(){const e=Object.entries(this.fulfillmentQuantities).map(([e,{fulfillCount:t}])=>({orderLineId:e,quantity:t}));this.resolveWith({lines:e,handler:Object(i.lc)(this.fulfillmentHandler,this.fulfillmentHandlerControl.value)})}cancel(){this.resolveWith()}}fn.\u0275fac=function(e){return new(e||fn)(n.fc(i.L),n.fc(n.k))},fn.\u0275cmp=n.Zb({type:fn,selectors:[["vdr-fulfill-order-dialog"]],decls:34,vars:29,consts:[["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-table"],[1,"table"],["class","order-line",3,"ignore",4,"ngFor","ngForOf"],[1,"shipping-details"],[3,"address"],[3,"operationDefinition","operation","formControl","removable"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"disabled","ngModel","max","ngModelChange",4,"ngIf"],[3,"src"],["type","number","min","0",3,"disabled","ngModel","max","ngModelChange"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(n.Zc(0,W,2,3,"ng-template",0),n.lc(1,"div",1),n.lc(2,"div",2),n.lc(3,"table",3),n.lc(4,"thead"),n.lc(5,"tr"),n.gc(6,"th"),n.lc(7,"th"),n.bd(8),n.yc(9,"translate"),n.kc(),n.lc(10,"th"),n.bd(11),n.yc(12,"translate"),n.kc(),n.lc(13,"th"),n.bd(14),n.yc(15,"translate"),n.kc(),n.lc(16,"th"),n.bd(17),n.yc(18,"translate"),n.kc(),n.lc(19,"th"),n.bd(20),n.yc(21,"translate"),n.kc(),n.kc(),n.kc(),n.Zc(22,U,13,8,"tr",4),n.kc(),n.kc(),n.lc(23,"div",5),n.gc(24,"vdr-formatted-address",6),n.lc(25,"h6"),n.bd(26),n.yc(27,"translate"),n.kc(),n.bd(28),n.lc(29,"strong"),n.bd(30),n.yc(31,"localeCurrency"),n.kc(),n.gc(32,"vdr-configurable-input",7),n.kc(),n.kc(),n.Zc(33,G,6,7,"ng-template",8)),2&e&&(n.Tb(8),n.cd(n.zc(9,14,"order.product-name")),n.Tb(3),n.cd(n.zc(12,16,"order.product-sku")),n.Tb(3),n.cd(n.zc(15,18,"order.unfulfilled")),n.Tb(3),n.cd(n.zc(18,20,"catalog.stock-on-hand")),n.Tb(3),n.cd(n.zc(21,22,"order.fulfill")),n.Tb(2),n.Ec("ngForOf",t.order.lines),n.Tb(2),n.Ec("address",t.order.shippingAddress),n.Tb(2),n.cd(n.zc(27,24,"order.shipping-method")),n.Tb(2),n.dd(" ",null==t.order.shippingLines[0]||null==t.order.shippingLines[0].shippingMethod?null:t.order.shippingLines[0].shippingMethod.name," "),n.Tb(2),n.cd(n.Ac(31,26,t.order.shipping,t.order.currencyCode)),n.Tb(2),n.Ec("operationDefinition",t.fulfillmentHandlerDef)("operation",t.fulfillmentHandler)("formControl",t.fulfillmentHandlerControl)("removable",!1))},directives:[i.R,A.n,i.gb,i.E,r.p,r.g,i.Q,A.o,i.eb,r.v,r.b,r.s],pipes:[w.d,i.zb,i.r],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-top:24px}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-top:0;margin-left:24px;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]   clr-input-container[_ngcontent-%COMP%]{margin-top:24px}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}"],changeDetection:0}),fn.ctorParameters=()=>[{type:i.L},{type:n.k}];class mn{constructor(){this.transitionState=new n.u}nextSuggestedState(){var e;if(!this.fulfillment)return;const{nextStates:t}=this.fulfillment,c=e=>t.includes(e)?e:t[0];switch(null===(e=this.fulfillment)||void 0===e?void 0:e.state){case"Pending":return c("Shipped");case"Shipped":return c("Delivered");default:return t.find(e=>"Cancelled"!==e)}}nextOtherStates(){if(!this.fulfillment)return[];const e=this.nextSuggestedState();return this.fulfillment.nextStates.filter(t=>t!==e)}}mn.\u0275fac=function(e){return new(e||mn)},mn.\u0275cmp=n.Zb({type:mn,selectors:[["vdr-fulfillment-card"]],inputs:{fulfillment:"fulfillment",order:"order"},outputs:{transitionState:"transitionState"},decls:10,vars:6,consts:[[1,"card"],[1,"card-header","fulfillment-header"],[1,"fulfillment-state"],[3,"state"],[1,"card-block"],[3,"fulfillmentId","order",4,"ngIf"],["class","card-footer",4,"ngIf"],[3,"fulfillmentId","order"],[1,"card-footer"],[4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-primary",3,"click"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],[4,"ngIf","ngIfElse"],["cancel",""],["shape","step-forward-2"],["shape","error-standard",1,"is-error"]],template:function(e,t){1&e&&(n.lc(0,"div",0),n.lc(1,"div",1),n.lc(2,"div"),n.bd(3),n.yc(4,"translate"),n.kc(),n.lc(5,"div",2),n.gc(6,"vdr-fulfillment-state-label",3),n.kc(),n.kc(),n.lc(7,"div",4),n.Zc(8,B,1,2,"vdr-fulfillment-detail",5),n.kc(),n.Zc(9,te,7,2,"div",6),n.kc()),2&e&&(n.Tb(3),n.cd(n.zc(4,4,"order.fulfillment")),n.Tb(3),n.Ec("state",null==t.fulfillment?null:t.fulfillment.state),n.Tb(2),n.Ec("ngIf",!!t.fulfillment),n.Tb(1),n.Ec("ngIf",null==t.fulfillment?null:t.fulfillment.nextStates.length))},directives:function(){return[pn,A.o,bn,i.T,i.W,z.o,i.V,A.n,i.U]},pipes:function(){return[w.d,i.Rb]},styles:[".fulfillment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}"],changeDetection:0}),mn.propDecorators={fulfillment:[{type:n.E}],order:[{type:n.E}],transitionState:[{type:n.P}]};class bn{constructor(e){this.serverConfigService=e,this.customFieldConfig=[],this.customFieldFormGroup=new r.i({})}ngOnInit(){this.customFieldConfig=this.serverConfigService.getCustomFieldsFor("Fulfillment")}ngOnChanges(e){this.buildCustomFieldsFormGroup()}get fulfillment(){return this.order.fulfillments&&this.order.fulfillments.find(e=>e.id===this.fulfillmentId)}get items(){var e;const t=new Map,c=null===(e=this.fulfillment)||void 0===e?void 0:e.orderItems.map(e=>e.id);for(const n of this.order.lines)for(const e of n.items)if(null==c?void 0:c.includes(e.id)){const e=t.get(n.productVariant.name);null!=e?t.set(n.productVariant.name,e+1):t.set(n.productVariant.name,1)}return Array.from(t.entries()).map(([e,t])=>({name:e,quantity:t}))}buildCustomFieldsFormGroup(){const e=this.fulfillment.customFields;for(const t of this.serverConfigService.getCustomFieldsFor("Fulfillment"))this.customFieldFormGroup.addControl(t.name,new r.f(e[t.name]))}customFieldIsObject(e){return Array.isArray(e)||Object(d.isObject)(e)}}bn.\u0275fac=function(e){return new(e||bn)(n.fc(i.Mb))},bn.\u0275cmp=n.Zb({type:bn,selectors:[["vdr-fulfillment-detail"]],inputs:{fulfillmentId:"fulfillmentId",order:"order"},features:[n.Rb],decls:12,vars:17,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"items"],[4,"ngFor","ngForOf"],[3,"readonly","compact","customField","customFieldsFormGroup",4,"ngIf"],[3,"readonly","compact","customField","customFieldsFormGroup"]],template:function(e,t){1&e&&(n.lc(0,"vdr-labeled-data",0),n.yc(1,"translate"),n.bd(2),n.yc(3,"localeDate"),n.kc(),n.lc(4,"vdr-labeled-data",0),n.yc(5,"translate"),n.bd(6),n.kc(),n.Zc(7,ce,3,4,"vdr-labeled-data",1),n.lc(8,"vdr-labeled-data",0),n.yc(9,"translate"),n.gc(10,"vdr-simple-item-list",2),n.kc(),n.Zc(11,re,2,1,"ng-container",3)),2&e&&(n.Ec("label",n.zc(1,8,"common.created-at")),n.Tb(2),n.dd(" ",n.Ac(3,10,null==t.fulfillment?null:t.fulfillment.createdAt,"medium"),"\n"),n.Tb(2),n.Ec("label",n.zc(5,13,"order.fulfillment-method")),n.Tb(2),n.dd(" ",null==t.fulfillment?null:t.fulfillment.method,"\n"),n.Tb(1),n.Ec("ngIf",null==t.fulfillment?null:t.fulfillment.trackingCode),n.Tb(1),n.Ec("label",n.zc(9,15,"order.contents")),n.Tb(2),n.Ec("items",t.items),n.Tb(1),n.Ec("ngForOf",t.customFieldConfig))},directives:function(){return[i.ub,A.o,Nn,A.n,i.I]},pipes:function(){return[w.d,i.Ab]},styles:[""],changeDetection:0}),bn.ctorParameters=()=>[{type:i.Mb}],bn.propDecorators={fulfillmentId:[{type:n.E}],order:[{type:n.E}]};class pn{get chipColorType(){switch(this.state){case"Pending":case"Shipped":return"warning";case"Delivered":return"success";case"Cancelled":return"error"}}}pn.\u0275fac=function(e){return new(e||pn)},pn.\u0275cmp=n.Zb({type:pn,selectors:[["vdr-fulfillment-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(e,t){1&e&&(n.lc(0,"vdr-chip",0),n.yc(1,"translate"),n.Zc(2,ie,1,0,"clr-icon",1),n.bd(3),n.yc(4,"translate"),n.yc(5,"stateI18nToken"),n.kc()),2&e&&(n.Ec("title",n.zc(1,4,"order.payment-state"))("colorType",t.chipColorType),n.Tb(2),n.Ec("ngIf","Delivered"===t.state),n.Tb(1),n.dd(" ",n.zc(4,6,n.zc(5,8,t.state)),"\n"))},directives:[i.D,A.o,z.o],pipes:[w.d,i.Rb],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0}),pn.propDecorators={state:[{type:n.E}]};class gn{constructor(){this.fulfilledCount=0,this.fulfillments=[]}ngOnChanges(e){this.line&&(this.fulfilledCount=this.getDeliveredCount(this.line),this.fulfillmentStatus=this.getFulfillmentStatus(this.fulfilledCount,this.line.items.length),this.fulfillments=this.getFulfillments(this.line))}getDeliveredCount(e){return e.items.reduce((e,t)=>e+(t.fulfillment?1:0),0)}getFulfillmentStatus(e,t){return e===t?"full":0<e&&e<t?"partial":"none"}getFulfillments(e){const t={};for(const n of e.items)n.fulfillment&&(void 0===t[n.fulfillment.id]?t[n.fulfillment.id]=1:t[n.fulfillment.id]++);const c=e.items.reduce((e,t)=>t.fulfillment?[...e,t.fulfillment]:e,[]);return Object.entries(t).map(([e,t])=>({count:t,fulfillment:c.find(t=>t.id===e)}))}}gn.\u0275fac=function(e){return new(e||gn)},gn.\u0275cmp=n.Zb({type:gn,selectors:[["vdr-line-fulfillment"]],inputs:{line:"line",orderState:"orderState"},features:[n.Rb],decls:1,vars:1,consts:[["class","search-settings-menu",4,"ngIf"],[1,"search-settings-menu"],["type","button","vdrDropdownTrigger","",1,"icon-button"],["class","item-fulfilled","shape","check-circle",4,"ngIf"],["class","item-partially-fulfilled","shape","check-circle",4,"ngIf"],["class","item-not-fulfilled","shape","exclamation-circle",4,"ngIf"],["vdrPosition","bottom-right"],["class","dropdown-header",4,"ngIf"],["class","fulfillment-detail",4,"ngFor","ngForOf"],["shape","check-circle",1,"item-fulfilled"],["shape","check-circle",1,"item-partially-fulfilled"],["shape","exclamation-circle",1,"item-not-fulfilled"],[1,"dropdown-header"],[1,"fulfillment-detail"],[1,"fulfillment-title"],[3,"label"],[3,"label",4,"ngIf"]],template:function(e,t){1&e&&n.Zc(0,ge,10,7,"vdr-dropdown",0),2&e&&n.Ec("ngIf",t.fulfilledCount||"PartiallyDelivered"===t.orderState)},directives:[A.o,i.T,i.W,i.V,A.n,z.o,z.u,i.ub],pipes:[w.d,i.Ab],styles:[".item-fulfilled[_ngcontent-%COMP%]{color:var(--color-success-500)}.item-partially-fulfilled[_ngcontent-%COMP%]{color:var(--color-warning-500)}.item-not-fulfilled[_ngcontent-%COMP%]{color:var(--color-error-500)}.fulfillment-detail[_ngcontent-%COMP%]{margin:6px 12px}.fulfillment-detail[_ngcontent-%COMP%]:not(:last-of-type){border-bottom:1px dashed var(--color-component-border-200)}"],changeDetection:0}),gn.propDecorators={line:[{type:n.E}],orderState:[{type:n.E}]};class yn{getRefundedCount(){var e,t;const c=null!==(t=null===(e=this.payments)||void 0===e?void 0:e.reduce((e,t)=>[...e,...t.refunds],[]))&&void 0!==t?t:[];return this.line.items.filter(e=>{if(null===e.refundId&&!e.cancelled)return!1;if(e.refundId){const t=c.find(t=>t.id===e.refundId);return"Failed"!==(null==t?void 0:t.state)}return!1}).length}}yn.\u0275fac=function(e){return new(e||yn)},yn.\u0275cmp=n.Zb({type:yn,selectors:[["vdr-line-refunds"]],inputs:{line:"line",payments:"payments"},decls:1,vars:1,consts:[[3,"title",4,"ngIf"],[3,"title"],["shape","redo","dir","down",1,"is-solid"]],template:function(e,t){1&e&&n.Zc(0,ye,3,6,"span",0),2&e&&n.Ec("ngIf",t.getRefundedCount())},directives:[A.o,z.o,_.b],pipes:[w.d],styles:["[_nghost-%COMP%]{color:var(--color-error-500)}"],changeDetection:0}),yn.propDecorators={line:[{type:n.E}],payments:[{type:n.E}]};class hn{constructor(){this.addedItems=new Map,this.removedItems=new Map}ngOnChanges(){const{added:e,removed:t}=this.getModifiedLines();this.addedItems=e,this.removedItems=t}getSurcharge(e){return this.order.surcharges.find(t=>t.id===e)}getAddedItems(){return[...this.addedItems.entries()].map(([e,t])=>({name:e.productVariant.name,quantity:t}))}getRemovedItems(){return[...this.removedItems.entries()].map(([e,t])=>({name:e.productVariant.name,quantity:t}))}getModifiedLines(){var e,t;const c=new Map,n=new Map;for(const r of this.modification.orderItems||[]){const i=this.getOrderLineAndItem(r.id);if(i){const{line:r,item:o}=i;if(o.cancelled){const t=null!==(e=n.get(r))&&void 0!==e?e:0;n.set(r,t+1)}else{const e=null!==(t=c.get(r))&&void 0!==t?t:0;c.set(r,e+1)}}}return{added:c,removed:n}}getOrderLineAndItem(e){for(const t of this.order.lines){const c=t.items.find(t=>t.id===e);if(c)return{line:t,item:c}}}}hn.\u0275fac=function(e){return new(e||hn)},hn.\u0275cmp=n.Zb({type:hn,selectors:[["vdr-modification-detail"]],inputs:{order:"order",modification:"modification"},features:[n.Rb],decls:7,vars:8,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"label",4,"ngFor","ngForOf"],[3,"items"]],template:function(e,t){1&e&&(n.lc(0,"vdr-labeled-data",0),n.yc(1,"translate"),n.bd(2),n.kc(),n.Zc(3,he,3,4,"vdr-labeled-data",1),n.Zc(4,ve,4,8,"vdr-labeled-data",2),n.Zc(5,Te,3,4,"vdr-labeled-data",1),n.Zc(6,ke,3,4,"vdr-labeled-data",1)),2&e&&(n.Ec("label",n.zc(1,6,"common.ID")),n.Tb(2),n.cd(t.modification.id),n.Tb(1),n.Ec("ngIf",t.modification.note),n.Tb(1),n.Ec("ngForOf",t.modification.surcharges),n.Tb(1),n.Ec("ngIf",t.getAddedItems().length),n.Tb(1),n.Ec("ngIf",t.getRemovedItems().length))},directives:function(){return[i.ub,A.o,A.n,Nn]},pipes:function(){return[w.d,i.zb]},styles:[""],changeDetection:0}),hn.propDecorators={order:[{type:n.E}],modification:[{type:n.E}]};class vn{constructor(e){this.formBuilder=e,this.customFieldsConfig=[],this.customFieldValues={},this.updateClick=new n.u,this.editable=!1}ngOnInit(){this.customFieldForm=this.formBuilder.group({});for(const e of this.customFieldsConfig)this.customFieldForm.addControl(e.name,this.formBuilder.control(this.customFieldValues[e.name]))}onUpdateClick(){this.updateClick.emit(this.customFieldForm.value),this.customFieldForm.markAsPristine(),this.editable=!1}}vn.\u0275fac=function(e){return new(e||vn)(n.fc(r.e))},vn.\u0275cmp=n.Zb({type:vn,selectors:[["vdr-order-custom-fields-card"]],inputs:{customFieldsConfig:"customFieldsConfig",customFieldValues:"customFieldValues"},outputs:{updateClick:"updateClick"},decls:1,vars:1,consts:[["class","card",4,"ngIf"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"card-text","custom-field-form"],[4,"ngFor","ngForOf"],[1,"card-footer"],["class","btn btn-sm btn-secondary",3,"click",4,"ngIf"],["class","btn btn-sm btn-primary",3,"disabled","click",4,"ngIf"],["entityName","Order",3,"customFieldsFormGroup","compact","readonly","customField"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","pencil"],[1,"btn","btn-sm","btn-primary",3,"disabled","click"],["shape","check"]],template:function(e,t){1&e&&n.Zc(0,Ie,10,8,"div",0),2&e&&n.Ec("ngIf",t.customFieldsConfig.length)},directives:[A.o,A.n,i.I,z.o],pipes:[w.d],styles:["vdr-custom-field-control[_ngcontent-%COMP%]{margin-bottom:6px;display:block}.custom-field-form[_ngcontent-%COMP%]     .clr-control-label{color:var(--color-grey-400)}.custom-field-form.editable[_ngcontent-%COMP%]     .clr-control-label{color:inherit}"],changeDetection:0}),vn.ctorParameters=()=>[{type:r.e}],vn.propDecorators={customFieldsConfig:[{type:n.E}],customFieldValues:[{type:n.E}],updateClick:[{type:n.P}]};class Tn{constructor(){this.nextStates=[],this.message="",this.selectedState=""}select(){this.selectedState&&this.resolveWith(this.selectedState)}cancel(){this.resolveWith()}}Tn.\u0275fac=function(e){return new(e||Tn)},Tn.\u0275cmp=n.Zb({type:Tn,selectors:[["vdr-order-state-select-dialog"]],decls:8,vars:5,consts:[["vdrDialogTitle",""],["clrSelect","","name","state",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["vdrDialogButtons",""],[3,"value"],["type","submit","class","btn btn-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],["type","submit",1,"btn","btn-secondary",3,"click"]],template:function(e,t){1&e&&(n.Zc(0,Ee,2,3,"ng-template",0),n.lc(1,"p"),n.bd(2),n.yc(3,"translate"),n.kc(),n.lc(4,"clr-select-container"),n.lc(5,"select",1),n.vc("ngModelChange",function(e){return t.selectedState=e}),n.Zc(6,Se,4,6,"option",2),n.kc(),n.kc(),n.Zc(7,Me,6,12,"ng-template",3)),2&e&&(n.Tb(2),n.cd(n.zc(3,3,t.message)),n.Tb(3),n.Ec("ngModel",t.selectedState),n.Tb(1),n.Ec("ngForOf",t.nextStates))},directives:[i.R,z.B,i.eb,r.A,z.A,r.p,r.s,A.n,i.Q,r.u,r.D,A.o],pipes:[w.d,i.Rb],styles:[""],changeDetection:0});class kn{constructor(e,t,c,n){this.dataService=e,this.modalService=t,this.notificationService=c,this.i18nService=n}transitionToPreModifyingState(e,t){return this.getPreModifyingState(e).pipe(Object(b.a)(c=>{const n={orderId:e,nextStates:t,message:this.i18nService.translate(Object(o.a)("order.unable-to-transition-to-state-try-another"),{state:c}),cancellable:!1,retry:10};return c?this.transitionToStateOrThrow(e,c).pipe(Object(p.a)(e=>this.manuallyTransitionToState(n))):this.manuallyTransitionToState(n)}))}manuallyTransitionToState(e){return this.modalService.fromComponent(Tn,{locals:{nextStates:e.nextStates,cancellable:e.cancellable,message:e.message},closable:!1,size:"md"}).pipe(Object(b.a)(t=>{if(t)return this.transitionToStateOrThrow(e.orderId,t);if(e.cancellable)return a.a;throw new Error("An order state must be selected")}),(t=t=>t.pipe(Object(v.a)(2e3),Object(T.a)(e.retry)),e=>e.lift(new y(t,e))));var t}getPreModifyingState(e){return this.dataService.order.getOrderHistory(e,{filter:{type:{eq:i.mb.ORDER_STATE_TRANSITION}},sort:{createdAt:i.Pb.DESC}}).mapSingle(e=>e.order).pipe(Object(k.a)(e=>{const t=null==e?void 0:e.history.items.find(e=>"Modifying"===e.data.to);return t?t.data.from:void 0}))}transitionToStateOrThrow(e,t){return this.dataService.order.transitionToState(e,t).pipe(Object(k.a)(({transitionOrderToState:e})=>{switch(null==e?void 0:e.__typename){case"Order":return null==e?void 0:e.state;case"OrderStateTransitionError":throw this.notificationService.error(null==e?void 0:e.transitionError),new Error(null==e?void 0:e.transitionError)}}))}}kn.\u0275fac=function(e){return new(e||kn)(n.sc(i.L),n.sc(i.Db),n.sc(i.Eb),n.sc(i.nb))},kn.\u0275prov=Object(n.bc)({factory:function(){return new kn(Object(n.sc)(i.L),Object(n.sc)(i.Db),Object(n.sc)(i.Eb),Object(n.sc)(i.nb))},token:kn,providedIn:"root"}),kn.ctorParameters=()=>[{type:i.L},{type:i.Db},{type:i.Eb},{type:i.nb}];class Cn{constructor(e){this.serverConfigService=e,this.states=[]}ngOnInit(){this.states=this.serverConfigService.getOrderProcessStates()}}Cn.\u0275fac=function(e){return new(e||Cn)(n.fc(i.Mb))},Cn.\u0275cmp=n.Zb({type:Cn,selectors:[["vdr-order-process-graph-dialog"]],decls:2,vars:2,consts:[["vdrDialogTitle",""],[3,"states","initialState"]],template:function(e,t){1&e&&(n.Zc(0,Fe,2,3,"ng-template",0),n.gc(1,"vdr-order-process-graph",1)),2&e&&(n.Tb(1),n.Ec("states",t.states)("initialState",t.activeState))},directives:function(){return[i.R,jn]},pipes:function(){return[w.d]},styles:[""],changeDetection:0}),Cn.ctorParameters=()=>[{type:i.Mb}];class On{constructor(e){this.i18nService=e,this.lineQuantities={},this.refundShipping=!1,this.adjustment=0,this.reasons=[Object(o.a)("order.refund-reason-customer-request"),Object(o.a)("order.refund-reason-not-available")],this.reasons=this.reasons.map(e=>this.i18nService.translate(e))}get refundTotal(){return this.order.lines.reduce((e,t)=>{const c=this.lineQuantities[t.id],n=c.refund&&c.quantity||0;return e+t.proratedUnitPriceWithTax*n},0)+(this.refundShipping?this.order.shippingWithTax:0)+this.adjustment}get settledPaymentsTotal(){return this.settledPayments.map(e=>e.amount-Object(d.summate)(e.refunds.filter(e=>"Failed"!==e.state),"total")).reduce((e,t)=>e+t,0)}lineCanBeRefundedOrCancelled(e){var t,c;const n=null!==(c=null===(t=this.order.payments)||void 0===t?void 0:t.reduce((e,t)=>[...e,...t.refunds],[]))&&void 0!==c?c:[];return 0<e.items.filter(e=>{if(e.cancelled)return!1;if(null==e.refundId)return!0;const t=n.find(t=>t.id===e.refundId);return"Failed"===(null==t?void 0:t.state)}).length}ngOnInit(){this.lineQuantities=this.order.lines.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.id]:{quantity:0,refund:!1,cancel:!1}}),{}),this.settledPayments=(this.order.payments||[]).filter(e=>"Settled"===e.state),this.settledPayments.length&&(this.selectedPayment=this.settledPayments[0])}handleZeroQuantity(e){0===(null==e?void 0:e.quantity)&&(e.cancel=!1,e.refund=!1)}isRefunding(){return Object.values(this.lineQuantities).reduce((e,t)=>e||0<t.quantity&&t.refund,!1)}isCancelling(){return Object.values(this.lineQuantities).reduce((e,t)=>e||0<t.quantity&&t.cancel,!1)}canSubmit(){return this.isRefunding()?!!(this.selectedPayment&&this.reason&&0<this.refundTotal&&this.refundTotal<=this.settledPaymentsTotal):!!this.isCancelling()&&!!this.reason}select(){const e=this.selectedPayment;if(e){const t=this.getOrderLineInput(e=>e.refund),c=this.getOrderLineInput(e=>e.cancel);this.resolveWith({refund:{lines:t,reason:this.reason,shipping:this.refundShipping?this.order.shippingWithTax:0,adjustment:this.adjustment,paymentId:e.id},cancel:{lines:c,orderId:this.order.id,reason:this.reason}})}}cancel(){this.resolveWith()}getOrderLineInput(e){return Object.entries(this.lineQuantities).filter(([t,c])=>0<c.quantity&&e(c)).map(([e,t])=>({orderLineId:e,quantity:t.quantity}))}}On.\u0275fac=function(e){return new(e||On)(n.fc(i.nb))},On.\u0275cmp=n.Zb({type:On,selectors:[["vdr-refund-order-dialog"]],decls:69,vars:74,consts:[["vdrDialogTitle",""],[1,"refund-wrapper"],[1,"order-table"],[1,"table"],["class","order-line",4,"ngFor","ngForOf"],[1,"refund-details","mt4"],[1,"clr-control-label"],["bindLabel","name","autofocus","","bindValue","id",3,"disabled","items","placeholder","addTag","ngModel","ngModelChange"],["clrSelect","","name","options",3,"ngModel","disabled","ngModelChange"],[3,"ngValue","disabled",4,"ngFor","ngForOf"],["type","checkbox","clrCheckbox","",3,"ngModel","disabled","ngModelChange"],["clrInput","",3,"disabled","currencyCode","ngModel","ngModelChange"],[1,"totals"],[1,"order-total"],[1,"refund-total"],["class","refund-total-error",4,"ngIf"],["class","refund-total-warning",4,"ngIf"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[3,"line","payments"],[1,"prorated-wrapper"],[4,"ngIf"],[1,"align-middle","fulfil"],["type","number","min","0",3,"ngModel","max","ngModelChange","input",4,"ngIf"],[1,"align-middle"],[1,"cancel-checkbox-wrapper"],["type","checkbox","clrCheckbox","",3,"disabled","ngModel","ngModelChange",4,"ngIf"],["vdrDropdownTrigger","",1,"promotions-label"],[1,"icon-button"],["shape","info"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-amount"],["type","number","min","0",3,"ngModel","max","ngModelChange","input"],["type","checkbox","clrCheckbox","",3,"disabled","ngModel","ngModelChange"],[3,"ngValue","disabled"],[1,"refund-total-error"],[1,"refund-total-warning"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf","ngIfElse"],["cancelling",""]],template:function(e,t){1&e&&(n.Zc(0,we,2,3,"ng-template",0),n.lc(1,"div",1),n.lc(2,"div",2),n.lc(3,"table",3),n.lc(4,"thead"),n.lc(5,"tr"),n.gc(6,"th"),n.lc(7,"th"),n.bd(8),n.yc(9,"translate"),n.kc(),n.lc(10,"th"),n.bd(11),n.yc(12,"translate"),n.kc(),n.lc(13,"th"),n.bd(14),n.yc(15,"translate"),n.kc(),n.lc(16,"th"),n.bd(17),n.yc(18,"translate"),n.kc(),n.lc(19,"th"),n.bd(20),n.yc(21,"translate"),n.kc(),n.lc(22,"th"),n.bd(23),n.yc(24,"translate"),n.kc(),n.lc(25,"th"),n.bd(26),n.yc(27,"translate"),n.kc(),n.lc(28,"th"),n.bd(29),n.yc(30,"translate"),n.kc(),n.kc(),n.kc(),n.Zc(31,Le,27,21,"tr",4),n.kc(),n.kc(),n.lc(32,"div",5),n.lc(33,"div"),n.lc(34,"label",6),n.bd(35),n.yc(36,"translate"),n.kc(),n.lc(37,"ng-select",7),n.vc("ngModelChange",function(e){return t.reason=e}),n.yc(38,"translate"),n.kc(),n.kc(),n.lc(39,"div"),n.lc(40,"clr-select-container"),n.lc(41,"label"),n.bd(42),n.yc(43,"translate"),n.kc(),n.lc(44,"select",8),n.vc("ngModelChange",function(e){return t.selectedPayment=e}),n.Zc(45,Re,3,8,"option",9),n.kc(),n.kc(),n.lc(46,"clr-checkbox-wrapper"),n.lc(47,"input",10),n.vc("ngModelChange",function(e){return t.refundShipping=e}),n.kc(),n.lc(48,"label"),n.bd(49),n.yc(50,"translate"),n.yc(51,"localeCurrency"),n.kc(),n.kc(),n.lc(52,"clr-input-container"),n.lc(53,"label"),n.bd(54),n.yc(55,"translate"),n.kc(),n.lc(56,"vdr-currency-input",11),n.vc("ngModelChange",function(e){return t.adjustment=e}),n.kc(),n.kc(),n.lc(57,"div",12),n.lc(58,"div",13),n.bd(59),n.yc(60,"translate"),n.yc(61,"localeCurrency"),n.kc(),n.lc(62,"div",14),n.bd(63),n.yc(64,"translate"),n.yc(65,"localeCurrency"),n.kc(),n.Zc(66,$e,5,13,"div",15),n.Zc(67,qe,3,3,"div",16),n.kc(),n.kc(),n.kc(),n.kc(),n.Zc(68,He,7,6,"ng-template",17)),2&e&&(n.Tb(8),n.cd(n.zc(9,35,"order.product-name")),n.Tb(3),n.cd(n.zc(12,37,"order.product-sku")),n.Tb(3),n.cd(n.zc(15,39,"order.quantity")),n.Tb(3),n.cd(n.zc(18,41,"order.unit-price")),n.Tb(3),n.cd(n.zc(21,43,"order.prorated-unit-price")),n.Tb(3),n.cd(n.zc(24,45,"order.quantity")),n.Tb(3),n.cd(n.zc(27,47,"order.refund")),n.Tb(3),n.cd(n.zc(30,49,"order.cancel")),n.Tb(2),n.Ec("ngForOf",t.order.lines),n.Tb(4),n.cd(n.zc(36,51,"order.refund-cancellation-reason")),n.Tb(2),n.Ec("disabled",!t.isRefunding()&&!t.isCancelling())("items",t.reasons)("placeholder",n.zc(38,53,"order.refund-cancellation-reason-required"))("addTag",!0)("ngModel",t.reason),n.Tb(5),n.cd(n.zc(43,55,"order.payment-to-refund")),n.Tb(2),n.Ec("ngModel",t.selectedPayment)("disabled",!t.isRefunding()),n.Tb(1),n.Ec("ngForOf",t.settledPayments),n.Tb(2),n.Ec("ngModel",t.refundShipping)("disabled",!t.isRefunding()),n.Tb(2),n.ed(" ",n.zc(50,57,"order.refund-shipping")," (",n.Ac(51,59,t.order.shippingWithTax,t.order.currencyCode),") "),n.Tb(5),n.cd(n.zc(55,62,"order.refund-adjustment")),n.Tb(2),n.Ec("disabled",!t.isRefunding())("currencyCode",t.order.currencyCode)("ngModel",t.adjustment),n.Tb(1),n.Xb("disabled",!t.isRefunding()),n.Tb(2),n.ed(" ",n.zc(60,64,"order.payment-amount"),": ",n.Ac(61,66,t.selectedPayment.amount,t.order.currencyCode)," "),n.Tb(4),n.ed(" ",n.zc(64,69,"order.refund-total"),": ",n.Ac(65,71,t.refundTotal,t.order.currencyCode)," "),n.Tb(3),n.Ec("ngIf",t.refundTotal<0||t.settledPaymentsTotal<t.refundTotal),n.Tb(1),n.Ec("ngIf",t.selectedPayment.amount<t.refundTotal))},directives:[i.R,A.n,z.u,F.a,r.p,r.s,z.B,i.eb,r.A,z.A,z.k,r.a,z.i,z.t,i.H,z.s,A.o,i.Q,yn,i.T,i.W,z.o,i.V,r.v,r.b,r.u,r.D],pipes:[w.d,i.zb,i.r,A.d,A.f],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.refund-wrapper[_ngcontent-%COMP%]{flex:1;flex-direction:column}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.refund-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}.cancel-checkbox-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}clr-checkbox-wrapper[_ngcontent-%COMP%]{margin-top:12px;margin-bottom:12px;display:block}.refund-details[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.totals[_ngcontent-%COMP%]{margin-top:48px}.totals[_ngcontent-%COMP%]   .refund-total[_ngcontent-%COMP%]{font-size:18px}.totals[_ngcontent-%COMP%]   .refund-total-error[_ngcontent-%COMP%]{color:var(--color-error-500)}.totals[_ngcontent-%COMP%]   .refund-total-warning[_ngcontent-%COMP%]{color:var(--color-warning-600);max-width:250px}.totals.disabled[_ngcontent-%COMP%]{color:var(--color-grey-300)}.prorated-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.line-promotion[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;padding:3px 6px}.line-promotion[_ngcontent-%COMP%]   .promotion-amount[_ngcontent-%COMP%]{margin-left:12px}"],changeDetection:0}),On.ctorParameters=()=>[{type:i.nb}];class xn{constructor(){this.transactionId=""}submit(){this.resolveWith(this.transactionId)}cancel(){this.resolveWith()}}xn.\u0275fac=function(e){return new(e||xn)},xn.\u0275cmp=n.Zb({type:xn,selectors:[["vdr-settle-refund-dialog"]],decls:10,vars:10,consts:[["vdrDialogTitle",""],[1,"instruction"],["clrInput","","name","transactionId",3,"ngModel","ngModelChange"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(n.Zc(0,Ue,2,3,"ng-template",0),n.lc(1,"p",1),n.bd(2),n.yc(3,"translate"),n.kc(),n.lc(4,"clr-input-container"),n.lc(5,"label"),n.bd(6),n.yc(7,"translate"),n.kc(),n.lc(8,"input",2),n.vc("ngModelChange",function(e){return t.transactionId=e}),n.kc(),n.kc(),n.Zc(9,Ge,6,7,"ng-template",3)),2&e&&(n.Tb(2),n.dd(" ",n.Ac(3,3,"order.settle-refund-manual-instructions",n.Ic(8,Be,t.refund.method)),"\n"),n.Tb(4),n.cd(n.zc(7,6,"order.transaction-id")),n.Tb(2),n.Ec("ngModel",t.transactionId))},directives:[i.R,z.t,z.u,i.eb,r.b,z.s,r.p,r.s,i.Q],pipes:[w.d],styles:["[_nghost-%COMP%]{padding-bottom:32px}.instruction[_ngcontent-%COMP%]{margin-top:0;margin-bottom:24px}"],changeDetection:0});class In extends i.w{constructor(e,t,c,n,i,o,d,l){super(t,e,c,i),this.changeDetector=n,this.dataService=i,this.notificationService=o,this.modalService=d,this.orderTransitionService=l,this.detailForm=new r.i({}),this.fetchHistory=new s.a,this.defaultStates=["AddingItems","ArrangingPayment","PaymentAuthorized","PaymentSettled","PartiallyShipped","Shipped","PartiallyDelivered","Delivered","Cancelled","Modifying","ArrangingAdditionalPayment"]}ngOnInit(){this.init(),this.entity$.pipe(Object(T.a)(1)).subscribe(e=>{"Modifying"===e.state&&this.router.navigate(["./","modify"],{relativeTo:this.route})}),this.customFields=this.getCustomFieldConfig("Order"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.history$=this.fetchHistory.pipe(Object(C.a)(null),Object(b.a)(()=>this.dataService.order.getOrderHistory(this.id,{sort:{createdAt:i.Pb.DESC}}).mapStream(e=>{var t;return null===(t=e.order)||void 0===t?void 0:t.history.items}))),this.nextStates$=this.entity$.pipe(Object(k.a)(e=>!this.defaultStates.includes(e.state)?e.nextStates:e.nextStates.filter(e=>!this.defaultStates.includes(e))))}ngOnDestroy(){this.destroy()}openStateDiagram(){this.entity$.pipe(Object(T.a)(1),Object(b.a)(e=>this.modalService.fromComponent(Cn,{closable:!0,locals:{activeState:e.state}}))).subscribe()}transitionToState(e){this.dataService.order.transitionToState(this.id,e).subscribe(({transitionOrderToState:t})=>{switch(null==t?void 0:t.__typename){case"Order":this.notificationService.success(Object(o.a)("order.transitioned-to-state-success"),{state:e}),this.fetchHistory.next();break;case"OrderStateTransitionError":this.notificationService.error(t.transitionError)}})}manuallyTransitionToState(e){this.orderTransitionService.manuallyTransitionToState({orderId:e.id,nextStates:e.nextStates,cancellable:!0,message:Object(o.a)("order.manually-transition-to-state-message"),retry:0}).subscribe()}transitionToModifying(){this.dataService.order.transitionToState(this.id,"Modifying").subscribe(({transitionOrderToState:e})=>{switch(null==e?void 0:e.__typename){case"Order":this.router.navigate(["./modify"],{relativeTo:this.route});break;case"OrderStateTransitionError":this.notificationService.error(e.transitionError)}})}updateCustomFields(e){this.dataService.order.updateOrderCustomFields({id:this.id,customFields:e}).subscribe(()=>{this.notificationService.success(Object(o.a)("common.notify-update-success"),{entity:"Order"})})}getOrderAddressLines(e){return e?Object.values(e).filter(e=>"OrderAddress"!==e).filter(e=>!!e):[]}settlePayment(e){this.dataService.order.settlePayment(e.id).subscribe(({settlePayment:e})=>{switch(e.__typename){case"Payment":"Settled"===e.state?this.notificationService.success(Object(o.a)("order.settle-payment-success")):this.notificationService.error(Object(o.a)("order.settle-payment-error")),this.dataService.order.getOrder(this.id).single$.subscribe(),this.fetchHistory.next();break;case"OrderStateTransitionError":case"PaymentStateTransitionError":case"SettlePaymentError":this.notificationService.error(e.message)}})}transitionPaymentState({payment:e,state:t}){this.dataService.order.transitionPaymentToState(e.id,t).subscribe(({transitionPaymentToState:e})=>{switch(e.__typename){case"Payment":this.notificationService.success(Object(o.a)("order.transitioned-payment-to-state-success"),{state:t}),this.dataService.order.getOrder(this.id).single$.subscribe(),this.fetchHistory.next();break;case"PaymentStateTransitionError":this.notificationService.error(e.message)}})}canAddFulfillment(e){return!e.lines.reduce((e,t)=>[...e,...t.items],[]).every(e=>!!e.fulfillment)&&!this.hasUnsettledModifications(e)&&0===this.outstandingPaymentAmount(e)&&(e.nextStates.includes("Shipped")||e.nextStates.includes("PartiallyShipped")||e.nextStates.includes("Delivered"))}hasUnsettledModifications(e){return 0<e.modifications.filter(e=>!e.isSettled).length}getOutstandingModificationAmount(e){return Object(d.summate)(e.modifications.filter(e=>!e.isSettled),"priceChange")}outstandingPaymentAmount(e){var t,c,n;const r=e=>"Cancelled"!==e.state&&"Declined"!==e.state&&"Error"!==e.state;let i=0;for(const o of null!==(c=null===(t=e.payments)||void 0===t?void 0:t.filter(r))&&void 0!==c?c:[]){const e=null!==(n=o.refunds.filter(e=>"Failed"!==e.state))&&void 0!==n?n:[],t=Object(d.summate)(e,"total");i+=o.amount-t}return e.totalWithTax-i}addManualPayment(e){this.modalService.fromComponent(sn,{closable:!0,locals:{outstandingAmount:this.outstandingPaymentAmount(e),currencyCode:e.currencyCode}}).pipe(Object(b.a)(e=>e?this.dataService.order.addManualPaymentToOrder({orderId:this.id,transactionId:e.transactionId,method:e.method,metadata:e.metadata||{}}):a.a),Object(b.a)(({addManualPaymentToOrder:t})=>{switch(t.__typename){case"Order":return this.notificationService.success(Object(o.a)("order.add-payment-to-order-success")),this.orderTransitionService.transitionToPreModifyingState(e.id,e.nextStates);case"ManualPaymentStateError":return this.notificationService.error(t.message),a.a;default:return a.a}})).subscribe(e=>{e&&this.refetchOrder({result:e})})}fulfillOrder(){this.entity$.pipe(Object(T.a)(1),Object(b.a)(e=>this.modalService.fromComponent(fn,{size:"xl",locals:{order:e}})),Object(b.a)(e=>e?this.dataService.order.createFulfillment(e):Object(u.a)(void 0)),Object(b.a)(e=>this.refetchOrder(e).pipe(Object(O.a)(e)))).subscribe(e=>{if(e){const{addFulfillmentToOrder:t}=e;switch(t.__typename){case"Fulfillment":this.notificationService.success(Object(o.a)("order.create-fulfillment-success"));break;case"EmptyOrderLineSelectionError":case"InsufficientStockOnHandError":case"ItemsAlreadyFulfilledError":case"InvalidFulfillmentHandlerError":this.notificationService.error(t.message);break;case"FulfillmentStateTransitionError":this.notificationService.error(t.transitionError);break;case"CreateFulfillmentError":this.notificationService.error(t.fulfillmentHandlerError);break;case void 0:this.notificationService.error(JSON.stringify(t));break;default:Object(d.assertNever)(t)}}})}transitionFulfillment(e,t){this.dataService.order.transitionFulfillmentToState(e,t).pipe(Object(b.a)(e=>this.refetchOrder(e))).subscribe(()=>{this.notificationService.success(Object(o.a)("order.successfully-updated-fulfillment"))})}cancelOrRefund(e){const t=this.orderHasSettledPayments(e);"PaymentAuthorized"!==e.state&&!0!==e.active&&t?this.refundOrder(e):this.cancelOrder(e)}settleRefund(e){this.modalService.fromComponent(xn,{size:"md",locals:{refund:e}}).pipe(Object(b.a)(t=>t?this.dataService.order.settleRefund({transactionId:t,id:e.id},this.id):Object(u.a)(void 0))).subscribe(e=>{e&&this.notificationService.success(Object(o.a)("order.settle-refund-success"))})}addNote(e){const{note:t,isPublic:c}=e;this.dataService.order.addNoteToOrder({id:this.id,note:t,isPublic:c}).pipe(Object(b.a)(e=>this.refetchOrder(e))).subscribe(e=>{this.notificationService.success(Object(o.a)("common.notify-create-success"),{entity:"Note"})})}updateNote(e){this.modalService.fromComponent(i.Y,{closable:!0,locals:{displayPrivacyControls:!0,note:e.data.note,noteIsPrivate:!e.isPublic}}).pipe(Object(b.a)(t=>t?this.dataService.order.updateOrderNote({noteId:e.id,isPublic:!t.isPrivate,note:t.note}):a.a)).subscribe(e=>{this.fetchHistory.next(),this.notificationService.success(Object(o.a)("common.notify-update-success"),{entity:"Note"})})}deleteNote(e){return this.modalService.dialog({title:Object(o.a)("common.confirm-delete-note"),body:e.data.note,buttons:[{type:"secondary",label:Object(o.a)("common.cancel")},{type:"danger",label:Object(o.a)("common.delete"),returnValue:!0}]}).pipe(Object(b.a)(t=>t?this.dataService.order.deleteOrderNote(e.id):a.a)).subscribe(()=>{this.fetchHistory.next(),this.notificationService.success(Object(o.a)("common.notify-delete-success"),{entity:"Note"})})}orderHasSettledPayments(e){var t;return!!(null===(t=e.payments)||void 0===t?void 0:t.find(e=>"Settled"===e.state))}cancelOrder(e){this.modalService.fromComponent(un,{size:"xl",locals:{order:e}}).pipe(Object(b.a)(e=>e?this.dataService.order.cancelOrder(e):Object(u.a)(void 0)),Object(b.a)(e=>this.refetchOrder(e))).subscribe(e=>{e&&this.notificationService.success(Object(o.a)("order.cancelled-order-success"))})}refundOrder(e){this.modalService.fromComponent(On,{size:"xl",locals:{order:e}}).pipe(Object(b.a)(e=>{var t;if(!e)return Object(u.a)(void 0);const c=[];return e.refund.lines.length&&c.push(this.dataService.order.refundOrder(e.refund).pipe(Object(k.a)(e=>e.refundOrder))),(null===(t=e.cancel.lines)||void 0===t?void 0:t.length)&&c.push(this.dataService.order.cancelOrder(e.cancel).pipe(Object(k.a)(e=>e.cancelOrder))),Object(f.a)(...c)})).subscribe(e=>{if(e)switch(e.__typename){case"Order":this.refetchOrder(e).subscribe(),this.notificationService.success(Object(o.a)("order.cancelled-order-success"));break;case"Refund":this.refetchOrder(e).subscribe(),"Failed"===e.state?this.notificationService.error(Object(o.a)("order.refund-order-failed")):this.notificationService.success(Object(o.a)("order.refund-order-success"));break;case"QuantityTooGreatError":case"MultipleOrderError":case"OrderStateTransitionError":case"CancelActiveOrderError":case"EmptyOrderLineSelectionError":case"AlreadyRefundedError":case"NothingToRefundError":case"PaymentOrderMismatchError":case"RefundOrderStateError":case"RefundStateTransitionError":this.notificationService.error(e.message)}})}refetchOrder(e){return this.fetchHistory.next(),e?this.dataService.order.getOrder(this.id).single$:Object(u.a)(void 0)}setFormValues(e){}}var En;In.\u0275fac=function(e){return new(e||In)(n.fc(l.e),n.fc(l.a),n.fc(i.Mb),n.fc(n.k),n.fc(i.L),n.fc(i.Eb),n.fc(i.Db),n.fc(kn))},In.\u0275cmp=n.Zb({type:In,selectors:[["vdr-order-detail"]],features:[n.Qb],decls:4,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"entity"],[3,"state"],[1,"icon-button",3,"title","click"],["shape","list"],["locationId","order-detail"],["class","btn btn-primary",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","class","btn","vdrDropdownItem","",3,"click",4,"ngIf"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],["shape","step-forward-2",1,"is-warning"],[1,"btn","btn-primary",3,"click"],["shape","pencil"],["shape","error-standard",1,"is-error"],[4,"ngIf","ngIfElse"],["cancelOnly",""],["type","button","class","btn","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["shape","step-forward-2"],[1,"clr-row"],[1,"clr-col-lg-8"],[3,"order","orderLineCustomFields"],[1,"table"],[4,"ngFor","ngForOf"],[3,"order","history","addNote","updateNote","deleteNote"],[1,"clr-col-lg-4","order-cards"],[3,"customFieldsConfig","customFieldValues","updateClick"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"card-text"],[3,"customer"],[3,"address"],[3,"currencyCode","payment","settlePayment","transitionPaymentState","settleRefund",4,"ngFor","ngForOf"],[3,"currencyCode","payment","settlePayment","transitionPaymentState","settleRefund"],[3,"fulfillment","order","transitionState"]],template:function(e,t){1&e&&(n.Zc(0,rt,29,21,"vdr-action-bar",0),n.yc(1,"async"),n.Zc(2,ut,41,34,"div",0),n.yc(3,"async")),2&e&&(n.Ec("ngIf",n.zc(1,2,t.entity$)),n.Tb(2),n.Ec("ngIf",n.zc(3,4,t.entity$)))},directives:function(){return[A.o,i.c,i.e,i.ab,i.Gb,z.o,i.f,i.d,i.T,i.W,i.V,i.U,A.n,Zn,Mn,vn,i.J,i.gb,wn,mn]},pipes:function(){return[A.b,w.d,i.zb,i.Rb,A.v]},styles:[".shipping-address[_ngcontent-%COMP%]{list-style-type:none;line-height:1.3em}.order-cards[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin-top:6px;color:var(--color-text-200)}"],changeDetection:0}),In.ctorParameters=()=>[{type:l.e},{type:l.a},{type:i.Mb},{type:n.k},{type:i.L},{type:i.Eb},{type:i.Db},{type:kn}],function(e){e[e.Refund=0]="Refund",e[e.Payment=1]="Payment",e[e.PriceUnchanged=2]="PriceUnchanged",e[e.Cancel=3]="Cancel"}(En||(En={}));class Sn{get priceDifference(){return this.order.totalWithTax-this.originalTotalWithTax}ngOnInit(){this.refundNote=this.modifyOrderInput.note||""}cancel(){this.resolveWith({result:En.Cancel})}submit(){0<this.priceDifference?this.resolveWith({result:En.Payment}):this.priceDifference<0?this.resolveWith({result:En.Refund,refundPaymentId:this.selectedPayment.id,refundNote:this.refundNote}):this.resolveWith({result:En.PriceUnchanged})}}Sn.\u0275fac=function(e){return new(e||Sn)},Sn.\u0275cmp=n.Zb({type:Sn,selectors:[["vdr-order-edits-preview-dialog"]],decls:10,vars:10,consts:[["vdrDialogTitle",""],[3,"order","orderLineCustomFields"],[1,"h4"],[4,"ngIf"],["vdrDialogButtons",""],["clrSelect","","name","options",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"clr-control-label"],["name","refundNote","clrTextarea","","required","",3,"ngModel","ngModelChange"],[3,"ngValue"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(n.Zc(0,ft,2,3,"ng-template",0),n.gc(1,"vdr-order-table",1),n.lc(2,"h4",2),n.bd(3),n.yc(4,"translate"),n.lc(5,"strong"),n.bd(6),n.yc(7,"localeCurrency"),n.kc(),n.kc(),n.Zc(8,bt,11,9,"div",3),n.Zc(9,pt,6,7,"ng-template",4)),2&e&&(n.Tb(1),n.Ec("order",t.order)("orderLineCustomFields",t.orderLineCustomFields),n.Tb(2),n.dd(" ",n.zc(4,5,"order.modify-order-price-difference"),": "),n.Tb(3),n.cd(n.Ac(7,7,t.priceDifference,t.order.currencyCode)),n.Tb(2),n.Ec("ngIf",t.priceDifference<0))},directives:function(){return[i.R,Zn,A.o,i.Q,z.B,z.u,i.eb,r.A,z.A,r.p,r.s,A.n,r.b,z.H,r.z,r.u,r.D]},pipes:function(){return[w.d,i.zb]},styles:[""],changeDetection:0});class Pn extends i.w{constructor(e,t,c,n,i,o,d,l){super(t,e,c,i),this.changeDetector=n,this.dataService=i,this.notificationService=o,this.modalService=d,this.orderTransitionService=l,this.detailForm=new r.i({}),this.modifyOrderInput={dryRun:!0,orderId:"",addItems:[],adjustOrderLines:[],surcharges:[],note:"",updateShippingAddress:{},updateBillingAddress:{}},this.note="",this.recalculateShipping=!0,this.addedVariants=new Map}get addedLines(){const e=e=>"SinglePrice"===e.__typename?e.value:0;return(this.modifyOrderInput.addItems||[]).map(t=>{const c=this.addedVariants.get(t.productVariantId);if(c)return Object.assign(Object.assign({},c),{price:e(c.price),priceWithTax:e(c.priceWithTax),quantity:t.quantity})}).filter(d.notNullOrUndefined)}ngOnInit(){this.init(),this.addressCustomFields=this.getCustomFieldConfig("Address"),this.modifyOrderInput.orderId=this.route.snapshot.paramMap.get("id"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.entity$.pipe(Object(x.a)(this.destroy$)).subscribe(e=>{var t,c,n,i,o,d,l,a,s,u,f,m,b,p,g,y,h,v;this.surchargeForm=new r.i({description:new r.f("",r.C.required),sku:new r.f(""),price:new r.f(0,r.C.required),priceIncludesTax:new r.f(!0),taxRate:new r.f(0),taxDescription:new r.f("")}),this.shippingAddressForm||(this.shippingAddressForm=new r.i({fullName:new r.f(null===(t=e.shippingAddress)||void 0===t?void 0:t.fullName),company:new r.f(null===(c=e.shippingAddress)||void 0===c?void 0:c.company),streetLine1:new r.f(null===(n=e.shippingAddress)||void 0===n?void 0:n.streetLine1),streetLine2:new r.f(null===(i=e.shippingAddress)||void 0===i?void 0:i.streetLine2),city:new r.f(null===(o=e.shippingAddress)||void 0===o?void 0:o.city),province:new r.f(null===(d=e.shippingAddress)||void 0===d?void 0:d.province),postalCode:new r.f(null===(l=e.shippingAddress)||void 0===l?void 0:l.postalCode),countryCode:new r.f(null===(a=e.shippingAddress)||void 0===a?void 0:a.countryCode),phoneNumber:new r.f(null===(s=e.shippingAddress)||void 0===s?void 0:s.phoneNumber)})),this.billingAddressForm||(this.billingAddressForm=new r.i({fullName:new r.f(null===(u=e.billingAddress)||void 0===u?void 0:u.fullName),company:new r.f(null===(f=e.billingAddress)||void 0===f?void 0:f.company),streetLine1:new r.f(null===(m=e.billingAddress)||void 0===m?void 0:m.streetLine1),streetLine2:new r.f(null===(b=e.billingAddress)||void 0===b?void 0:b.streetLine2),city:new r.f(null===(p=e.billingAddress)||void 0===p?void 0:p.city),province:new r.f(null===(g=e.billingAddress)||void 0===g?void 0:g.province),postalCode:new r.f(null===(y=e.billingAddress)||void 0===y?void 0:y.postalCode),countryCode:new r.f(null===(h=e.billingAddress)||void 0===h?void 0:h.countryCode),phoneNumber:new r.f(null===(v=e.billingAddress)||void 0===v?void 0:v.phoneNumber)})),this.orderLineCustomFieldsFormArray=new r.c([]);for(const T of e.lines){const e=new r.i({});for(const{name:t}of this.orderLineCustomFields)e.addControl(t,new r.f(T.customFields[t]));e.valueChanges.pipe(Object(x.a)(this.destroy$)).subscribe(e=>{let t=this.modifyOrderInput.adjustOrderLines.find(e=>e.orderLineId===T.id);t||(t={orderLineId:T.id,quantity:T.quantity},this.modifyOrderInput.adjustOrderLines.push(t)),this.orderLineCustomFields.length&&(t.customFields=e)}),this.orderLineCustomFieldsFormArray.push(e)}}),this.addItemCustomFieldsFormArray=new r.c([]),this.addItemCustomFieldsForm=new r.i({});for(const e of this.orderLineCustomFields)this.addItemCustomFieldsForm.addControl(e.name,new r.f);this.availableCountries$=this.dataService.settings.getAvailableCountries().mapSingle(e=>e.countries.items).pipe(Object(I.a)(1)),this.dataService.order.getOrderHistory(this.id,{take:1,sort:{createdAt:i.Pb.DESC},filter:{type:{eq:i.mb.ORDER_STATE_TRANSITION}}}).single$.subscribe(({order:e})=>{this.previousState=null==e?void 0:e.history.items[0].data.from})}ngOnDestroy(){this.destroy()}transitionToPriorState(e){this.orderTransitionService.transitionToPreModifyingState(e.id,e.nextStates).subscribe(e=>{this.router.navigate([".."],{relativeTo:this.route})})}canPreviewChanges(){const{addItems:e,adjustOrderLines:t,surcharges:c}=this.modifyOrderInput;return!!(null==e?void 0:e.length)||!!(null==c?void 0:c.length)||!!(null==t?void 0:t.length)||this.shippingAddressForm.dirty&&this.shippingAddressForm.valid||this.billingAddressForm.dirty&&this.billingAddressForm.valid}isLineModified(e){var t;return!!(null===(t=this.modifyOrderInput.adjustOrderLines)||void 0===t?void 0:t.find(t=>t.orderLineId===e.id&&t.quantity!==e.quantity))}updateLineQuantity(e,t){const{adjustOrderLines:c}=this.modifyOrderInput;let n=null==c?void 0:c.find(t=>t.orderLineId===e.id);n&&+t===e.quantity&&(null==c||c.splice(null==c?void 0:c.indexOf(n),1)),n||(n={orderLineId:e.id,quantity:+t},null==c||c.push(n)),n.quantity=+t}updateAddedItemQuantity(e,t){var c;const n=null===(c=this.modifyOrderInput.addItems)||void 0===c?void 0:c.find(t=>t.productVariantId===e.productVariantId);n&&(n.quantity=+t)}trackByProductVariantId(e,t){return t.productVariantId}getSelectedItemPrice(e){switch(null==e?void 0:e.priceWithTax.__typename){case"SinglePrice":return e.priceWithTax.value;default:return 0}}addItemToOrder(e){var t,c;if(!e)return;const n=this.orderLineCustomFields.length?this.addItemCustomFieldsForm.value:void 0;let i=null===(t=this.modifyOrderInput.addItems)||void 0===t?void 0:t.find(t=>this.isMatchingAddItemRow(t,e,n));if(i?i.quantity++:(i={productVariantId:e.productVariantId,quantity:1},n&&(i.customFields=n),null===(c=this.modifyOrderInput.addItems)||void 0===c||c.push(i)),n){const e=new r.i({});for(const[t,c]of Object.entries(n))e.addControl(t,new r.f(c));this.addItemCustomFieldsFormArray.push(e),e.valueChanges.pipe(Object(x.a)(this.destroy$)).subscribe(e=>{i&&(i.customFields=e)})}this.addItemCustomFieldsForm.reset({}),this.addItemSelectedVariant=void 0,this.addedVariants.set(e.productVariantId,e)}isMatchingAddItemRow(e,t,c){return e.productVariantId===t.productVariantId&&JSON.stringify(e.customFields)===JSON.stringify(c)}removeAddedItem(e){this.modifyOrderInput.addItems.splice(e,1),-1<e&&this.addItemCustomFieldsFormArray.removeAt(e)}getSurchargePrices(e){const t=e.priceIncludesTax?e.price:Math.round(e.price*((100+(e.taxRate||0))/100));return{price:e.priceIncludesTax?Math.round(e.price/((100+(e.taxRate||0))/100)):e.price,priceWithTax:t}}addSurcharge(e){var t;null===(t=this.modifyOrderInput.surcharges)||void 0===t||t.push(e),this.surchargeForm.reset({price:0,priceIncludesTax:!0,taxRate:0})}removeSurcharge(e){var t;null===(t=this.modifyOrderInput.surcharges)||void 0===t||t.splice(e,1)}previewAndModify(e){var t;const c=Object.assign(Object.assign(Object.assign(Object.assign({},this.modifyOrderInput),this.billingAddressForm.dirty?{updateBillingAddress:this.billingAddressForm.value}:{}),this.shippingAddressForm.dirty?{updateShippingAddress:this.shippingAddressForm.value}:{}),{dryRun:!0,note:null!==(t=this.note)&&void 0!==t?t:"",options:{recalculateShipping:this.recalculateShipping}}),n=e.totalWithTax;this.dataService.order.modifyOrder(c).pipe(Object(b.a)(({modifyOrder:e})=>{switch(e.__typename){case"Order":return this.modalService.fromComponent(Sn,{size:"xl",closable:!1,locals:{originalTotalWithTax:n,order:e,orderLineCustomFields:this.orderLineCustomFields,modifyOrderInput:c}});case"InsufficientStockError":case"NegativeQuantityError":case"NoChangesSpecifiedError":case"OrderLimitError":case"OrderModificationStateError":case"PaymentMethodMissingError":case"RefundPaymentIdMissingError":return this.notificationService.error(e.message),Object(u.a)(!1);case null:case void 0:return Object(u.a)(!1);default:Object(d.assertNever)(e)}}),Object(b.a)(t=>{if(t&&t.result!==En.Cancel){const r=Object.assign(Object.assign({},c),{dryRun:!1});return t.result===En.Refund&&(r.refund={paymentId:t.refundPaymentId,reason:t.refundNote}),this.dataService.order.modifyOrder(r).pipe(Object(b.a)(({modifyOrder:t})=>{if("Order"===t.__typename){const c=0<t.totalWithTax-n?"ArrangingAdditionalPayment":this.previousState;return this.dataService.order.transitionToState(e.id,c).pipe(Object(O.a)(!0))}return this.notificationService.error(t.message),a.a}))}return this.dataService.order.getOrder(this.id).mapSingle(()=>!1)})).subscribe(e=>{e&&this.router.navigate(["../"],{relativeTo:this.route})})}setFormValues(e,t){}}Pn.\u0275fac=function(e){return new(e||Pn)(n.fc(l.e),n.fc(l.a),n.fc(i.Mb),n.fc(n.k),n.fc(i.L),n.fc(i.Eb),n.fc(i.Db),n.fc(kn))},Pn.\u0275cmp=n.Zb({type:Pn,selectors:[["vdr-order-editor"]],features:[n.Qb],decls:4,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"entity"],[3,"state"],[1,"btn","btn-secondary",3,"click"],[1,"clr-row"],[1,"clr-col-lg-8"],[1,"order-table","table"],["class","order-line",3,"is-cancelled","modified",4,"ngFor","ngForOf"],["class","modified",4,"ngFor","ngForOf","ngForTrackBy"],["class","surcharge",4,"ngFor","ngForOf"],["class","surcharge modified",4,"ngFor","ngForOf"],[1,"shipping"],[1,"left","clr-align-middle"],[1,"clr-align-middle"],["colspan","3"],[1,"net-price",3,"title"],[1,"mb2"],[4,"clrIfExpanded"],[1,"clr-col-lg-4","order-cards"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"clr-control-label"],["name","note","clrTextarea","","required","",3,"ngModel","ngModelChange"],[1,""],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],[1,"card-footer"],[1,"btn","btn-primary",3,"disabled","click"],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","unit-price"],[1,"align-middle","quantity"],["type","number","min","0",3,"value","input"],[3,"line","payments"],[3,"line","orderState"],["class","order-line-custom-field align-middle",4,"ngIf"],[1,"align-middle","total"],[3,"src"],[1,"order-line-custom-field","align-middle"],[4,"ngFor","ngForOf"],["entityName","OrderLine",3,"customField","customFieldsFormGroup","compact"],[1,"modified"],[1,"icon-button",3,"click"],["shape","trash"],[1,"surcharge"],["colspan","2",1,"align-middle","name","left"],[1,"align-middle"],[1,"surcharge","modified"],[1,"mb4",3,"productSelected"],["class","flex mb4",4,"ngIf"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"flex","mb4"],["class","mr4",3,"src",4,"ngIf"],[1,"mr4"],[1,"mr4",3,"src"],["entityName","OrderLine",3,"readonly","customField","customFieldsFormGroup","compact"],[3,"formGroup","submit"],["for","description",3,"label"],["id","description","type","text","formControlName","description"],["for","sku",3,"label"],["id","sku","type","text","formControlName","sku"],["for","price",3,"label"],["id","price","formControlName","price",3,"currencyCode"],["for","priceIncludesTax",3,"label"],["id","priceIncludesTax","type","checkbox","clrCheckbox","","formControlName","priceIncludesTax"],["for","taxRate",3,"label"],["suffix","%"],["id","taxRate","type","number","min","0","max","100","formControlName","taxRate"],["for","taxDescription",3,"label"],["id","taxDescription","type","text","formControlName","taxDescription"],[1,"btn","btn-secondary",3,"disabled"],[3,"formGroup","availableCountries","customFields"]],template:function(e,t){1&e&&(n.Zc(0,gt,10,7,"vdr-action-bar",0),n.yc(1,"async"),n.Zc(2,Ht,93,72,"div",0),n.yc(3,"async")),2&e&&(n.Ec("ngIf",n.zc(1,2,t.entity$)),n.Tb(2),n.Ec("ngIf",n.zc(3,4,t.entity$)))},directives:[A.o,i.c,i.e,i.ab,i.Gb,i.f,A.n,z.l,z.b,z.O,z.d,z.N,z.e,z.Q,z.q,z.u,i.eb,r.b,z.H,r.z,r.p,r.s,z.k,r.a,z.i,yn,gn,i.I,z.o,z.c,i.Jb,r.E,r.q,r.j,i.db,r.h,i.H,i.i,r.v,i.g],pipes:[A.b,w.d,i.zb,i.r,A.d],styles:[".order-table[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.order-table[_ngcontent-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700}.order-table[_ngcontent-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-right:18px}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px}.order-table[_ngcontent-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}.order-table[_ngcontent-%COMP%]   tr.modified[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-warning-100)}"],changeDetection:0}),Pn.ctorParameters=()=>[{type:l.e},{type:l.a},{type:i.Mb},{type:n.k},{type:i.L},{type:i.Eb},{type:i.Db},{type:kn}];class Mn{constructor(){this.addNote=new n.u,this.updateNote=new n.u,this.deleteNote=new n.u,this.note="",this.noteIsPrivate=!0,this.expanded=!1,this.type=i.mb}getDisplayType(e){if(e.type===i.mb.ORDER_STATE_TRANSITION){if("Delivered"===e.data.to)return"success";if("Cancelled"===e.data.to)return"error"}return e.type===i.mb.ORDER_FULFILLMENT_TRANSITION&&"Delivered"===e.data.to?"success":e.type!==i.mb.ORDER_PAYMENT_TRANSITION||"Declined"!==e.data.to&&"Cancelled"!==e.data.to?e.type===i.mb.ORDER_CANCELLATION?"error":e.type===i.mb.ORDER_REFUND_TRANSITION?"warning":"default":"error"}getTimelineIcon(e){if(e.type===i.mb.ORDER_STATE_TRANSITION){if("Delivered"===e.data.to)return["success-standard","is-solid"];if("Cancelled"===e.data.to)return"ban"}if(e.type===i.mb.ORDER_PAYMENT_TRANSITION&&"Settled"===e.data.to)return"credit-card";if(e.type===i.mb.ORDER_NOTE)return"note";if(e.type===i.mb.ORDER_MODIFIED)return"pencil";if(e.type===i.mb.ORDER_FULFILLMENT_TRANSITION){if("Shipped"===e.data.to)return"truck";if("Delivered"===e.data.to)return"truck"}}isFeatured(e){switch(e.type){case i.mb.ORDER_STATE_TRANSITION:return"Delivered"===e.data.to||"Cancelled"===e.data.to||"Settled"===e.data.to;case i.mb.ORDER_PAYMENT_TRANSITION:return"Settled"===e.data.to||"Cancelled"===e.data.to;case i.mb.ORDER_FULFILLMENT_TRANSITION:return"Delivered"===e.data.to||"Shipped"===e.data.to;case i.mb.ORDER_NOTE:case i.mb.ORDER_MODIFIED:return!0;default:return!1}}getFulfillment(e){if((e.type===i.mb.ORDER_FULFILLMENT||e.type===i.mb.ORDER_FULFILLMENT_TRANSITION)&&this.order.fulfillments)return this.order.fulfillments.find(t=>t.id===e.data.fulfillmentId)}getPayment(e){if(e.type===i.mb.ORDER_PAYMENT_TRANSITION&&this.order.payments)return this.order.payments.find(t=>t.id===e.data.paymentId)}getCancelledItems(e){const t=new Map,c=e.data.orderItemIds;for(const n of this.order.lines)for(const e of n.items)if(c.includes(e.id)){const e=t.get(n.productVariant.name);null!=e?t.set(n.productVariant.name,e+1):t.set(n.productVariant.name,1)}return Array.from(t.entries()).map(([e,t])=>({name:e,quantity:t}))}getModification(e){return this.order.modifications.find(t=>t.id===e)}getName(e){const{administrator:t}=e;if(t)return`${t.firstName} ${t.lastName}`;{const e=this.order.customer;if(e)return`${e.firstName} ${e.lastName}`}return""}addNoteToOrder(){this.addNote.emit({note:this.note,isPublic:!this.noteIsPrivate}),this.note="",this.noteIsPrivate=!0}}Mn.\u0275fac=function(e){return new(e||Mn)},Mn.\u0275cmp=n.Zb({type:Mn,selectors:[["vdr-order-history"]],inputs:{order:"order",history:"history"},outputs:{addNote:"addNote",updateNote:"updateNote",deleteNote:"deleteNote"},decls:23,vars:24,consts:[[1,"entry-list"],["iconShape","note","displayType","muted",3,"featured"],[1,"note-entry"],["name","note",1,"note",3,"ngModel","ngModelChange"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"visibility-select"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],["class","private",4,"ngIf"],["class","public",4,"ngIf"],[3,"displayType","iconShape","createdAt","name","featured","collapsed","expandClick",4,"ngFor","ngForOf"],[3,"isLast","createdAt","featured"],[1,"title"],[1,"private"],[1,"public"],[3,"displayType","iconShape","createdAt","name","featured","collapsed","expandClick"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","title",4,"ngIf"],[3,"ngIf"],[4,"ngIf"],["colorType","success",4,"ngIf"],["colorType","error",4,"ngIf"],[3,"order","modification"],["colorType","success"],["colorType","error"],[4,"ngIf","ngIfElse"],["regularPaymentTransition",""],[3,"payment","currencyCode"],[3,"label"],[3,"items"],[3,"fulfillmentId","order"],[1,"flex"],[1,"note-text"],["class","note-visibility public",4,"ngIf"],["class","note-visibility private",4,"ngIf"],[1,"flex-spacer"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["vdrDropdownItem","",1,"button",3,"disabled","click"],["shape","edit"],[1,"dropdown-divider"],["shape","trash",1,"is-danger"],[1,"note-visibility","public"],[1,"note-visibility","private"],[3,"routerLink"],[1,"cancelled-coupon-code"]],template:function(e,t){1&e&&(n.lc(0,"h4"),n.bd(1),n.yc(2,"translate"),n.kc(),n.lc(3,"div",0),n.lc(4,"vdr-timeline-entry",1),n.lc(5,"div",2),n.lc(6,"textarea",3),n.vc("ngModelChange",function(e){return t.note=e}),n.kc(),n.lc(7,"button",4),n.vc("click",function(){return t.addNoteToOrder()}),n.bd(8),n.yc(9,"translate"),n.kc(),n.kc(),n.lc(10,"div",5),n.lc(11,"clr-checkbox-wrapper"),n.lc(12,"input",6),n.vc("ngModelChange",function(e){return t.noteIsPrivate=e}),n.kc(),n.lc(13,"label"),n.bd(14),n.yc(15,"translate"),n.kc(),n.kc(),n.Zc(16,Ut,3,3,"span",7),n.Zc(17,Gt,3,3,"span",8),n.kc(),n.kc(),n.Zc(18,Ic,12,17,"vdr-timeline-entry",9),n.lc(19,"vdr-timeline-entry",10),n.lc(20,"div",11),n.bd(21),n.yc(22,"translate"),n.kc(),n.kc(),n.kc()),2&e&&(n.Tb(1),n.cd(n.zc(2,16,"order.order-history")),n.Tb(2),n.Xb("expanded",t.expanded),n.Tb(1),n.Ec("featured",!0),n.Tb(2),n.Ec("ngModel",t.note),n.Tb(1),n.Ec("disabled",!t.note),n.Tb(1),n.dd(" ",n.zc(9,18,"common.add-note")," "),n.Tb(4),n.Ec("ngModel",t.noteIsPrivate),n.Tb(2),n.cd(n.zc(15,20,"order.note-is-private")),n.Tb(2),n.Ec("ngIf",t.noteIsPrivate),n.Tb(1),n.Ec("ngIf",!t.noteIsPrivate),n.Tb(1),n.Ec("ngForOf",t.history),n.Tb(1),n.Ec("isLast",!0)("createdAt",t.order.createdAt)("featured",!0),n.Tb(2),n.dd(" ",n.zc(22,22,"order.history-order-created")," "))},directives:function(){return[i.Vb,i.eb,r.b,r.p,r.s,z.k,r.a,z.i,z.u,A.o,A.n,A.q,A.r,i.lb,hn,i.D,Dn,i.ub,Nn,bn,i.T,i.W,z.o,i.V,i.U,l.h]},pipes:function(){return[w.d,i.zb,i.ib]},styles:["[_nghost-%COMP%]{margin-top:48px;display:block}.entry-list[_ngcontent-%COMP%]{margin-top:24px;margin-left:24px;margin-right:12px}.note-entry[_ngcontent-%COMP%]{display:flex;align-items:center}.note-entry[_ngcontent-%COMP%]   .note[_ngcontent-%COMP%]{flex:1}.note-entry[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0}.visibility-select[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline}.visibility-select[_ngcontent-%COMP%]   .public[_ngcontent-%COMP%]{color:var(--color-warning-500)}.visibility-select[_ngcontent-%COMP%]   .private[_ngcontent-%COMP%]{color:var(--color-success-500)}textarea.note[_ngcontent-%COMP%]{flex:1;height:36px;border-radius:3px;margin-right:6px}.note-text[_ngcontent-%COMP%]{color:var(--color-grey-800);white-space:pre-wrap}.cancelled-coupon-code[_ngcontent-%COMP%]{text-decoration:line-through}.note-visibility[_ngcontent-%COMP%]{text-transform:lowercase}.note-visibility.public[_ngcontent-%COMP%]{color:var(--color-warning-500)}.note-visibility.private[_ngcontent-%COMP%]{color:var(--color-success-500)}"],changeDetection:0}),Mn.propDecorators={order:[{type:n.E}],history:[{type:n.E}],addNote:[{type:n.P}],updateNote:[{type:n.P}],deleteNote:[{type:n.P}]};class Fn extends i.y{constructor(e,t,c,n,i){super(n,i),this.serverConfigService=e,this.dataService=t,this.localStorageService=c,this.searchOrderCodeControl=new r.f(""),this.searchLastNameControl=new r.f(""),this.orderStates=this.serverConfigService.getOrderProcessStates().map(e=>e.name),this.filterPresets=[{name:"open",label:Object(o.a)("order.filter-preset-open"),config:{active:!1,states:this.orderStates.filter(e=>"Delivered"!==e&&"Cancelled"!==e&&"Shipped"!==e)}},{name:"shipped",label:Object(o.a)("order.filter-preset-shipped"),config:{active:!1,states:["Shipped"]}},{name:"completed",label:Object(o.a)("order.filter-preset-completed"),config:{active:!1,states:["Delivered","Cancelled"]}},{name:"active",label:Object(o.a)("order.filter-preset-active"),config:{active:!0}}],super.setQueryFn((e,t)=>this.dataService.order.getOrders({take:e,skip:t}).refetchOnChannelChange(),e=>e.orders,(e,t)=>this.createQueryOptions(e,t,this.searchOrderCodeControl.value,this.searchLastNameControl.value,this.route.snapshot.queryParamMap.get("filter")||"open"));const d=this.localStorageService.get("orderListLastCustomFilters");d&&this.setQueryParam(d,{replaceUrl:!0})}ngOnInit(){var e;super.ngOnInit(),this.activePreset$=this.route.queryParamMap.pipe(Object(k.a)(e=>e.get("filter")||"open"),Object(E.a)());const t=Object(f.a)(this.searchOrderCodeControl.valueChanges,this.searchLastNameControl.valueChanges).pipe(Object(S.a)(e=>2<e.length||0===e.length),Object(P.a)(250));Object(f.a)(t,this.route.queryParamMap).pipe(Object(x.a)(this.destroy$)).subscribe(e=>{this.refresh()});const c=this.route.snapshot.queryParamMap;this.customFilterForm=new r.i({states:new r.f(null!==(e=c.getAll("states"))&&void 0!==e?e:[]),placedAtStart:new r.f(c.get("placedAtStart")),placedAtEnd:new r.f(c.get("placedAtEnd"))})}selectFilterPreset(e){var t;const c=null!==(t=this.localStorageService.get("orderListLastCustomFilters"))&&void 0!==t?t:{},n="custom"===e?c:{states:void 0,placedAtStart:void 0,placedAtEnd:void 0};this.setQueryParam(Object.assign({filter:e,page:1},n),{replaceUrl:!0})}applyCustomFilters(){const e=this.customFilterForm.value,t={states:e.states,placedAtStart:e.placedAtStart,placedAtEnd:e.placedAtEnd};this.setQueryParam(Object.assign({filter:"custom"},t)),this.customFilterForm.markAsPristine(),this.localStorageService.set("orderListLastCustomFilters",t)}createQueryOptions(e,t,c,n,r){var o;const d=this.filterPresets.find(e=>e.name===r),l={};if(d)null!=d.config.active&&(l.active={eq:d.config.active}),d.config.states&&(l.state={in:d.config.states});else if("custom"===r){const e=this.route.snapshot.queryParamMap,t=null!==(o=e.getAll("states"))&&void 0!==o?o:[],c=e.get("placedAtStart"),n=e.get("placedAtEnd");t.length&&(l.state={in:t}),c&&n?l.orderPlacedAt={between:{start:c,end:n}}:c?l.orderPlacedAt={after:c}:n&&(l.orderPlacedAt={before:n})}return n&&(l.customerLastName={contains:n}),c&&(l.code={contains:c}),{options:{skip:e,take:t,filter:Object.assign({},null!=l?l:{}),sort:{updatedAt:i.Pb.DESC}}}}getShippingNames(e){return e.shippingLines.length?e.shippingLines.map(e=>e.shippingMethod.name).join(", "):""}}Fn.\u0275fac=function(e){return new(e||Fn)(n.fc(i.Mb),n.fc(i.L),n.fc(i.xb),n.fc(l.e),n.fc(l.a))},Fn.\u0275cmp=n.Zb({type:Fn,selectors:[["vdr-order-list"]],features:[n.Qb],decls:62,vars:67,consts:[[1,"search-form"],["class","btn-group btn-outline-primary",4,"ngIf"],["type","text","name","searchTerm",1,"search-input",3,"formControl","placeholder"],[1,"custom-filters"],[3,"formGroup"],[1,"flex","align-center"],["appendTo","body","formControlName","states",3,"items","addTag","multiple","placeholder","clearable","searchable"],["ng-option-tmp",""],["ng-label-tmp",""],[1,"btn","btn-secondary",3,"disabled","click"],["shape","filter"],[1,"flex"],["formControlName","placedAtStart"],["formControlName","placedAtEnd"],["locationId","order-list"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"btn-group","btn-outline-primary"],["class","btn",3,"btn-primary","click",4,"ngFor","ngForOf"],[1,"btn",3,"click"],["shape","angle down"],[1,"ng-value-label"],["aria-hidden","true",1,"ng-value-icon","right",3,"click"],[1,"left","align-middle"],[3,"customer"],[3,"state"],[1,"right","align-middle"],["iconShape","shopping-cart",3,"label","linkTo"]],template:function(e,t){1&e&&(n.lc(0,"vdr-action-bar"),n.lc(1,"vdr-ab-left"),n.lc(2,"div",0),n.Zc(3,Sc,6,6,"div",1),n.yc(4,"async"),n.gc(5,"input",2),n.yc(6,"translate"),n.gc(7,"input",2),n.yc(8,"translate"),n.kc(),n.lc(9,"div",3),n.yc(10,"async"),n.lc(11,"form",4),n.lc(12,"div",5),n.lc(13,"ng-select",6),n.yc(14,"translate"),n.Zc(15,Pc,3,5,"ng-template",7),n.Zc(16,Mc,6,5,"ng-template",8),n.kc(),n.lc(17,"button",9),n.vc("click",function(){return t.applyCustomFilters()}),n.bd(18),n.yc(19,"translate"),n.gc(20,"clr-icon",10),n.kc(),n.kc(),n.lc(21,"div",11),n.lc(22,"div"),n.lc(23,"label"),n.bd(24),n.yc(25,"translate"),n.kc(),n.gc(26,"vdr-datetime-picker",12),n.kc(),n.lc(27,"div"),n.lc(28,"label"),n.bd(29),n.yc(30,"translate"),n.kc(),n.gc(31,"vdr-datetime-picker",13),n.kc(),n.kc(),n.kc(),n.kc(),n.kc(),n.lc(32,"vdr-ab-right"),n.gc(33,"vdr-action-bar-items",14),n.kc(),n.kc(),n.lc(34,"vdr-data-table",15),n.vc("pageChange",function(e){return t.setPageNumber(e)})("itemsPerPageChange",function(e){return t.setItemsPerPage(e)}),n.yc(35,"async"),n.yc(36,"async"),n.yc(37,"async"),n.yc(38,"async"),n.lc(39,"vdr-dt-column"),n.bd(40),n.yc(41,"translate"),n.kc(),n.lc(42,"vdr-dt-column"),n.bd(43),n.yc(44,"translate"),n.kc(),n.lc(45,"vdr-dt-column"),n.bd(46),n.yc(47,"translate"),n.kc(),n.lc(48,"vdr-dt-column"),n.bd(49),n.yc(50,"translate"),n.kc(),n.lc(51,"vdr-dt-column"),n.bd(52),n.yc(53,"translate"),n.kc(),n.lc(54,"vdr-dt-column"),n.bd(55),n.yc(56,"translate"),n.kc(),n.lc(57,"vdr-dt-column"),n.bd(58),n.yc(59,"translate"),n.kc(),n.gc(60,"vdr-dt-column"),n.Zc(61,Ac,20,23,"ng-template"),n.kc()),2&e&&(n.Tb(3),n.Ec("ngIf",n.zc(4,29,t.activePreset$)),n.Tb(2),n.Ec("formControl",t.searchOrderCodeControl)("placeholder",n.zc(6,31,"order.search-by-order-code")),n.Tb(2),n.Ec("formControl",t.searchLastNameControl)("placeholder",n.zc(8,33,"order.search-by-customer-last-name")),n.Tb(2),n.Xb("expanded","custom"===n.zc(10,35,t.activePreset$)),n.Tb(2),n.Ec("formGroup",t.customFilterForm),n.Tb(2),n.Ec("items",t.orderStates)("addTag",!1)("multiple",!0)("placeholder",n.zc(14,37,"state.all-orders"))("clearable",!0)("searchable",!1),n.Tb(4),n.Ec("disabled",t.customFilterForm.pristine),n.Tb(1),n.dd(" ",n.zc(19,39,"order.apply-filters")," "),n.Tb(6),n.cd(n.zc(25,41,"order.placed-at-start")),n.Tb(5),n.cd(n.zc(30,43,"order.placed-at-end")),n.Tb(5),n.Ec("items",n.zc(35,45,t.items$))("itemsPerPage",n.zc(36,47,t.itemsPerPage$))("totalItems",n.zc(37,49,t.totalItems$))("currentPage",n.zc(38,51,t.currentPage$)),n.Tb(6),n.cd(n.zc(41,53,"common.code")),n.Tb(3),n.cd(n.zc(44,55,"order.customer")),n.Tb(3),n.cd(n.zc(47,57,"order.state")),n.Tb(3),n.cd(n.zc(50,59,"order.total")),n.Tb(3),n.cd(n.zc(53,61,"common.updated-at")),n.Tb(3),n.cd(n.zc(56,63,"order.placed-at")),n.Tb(3),n.cd(n.zc(59,65,"order.shipping")))},directives:[i.c,i.e,A.o,i.eb,r.b,r.p,r.g,r.E,r.q,r.j,F.a,r.h,F.d,F.e,z.o,z.u,i.O,i.f,i.d,i.N,i.M,A.n,i.J,i.Gb,i.Tb],pipes:[A.b,w.d,i.Rb,i.zb,i.Ub,i.Ab],styles:[".search-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:baseline;width:100%;margin-bottom:6px}@media screen and (min-width:768px){.search-form[_ngcontent-%COMP%]{flex-direction:row}}.search-input[_ngcontent-%COMP%]{margin-left:6px;margin-top:6px;min-width:300px}.custom-filters[_ngcontent-%COMP%]{overflow:hidden;max-height:0;padding-bottom:6px}.custom-filters.expanded[_ngcontent-%COMP%]{max-height:none}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%}ng-select[_ngcontent-%COMP%]{flex:1;min-width:200px}ng-select[_ngcontent-%COMP%], ng-select[_ngcontent-%COMP%]     .ng-select-container{height:36px}"],changeDetection:0}),Fn.ctorParameters=()=>[{type:i.Mb},{type:i.L},{type:i.xb},{type:l.e},{type:l.a}];class wn{constructor(){this.settlePayment=new n.u,this.transitionPaymentState=new n.u,this.settleRefund=new n.u}refundHasMetadata(e){return!!e&&Object.keys(e.metadata).length>0}nextOtherStates(){return this.payment?this.payment.nextStates.filter(e=>"Settled"!==e):[]}}wn.\u0275fac=function(e){return new(e||wn)},wn.\u0275cmp=n.Zb({type:wn,selectors:[["vdr-order-payment-card"]],inputs:{payment:"payment",currencyCode:"currencyCode"},outputs:{settlePayment:"settlePayment",transitionPaymentState:"transitionPaymentState",settleRefund:"settleRefund"},decls:12,vars:9,consts:[[1,"card"],[1,"card-header","payment-header"],[4,"ngIf"],[1,"payment-state"],[3,"state"],[1,"card-block"],[3,"payment","currencyCode"],[4,"ngFor","ngForOf"],["class","card-footer",4,"ngIf"],["shape","redo","dir","down",1,"refund-icon"],[1,"clr-flex-fill"],[3,"label"],[3,"label",4,"ngIf"],[3,"value"],[1,"card-footer"],[1,"btn","btn-sm","btn-primary",3,"click"],["class","btn btn-sm btn-primary",3,"click",4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],[4,"ngIf","ngIfElse"],["cancel",""],["shape","step-forward-2"],["shape","error-standard",1,"is-error"]],template:function(e,t){1&e&&(n.lc(0,"div",0),n.lc(1,"div",1),n.lc(2,"div"),n.bd(3),n.yc(4,"translate"),n.Zc(5,zc,2,1,"ng-container",2),n.kc(),n.lc(6,"div",3),n.gc(7,"vdr-payment-state-label",4),n.kc(),n.kc(),n.lc(8,"div",5),n.gc(9,"vdr-payment-detail",6),n.kc(),n.Zc(10,Lc,20,23,"ng-container",7),n.Zc(11,Vc,7,2,"div",8),n.kc()),2&e&&(n.Tb(3),n.dd(" ",n.zc(4,7,"order.payment")," "),n.Tb(2),n.Ec("ngIf",t.payment.transactionId),n.Tb(2),n.Ec("state",t.payment.state),n.Tb(2),n.Ec("payment",t.payment)("currencyCode",t.currencyCode),n.Tb(1),n.Ec("ngForOf",t.payment.refunds),n.Tb(1),n.Ec("ngIf",t.payment.nextStates.length))},directives:function(){return[A.o,Ln,Dn,A.n,z.o,_.b,Rn,i.ub,i.Fb,i.T,i.W,i.V,i.U]},pipes:function(){return[w.d,i.Ab,i.zb,i.Rb]},styles:[".payment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.refund-icon[_ngcontent-%COMP%]{margin-right:6px;color:var(--color-grey-400)}.card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}"],changeDetection:0}),wn.propDecorators={payment:[{type:n.E}],currencyCode:[{type:n.E}],settlePayment:[{type:n.P}],transitionPaymentState:[{type:n.P}],settleRefund:[{type:n.P}]};const An=72;class zn{constructor(e){this.elementRef=e,this.active$=new m.a(!1),this.activeTarget$=new m.a(!1),this.isCancellable=!1,this.cancelledState="Cancelled"}ngOnChanges(e){this.isCancellable=!!this.node.to.find(e=>"Cancelled"===e.name),e.active&&this.active$.next(this.active)}getPos(e="top"){var t,c;this.elementRef.nativeElement.getBoundingClientRect();const n=null!==(c=null===(t=this.elementRef.nativeElement.querySelector(".node"))||void 0===t?void 0:t.getBoundingClientRect().height)&&void 0!==c?c:0;return{x:10,y:this.index*An+("bottom"===e?n:0)}}getStyle(){const e=this.getPos();return{"top.px":e.y,"left.px":e.x}}}zn.\u0275fac=function(e){return new(e||zn)(n.fc(n.s))},zn.\u0275cmp=n.Zb({type:zn,selectors:[["vdr-order-process-node"]],inputs:{node:"node",index:"index",active:"active"},features:[n.Rb],decls:8,vars:15,consts:[[1,"node-wrapper",3,"ngStyle"],[1,"node"],["class","cancelled-wrapper",4,"ngIf"],[1,"cancelled-wrapper"],[1,"cancelled-edge"],["shape","dot-circle"],[1,"cancelled-node"]],template:function(e,t){1&e&&(n.lc(0,"div",0),n.yc(1,"async"),n.lc(2,"div",1),n.yc(3,"async"),n.bd(4),n.yc(5,"translate"),n.yc(6,"stateI18nToken"),n.kc(),n.Zc(7,Wc,7,5,"div",2),n.kc()),2&e&&(n.Xb("active",n.zc(1,7,t.active$)),n.Ec("ngStyle",t.getStyle()),n.Tb(2),n.Xb("active-target",n.zc(3,9,t.activeTarget$)),n.Tb(2),n.dd(" ",n.zc(5,11,n.zc(6,13,t.node.name))," "),n.Tb(3),n.Ec("ngIf",t.isCancellable))},directives:[A.p,A.o,z.o],pipes:[A.b,w.d,i.Rb],styles:["[_nghost-%COMP%]{display:block}.node-wrapper[_ngcontent-%COMP%]{position:absolute;z-index:1;display:flex;align-items:center}.node[_ngcontent-%COMP%]{display:inline-block;border:2px solid var(--color-component-border-200);border-radius:3px;padding:3px 6px;z-index:1;background-color:var(--color-component-bg-100);opacity:.7;transition:opacity .2s,background-color .2s,color .2s;cursor:default}.node.active-target[_ngcontent-%COMP%]{border-color:var(--color-primary-500);opacity:.9}.cancelled-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;color:var(--color-grey-300);transition:color .2s,opacity .2s;opacity:.7}.cancelled-edge[_ngcontent-%COMP%]{width:48px;height:2px;background-color:var(--color-component-bg-300);transition:background-color .2s}clr-icon[_ngcontent-%COMP%]{margin-left:-1px}.cancelled-node[_ngcontent-%COMP%]{margin-left:6px}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{opacity:1}.active[_ngcontent-%COMP%]   .node[_ngcontent-%COMP%]{opacity:1;background-color:var(--color-primary-600);border-color:var(--color-primary-600);color:var(--color-primary-100)}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{color:var(--color-error-500)}.active[_ngcontent-%COMP%]   .cancelled-edge[_ngcontent-%COMP%]{background-color:var(--color-error-500)}"],changeDetection:0}),zn.ctorParameters=()=>[{type:n.s}],zn.propDecorators={node:[{type:n.E}],index:[{type:n.E}],active:[{type:n.E}]};class _n{ngOnInit(){this.active$=this.from.active$.asObservable().pipe(Object(M.a)(e=>this.to.activeTarget$.next(e)))}getStyle(){const e=this.from.index<this.to.index?"down":"up",t=this.from.getPos("down"===e?"bottom":"top"),c=this.to.getPos("down"===e?"top":"bottom"),n=Math.abs(t.x-c.x),r=Math.abs(t.y-c.y),i=Math.sqrt(Math.pow(n,2)+Math.pow(r,2));return Object.assign({"top.px":t.y,"left.px":t.x+("down"===e?10:40)+12*this.index,"height.px":i,"width.px":1},"up"===e?{transform:"rotateZ(180deg)","transform-origin":"top"}:{})}}_n.\u0275fac=function(e){return new(e||_n)},_n.\u0275cmp=n.Zb({type:_n,selectors:[["vdr-order-process-edge"]],inputs:{from:"from",to:"to",index:"index"},decls:3,vars:7,consts:[[1,"edge",3,"ngStyle"],["shape","arrow","flip","vertical",1,"arrow"]],template:function(e,t){1&e&&(n.lc(0,"div",0),n.yc(1,"async"),n.gc(2,"clr-icon",1),n.kc()),2&e&&(n.Xb("active",n.zc(1,5,t.active$)),n.Ec("ngStyle",t.getStyle()),n.Ub("data-from",t.from.node.name)("data-to",t.to.node.name))},directives:[A.p,z.o],pipes:[A.b],styles:[".edge[_ngcontent-%COMP%]{position:absolute;border:1px solid var(--color-component-border-200);background-color:var(--color-component-bg-300);opacity:.3;transition:border .2s,opacity .2s,background-color .2s}.edge.active[_ngcontent-%COMP%]{border-color:var(--color-primary-500);background-color:var(--color-primary-500);opacity:1}.edge.active[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{color:var(--color-primary-500)}.edge[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{position:absolute;bottom:-4px;left:-8px;color:var(--color-grey-300)}"],changeDetection:0}),_n.propDecorators={from:[{type:n.E}],to:[{type:n.E}],index:[{type:n.E}]};class jn{constructor(e){this.changeDetector=e,this.setActiveState$=new m.a(void 0),this.nodes=[],this.edges=[]}get outerHeight(){return this.nodes.length*An}ngOnInit(){this.setActiveState$.next(this.initialState),this.activeState$=this.setActiveState$.pipe(Object(P.a)(150))}ngOnChanges(e){this.populateNodes()}ngAfterViewInit(){setTimeout(()=>this.populateEdges())}onMouseOver(e){this.setActiveState$.next(e)}onMouseOut(){this.setActiveState$.next(this.initialState)}getNodeFor(e){if(this.nodeComponents)return this.nodeComponents.find(t=>t.node.name===e)}populateNodes(){var e,t;const c=new Map;for(const n of this.states)c.set(n.name,{name:n.name,to:[]});for(const[n,r]of c.entries()){const i=null!==(t=null===(e=this.states.find(e=>e.name===n))||void 0===e?void 0:e.to)&&void 0!==t?t:[];for(const e of i){const t=c.get(e);t&&r.to.push(t)}}this.nodes=[...c.values()].filter(e=>"Cancelled"!==e.name)}populateEdges(){for(const e of this.nodes){const t=this.getNodeFor(e.name);let c=0;for(const n of e.to){const e=this.getNodeFor(n.name);t&&e&&t!==e&&(this.edges.push({to:e,from:t,index:c}),c++)}}this.edges=[...this.edges],this.changeDetector.markForCheck()}}jn.\u0275fac=function(e){return new(e||jn)(n.fc(n.k))},jn.\u0275cmp=n.Zb({type:jn,selectors:[["vdr-order-process-graph"]],viewQuery:function(e,t){if(1&e&&n.gd(zn,1),2&e){let e;n.Nc(e=n.wc())&&(t.nodeComponents=e)}},hostVars:2,hostBindings:function(e,t){2&e&&n.Wc("height",t.outerHeight,"px")},inputs:{states:"states",initialState:"initialState"},features:[n.Rb],decls:2,vars:2,consts:[[4,"ngFor","ngForOf"],[3,"node","index","active","mouseenter","mouseleave"],[3,"from","to","index"]],template:function(e,t){1&e&&(n.Zc(0,Qc,3,5,"ng-container",0),n.Zc(1,Hc,2,3,"ng-container",0)),2&e&&(n.Ec("ngForOf",t.nodes),n.Tb(1),n.Ec("ngForOf",t.edges))},directives:[A.n,zn,_n],pipes:[A.b],styles:["[_nghost-%COMP%]{display:block;border:1px #ff69b4;margin:20px;padding:12px;position:relative}.state-row[_ngcontent-%COMP%]{display:flex}"],changeDetection:0}),jn.ctorParameters=()=>[{type:n.k}],jn.propDecorators={states:[{type:n.E}],initialState:[{type:n.E}],nodeComponents:[{type:n.gb,args:[zn]}],outerHeight:[{type:n.w,args:["style.height.px"]}]};class Zn{constructor(){this.orderLineCustomFieldsVisible=!1,this.customFieldsForLine={}}get visibleOrderLineCustomFields(){return this.orderLineCustomFieldsVisible?this.orderLineCustomFields:[]}get showElided(){return!this.orderLineCustomFieldsVisible&&0<this.orderLineCustomFields.length}ngOnInit(){this.orderLineCustomFieldsVisible=this.orderLineCustomFields.length<2,this.getLineCustomFields()}toggleOrderLineCustomFields(){this.orderLineCustomFieldsVisible=!this.orderLineCustomFieldsVisible}getLineDiscounts(e){return e.discounts.filter(e=>e.type===i.h.PROMOTION)}getLineCustomFields(){for(const e of this.order.lines){const t=new r.i({}),c=this.orderLineCustomFields.map(c=>{const n=e.customFields[c.name];return t.addControl(c.name,new r.f(n)),{config:c,formGroup:t,value:n}}).filter(e=>!!this.orderLineCustomFieldsVisible||null!=e.value);this.customFieldsForLine[e.id]=c}}getPromotionLink(e){return["/marketing","promotions",e.adjustmentSource.split(":")[1]]}getCouponCodeForAdjustment(e,t){const c=t.adjustmentSource.split(":")[1],n=e.promotions.find(e=>e.id===c);if(n)return n.couponCode||void 0}}Zn.\u0275fac=function(e){return new(e||Zn)},Zn.\u0275cmp=n.Zb({type:Zn,selectors:[["vdr-order-table"]],inputs:{order:"order",orderLineCustomFields:"orderLineCustomFields"},decls:61,vars:61,consts:[[1,"order-table","table"],[4,"ngFor","ngForOf"],["class","surcharge",4,"ngFor","ngForOf"],["class","order-adjustment",4,"ngFor","ngForOf"],[1,"sub-total"],[1,"left","clr-align-middle"],["colspan","4"],[1,"clr-align-middle"],[1,"net-price",3,"title"],[1,"shipping"],["colspan","3"],[1,"total"],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","unit-price"],[1,"align-middle","quantity"],[3,"line","payments"],[3,"line","orderState"],[1,"align-middle","total"],[4,"ngIf"],[3,"src"],["vdrDropdownTrigger","",1,"promotions-label"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-name",3,"routerLink"],[1,"promotion-amount"],["colspan","6",1,"custom-fields-row"],[1,"order-line-custom-fields"],["class","custom-field",4,"ngFor","ngForOf"],[1,"custom-field"],[3,"compact","readonly","customField","customFieldsFormGroup"],[1,"surcharge"],["colspan","2",1,"align-middle","name","left"],["colspan","2",1,"align-middle"],[1,"order-adjustment"],["colspan","5",1,"left","clr-align-middle"],[3,"routerLink"]],template:function(e,t){1&e&&(n.lc(0,"table",0),n.lc(1,"thead"),n.lc(2,"tr"),n.gc(3,"th"),n.lc(4,"th"),n.bd(5),n.yc(6,"translate"),n.kc(),n.lc(7,"th"),n.bd(8),n.yc(9,"translate"),n.kc(),n.lc(10,"th"),n.bd(11),n.yc(12,"translate"),n.kc(),n.lc(13,"th"),n.bd(14),n.yc(15,"translate"),n.kc(),n.lc(16,"th"),n.bd(17),n.yc(18,"translate"),n.kc(),n.kc(),n.kc(),n.lc(19,"tbody"),n.Zc(20,en,28,34,"ng-container",1),n.Zc(21,tn,13,13,"tr",2),n.Zc(22,nn,12,14,"tr",3),n.lc(23,"tr",4),n.lc(24,"td",5),n.bd(25),n.yc(26,"translate"),n.kc(),n.gc(27,"td",6),n.lc(28,"td",7),n.bd(29),n.yc(30,"localeCurrency"),n.lc(31,"div",8),n.yc(32,"translate"),n.bd(33),n.yc(34,"localeCurrency"),n.kc(),n.kc(),n.kc(),n.lc(35,"tr",9),n.lc(36,"td",5),n.bd(37),n.yc(38,"translate"),n.kc(),n.lc(39,"td",7),n.bd(40),n.kc(),n.gc(41,"td",10),n.lc(42,"td",7),n.bd(43),n.yc(44,"localeCurrency"),n.lc(45,"div",8),n.yc(46,"translate"),n.bd(47),n.yc(48,"localeCurrency"),n.kc(),n.kc(),n.kc(),n.lc(49,"tr",11),n.lc(50,"td",5),n.bd(51),n.yc(52,"translate"),n.kc(),n.gc(53,"td",6),n.lc(54,"td",7),n.bd(55),n.yc(56,"localeCurrency"),n.lc(57,"div",8),n.yc(58,"translate"),n.bd(59),n.yc(60,"localeCurrency"),n.kc(),n.kc(),n.kc(),n.kc(),n.kc()),2&e&&(n.Tb(5),n.cd(n.zc(6,21,"order.product-name")),n.Tb(3),n.cd(n.zc(9,23,"order.product-sku")),n.Tb(3),n.cd(n.zc(12,25,"order.unit-price")),n.Tb(3),n.cd(n.zc(15,27,"order.quantity")),n.Tb(3),n.cd(n.zc(18,29,"order.total")),n.Tb(3),n.Ec("ngForOf",t.order.lines),n.Tb(1),n.Ec("ngForOf",t.order.surcharges),n.Tb(1),n.Ec("ngForOf",t.order.discounts),n.Tb(3),n.cd(n.zc(26,31,"order.sub-total")),n.Tb(4),n.dd(" ",n.Ac(30,33,t.order.subTotalWithTax,t.order.currencyCode)," "),n.Tb(2),n.Ec("title",n.zc(32,36,"order.net-price")),n.Tb(2),n.dd(" ",n.Ac(34,38,t.order.subTotal,t.order.currencyCode)," "),n.Tb(4),n.cd(n.zc(38,41,"order.shipping")),n.Tb(3),n.cd(null==t.order.shippingLines[0]||null==t.order.shippingLines[0].shippingMethod?null:t.order.shippingLines[0].shippingMethod.name),n.Tb(3),n.dd(" ",n.Ac(44,43,t.order.shippingWithTax,t.order.currencyCode)," "),n.Tb(2),n.Ec("title",n.zc(46,46,"order.net-price")),n.Tb(2),n.dd(" ",n.Ac(48,48,t.order.shipping,t.order.currencyCode)," "),n.Tb(4),n.cd(n.zc(52,51,"order.total")),n.Tb(4),n.dd(" ",n.Ac(56,53,t.order.totalWithTax,t.order.currencyCode)," "),n.Tb(2),n.Ec("title",n.zc(58,56,"order.net-price")),n.Tb(2),n.dd(" ",n.Ac(60,58,t.order.total,t.order.currencyCode)," "))},directives:[A.n,A.o,yn,gn,i.T,i.W,i.V,l.h,i.I,i.D],pipes:[w.d,i.zb,i.r],styles:[".order-table[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.order-table[_ngcontent-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700}.order-table[_ngcontent-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-right:18px}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px}.order-table[_ngcontent-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}  .line-promotion{display:flex;justify-content:space-between;padding:6px 12px}  .line-promotion .promotion-amount{margin-left:12px}  .line-promotion .net-price{font-size:11px;color:var(--color-text-300)}"],changeDetection:0}),Zn.propDecorators={order:[{type:n.E}],orderLineCustomFields:[{type:n.E}]};class Dn{}Dn.\u0275fac=function(e){return new(e||Dn)},Dn.\u0275cmp=n.Zb({type:Dn,selectors:[["vdr-payment-detail"]],inputs:{payment:"payment",currencyCode:"currencyCode"},decls:12,vars:17,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"value"]],template:function(e,t){1&e&&(n.lc(0,"vdr-labeled-data",0),n.yc(1,"translate"),n.bd(2),n.kc(),n.lc(3,"vdr-labeled-data",0),n.yc(4,"translate"),n.bd(5),n.yc(6,"localeCurrency"),n.kc(),n.Zc(7,rn,3,4,"vdr-labeled-data",1),n.Zc(8,on,3,4,"vdr-labeled-data",1),n.lc(9,"vdr-labeled-data",0),n.yc(10,"translate"),n.gc(11,"vdr-object-tree",2),n.kc()),2&e&&(n.Ec("label",n.zc(1,8,"order.payment-method")),n.Tb(2),n.dd(" ",t.payment.method,"\n"),n.Tb(1),n.Ec("label",n.zc(4,10,"order.amount")),n.Tb(2),n.dd(" ",n.Ac(6,12,t.payment.amount,t.currencyCode),"\n"),n.Tb(2),n.Ec("ngIf",t.payment.errorMessage),n.Tb(1),n.Ec("ngIf",t.payment.transactionId),n.Tb(1),n.Ec("label",n.zc(10,15,"order.payment-metadata")),n.Tb(2),n.Ec("value",t.payment.metadata))},directives:[i.ub,A.o,i.Fb],pipes:[w.d,i.zb],styles:[""],changeDetection:0}),Dn.propDecorators={payment:[{type:n.E}],currencyCode:[{type:n.E}]};class Ln{get chipColorType(){switch(this.state){case"Authorized":return"warning";case"Settled":return"success";case"Declined":case"Cancelled":return"error"}}}Ln.\u0275fac=function(e){return new(e||Ln)},Ln.\u0275cmp=n.Zb({type:Ln,selectors:[["vdr-payment-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(e,t){1&e&&(n.lc(0,"vdr-chip",0),n.yc(1,"translate"),n.Zc(2,dn,1,0,"clr-icon",1),n.bd(3),n.yc(4,"translate"),n.yc(5,"stateI18nToken"),n.kc()),2&e&&(n.Ec("title",n.zc(1,4,"order.payment-state"))("colorType",t.chipColorType),n.Tb(2),n.Ec("ngIf","Settled"===t.state),n.Tb(1),n.dd(" ",n.zc(4,6,n.zc(5,8,t.state)),"\n"))},directives:[i.D,A.o,z.o],pipes:[w.d,i.Rb],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0}),Ln.propDecorators={state:[{type:n.E}]};class Rn{get chipColorType(){switch(this.state){case"Pending":return"warning";case"Settled":return"success";case"Failed":return"error"}}}Rn.\u0275fac=function(e){return new(e||Rn)},Rn.\u0275cmp=n.Zb({type:Rn,selectors:[["vdr-refund-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(e,t){1&e&&(n.lc(0,"vdr-chip",0),n.yc(1,"translate"),n.Zc(2,ln,1,0,"clr-icon",1),n.bd(3),n.yc(4,"translate"),n.yc(5,"stateI18nToken"),n.kc()),2&e&&(n.Ec("title",n.zc(1,4,"order.payment-state"))("colorType",t.chipColorType),n.Tb(2),n.Ec("ngIf","Settled"===t.state),n.Tb(1),n.dd(" ",n.zc(4,6,n.zc(5,8,t.state)),"\n"))},directives:[i.D,A.o,z.o],pipes:[w.d,i.Rb],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0}),Rn.propDecorators={state:[{type:n.E}]};class Nn{}Nn.\u0275fac=function(e){return new(e||Nn)},Nn.\u0275cmp=n.Zb({type:Nn,selectors:[["vdr-simple-item-list"]],inputs:{items:"items"},decls:3,vars:1,consts:[[1,"items-list"],[3,"title",4,"ngFor","ngForOf"],[3,"title"],[1,"quantity"],["shape","times","size","12"]],template:function(e,t){1&e&&(n.lc(0,"div",0),n.lc(1,"ul"),n.Zc(2,an,5,3,"li",1),n.kc(),n.kc()),2&e&&(n.Tb(2),n.Ec("ngForOf",t.items))},directives:[A.n,z.o],styles:[".items-list[_ngcontent-%COMP%]{font-size:12px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin-top:6px;list-style-type:none;margin-left:2px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{line-height:14px;text-overflow:ellipsis;overflow:hidden}.items-list[_ngcontent-%COMP%]   .quantity[_ngcontent-%COMP%]{min-width:16px;display:inline-block}"],changeDetection:0}),Nn.propDecorators={items:[{type:n.E}]};class $n extends i.x{constructor(e,t){super(e,{__typename:"Order",id:"",code:"",createdAt:"",updatedAt:"",total:0},e=>t.order.getOrder(e).mapStream(e=>e.order))}}$n.\u0275fac=function(e){return new(e||$n)(n.sc(l.e),n.sc(i.L))},$n.\u0275prov=Object(n.bc)({factory:function(){return new $n(Object(n.sc)(l.e),Object(n.sc)(i.L))},token:$n,providedIn:"root"}),$n.ctorParameters=()=>[{type:l.e},{type:i.L}];const qn={breadcrumb:Object(o.a)("breadcrumb.orders")},Vn={breadcrumb:Hn},Wn={breadcrumb:Un},Qn=[{path:"",component:Fn,data:qn},{path:":id",component:In,resolve:Object(i.ac)($n),canDeactivate:[i.z],data:Vn},{path:":id/modify",component:Pn,resolve:Object(i.ac)($n),data:Wn}];function Hn(e,t){return Object(i.cc)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.orders",getName:e=>e.code,route:""})}function Un(e,t){return Hn(e,t).pipe(Object(k.a)(e=>{const t=e.slice();return t[0].link[0]="../",t[1].link[0]="../orders",t.concat({label:Object(o.a)("breadcrumb.modifying"),link:[""]})}))}class Gn{}Gn.\u0275fac=function(e){return new(e||Gn)},Gn.\u0275mod=n.dc({type:Gn}),Gn.\u0275inj=n.cc({imports:[[i.Nb,l.i.forChild(Qn)]]})}}]);
//# sourceMappingURL=11-es2015.923ef676433fb11e8c6c.js.map