(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{FGij:function(e,t,c){"use strict";c.r(t),c.d(t,"ApplyFacetDialogComponent",function(){return Hn}),c.d(t,"AssetDetailComponent",function(){return Dn}),c.d(t,"AssetListComponent",function(){return $n}),c.d(t,"AssetResolver",function(){return ea}),c.d(t,"AssignProductsToChannelDialogComponent",function(){return qn}),c.d(t,"CatalogModule",function(){return Ma}),c.d(t,"CollectionContentsComponent",function(){return _n}),c.d(t,"CollectionDetailComponent",function(){return Ln}),c.d(t,"CollectionListComponent",function(){return Zn}),c.d(t,"CollectionResolver",function(){return ta}),c.d(t,"CollectionTreeComponent",function(){return ka}),c.d(t,"CollectionTreeNodeComponent",function(){return Oa}),c.d(t,"ConfirmVariantDeletionDialogComponent",function(){return Kn}),c.d(t,"FacetDetailComponent",function(){return Nn}),c.d(t,"FacetListComponent",function(){return Gn}),c.d(t,"FacetResolver",function(){return ca}),c.d(t,"GenerateProductVariantsComponent",function(){return Pa}),c.d(t,"GeneratedVariant",function(){return Jn}),c.d(t,"OPTION_VALUE_INPUT_VALUE_ACCESSOR",function(){return xa}),c.d(t,"OptionValueInputComponent",function(){return Ta}),c.d(t,"ProductAssetsComponent",function(){return Ia}),c.d(t,"ProductDetailComponent",function(){return Rn}),c.d(t,"ProductDetailService",function(){return Bn}),c.d(t,"ProductListComponent",function(){return Qn}),c.d(t,"ProductResolver",function(){return na}),c.d(t,"ProductSearchInputComponent",function(){return Wn}),c.d(t,"ProductVariantsEditorComponent",function(){return Yn}),c.d(t,"ProductVariantsListComponent",function(){return Ea}),c.d(t,"ProductVariantsResolver",function(){return aa}),c.d(t,"ProductVariantsTableComponent",function(){return Sa}),c.d(t,"UpdateProductOptionDialogComponent",function(){return Fa}),c.d(t,"VariantPriceDetailComponent",function(){return ja}),c.d(t,"arrayToTree",function(){return Ca}),c.d(t,"assetBreadcrumb",function(){return ya}),c.d(t,"catalogRoutes",function(){return ma}),c.d(t,"collectionBreadcrumb",function(){return va}),c.d(t,"facetBreadcrumb",function(){return fa}),c.d(t,"productBreadcrumb",function(){return ba}),c.d(t,"productVariantEditorBreadcrumb",function(){return ha}),c.d(t,"replaceLast",function(){return Un}),c.d(t,"\u02750",function(){return ia}),c.d(t,"\u02751",function(){return oa}),c.d(t,"\u02752",function(){return ra}),c.d(t,"\u02753",function(){return sa}),c.d(t,"\u02754",function(){return la}),c.d(t,"\u02755",function(){return da}),c.d(t,"\u02756",function(){return ua}),c.d(t,"\u02757",function(){return pa}),c.d(t,"\u02758",function(){return ga});var n=c("EM62"),a=c("sEIs"),i=c("ixhn"),o=c("OxKu"),r=c("YtkY"),s=c("mWib"),l=c("kuMc"),d=c("ruxD"),u=c("TLy2"),p=c("jIqt"),g=c("Ohay"),m=c("8j5Y"),b=c("J+dc"),h=c("cJ9h"),f=c("wqq/"),v=c("7SLS"),y=c("w0kG"),C=c("BwBJ"),k=c("xVbo"),O=c("nIj0"),P=c("C05f"),x=c("HM3f"),T=c("6Oco"),I=c("ZTXN"),F=c("ROBh"),E=c("P4Xx"),S=c("47ST"),j=c("GoAz"),M=c("g6G6"),V=c("hbhS"),w=c("hG4v"),z=c("2kYt"),A=c("Ui7s"),D=c("qzMg"),$=c("D57K"),_=c("jY47"),L=c("GZLE"),Z=c("oqI+"),N=c("qvOF"),G=c("s2Ay"),U=c("iNDR"),B=c("Kej3");function H(e,t){if(1&e){const e=n.mc();n.lc(0,"button",4),n.vc("click",function(){n.Sc(e);return n.xc().save()}),n.bd(1),n.yc(2,"translate"),n.kc()}if(2&e){const e=n.xc();n.Ec("disabled",e.detailForm.invalid||e.detailForm.pristine),n.Tb(1),n.dd(" ",n.zc(2,2,"common.update")," ")}}const q=function(){return["UpdateCatalog","UpdateAsset"]},R=function(){return{}},X=function(){return["DeleteCatalog","DeleteAsset"]};function W(e,t){1&e&&n.hc(0)}const Q=function(){return{tab:"variants"}},K=function(e,t){return["/catalog/products",e,t]};function J(e,t){if(1&e&&(n.lc(0,"td",5),n.bd(1),n.kc(),n.lc(2,"td",6),n.gc(3,"vdr-table-row-action",7),n.yc(4,"translate"),n.kc()),2&e){const e=t.item;n.Tb(1),n.cd(e.name),n.Tb(2),n.Ec("label",n.zc(4,3,"common.edit"))("linkTo",n.Jc(6,K,e.productId,n.Hc(5,Q)))}}const Y=function(e){return{$implicit:e}},ee=["collectionContents"];function te(e,t){if(1&e){const e=n.mc();n.lc(0,"button",6),n.vc("click",function(){n.Sc(e);return n.xc().create()}),n.bd(1),n.yc(2,"translate"),n.kc()}if(2&e){const e=n.xc();n.Ec("disabled",e.detailForm.invalid||e.detailForm.pristine),n.Tb(1),n.dd(" ",n.zc(2,2,"common.create")," ")}}function ce(e,t){if(1&e){const e=n.mc();n.lc(0,"button",6),n.vc("click",function(){n.Sc(e);return n.xc(2).save()}),n.bd(1),n.yc(2,"translate"),n.kc()}if(2&e){const e=n.xc(2);n.Ec("disabled",(e.detailForm.invalid||e.detailForm.pristine)&&!e.assetsChanged()),n.Tb(1),n.dd(" ",n.zc(2,2,"common.update")," ")}}function ne(e,t){if(1&e&&n.Zc(0,ce,3,4,"button",7),2&e){const e=n.xc();n.Ec("vdrIfPermissions",e.updatePermission)}}function ae(e,t){1&e&&(n.jc(0),n.bd(1),n.yc(2,"translate"),n.ic()),2&e&&(n.Tb(1),n.cd(n.zc(2,1,"catalog.public")))}function ie(e,t){1&e&&(n.bd(0),n.yc(1,"translate")),2&e&&n.cd(n.zc(1,1,"catalog.private"))}const oe=function(){return["customFields"]};function re(e,t){if(1&e&&n.gc(0,"vdr-custom-field-control",31),2&e){const e=n.xc().$implicit,t=n.xc(3);n.Ec("customFieldsFormGroup",t.detailForm.get(n.Hc(2,oe)))("customField",e)}}function se(e,t){if(1&e&&(n.jc(0),n.Zc(1,re,1,3,"vdr-custom-field-control",30),n.ic()),2&e){const e=t.$implicit,c=n.xc(3);n.Tb(1),n.Ec("ngIf",c.customFieldIsSet(e.name))}}function le(e,t){if(1&e&&(n.lc(0,"section",29),n.lc(1,"label"),n.bd(2),n.yc(3,"translate"),n.kc(),n.Zc(4,se,2,1,"ng-container",25),n.kc()),2&e){const e=n.xc(2);n.Tb(2),n.cd(n.zc(3,2,"common.custom-fields")),n.Tb(2),n.Ec("ngForOf",e.customFields)}}function de(e,t){if(1&e){const e=n.mc();n.jc(0),n.lc(1,"vdr-configurable-input",32),n.vc("remove",function(t){n.Sc(e);return n.xc(2).removeFilter(t)}),n.yc(2,"hasPermission"),n.kc(),n.ic()}if(2&e){const e=t.$implicit,c=t.index,a=n.xc(2);n.Tb(1),n.Ec("operation",e)("operationDefinition",a.getFilterDefinition(e))("formControlName",c)("readonly",!n.zc(2,4,a.updatePermission))}}function ue(e,t){if(1&e){const e=n.mc();n.lc(0,"button",37),n.vc("click",function(){n.Sc(e);const c=t.$implicit;return n.xc(3).addFilter(c)}),n.bd(1),n.kc()}if(2&e){const e=t.$implicit;n.Tb(1),n.dd(" ",e.description," ")}}function pe(e,t){if(1&e&&(n.lc(0,"div"),n.lc(1,"vdr-dropdown"),n.lc(2,"button",33),n.gc(3,"clr-icon",34),n.bd(4),n.yc(5,"translate"),n.kc(),n.lc(6,"vdr-dropdown-menu",35),n.Zc(7,ue,2,1,"button",36),n.kc(),n.kc(),n.kc()),2&e){const e=n.xc(2);n.Tb(4),n.dd(" ",n.zc(5,2,"marketing.add-condition")," "),n.Tb(3),n.Ec("ngForOf",e.allFilters)}}const ge=function(e){return{count:e}};function me(e,t){if(1&e&&(n.lc(0,"div",38),n.bd(1),n.yc(2,"translate"),n.yc(3,"translate"),n.kc()),2&e){const e=t.$implicit;n.Tb(1),n.ed(" ",n.zc(2,2,"catalog.collection-contents")," (",n.Ac(3,4,"common.results-count",n.Ic(7,ge,e)),") ")}}const be=function(e){return{pattern:e}};function he(e,t){if(1&e){const e=n.mc();n.lc(0,"form",8),n.lc(1,"div",9),n.lc(2,"div",10),n.lc(3,"vdr-form-field",11),n.yc(4,"translate"),n.lc(5,"clr-toggle-wrapper"),n.gc(6,"input",12),n.yc(7,"hasPermission"),n.lc(8,"label",13),n.Zc(9,ae,3,3,"ng-container",14),n.Zc(10,ie,2,3,"ng-template",null,15,n.ad),n.kc(),n.kc(),n.kc(),n.lc(12,"vdr-form-field",16),n.yc(13,"translate"),n.lc(14,"input",17),n.vc("input",function(t){n.Sc(e);return n.xc().updateSlug(t.target.value)}),n.yc(15,"hasPermission"),n.kc(),n.kc(),n.lc(16,"vdr-form-field",18),n.yc(17,"translate"),n.yc(18,"translate"),n.gc(19,"input",19),n.yc(20,"hasPermission"),n.kc(),n.gc(21,"vdr-rich-text-editor",20),n.yc(22,"hasPermission"),n.yc(23,"translate"),n.Zc(24,le,5,4,"section",21),n.kc(),n.lc(25,"div",22),n.lc(26,"vdr-product-assets",23),n.vc("change",function(t){n.Sc(e);return n.xc().assetChanges=t}),n.kc(),n.kc(),n.kc(),n.lc(27,"div",24),n.lc(28,"div",10),n.lc(29,"label"),n.bd(30),n.yc(31,"translate"),n.kc(),n.Zc(32,de,3,6,"ng-container",25),n.Zc(33,pe,8,4,"div",26),n.kc(),n.lc(34,"div",10),n.lc(35,"vdr-collection-contents",27,28),n.Zc(37,me,4,9,"ng-template"),n.kc(),n.kc(),n.kc(),n.kc()}if(2&e){const e=t.ngIf,c=n.Oc(11),a=n.xc();n.Ec("formGroup",a.detailForm),n.Tb(3),n.Ec("label",n.zc(4,19,"catalog.visibility")),n.Tb(3),n.Ec("vdrDisabled",!n.zc(7,21,a.updatePermission)),n.Tb(3),n.Ec("ngIf",a.detailForm.value.visible)("ngIfElse",c),n.Tb(3),n.Ec("label",n.zc(13,23,"common.name")),n.Tb(2),n.Ec("readonly",!n.zc(15,25,a.updatePermission)),n.Tb(2),n.Ec("label",n.zc(17,27,"catalog.slug"))("errors",n.Ic(39,be,n.zc(18,29,"catalog.slug-pattern-error"))),n.Tb(3),n.Ec("readonly",!n.zc(20,31,a.updatePermission)),n.Tb(2),n.Ec("readonly",!n.zc(22,33,a.updatePermission))("label",n.zc(23,35,"common.description")),n.Tb(3),n.Ec("ngIf",a.customFields.length),n.Tb(2),n.Ec("assets",e.assets)("featuredAsset",e.featuredAsset),n.Tb(4),n.cd(n.zc(31,37,"catalog.filters")),n.Tb(2),n.Ec("ngForOf",a.filters),n.Tb(1),n.Ec("vdrIfPermissions",a.updatePermission),n.Tb(2),n.Ec("collectionId",a.id)}}const fe=function(){return["./create"]};function ve(e,t){1&e&&(n.lc(0,"a",10),n.gc(1,"clr-icon",11),n.bd(2),n.yc(3,"translate"),n.kc()),2&e&&(n.Ec("routerLink",n.Hc(4,fe)),n.Tb(2),n.dd(" ",n.zc(3,2,"catalog.create-new-collection")," "))}function ye(e,t){if(1&e){const e=n.mc();n.lc(0,"div",12),n.bd(1),n.yc(2,"async"),n.yc(3,"translate"),n.kc(),n.lc(4,"button",13),n.vc("click",function(){n.Sc(e);return n.xc().closeContents()}),n.gc(5,"clr-icon",14),n.kc()}if(2&e){const e=t.$implicit,c=n.xc();n.Tb(1),n.ed(" ",n.zc(2,2,c.activeCollectionTitle$)," (",n.Ac(3,4,"common.results-count",n.Ic(7,ge,e)),") ")}}const Ce=function(){return["CreateCatalog","CreateCollection"]};function ke(e,t){if(1&e){const e=n.mc();n.lc(0,"button",6),n.vc("click",function(){n.Sc(e);return n.xc().create()}),n.bd(1),n.yc(2,"translate"),n.kc()}if(2&e){const e=n.xc();n.Ec("disabled",e.detailForm.invalid||e.detailForm.pristine),n.Tb(1),n.dd(" ",n.zc(2,2,"common.create")," ")}}function Oe(e,t){if(1&e){const e=n.mc();n.lc(0,"button",6),n.vc("click",function(){n.Sc(e);return n.xc(2).save()}),n.bd(1),n.yc(2,"translate"),n.kc()}if(2&e){const e=n.xc(2);n.Ec("disabled",e.detailForm.invalid||e.detailForm.pristine),n.Tb(1),n.dd(" ",n.zc(2,2,"common.update")," ")}}function Pe(e,t){if(1&e&&n.Zc(0,Oe,3,4,"button",7),2&e){const e=n.xc();n.Ec("vdrIfPermissions",e.updatePermission)}}function xe(e,t){1&e&&(n.jc(0),n.bd(1),n.yc(2,"translate"),n.ic()),2&e&&(n.Tb(1),n.cd(n.zc(2,1,"catalog.public")))}function Te(e,t){1&e&&(n.bd(0),n.yc(1,"translate")),2&e&&n.cd(n.zc(1,1,"catalog.private"))}const Ie=function(){return["facet","customFields"]};function Fe(e,t){if(1&e&&n.gc(0,"vdr-custom-field-control",24),2&e){const e=n.xc().$implicit,t=n.xc(3);n.Ec("customFieldsFormGroup",t.detailForm.get(n.Hc(2,Ie)))("customField",e)}}function Ee(e,t){if(1&e&&(n.jc(0),n.Zc(1,Fe,1,3,"vdr-custom-field-control",23),n.ic()),2&e){const e=t.$implicit,c=n.xc(3);n.Tb(1),n.Ec("ngIf",c.customFieldIsSet(e.name))}}function Se(e,t){if(1&e&&(n.lc(0,"section",21),n.lc(1,"label"),n.bd(2),n.yc(3,"translate"),n.kc(),n.Zc(4,Ee,2,1,"ng-container",22),n.kc()),2&e){const e=n.xc(2);n.Tb(2),n.cd(n.zc(3,2,"common.custom-fields")),n.Tb(2),n.Ec("ngForOf",e.customFields)}}function je(e,t){if(1&e&&(n.jc(0),n.lc(1,"th"),n.bd(2),n.kc(),n.ic()),2&e){const e=t.$implicit;n.Tb(2),n.cd(e.name)}}const Me=function(e){return["values",e,"customFields"]};function Ve(e,t){if(1&e&&n.gc(0,"vdr-custom-field-control",40),2&e){const e=n.xc().$implicit,t=n.xc().index,c=n.xc(4);n.Ec("showLabel",!1)("customFieldsFormGroup",c.detailForm.get(n.Ic(3,Me,t)))("customField",e)}}function we(e,t){if(1&e&&(n.jc(0),n.lc(1,"td",31),n.Zc(2,Ve,1,5,"vdr-custom-field-control",39),n.kc(),n.ic()),2&e){const e=t.$implicit,c=n.xc().index,a=n.xc(4);n.Tb(2),n.Ec("ngIf",a.customValueFieldIsSet(c,e.name))}}function ze(e,t){if(1&e){const e=n.mc();n.lc(0,"tr",30),n.lc(1,"td",31),n.gc(2,"vdr-entity-info",0),n.kc(),n.lc(3,"td",31),n.lc(4,"input",32),n.vc("input",function(c){n.Sc(e);const a=t.index,i=n.xc(3).ngIf;return n.xc().updateValueCode(null==i.values[a]?null:i.values[a].code,c.target.value,a)}),n.yc(5,"hasPermission"),n.kc(),n.kc(),n.lc(6,"td",31),n.gc(7,"input",33),n.kc(),n.Zc(8,we,3,1,"ng-container",22),n.lc(9,"td",31),n.lc(10,"vdr-dropdown"),n.lc(11,"button",34),n.bd(12),n.yc(13,"translate"),n.gc(14,"clr-icon",35),n.kc(),n.lc(15,"vdr-dropdown-menu",36),n.lc(16,"button",37),n.vc("click",function(){n.Sc(e);const c=t.index,a=n.xc(3).ngIf;return n.xc().deleteFacetValue(null==a.values[c]?null:a.values[c].id,c)}),n.yc(17,"hasPermission"),n.gc(18,"clr-icon",38),n.bd(19),n.yc(20,"translate"),n.kc(),n.kc(),n.kc(),n.kc(),n.kc()}if(2&e){const e=t.$implicit,c=t.index,a=n.xc(4);n.Ec("formGroupName",c),n.Tb(2),n.Ec("entity",e),n.Tb(2),n.Ec("readonly",!n.zc(5,7,a.updatePermission)),n.Tb(4),n.Ec("ngForOf",a.customValueFields),n.Tb(4),n.dd(" ",n.zc(13,9,"common.actions")," "),n.Tb(4),n.Ec("disabled",!n.zc(17,11,a.updatePermission)),n.Tb(3),n.dd(" ",n.zc(20,13,"common.delete")," ")}}function Ae(e,t){if(1&e&&(n.lc(0,"table",28),n.lc(1,"thead"),n.lc(2,"tr"),n.gc(3,"th"),n.lc(4,"th"),n.bd(5),n.yc(6,"translate"),n.kc(),n.lc(7,"th"),n.bd(8),n.yc(9,"translate"),n.kc(),n.Zc(10,je,3,1,"ng-container",22),n.gc(11,"th"),n.kc(),n.kc(),n.lc(12,"tbody"),n.Zc(13,ze,21,15,"tr",29),n.kc(),n.kc()),2&e){const e=n.xc(3);n.Tb(5),n.cd(n.zc(6,4,"common.name")),n.Tb(3),n.cd(n.zc(9,6,"common.code")),n.Tb(2),n.Ec("ngForOf",e.customValueFields),n.Tb(3),n.Ec("ngForOf",e.values)}}function De(e,t){if(1&e){const e=n.mc();n.lc(0,"button",41),n.vc("click",function(){n.Sc(e);return n.xc(3).addFacetValue()}),n.gc(1,"clr-icon",42),n.bd(2),n.yc(3,"translate"),n.kc()}2&e&&(n.Tb(2),n.dd(" ",n.zc(3,1,"catalog.add-facet-value")," "))}const $e=function(){return["CreateCatalog","CreateFacet"]};function _e(e,t){if(1&e&&(n.lc(0,"section",25),n.lc(1,"label"),n.bd(2),n.yc(3,"translate"),n.kc(),n.Zc(4,Ae,14,8,"table",26),n.lc(5,"div"),n.Zc(6,De,4,3,"button",27),n.kc(),n.kc()),2&e){const e=n.xc(2);n.Tb(2),n.cd(n.zc(3,3,"catalog.facet-values")),n.Tb(2),n.Ec("ngIf",0<e.getValuesFormArray().length),n.Tb(2),n.Ec("vdrIfPermissions",n.Hc(5,$e))}}function Le(e,t){if(1&e){const e=n.mc();n.lc(0,"form",8),n.lc(1,"section",9),n.lc(2,"vdr-form-field",10),n.yc(3,"translate"),n.lc(4,"clr-toggle-wrapper"),n.gc(5,"input",11),n.yc(6,"hasPermission"),n.lc(7,"label",12),n.Zc(8,xe,3,3,"ng-container",13),n.Zc(9,Te,2,3,"ng-template",null,14,n.ad),n.kc(),n.kc(),n.kc(),n.lc(11,"vdr-form-field",15),n.yc(12,"translate"),n.lc(13,"input",16),n.vc("input",function(c){n.Sc(e);const a=t.ngIf;return n.xc().updateCode(a.code,c.target.value)}),n.yc(14,"hasPermission"),n.kc(),n.kc(),n.lc(15,"vdr-form-field",17),n.yc(16,"translate"),n.yc(17,"hasPermission"),n.gc(18,"input",18),n.yc(19,"hasPermission"),n.kc(),n.Zc(20,Se,5,4,"section",19),n.kc(),n.Zc(21,_e,7,6,"section",20),n.yc(22,"async"),n.kc()}if(2&e){const e=n.Oc(10),t=n.xc();n.Ec("formGroup",t.detailForm),n.Tb(2),n.Ec("label",n.zc(3,12,"catalog.visibility")),n.Tb(3),n.Ec("vdrDisabled",!n.zc(6,14,t.updatePermission)),n.Tb(3),n.Ec("ngIf",t.detailForm.value.facet.visible)("ngIfElse",e),n.Tb(3),n.Ec("label",n.zc(12,16,"common.name")),n.Tb(2),n.Ec("readonly",!n.zc(14,18,t.updatePermission)),n.Tb(2),n.Ec("label",n.zc(16,20,"common.code"))("readOnlyToggle",n.zc(17,22,t.updatePermission)),n.Tb(3),n.Ec("readonly",!n.zc(19,24,t.updatePermission)),n.Tb(2),n.Ec("ngIf",t.customFields.length),n.Tb(1),n.Ec("ngIf",!n.zc(22,26,t.isNew$))}}const Ze=".visible-toggle[_ngcontent-%COMP%]{margin-top:-3px!important}";function Ne(e,t){1&e&&(n.lc(0,"a",5),n.gc(1,"clr-icon",6),n.bd(2),n.yc(3,"translate"),n.kc()),2&e&&(n.Ec("routerLink",n.Hc(4,fe)),n.Tb(2),n.dd(" ",n.zc(3,2,"catalog.create-new-facet")," "))}function Ge(e,t){if(1&e&&n.gc(0,"vdr-facet-value-chip",19),2&e){const e=t.$implicit;n.Ec("facetValue",e)("removable",!1)("displayFacetName",!1)}}function Ue(e,t){if(1&e&&(n.jc(0),n.gc(1,"clr-icon",6),n.bd(2),n.ic()),2&e){const e=n.xc(2).item,t=n.xc();n.Tb(2),n.dd(" ",e.values.length-t.initialLimit," ")}}function Be(e,t){1&e&&n.gc(0,"clr-icon",22)}function He(e,t){if(1&e){const e=n.mc();n.lc(0,"button",20),n.vc("click",function(){n.Sc(e);const t=n.xc().item;return n.xc().toggleDisplayLimit(t)}),n.Zc(1,Ue,3,1,"ng-container",10),n.Zc(2,Be,1,0,"ng-template",null,21,n.ad),n.kc()}if(2&e){const e=n.Oc(3),t=n.xc().item,c=n.xc();n.Tb(1),n.Ec("ngIf",(c.displayLimit[t.id]||0)<t.values.length)("ngIfElse",e)}}function qe(e,t){1&e&&(n.jc(0),n.bd(1),n.yc(2,"translate"),n.ic()),2&e&&(n.Tb(1),n.cd(n.zc(2,1,"catalog.public")))}function Re(e,t){1&e&&(n.bd(0),n.yc(1,"translate")),2&e&&n.cd(n.zc(1,1,"catalog.private"))}const Xe=function(e){return["./",e]},We=function(){return["DeleteCatalog","DeleteFacet"]};function Qe(e,t){if(1&e){const e=n.mc();n.lc(0,"td",7),n.bd(1),n.kc(),n.lc(2,"td",7),n.bd(3),n.kc(),n.lc(4,"td",7),n.Zc(5,Ge,1,3,"vdr-facet-value-chip",8),n.yc(6,"slice"),n.Zc(7,He,4,2,"button",9),n.kc(),n.lc(8,"td",7),n.lc(9,"vdr-chip"),n.Zc(10,qe,3,3,"ng-container",10),n.Zc(11,Re,2,3,"ng-template",null,11,n.ad),n.kc(),n.kc(),n.lc(13,"td",12),n.gc(14,"vdr-table-row-action",13),n.yc(15,"translate"),n.kc(),n.lc(16,"td",12),n.lc(17,"vdr-dropdown"),n.lc(18,"button",14),n.bd(19),n.yc(20,"translate"),n.gc(21,"clr-icon",15),n.kc(),n.lc(22,"vdr-dropdown-menu",16),n.lc(23,"button",17),n.vc("click",function(){n.Sc(e);const c=t.item;return n.xc().deleteFacet(c.id)}),n.yc(24,"hasPermission"),n.gc(25,"clr-icon",18),n.bd(26),n.yc(27,"translate"),n.kc(),n.kc(),n.kc(),n.kc()}if(2&e){const e=t.item,c=n.Oc(12),a=n.xc();n.Xb("private",e.isPrivate),n.Tb(1),n.cd(e.code),n.Tb(1),n.Xb("private",e.isPrivate),n.Tb(1),n.cd(e.name),n.Tb(1),n.Xb("private",e.isPrivate),n.Tb(1),n.Ec("ngForOf",n.Bc(6,23,e.values,0,a.displayLimit[e.id]||3)),n.Tb(2),n.Ec("ngIf",e.values.length>a.initialLimit),n.Tb(1),n.Xb("private",e.isPrivate),n.Tb(2),n.Ec("ngIf",!e.isPrivate)("ngIfElse",c),n.Tb(3),n.Xb("private",e.isPrivate),n.Tb(1),n.Ec("label",n.zc(15,27,"common.edit"))("linkTo",n.Ic(35,Xe,e.id)),n.Tb(2),n.Xb("private",e.isPrivate),n.Tb(3),n.dd(" ",n.zc(20,29,"common.actions")," "),n.Tb(4),n.Ec("disabled",!n.zc(24,31,n.Hc(37,We))),n.Tb(3),n.dd(" ",n.zc(27,33,"common.delete")," ")}}function Ke(e,t){1&e&&(n.bd(0),n.yc(1,"translate")),2&e&&n.cd(n.zc(1,1,"catalog.add-facets"))}function Je(e,t){if(1&e){const e=n.mc();n.lc(0,"button",3),n.vc("click",function(){n.Sc(e);return n.xc().cancel()}),n.bd(1),n.yc(2,"translate"),n.kc(),n.lc(3,"button",4),n.vc("click",function(){n.Sc(e);return n.xc().selectValues()}),n.bd(4),n.yc(5,"translate"),n.kc()}if(2&e){const e=n.xc();n.Tb(1),n.cd(n.zc(2,3,"common.cancel")),n.Tb(2),n.Ec("disabled",0===e.selectedValues.length),n.Tb(1),n.dd(" ",n.zc(5,5,"catalog.add-facets")," ")}}function Ye(e,t){1&e&&(n.jc(0),n.bd(1),n.yc(2,"translate"),n.ic()),2&e&&(n.Tb(1),n.cd(n.zc(2,1,"catalog.assign-variants-to-channel")))}function et(e,t){1&e&&(n.bd(0),n.yc(1,"translate")),2&e&&n.cd(n.zc(1,1,"catalog.assign-products-to-channel"))}function tt(e,t){if(1&e&&(n.Zc(0,Ye,3,3,"ng-container",12),n.Zc(1,et,2,3,"ng-template",null,13,n.ad)),2&e){const e=n.Oc(2),t=n.xc();n.Ec("ngIf",t.isProductVariantMode)("ngIfElse",e)}}const ct=function(e){return{channel:e}};function nt(e,t){if(1&e&&(n.bd(0),n.yc(1,"translate")),2&e){const e=n.xc();n.dd(" ",n.Ac(1,1,"catalog.price-in-channel",n.Ic(4,ct,null==e.selectedChannel?null:e.selectedChannel.code))," ")}}function at(e,t){1&e&&(n.bd(0),n.yc(1,"translate")),2&e&&n.dd(" ",n.zc(1,1,"catalog.no-channel-selected")," ")}function it(e,t){if(1&e&&(n.bd(0),n.yc(1,"localeCurrency")),2&e){const e=n.xc().$implicit,t=n.xc();n.dd(" ",n.Ac(1,1,e.pricePreview,null==t.selectedChannel?null:t.selectedChannel.currencyCode)," ")}}function ot(e,t){1&e&&n.bd(0," - ")}function rt(e,t){if(1&e&&(n.lc(0,"tr"),n.lc(1,"td"),n.bd(2),n.kc(),n.lc(3,"td"),n.bd(4),n.yc(5,"localeCurrency"),n.kc(),n.lc(6,"td"),n.Zc(7,it,2,4,"ng-template",8),n.Zc(8,ot,1,0,"ng-template",null,14,n.ad),n.kc(),n.kc()),2&e){const e=t.$implicit,c=n.Oc(9),a=n.xc();n.Tb(2),n.cd(e.name),n.Tb(2),n.cd(n.Ac(5,4,e.price,null==a.currentChannel?null:a.currentChannel.currencyCode)),n.Tb(3),n.Ec("ngIf",a.selectedChannel)("ngIfElse",c)}}const st=function(e){return{channelCode:e}};function lt(e,t){if(1&e&&(n.bd(0),n.yc(1,"translate")),2&e){const e=n.xc(2);n.dd(" ",n.Ac(1,1,"catalog.assign-to-named-channel",n.Ic(4,st,null==e.selectedChannel?null:e.selectedChannel.code))," ")}}function dt(e,t){1&e&&(n.bd(0),n.yc(1,"translate")),2&e&&n.dd(" ",n.zc(1,1,"catalog.no-channel-selected")," ")}function ut(e,t){if(1&e){const e=n.mc();n.lc(0,"button",15),n.vc("click",function(){n.Sc(e);return n.xc().cancel()}),n.bd(1),n.yc(2,"translate"),n.kc(),n.lc(3,"button",16),n.vc("click",function(){n.Sc(e);return n.xc().assign()}),n.Zc(4,lt,2,6,"ng-template",8),n.Zc(5,dt,2,3,"ng-template",null,9,n.ad),n.kc()}if(2&e){const e=n.Oc(6),t=n.xc();n.Tb(1),n.cd(n.zc(2,4,"common.cancel")),n.Tb(2),n.Ec("disabled",!t.selectedChannel),n.Tb(1),n.Ec("ngIf",t.selectedChannel)("ngIfElse",e)}}const pt=function(){return["product","enabled"]};function gt(e,t){if(1&e&&(n.lc(0,"clr-toggle-wrapper"),n.gc(1,"input",8),n.lc(2,"label"),n.bd(3),n.yc(4,"translate"),n.kc(),n.kc()),2&e){const e=n.xc();n.Tb(1),n.Ec("formControl",e.detailForm.get(n.Hc(4,pt))),n.Tb(2),n.cd(n.zc(4,2,"common.enabled"))}}function mt(e,t){if(1&e){const e=n.mc();n.lc(0,"button",9),n.vc("click",function(){n.Sc(e);return n.xc().create()}),n.bd(1),n.yc(2,"translate"),n.kc()}if(2&e){const e=n.xc();n.Ec("disabled",e.detailForm.invalid||e.detailForm.pristine||!e.variantsToCreateAreValid()),n.Tb(1),n.dd(" ",n.zc(2,2,"common.create")," ")}}function bt(e,t){if(1&e){const e=n.mc();n.lc(0,"button",9),n.vc("click",function(){n.Sc(e);return n.xc(2).save()}),n.bd(1),n.yc(2,"translate"),n.kc()}if(2&e){const e=n.xc(2);n.Ec("disabled",(e.detailForm.invalid||e.detailForm.pristine)&&!e.assetsChanged()&&!e.variantAssetsChanged()),n.Tb(1),n.dd(" ",n.zc(2,2,"common.update")," ")}}const ht=function(){return["UpdateCatalog","UpdateProduct"]};function ft(e,t){1&e&&n.Zc(0,bt,3,4,"button",10),2&e&&n.Ec("vdrIfPermissions",n.Hc(1,ht))}function vt(e,t){if(1&e){const e=n.mc();n.lc(0,"vdr-chip",40),n.vc("iconClick",function(){n.Sc(e);const t=n.xc().$implicit;return n.xc(5).removeFromChannel(t.id)}),n.gc(1,"vdr-channel-badge",41),n.bd(2),n.yc(3,"channelCodeToLabel"),n.kc()}if(2&e){const e=n.xc().$implicit;n.Tb(1),n.Ec("channelCode",e.code),n.Tb(1),n.dd(" ",n.zc(3,2,e.code)," ")}}function yt(e,t){if(1&e&&(n.jc(0),n.Zc(1,vt,4,4,"vdr-chip",39),n.ic()),2&e){const e=t.$implicit,c=n.xc(5);n.Tb(1),n.Ec("ngIf",!c.isDefaultChannel(e.code))}}function Ct(e,t){if(1&e){const e=n.mc();n.lc(0,"vdr-form-item",34),n.yc(1,"translate"),n.lc(2,"div",35),n.Zc(3,yt,2,1,"ng-container",36),n.yc(4,"async"),n.lc(5,"button",37),n.vc("click",function(){n.Sc(e);return n.xc(4).assignToChannel()}),n.gc(6,"clr-icon",38),n.bd(7),n.yc(8,"translate"),n.kc(),n.kc(),n.kc()}if(2&e){const e=n.xc(4);n.Ec("label",n.zc(1,3,"common.channels")),n.Tb(3),n.Ec("ngForOf",n.zc(4,5,e.productChannels$)),n.Tb(4),n.dd(" ",n.zc(8,7,"catalog.assign-to-channel")," ")}}function kt(e,t){1&e&&(n.jc(0),n.Zc(1,Ct,9,9,"vdr-form-item",33),n.ic())}const Ot=function(){return["product","customFields"]};function Pt(e,t){if(1&e&&(n.gc(0,"vdr-custom-field-control",44),n.yc(1,"hasPermission")),2&e){const e=n.xc().$implicit,t=n.xc(4);n.Ec("customFieldsFormGroup",t.detailForm.get(n.Hc(5,Ot)))("customField",e)("readonly",!n.zc(1,3,n.Hc(6,ht)))}}function xt(e,t){if(1&e&&(n.jc(0),n.Zc(1,Pt,2,7,"vdr-custom-field-control",43),n.ic()),2&e){const e=t.$implicit,c=n.xc(4);n.Tb(1),n.Ec("ngIf",c.customFieldIsSet(e.name))}}function Tt(e,t){if(1&e&&(n.lc(0,"section",42),n.lc(1,"label"),n.bd(2),n.yc(3,"translate"),n.kc(),n.Zc(4,xt,2,1,"ng-container",36),n.kc()),2&e){const e=n.xc(3);n.Tb(2),n.cd(n.zc(3,2,"common.custom-fields")),n.Tb(2),n.Ec("ngForOf",e.customFields)}}function It(e,t){if(1&e){const e=n.mc();n.lc(0,"vdr-facet-value-chip",45),n.vc("remove",function(){n.Sc(e);const c=t.$implicit;return n.xc(3).removeProductFacetValue(c.id)}),n.yc(1,"hasPermission"),n.kc()}if(2&e){const e=t.$implicit;n.Ec("facetValue",e)("removable",n.zc(1,2,n.Hc(4,ht)))}}function Ft(e,t){if(1&e){const e=n.mc();n.lc(0,"button",46),n.vc("click",function(){n.Sc(e);return n.xc(3).selectProductFacetValue()}),n.gc(1,"clr-icon",47),n.bd(2),n.yc(3,"translate"),n.kc()}2&e&&(n.Tb(2),n.dd(" ",n.zc(3,1,"catalog.add-facets")," "))}function Et(e,t){if(1&e){const e=n.mc();n.lc(0,"div"),n.lc(1,"h4"),n.bd(2),n.yc(3,"translate"),n.kc(),n.lc(4,"vdr-generate-product-variants",48),n.vc("variantsChange",function(t){n.Sc(e);return n.xc(3).createVariantsConfig=t}),n.kc(),n.kc()}2&e&&(n.Tb(2),n.cd(n.zc(3,1,"catalog.product-variants")))}const St=function(){return["product","name"]};function jt(e,t){if(1&e){const e=n.mc();n.lc(0,"clr-tab-content"),n.lc(1,"div",16),n.lc(2,"div",17),n.lc(3,"section",18),n.Zc(4,kt,2,0,"ng-container",19),n.lc(5,"vdr-form-field",20),n.yc(6,"translate"),n.lc(7,"input",21),n.vc("input",function(t){n.Sc(e);return n.xc(2).updateSlug(t.target.value)}),n.yc(8,"hasPermission"),n.kc(),n.kc(),n.lc(9,"div",22),n.yc(10,"async"),n.lc(11,"clr-checkbox-wrapper"),n.gc(12,"input",23),n.lc(13,"label"),n.bd(14),n.yc(15,"translate"),n.kc(),n.kc(),n.kc(),n.lc(16,"vdr-form-field",24),n.yc(17,"translate"),n.yc(18,"translate"),n.gc(19,"input",25),n.yc(20,"hasPermission"),n.kc(),n.gc(21,"vdr-rich-text-editor",26),n.yc(22,"hasPermission"),n.yc(23,"translate"),n.Zc(24,Tt,5,4,"section",27),n.lc(25,"div",28),n.Zc(26,It,2,5,"vdr-facet-value-chip",29),n.yc(27,"async"),n.Zc(28,Ft,4,3,"button",30),n.kc(),n.kc(),n.kc(),n.lc(29,"div",31),n.lc(30,"vdr-product-assets",32),n.vc("change",function(t){n.Sc(e);return n.xc(2).assetChanges=t}),n.kc(),n.kc(),n.kc(),n.Zc(31,Et,5,3,"div",15),n.yc(32,"async"),n.kc()}if(2&e){const e=n.xc().ngIf,t=n.xc();let c=null;n.Tb(5),n.Ec("label",n.zc(6,16,"catalog.product-name")),n.Tb(2),n.Ec("readonly",!n.zc(8,18,n.Hc(38,ht))),n.Tb(2),n.Xb("visible",!1===n.zc(10,20,t.isNew$)&&(null==(c=t.detailForm.get(n.Hc(39,St)))?null:c.dirty)),n.Tb(5),n.cd(n.zc(15,22,"catalog.auto-update-product-variant-name")),n.Tb(2),n.Ec("label",n.zc(17,24,"catalog.slug"))("errors",n.Ic(40,be,n.zc(18,26,"catalog.slug-pattern-error"))),n.Tb(3),n.Ec("readonly",!n.zc(20,28,n.Hc(42,ht))),n.Tb(2),n.Ec("readonly",!n.zc(22,30,n.Hc(43,ht)))("label",n.zc(23,32,"common.description")),n.Tb(3),n.Ec("ngIf",t.customFields.length),n.Tb(2),n.Ec("ngForOf",n.zc(27,34,t.facetValues$)),n.Tb(2),n.Ec("vdrIfPermissions",n.Hc(44,ht)),n.Tb(2),n.Ec("assets",t.assetChanges.assets||e.assets)("featuredAsset",t.assetChanges.featuredAsset||e.featuredAsset),n.Tb(1),n.Ec("ngIf",n.zc(32,36,t.isNew$))}}const Mt=function(){return["./","manage-variants"]};function Vt(e,t){1&e&&(n.lc(0,"a",64),n.gc(1,"clr-icon",65),n.bd(2),n.yc(3,"translate"),n.kc()),2&e&&(n.Ec("routerLink",n.Hc(4,Mt)),n.Tb(2),n.dd(" ",n.zc(3,2,"catalog.manage-variants")," "))}function wt(e,t){if(1&e&&(n.gc(0,"vdr-product-variants-table",66),n.yc(1,"async"),n.yc(2,"async")),2&e){const e=n.xc(3).ngIf,t=n.xc();n.Ec("variants",n.zc(1,5,t.variants$))("optionGroups",e.optionGroups)("channelPriceIncludesTax",n.zc(2,7,t.channelPriceIncludesTax$))("productVariantsFormArray",t.detailForm.get("variants"))("pendingAssetChanges",t.variantAssetChanges)}}function zt(e,t){if(1&e){const e=n.mc();n.lc(0,"vdr-product-variants-list",67),n.vc("assignToChannel",function(t){n.Sc(e);return n.xc(4).assignVariantToChannel(t)})("removeFromChannel",function(t){n.Sc(e);return n.xc(4).removeVariantFromChannel(t)})("assetChange",function(t){n.Sc(e);return n.xc(4).variantAssetChange(t)})("updateProductOption",function(t){n.Sc(e);return n.xc(4).updateProductOption(t)})("selectionChange",function(t){n.Sc(e);return n.xc(4).selectedVariantIds=t})("selectFacetValueClick",function(t){n.Sc(e);return n.xc(4).selectVariantFacetValue(t)}),n.yc(1,"async"),n.yc(2,"async"),n.yc(3,"async"),n.yc(4,"async"),n.yc(5,"async"),n.kc()}if(2&e){const e=n.xc(3).ngIf,t=n.xc();n.Ec("variants",n.zc(1,10,t.variants$))("channelPriceIncludesTax",n.zc(2,12,t.channelPriceIncludesTax$))("facets",n.zc(3,14,t.facets$))("optionGroups",e.optionGroups)("productVariantsFormArray",t.detailForm.get("variants"))("taxCategories",n.zc(4,16,t.taxCategories$))("customFields",t.customVariantFields)("customOptionFields",t.customOptionFields)("activeLanguage",n.zc(5,18,t.languageCode$))("pendingAssetChanges",t.variantAssetChanges)}}function At(e,t){if(1&e){const e=n.mc();n.lc(0,"clr-tab-content"),n.lc(1,"section",49),n.lc(2,"div",50),n.lc(3,"div",51),n.lc(4,"button",52),n.vc("click",function(){n.Sc(e);return n.xc(3).variantDisplayMode="card"}),n.gc(5,"clr-icon",53),n.bd(6),n.yc(7,"translate"),n.kc(),n.lc(8,"button",54),n.vc("click",function(){n.Sc(e);return n.xc(3).variantDisplayMode="table"}),n.gc(9,"clr-icon",55),n.bd(10),n.yc(11,"translate"),n.kc(),n.kc(),n.lc(12,"div",56),n.gc(13,"input",57),n.yc(14,"translate"),n.lc(15,"button",58),n.vc("click",function(){n.Sc(e);return n.xc(3).filterInput.setValue("")}),n.gc(16,"clr-icon",59),n.kc(),n.kc(),n.gc(17,"div",60),n.Zc(18,Vt,4,5,"a",61),n.kc(),n.Zc(19,wt,3,9,"vdr-product-variants-table",62),n.Zc(20,zt,6,20,"vdr-product-variants-list",63),n.kc(),n.kc()}if(2&e){const e=n.xc(3);n.Tb(4),n.Xb("btn-primary","card"===e.variantDisplayMode),n.Tb(2),n.dd(" ",n.zc(7,11,"catalog.display-variant-cards")," "),n.Tb(2),n.Xb("btn-primary","table"===e.variantDisplayMode),n.Tb(2),n.dd(" ",n.zc(11,13,"catalog.display-variant-table")," "),n.Tb(3),n.Ec("formControl",e.filterInput)("placeholder",n.zc(14,15,"catalog.filter-by-name-or-sku")),n.Tb(5),n.Ec("vdrIfPermissions",n.Hc(17,ht)),n.Tb(1),n.Ec("ngIf","table"===e.variantDisplayMode),n.Tb(1),n.Ec("ngIf","card"===e.variantDisplayMode)}}function Dt(e,t){if(1&e){const e=n.mc();n.lc(0,"clr-tab"),n.lc(1,"button",13),n.vc("click",function(){n.Sc(e);return n.xc(2).navigateToTab("variants")}),n.bd(2),n.yc(3,"translate"),n.kc(),n.Zc(4,At,21,18,"clr-tab-content",14),n.yc(5,"async"),n.kc()}if(2&e){const e=n.xc(2);n.Tb(2),n.dd(" ",n.zc(3,2,"catalog.product-variants")," "),n.Tb(2),n.Ec("clrIfActive","variants"===n.zc(5,4,e.activeTab$))}}function $t(e,t){if(1&e){const e=n.mc();n.lc(0,"form",11),n.gc(1,"button",12),n.lc(2,"clr-tabs"),n.lc(3,"clr-tab"),n.lc(4,"button",13),n.vc("click",function(){n.Sc(e);return n.xc().navigateToTab("details")}),n.bd(5),n.yc(6,"translate"),n.kc(),n.Zc(7,jt,33,45,"clr-tab-content",14),n.yc(8,"async"),n.kc(),n.Zc(9,Dt,6,6,"clr-tab",15),n.yc(10,"async"),n.kc(),n.kc()}if(2&e){const e=n.xc();n.Ec("formGroup",e.detailForm),n.Tb(5),n.dd(" ",n.zc(6,4,"catalog.product-details")," "),n.Tb(2),n.Ec("clrIfActive","details"===n.zc(8,6,e.activeTab$)),n.Tb(2),n.Ec("ngIf",!n.zc(10,8,e.isNew$))}}const _t=["selectComponent"];function Lt(e,t){if(1&e){const e=n.mc();n.lc(0,"div",6),n.vc("click",function(){n.Sc(e),n.xc(2);return n.Oc(1).selectTag()}),n.bd(1),n.yc(2,"translate"),n.kc()}if(2&e){const e=n.xc(2),t=n.Oc(1);n.Xb("selected",e.isSearchHeaderSelected()),n.Tb(1),n.ed(" ",n.zc(2,4,"catalog.search-for-term"),": ",t.searchTerm," ")}}function Zt(e,t){if(1&e&&n.Zc(0,Lt,3,6,"div",5),2&e){n.xc();const e=n.Oc(1);n.Ec("ngIf",e.searchTerm)}}function Nt(e,t){if(1&e){const e=n.mc();n.jc(0),n.lc(1,"vdr-facet-value-chip",8),n.vc("remove",function(){n.Sc(e);const t=n.xc(),c=t.item;return(0,t.clear)(c)}),n.kc(),n.ic()}if(2&e){const e=n.xc().item;n.Tb(1),n.Ec("facetValue",e.facetValue)("removable",!0)}}function Gt(e,t){if(1&e){const e=n.mc();n.jc(0),n.lc(1,"vdr-chip",9),n.vc("iconClick",function(){n.Sc(e);const t=n.xc(),c=t.item;return(0,t.clear)(c)}),n.bd(2),n.kc(),n.ic()}if(2&e){const e=n.xc().item;n.Tb(1),n.Ec("icon","times"),n.Tb(1),n.dd('"',e.label,'"')}}function Ut(e,t){if(1&e&&(n.Zc(0,Nt,2,2,"ng-container",7),n.Zc(1,Gt,3,2,"ng-container",7)),2&e){const e=t.item;n.Ec("ngIf",e.facetValue),n.Tb(1),n.Ec("ngIf",!e.facetValue)}}function Bt(e,t){if(1&e&&(n.jc(0),n.gc(1,"vdr-facet-value-chip",10),n.ic()),2&e){const e=n.xc().item;n.Tb(1),n.Ec("facetValue",e.facetValue)("removable",!1)}}function Ht(e,t){if(1&e&&n.Zc(0,Bt,2,2,"ng-container",7),2&e){const e=t.item;n.Ec("ngIf",e.facetValue)}}const qt=["productSearchInputComponent"];function Rt(e,t){1&e&&(n.lc(0,"a",16),n.gc(1,"clr-icon",17),n.lc(2,"span",18),n.bd(3),n.yc(4,"translate"),n.kc(),n.kc()),2&e&&(n.Ec("routerLink",n.Hc(4,fe)),n.Tb(3),n.cd(n.zc(4,2,"catalog.create-new-product")))}function Xt(e,t){if(1&e&&(n.gc(0,"img",31),n.yc(1,"assetPreview")),2&e){const e=t.ngIf;n.Ec("src",n.Ac(1,1,e,"tiny"),n.Uc)}}function Wt(e,t){1&e&&(n.lc(0,"div",32),n.gc(1,"clr-icon",33),n.kc())}function Qt(e,t){1&e&&(n.lc(0,"vdr-chip"),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.cd(n.zc(2,1,"common.disabled")))}const Kt=function(){return["DeleteCatalog","DeleteProduct"]};function Jt(e,t){if(1&e){const e=n.mc();n.lc(0,"td",19),n.lc(1,"div",20),n.Zc(2,Xt,2,4,"img",21),n.Zc(3,Wt,2,0,"ng-template",null,22,n.ad),n.kc(),n.kc(),n.lc(5,"td",19),n.bd(6),n.kc(),n.lc(7,"td",23),n.Zc(8,Qt,3,3,"vdr-chip",24),n.kc(),n.lc(9,"td",25),n.gc(10,"vdr-table-row-action",26),n.yc(11,"translate"),n.kc(),n.lc(12,"td",25),n.lc(13,"vdr-dropdown"),n.lc(14,"button",27),n.bd(15),n.yc(16,"translate"),n.gc(17,"clr-icon",28),n.kc(),n.lc(18,"vdr-dropdown-menu",7),n.lc(19,"button",29),n.vc("click",function(){n.Sc(e);const c=t.item;return n.xc().deleteProduct(c.productId)}),n.yc(20,"hasPermission"),n.gc(21,"clr-icon",30),n.bd(22),n.yc(23,"translate"),n.kc(),n.kc(),n.kc(),n.kc()}if(2&e){const e=t.item,c=n.Oc(4),a=n.xc();n.Xb("disabled",!e.enabled),n.Tb(2),n.Ec("ngIf",a.groupByProduct?e.productAsset:e.productVariantAsset||e.productAsset)("ngIfElse",c),n.Tb(3),n.Xb("disabled",!e.enabled),n.Tb(1),n.dd(" ",a.groupByProduct?e.productName:e.productVariantName," "),n.Tb(1),n.Xb("disabled",!e.enabled),n.Tb(1),n.Ec("ngIf",!e.enabled),n.Tb(1),n.Xb("disabled",!e.enabled),n.Tb(1),n.Ec("label",n.zc(11,19,"common.edit"))("linkTo",n.Ic(27,Xe,e.productId)),n.Tb(2),n.Xb("disabled",!e.enabled),n.Tb(3),n.dd(" ",n.zc(16,21,"common.actions")," "),n.Tb(4),n.Ec("disabled",!n.zc(20,23,n.Hc(29,Kt))),n.Tb(3),n.dd(" ",n.zc(23,25,"common.delete")," ")}}const Yt=function(){return["CreateCatalog","CreateProduct"]};function ec(e,t){1&e&&(n.bd(0),n.yc(1,"translate")),2&e&&n.dd(" ",n.zc(1,1,"catalog.confirm-deletion-of-unused-variants-title"),"\n")}function tc(e,t){if(1&e&&(n.lc(0,"li"),n.bd(1),n.kc()),2&e){const e=t.$implicit;n.Tb(1),n.ed("",e.name," (",e.sku,")")}}function cc(e,t){if(1&e){const e=n.mc();n.lc(0,"button",3),n.vc("click",function(){n.Sc(e);return n.xc().cancel()}),n.bd(1),n.yc(2,"translate"),n.kc(),n.lc(3,"button",4),n.vc("click",function(){n.Sc(e);return n.xc().confirm()}),n.bd(4),n.yc(5,"translate"),n.kc()}2&e&&(n.Tb(1),n.cd(n.zc(2,2,"common.cancel")),n.Tb(3),n.dd(" ",n.zc(5,4,"common.confirm")," "))}function nc(e,t){if(1&e){const e=n.mc();n.lc(0,"div",7),n.lc(1,"div",8),n.lc(2,"label"),n.bd(3),n.yc(4,"translate"),n.kc(),n.lc(5,"input",9),n.vc("ngModelChange",function(e){return t.$implicit.name=e}),n.kc(),n.kc(),n.lc(6,"div",10),n.lc(7,"label"),n.bd(8),n.yc(9,"translate"),n.kc(),n.lc(10,"vdr-option-value-input",11,12),n.vc("ngModelChange",function(e){return t.$implicit.values=e})("ngModelChange",function(){n.Sc(e);return n.xc().generateVariants()}),n.kc(),n.kc(),n.kc()}if(2&e){const e=t.$implicit;n.Tb(3),n.cd(n.zc(4,7,"catalog.option")),n.Tb(2),n.Ec("ngModel",e.name)("readonly",!e.isNew),n.Tb(3),n.cd(n.zc(9,9,"catalog.option-values")),n.Tb(2),n.Ec("ngModel",e.values)("groupName",e.name)("disabled",""===e.name)}}function ac(e,t){if(1&e){const e=n.mc();n.lc(0,"input",15),n.vc("ngModelChange",function(t){n.Sc(e);return n.xc().$implicit.enabled=t})("ngModelChange",function(){n.Sc(e);return n.xc(2).formValueChanged=!0}),n.kc()}if(2&e){const e=n.xc().$implicit;n.Ec("ngModel",e.enabled)}}function ic(e,t){if(1&e){const e=n.mc();n.lc(0,"clr-input-container"),n.lc(1,"input",16),n.vc("ngModelChange",function(t){n.Sc(e);return n.xc().$implicit.sku=t})("ngModelChange",function(){n.Sc(e);const t=n.xc().$implicit;return n.xc().onFormChanged(t)}),n.yc(2,"translate"),n.kc(),n.kc()}if(2&e){const e=n.xc().$implicit;n.Tb(1),n.Ec("ngModel",e.sku)("placeholder",n.zc(2,2,"catalog.sku"))}}function oc(e,t){if(1&e&&(n.lc(0,"span"),n.bd(1),n.kc()),2&e){const e=n.xc().$implicit;n.Tb(1),n.cd(e.sku)}}function rc(e,t){if(1&e){const e=n.mc();n.lc(0,"clr-input-container"),n.lc(1,"vdr-currency-input",17),n.vc("ngModelChange",function(t){n.Sc(e);return n.xc().$implicit.price=t})("ngModelChange",function(){n.Sc(e);const t=n.xc().$implicit;return n.xc().onFormChanged(t)}),n.kc(),n.kc()}if(2&e){const e=n.xc().$implicit,t=n.xc();n.Tb(1),n.Ec("ngModel",e.price)("currencyCode",t.currencyCode)}}function sc(e,t){if(1&e&&(n.lc(0,"span"),n.bd(1),n.yc(2,"localeCurrency"),n.kc()),2&e){const e=n.xc().$implicit,t=n.xc();n.Tb(1),n.cd(n.Ac(2,1,e.price,t.currencyCode))}}function lc(e,t){if(1&e){const e=n.mc();n.lc(0,"clr-input-container"),n.lc(1,"input",18),n.vc("ngModelChange",function(t){n.Sc(e);return n.xc().$implicit.stock=t})("ngModelChange",function(){n.Sc(e);const t=n.xc().$implicit;return n.xc().onFormChanged(t)}),n.kc(),n.kc()}if(2&e){const e=n.xc().$implicit;n.Tb(1),n.Ec("ngModel",e.stock)}}function dc(e,t){if(1&e&&(n.lc(0,"span"),n.bd(1),n.kc()),2&e){const e=n.xc().$implicit;n.Tb(1),n.cd(e.stock)}}function uc(e,t){if(1&e){const e=n.mc();n.lc(0,"vdr-dropdown"),n.lc(1,"button",19),n.gc(2,"clr-icon",20),n.kc(),n.lc(3,"vdr-dropdown-menu",21),n.lc(4,"button",22),n.vc("click",function(){n.Sc(e);const c=t.ngIf;return n.xc(2).deleteVariant(c)}),n.gc(5,"clr-icon",23),n.bd(6),n.yc(7,"translate"),n.kc(),n.kc(),n.kc()}2&e&&(n.Tb(6),n.dd(" ",n.zc(7,1,"common.delete")," "))}function pc(e,t){if(1&e&&(n.lc(0,"tr"),n.lc(1,"td"),n.Zc(2,ac,1,1,"input",13),n.kc(),n.lc(3,"td"),n.bd(4),n.yc(5,"translate"),n.kc(),n.lc(6,"td"),n.Zc(7,ic,3,4,"clr-input-container",14),n.Zc(8,oc,2,1,"span",14),n.kc(),n.lc(9,"td"),n.Zc(10,rc,2,2,"clr-input-container",14),n.Zc(11,sc,3,4,"span",14),n.kc(),n.lc(12,"td"),n.Zc(13,lc,2,1,"clr-input-container",14),n.Zc(14,dc,2,1,"span",14),n.kc(),n.lc(15,"td"),n.Zc(16,uc,8,3,"vdr-dropdown",14),n.kc(),n.kc()),2&e){const e=t.$implicit,c=n.xc();n.Xb("disabled",!e.enabled||e.existing),n.Tb(2),n.Ec("ngIf",!e.existing),n.Tb(2),n.dd(" ",n.zc(5,11,c.getVariantName(e))," "),n.Tb(3),n.Ec("ngIf",!e.existing),n.Tb(1),n.Ec("ngIf",e.existing),n.Tb(2),n.Ec("ngIf",!e.existing),n.Tb(1),n.Ec("ngIf",e.existing),n.Tb(2),n.Ec("ngIf",!e.existing),n.Tb(1),n.Ec("ngIf",e.existing),n.Tb(2),n.Ec("ngIf",e.productVariantId)}}function gc(e,t){if(1&e&&n.gc(0,"vdr-collection-tree-node",1),2&e){const e=n.xc();n.Ec("expandAll",e.expandAll)("collectionTree",e.collectionTree)("activeCollectionId",e.activeCollectionId)}}function mc(e,t){1&e&&n.gc(0,"clr-icon",31)}function bc(e,t){1&e&&n.gc(0,"clr-icon",32)}function hc(e,t){if(1&e){const e=n.mc();n.lc(0,"button",28),n.vc("click",function(){n.Sc(e);const t=n.xc().$implicit;return t.expanded=!t.expanded}),n.Zc(1,mc,1,0,"clr-icon",29),n.Zc(2,bc,1,0,"clr-icon",30),n.kc()}if(2&e){const e=n.xc().$implicit,t=n.xc();n.Ec("disabled",t.expandAll),n.Tb(1),n.Ec("ngIf",!e.expanded&&!t.expandAll),n.Tb(1),n.Ec("ngIf",e.expanded||t.expandAll)}}function fc(e,t){1&e&&n.gc(0,"div",33)}function vc(e,t){1&e&&(n.lc(0,"vdr-chip"),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.cd(n.zc(2,1,"catalog.private")))}function yc(e,t){1&e&&(n.lc(0,"div",34),n.gc(1,"clr-icon",35),n.kc())}const Cc=function(e){return{parentId:e}},kc=function(e){return["./","create",e]};function Oc(e,t){if(1&e&&(n.lc(0,"a",36),n.gc(1,"clr-icon",37),n.bd(2),n.yc(3,"translate"),n.kc()),2&e){const e=n.xc().$implicit;n.Ec("routerLink",n.Ic(6,kc,n.Ic(4,Cc,e.id))),n.Tb(2),n.dd(" ",n.zc(3,2,"catalog.create-new-collection")," ")}}function Pc(e,t){if(1&e){const e=n.mc();n.lc(0,"button",20),n.vc("click",function(){n.Sc(e);const c=t.$implicit,a=n.xc().$implicit;return n.xc().move(a,c.id)}),n.yc(1,"async"),n.lc(2,"div",38),n.lc(3,"div",39),n.gc(4,"clr-icon",40),n.kc(),n.lc(5,"div",41),n.bd(6),n.kc(),n.kc(),n.kc()}if(2&e){const e=t.$implicit,c=n.xc(2);n.Ec("disabled",!n.zc(1,2,c.hasUpdatePermission$)),n.Tb(6),n.dd(" ",e.path," ")}}function xc(e,t){if(1&e&&n.gc(0,"vdr-collection-tree-node",42),2&e){const e=n.xc().$implicit,t=n.xc();n.Ec("expandAll",t.expandAll)("collectionTree",e)("activeCollectionId",t.activeCollectionId)}}const Tc=function(e){return{contents:e}},Ic=function(e){return["/catalog/collections/",e]},Fc=function(){return["UpdateCatalog","UpdateCollection"]};function Ec(e,t){if(1&e){const e=n.mc();n.lc(0,"div",3),n.lc(1,"div",4),n.lc(2,"div",5),n.Zc(3,hc,3,3,"button",6),n.Zc(4,fc,1,0,"ng-template",null,7,n.ad),n.bd(6),n.kc(),n.gc(7,"div",8),n.Zc(8,vc,3,3,"vdr-chip",9),n.lc(9,"a",10),n.gc(10,"clr-icon",11),n.bd(11),n.yc(12,"translate"),n.kc(),n.lc(13,"a",12),n.gc(14,"clr-icon",13),n.bd(15),n.yc(16,"translate"),n.kc(),n.Zc(17,yc,2,0,"div",14),n.lc(18,"vdr-dropdown"),n.lc(19,"button",15),n.gc(20,"clr-icon",16),n.kc(),n.lc(21,"vdr-dropdown-menu",17),n.Zc(22,Oc,4,8,"a",18),n.gc(23,"div",19),n.lc(24,"button",20),n.vc("click",function(){n.Sc(e);const c=t.$implicit,a=t.index;return n.xc().moveUp(c,a)}),n.yc(25,"async"),n.gc(26,"clr-icon",21),n.bd(27),n.yc(28,"translate"),n.kc(),n.lc(29,"button",20),n.vc("click",function(){n.Sc(e);const c=t.$implicit,a=t.index;return n.xc().moveDown(c,a)}),n.yc(30,"async"),n.gc(31,"clr-icon",22),n.bd(32),n.yc(33,"translate"),n.kc(),n.lc(34,"h4",23),n.bd(35),n.yc(36,"translate"),n.kc(),n.Zc(37,Pc,7,4,"button",24),n.gc(38,"div",19),n.lc(39,"button",25),n.vc("click",function(){n.Sc(e);const c=t.$implicit;return n.xc().delete(c.id)}),n.yc(40,"async"),n.gc(41,"clr-icon",26),n.bd(42),n.yc(43,"translate"),n.kc(),n.kc(),n.kc(),n.kc(),n.Zc(44,xc,1,3,"vdr-collection-tree-node",27),n.kc()}if(2&e){const e=t.$implicit,c=t.index,a=n.Oc(5),i=n.xc();n.Xb("private",e.isPrivate),n.Ec("cdkDragData",e),n.Tb(1),n.Xb("active",e.id===i.activeCollectionId),n.Ec("ngClass","depth-"+i.depth),n.Tb(2),n.Ec("ngIf",null==e.children?null:e.children.length)("ngIfElse",a),n.Tb(3),n.dd(" ",e.name," "),n.Tb(2),n.Ec("ngIf",e.isPrivate),n.Tb(1),n.Ec("routerLink",n.Ic(45,Xe,n.Ic(43,Tc,e.id))),n.Tb(2),n.dd(" ",n.zc(12,25,"catalog.view-contents")," "),n.Tb(2),n.Ec("routerLink",n.Ic(47,Ic,e.id)),n.Tb(2),n.dd(" ",n.zc(16,27,"common.edit")," "),n.Tb(2),n.Ec("vdrIfPermissions",n.Hc(49,Fc)),n.Tb(5),n.Ec("vdrIfPermissions",n.Hc(50,Ce)),n.Tb(2),n.Ec("disabled",0===c||!n.zc(25,29,i.hasUpdatePermission$)),n.Tb(3),n.dd(" ",n.zc(28,31,"catalog.move-up")," "),n.Tb(2),n.Ec("disabled",c===i.collectionTree.children.length-1||!n.zc(30,33,i.hasUpdatePermission$)),n.Tb(3),n.dd(" ",n.zc(33,35,"catalog.move-down")," "),n.Tb(3),n.cd(n.zc(36,37,"catalog.move-to")),n.Tb(2),n.Ec("ngForOf",i.getMoveListItems(e)),n.Tb(2),n.Ec("disabled",!n.zc(40,39,i.hasDeletePermission$)),n.Tb(3),n.dd(" ",n.zc(43,41,"common.delete")," "),n.Tb(2),n.Ec("ngIf",e.expanded||i.expandAll)}}function Sc(e,t){if(1&e){const e=n.mc();n.lc(0,"div",7),n.lc(1,"div",8),n.lc(2,"label"),n.bd(3),n.yc(4,"translate"),n.kc(),n.lc(5,"input",9),n.vc("ngModelChange",function(e){return t.$implicit.name=e})("keydown.enter",function(t){n.Sc(e);const c=n.Oc(11);return n.xc().handleEnter(t,c)}),n.kc(),n.kc(),n.lc(6,"div",10),n.lc(7,"label"),n.bd(8),n.yc(9,"translate"),n.kc(),n.lc(10,"vdr-option-value-input",11,12),n.vc("ngModelChange",function(e){return t.$implicit.values=e})("ngModelChange",function(){n.Sc(e);return n.xc().generateVariants()}),n.kc(),n.kc(),n.lc(12,"div",13),n.lc(13,"button",14),n.vc("click",function(){n.Sc(e);const c=t.$implicit;return n.xc().removeOption(c.name)}),n.yc(14,"translate"),n.gc(15,"clr-icon",15),n.kc(),n.kc(),n.kc()}if(2&e){const e=t.$implicit;n.Tb(3),n.cd(n.zc(4,7,"catalog.option")),n.Tb(2),n.Ec("ngModel",e.name),n.Tb(3),n.cd(n.zc(9,9,"catalog.option-values")),n.Tb(2),n.Ec("ngModel",e.values)("groupName",e.name)("disabled",""===e.name),n.Tb(3),n.Ec("title",n.zc(14,11,"catalog.remove-option"))}}function jc(e,t){1&e&&(n.lc(0,"th"),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.cd(n.zc(2,1,"common.create")))}function Mc(e,t){1&e&&(n.lc(0,"th"),n.bd(1),n.yc(2,"translate"),n.kc()),2&e&&(n.Tb(1),n.cd(n.zc(2,1,"catalog.variant")))}function Vc(e,t){if(1&e){const e=n.mc();n.lc(0,"td"),n.lc(1,"input",19),n.vc("change",function(){n.Sc(e);return n.xc(2).onFormChange()})("ngModelChange",function(t){n.Sc(e);const c=n.xc().$implicit;return n.xc().variantFormValues[c.id].enabled=t}),n.kc(),n.kc()}if(2&e){const e=n.xc().$implicit,t=n.xc();n.Tb(1),n.Ec("ngModel",t.variantFormValues[e.id].enabled)}}function wc(e,t){if(1&e&&(n.lc(0,"td"),n.bd(1),n.kc()),2&e){const e=n.xc().$implicit;n.Tb(1),n.dd(" ",e.values.join(" ")," ")}}function zc(e,t){if(1&e){const e=n.mc();n.lc(0,"tr"),n.Zc(1,Vc,2,1,"td",5),n.Zc(2,wc,2,1,"td",5),n.lc(3,"td"),n.lc(4,"clr-input-container"),n.lc(5,"input",16),n.vc("change",function(){n.Sc(e);return n.xc().onFormChange()})("ngModelChange",function(c){n.Sc(e);const a=t.$implicit;return n.xc().variantFormValues[a.id].sku=c}),n.yc(6,"translate"),n.kc(),n.kc(),n.kc(),n.lc(7,"td"),n.lc(8,"clr-input-container"),n.lc(9,"vdr-currency-input",17),n.vc("ngModelChange",function(c){n.Sc(e);const a=t.$implicit;return n.xc().variantFormValues[a.id].price=c})("ngModelChange",function(){n.Sc(e);return n.xc().onFormChange()}),n.kc(),n.kc(),n.kc(),n.lc(10,"td"),n.lc(11,"clr-input-container"),n.lc(12,"input",18),n.vc("ngModelChange",function(c){n.Sc(e);const a=t.$implicit;return n.xc().variantFormValues[a.id].stock=c})("change",function(){n.Sc(e);return n.xc().onFormChange()}),n.kc(),n.kc(),n.kc(),n.kc()}if(2&e){const e=t.$implicit,c=n.xc();n.Xb("disabled",!c.variantFormValues[e.id].enabled),n.Tb(1),n.Ec("ngIf",1<c.variants.length),n.Tb(1),n.Ec("ngIf",1<c.variants.length),n.Tb(3),n.Ec("ngModel",c.variantFormValues[e.id].sku)("placeholder",n.zc(6,9,"catalog.sku")),n.Tb(4),n.Ec("ngModel",c.variantFormValues[e.id].price)("currencyCode",c.currencyCode),n.Tb(3),n.Ec("ngModel",c.variantFormValues[e.id].stock)}}const Ac=["textArea"];function Dc(e,t){if(1&e){const e=n.mc();n.lc(0,"vdr-chip",6),n.vc("iconClick",function(){n.Sc(e);const c=t.$implicit;return n.xc(2).removeOption(c)}),n.bd(1),n.kc()}if(2&e){const e=t.$implicit,c=t.last,a=n.xc(2);n.Xb("selected",c&&a.lastSelected)("locked",e.locked),n.Ec("icon",e.locked?"lock":"times")("colorFrom",a.groupName),n.Tb(1),n.dd(" ",e.name," ")}}function $c(e,t){if(1&e&&(n.lc(0,"div",4),n.Zc(1,Dc,2,7,"vdr-chip",5),n.kc()),2&e){const e=n.xc();n.Tb(1),n.Ec("ngForOf",e.options)}}function _c(e,t){if(1&e){const e=n.mc();n.lc(0,"img",11),n.vc("click",function(){n.Sc(e);const t=n.xc(2);return t.previewAsset(t.featuredAsset)}),n.yc(1,"assetPreview"),n.kc()}if(2&e){const e=n.xc(2);n.Ec("src",n.Ac(1,1,e.featuredAsset,"small"),n.Uc)}}function Lc(e,t){if(1&e){const e=n.mc();n.lc(0,"div",12),n.vc("click",function(){n.Sc(e);return n.xc(2).selectAssets()}),n.gc(1,"clr-icon",13),n.lc(2,"div"),n.bd(3),n.yc(4,"translate"),n.kc(),n.kc()}2&e&&(n.Tb(3),n.cd(n.zc(4,1,"catalog.no-featured-asset")))}function Zc(e,t){1&e&&n.hc(0)}function Nc(e,t){if(1&e){const e=n.mc();n.lc(0,"div",14),n.lc(1,"button",15),n.vc("click",function(){n.Sc(e);return n.xc(2).selectAssets()}),n.gc(2,"clr-icon",16),n.bd(3),n.yc(4,"translate"),n.kc(),n.kc()}2&e&&(n.Tb(3),n.dd(" ",n.zc(4,1,"asset.add-asset")," "))}function Gc(e,t){if(1&e&&(n.lc(0,"div",3),n.lc(1,"div",4),n.lc(2,"div",5),n.Zc(3,_c,2,4,"img",6),n.Zc(4,Lc,5,3,"div",7),n.kc(),n.kc(),n.lc(5,"div",8),n.Zc(6,Zc,1,0,"ng-container",9),n.kc(),n.Zc(7,Nc,5,3,"div",10),n.kc()),2&e){const e=n.xc(),t=n.Oc(4);n.Tb(3),n.Ec("ngIf",e.featuredAsset),n.Tb(1),n.Ec("ngIf",!e.featuredAsset),n.Tb(2),n.Ec("ngTemplateOutlet",t),n.Tb(1),n.Ec("vdrIfPermissions",e.updatePermissions)}}function Uc(e,t){if(1&e){const e=n.mc();n.lc(0,"img",11),n.vc("click",function(){n.Sc(e);const t=n.xc(2);return t.previewAsset(t.featuredAsset)}),n.yc(1,"assetPreview"),n.kc()}if(2&e){const e=n.xc(2);n.Ec("src",n.Ac(1,1,e.featuredAsset,"thumb"),n.Uc)}}function Bc(e,t){if(1&e){const e=n.mc();n.lc(0,"div",12),n.vc("click",function(){n.Sc(e);return n.xc(2).selectAssets()}),n.gc(1,"clr-icon",19),n.kc()}}function Hc(e,t){1&e&&n.hc(0)}function qc(e,t){if(1&e){const e=n.mc();n.lc(0,"button",20),n.vc("click",function(){n.Sc(e);return n.xc(2).selectAssets()}),n.yc(1,"translate"),n.gc(2,"clr-icon",16),n.bd(3),n.yc(4,"translate"),n.kc()}2&e&&(n.Ec("title",n.zc(1,2,"asset.add-asset")),n.Tb(3),n.dd(" ",n.zc(4,4,"asset.add-asset")," "))}function Rc(e,t){if(1&e&&(n.lc(0,"div",17),n.Zc(1,Uc,2,4,"img",6),n.Zc(2,Bc,2,0,"div",7),n.kc(),n.Zc(3,Hc,1,0,"ng-container",9),n.Zc(4,qc,5,6,"button",18)),2&e){const e=n.xc(),t=n.Oc(4);n.Tb(1),n.Ec("ngIf",e.featuredAsset),n.Tb(1),n.Ec("ngIf",!e.featuredAsset),n.Tb(1),n.Ec("ngTemplateOutlet",t),n.Tb(1),n.Ec("vdrIfPermissions",e.updatePermissions)}}function Xc(e,t){if(1&e){const e=n.mc();n.lc(0,"div",23),n.vc("cdkDropListDropped",function(t){n.Sc(e);return n.xc(2).dropListDropped(t)}),n.yc(1,"hasPermission"),n.lc(2,"vdr-dropdown",24),n.lc(3,"div",25),n.gc(4,"img",26),n.yc(5,"assetPreview"),n.kc(),n.lc(6,"vdr-dropdown-menu",27),n.lc(7,"button",28),n.vc("click",function(){n.Sc(e);const c=t.$implicit;return n.xc(2).previewAsset(c)}),n.bd(8),n.yc(9,"translate"),n.kc(),n.lc(10,"button",29),n.vc("click",function(){n.Sc(e);const c=t.$implicit;return n.xc(2).setAsFeatured(c)}),n.yc(11,"hasPermission"),n.bd(12),n.yc(13,"translate"),n.kc(),n.gc(14,"div",30),n.lc(15,"button",31),n.vc("click",function(){n.Sc(e);const c=t.$implicit;return n.xc(2).removeAsset(c)}),n.yc(16,"hasPermission"),n.bd(17),n.yc(18,"translate"),n.kc(),n.kc(),n.kc(),n.kc()}if(2&e){const e=t.$implicit,c=t.index,a=n.xc(2);n.Ec("cdkDropListData",c)("cdkDropListDisabled",!n.zc(1,10,a.updatePermissions)),n.Tb(3),n.Xb("featured",a.isFeatured(e)),n.Tb(1),n.Ec("src",n.Ac(5,12,e,"tiny"),n.Uc),n.Tb(4),n.dd(" ",n.zc(9,15,"asset.preview")," "),n.Tb(2),n.Ec("disabled",a.isFeatured(e)||!n.zc(11,17,a.updatePermissions)),n.Tb(2),n.dd(" ",n.zc(13,19,"asset.set-as-featured-asset")," "),n.Tb(3),n.Ec("disabled",!n.zc(16,21,a.updatePermissions)),n.Tb(2),n.dd(" ",n.zc(18,23,"asset.remove-asset")," ")}}function Wc(e,t){if(1&e&&(n.lc(0,"div",21),n.Zc(1,Xc,19,25,"div",22),n.kc()),2&e){const e=n.xc();n.Xb("compact",e.compact),n.Tb(1),n.Ec("ngForOf",e.assets)}}function Qc(e,t){1&e&&(n.bd(0),n.yc(1,"translate")),2&e&&n.cd(n.zc(1,1,"catalog.update-product-option"))}function Kc(e,t){if(1&e&&(n.gc(0,"vdr-custom-field-control",12),n.yc(1,"hasPermission")),2&e){const e=n.xc().$implicit,t=n.xc(2);n.Ec("customFieldsFormGroup",t.customFieldsForm)("customField",e)("readonly",!n.zc(1,3,n.Hc(5,ht)))}}function Jc(e,t){if(1&e&&(n.jc(0),n.Zc(1,Kc,2,6,"vdr-custom-field-control",11),n.ic()),2&e){const e=t.$implicit,c=n.xc(2);n.Tb(1),n.Ec("ngIf",c.customFieldsForm.get(e.name))}}function Yc(e,t){if(1&e&&(n.lc(0,"section"),n.lc(1,"label"),n.bd(2),n.yc(3,"translate"),n.kc(),n.Zc(4,Jc,2,1,"ng-container",10),n.kc()),2&e){const e=n.xc();n.Tb(2),n.cd(n.zc(3,2,"common.custom-fields")),n.Tb(2),n.Ec("ngForOf",e.customFields)}}function en(e,t){if(1&e){const e=n.mc();n.lc(0,"button",13),n.vc("click",function(){n.Sc(e);return n.xc().cancel()}),n.bd(1),n.yc(2,"translate"),n.kc(),n.lc(3,"button",14),n.vc("click",function(){n.Sc(e);return n.xc().update()}),n.bd(4),n.yc(5,"translate"),n.kc()}if(2&e){const e=n.xc(),t=n.Oc(4),c=n.Oc(8);n.Tb(1),n.cd(n.zc(2,3,"common.cancel")),n.Tb(2),n.Ec("disabled",t.invalid||c.invalid||t.pristine&&c.pristine&&e.customFieldsForm.pristine),n.Tb(1),n.dd(" ",n.zc(5,5,"catalog.update-product-option")," ")}}function tn(e,t){1&e&&(n.lc(0,"clr-toggle-wrapper"),n.gc(1,"input",48),n.lc(2,"label"),n.bd(3),n.yc(4,"translate"),n.kc(),n.kc()),2&e&&(n.Tb(3),n.cd(n.zc(4,1,"common.enabled")))}function cn(e,t){if(1&e&&(n.lc(0,"option",51),n.bd(1),n.kc()),2&e){const e=t.$implicit;n.Ec("value",e.id),n.Tb(1),n.dd(" ",e.name," ")}}function nn(e,t){if(1&e&&(n.lc(0,"clr-select-container"),n.lc(1,"label"),n.bd(2),n.yc(3,"translate"),n.kc(),n.lc(4,"select",49),n.Zc(5,cn,2,2,"option",50),n.kc(),n.kc()),2&e){const e=n.xc(3);n.Tb(2),n.cd(n.zc(3,2,"catalog.tax-category")),n.Tb(3),n.Ec("ngForOf",e.taxCategories)}}function an(e,t){if(1&e&&(n.lc(0,"label",32),n.bd(1),n.yc(2,"translate"),n.kc(),n.lc(3,"div",52),n.bd(4),n.kc()),2&e){const e=n.xc().ngIf,t=n.xc(2);n.Tb(1),n.cd(n.zc(2,2,"catalog.tax-category")),n.Tb(3),n.dd(" ",t.getTaxCategoryName(e)," ")}}function on(e,t){if(1&e&&(n.gc(0,"vdr-currency-input",53),n.yc(1,"hasPermission")),2&e){const e=n.xc(2).$implicit,t=n.xc();n.Ec("currencyCode",e.currencyCode)("readonly",!n.zc(1,2,t.updatePermission))}}function rn(e,t){if(1&e&&(n.gc(0,"vdr-currency-input",54),n.yc(1,"hasPermission")),2&e){const e=n.xc(2).$implicit,t=n.xc();n.Ec("currencyCode",e.currencyCode)("readonly",!n.zc(1,2,t.updatePermission))}}function sn(e,t){if(1&e&&(n.lc(0,"clr-select-container"),n.lc(1,"label"),n.bd(2),n.yc(3,"translate"),n.gc(4,"vdr-help-tooltip",30),n.yc(5,"translate"),n.kc(),n.lc(6,"select",55),n.lc(7,"option",51),n.bd(8),n.yc(9,"translate"),n.kc(),n.lc(10,"option",51),n.bd(11),n.yc(12,"translate"),n.kc(),n.lc(13,"option",51),n.bd(14),n.yc(15,"translate"),n.kc(),n.kc(),n.kc()),2&e){const e=n.xc(3);n.Tb(2),n.dd("",n.zc(3,8,"catalog.track-inventory")," "),n.Tb(2),n.Ec("content",n.zc(5,10,"catalog.track-inventory-tooltip")),n.Tb(3),n.Ec("value",e.GlobalFlag.TRUE),n.Tb(1),n.dd(" ",n.zc(9,12,"catalog.track-inventory-true")," "),n.Tb(2),n.Ec("value",e.GlobalFlag.FALSE),n.Tb(1),n.dd(" ",n.zc(12,14,"catalog.track-inventory-false")," "),n.Tb(2),n.Ec("value",e.GlobalFlag.INHERIT),n.Tb(1),n.dd(" ",n.zc(15,16,"catalog.track-inventory-inherit")," ")}}function ln(e,t){if(1&e&&(n.gc(0,"vdr-custom-field-control",59),n.yc(1,"hasPermission")),2&e){const e=n.xc().$implicit,t=n.xc(2).ngIf,c=n.xc(2);n.Ec("compact",!0)("customFieldsFormGroup",t.get("customFields"))("readonly",!n.zc(1,4,c.updatePermission))("customField",e)}}const dn=function(e){return["customFields",e]};function un(e,t){if(1&e&&(n.jc(0),n.Zc(1,ln,2,6,"vdr-custom-field-control",58),n.ic()),2&e){const e=t.$implicit,c=n.xc(2).ngIf;n.Tb(1),n.Ec("ngIf",c.get(n.Ic(1,dn,e.name)))}}function pn(e,t){if(1&e&&(n.lc(0,"section",56),n.Zc(1,un,2,3,"ng-container",57),n.kc()),2&e){const e=n.xc(3);n.Tb(1),n.Ec("ngForOf",e.customFields)}}function gn(e,t){if(1&e){const e=n.mc();n.lc(0,"vdr-chip",62),n.vc("iconClick",function(){n.Sc(e);const c=t.$implicit;return n.xc(4).editOption(c)}),n.yc(1,"hasPermission"),n.lc(2,"span",63),n.bd(3),n.kc(),n.bd(4),n.kc()}if(2&e){const e=t.$implicit,c=n.xc(4);n.Ec("colorFrom",c.optionGroupName(e.groupId))("invert",!0)("icon",n.zc(1,5,c.updatePermission)&&"pencil"),n.Tb(3),n.cd(c.optionGroupName(e.groupId)),n.Tb(1),n.dd(" ",c.optionName(e)," ")}}function mn(e,t){if(1&e&&(n.lc(0,"div"),n.lc(1,"div",60),n.Zc(2,gn,5,7,"vdr-chip",61),n.yc(3,"sort"),n.kc(),n.kc()),2&e){const e=n.xc(2).$implicit;n.Tb(2),n.Ec("ngForOf",n.Ac(3,1,e.options,"groupId"))}}function bn(e,t){if(1&e){const e=n.mc();n.lc(0,"vdr-facet-value-chip",64),n.vc("remove",function(){n.Sc(e);const c=t.$implicit,a=n.xc(2).$implicit;return n.xc().removeFacetValue(a,c.id)}),n.yc(1,"hasPermission"),n.kc()}if(2&e){const e=t.$implicit,c=n.xc(3);n.Ec("facetValue",e)("removable",n.zc(1,2,c.updatePermission))}}function hn(e,t){if(1&e){const e=n.mc();n.lc(0,"vdr-facet-value-chip",64),n.vc("remove",function(){n.Sc(e);const c=t.$implicit,a=n.xc(2).$implicit;return n.xc().removeFacetValue(a,c.id)}),n.yc(1,"hasPermission"),n.kc()}if(2&e){const e=t.$implicit,c=n.xc(3);n.Ec("facetValue",e)("removable",n.zc(1,2,c.updatePermission))}}function fn(e,t){if(1&e){const e=n.mc();n.lc(0,"button",65),n.vc("click",function(){n.Sc(e);const t=n.xc(2).$implicit;return n.xc().selectFacetValueClick.emit([t.id])}),n.gc(1,"clr-icon",66),n.bd(2),n.yc(3,"translate"),n.kc()}2&e&&(n.Tb(2),n.dd(" ",n.zc(3,1,"catalog.add-facets")," "))}function vn(e,t){if(1&e){const e=n.mc();n.lc(0,"vdr-chip",72),n.vc("iconClick",function(){n.Sc(e);const t=n.xc().$implicit,c=n.xc(4).$implicit;return n.xc().removeFromChannel.emit({channelId:t.id,variant:c})}),n.yc(1,"translate"),n.gc(2,"vdr-channel-badge",73),n.bd(3),n.yc(4,"channelCodeToLabel"),n.kc()}if(2&e){const e=n.xc().$implicit;n.Ec("title",n.zc(1,3,"catalog.remove-from-channel")),n.Tb(2),n.Ec("channelCode",e.code),n.Tb(1),n.dd(" ",n.zc(4,5,e.code)," ")}}function yn(e,t){if(1&e&&(n.jc(0),n.Zc(1,vn,5,7,"vdr-chip",71),n.ic()),2&e){const e=t.$implicit,c=n.xc(5);n.Tb(1),n.Ec("ngIf",!c.isDefaultChannel(e.code))}}function Cn(e,t){if(1&e){const e=n.mc();n.lc(0,"div",16),n.lc(1,"div",68),n.Zc(2,yn,2,1,"ng-container",57),n.lc(3,"button",69),n.vc("click",function(){n.Sc(e);const t=n.xc(3).$implicit;return n.xc().assignToChannel.emit(t)}),n.gc(4,"clr-icon",70),n.bd(5),n.yc(6,"translate"),n.kc(),n.kc(),n.kc()}if(2&e){const e=n.xc(3).$implicit;n.Tb(2),n.Ec("ngForOf",e.channels),n.Tb(3),n.dd(" ",n.zc(6,2,"catalog.assign-to-channel")," ")}}function kn(e,t){1&e&&(n.jc(0),n.Zc(1,Cn,7,4,"div",67),n.ic())}function On(e,t){if(1&e){const e=n.mc();n.jc(0,7),n.lc(1,"div",8),n.lc(2,"div",9),n.lc(3,"vdr-title-input",10),n.yc(4,"hasPermission"),n.lc(5,"clr-input-container"),n.gc(6,"input",11),n.yc(7,"hasPermission"),n.yc(8,"translate"),n.kc(),n.kc(),n.lc(9,"vdr-title-input",12),n.yc(10,"hasPermission"),n.lc(11,"clr-input-container"),n.gc(12,"input",13),n.yc(13,"hasPermission"),n.yc(14,"translate"),n.kc(),n.kc(),n.kc(),n.lc(15,"div",14),n.Zc(16,tn,5,3,"clr-toggle-wrapper",15),n.kc(),n.kc(),n.lc(17,"div",16),n.lc(18,"div",17),n.lc(19,"div",18),n.lc(20,"vdr-product-assets",19),n.vc("change",function(t){n.Sc(e);const c=n.xc().$implicit;return n.xc().onAssetChange(c.id,t)}),n.kc(),n.kc(),n.lc(21,"div",20),n.lc(22,"div",21),n.lc(23,"div",22),n.lc(24,"div",23),n.Zc(25,nn,6,4,"clr-select-container",24),n.Zc(26,an,5,4,"ng-template",null,25,n.ad),n.kc(),n.lc(28,"div",26),n.lc(29,"clr-input-container"),n.lc(30,"label"),n.bd(31),n.yc(32,"translate"),n.kc(),n.Zc(33,on,2,4,"vdr-currency-input",27),n.Zc(34,rn,2,4,"vdr-currency-input",28),n.kc(),n.kc(),n.gc(35,"vdr-variant-price-detail",29),n.kc(),n.lc(36,"div",22),n.Zc(37,sn,16,18,"clr-select-container",15),n.lc(38,"clr-input-container"),n.lc(39,"label"),n.bd(40),n.yc(41,"translate"),n.gc(42,"vdr-help-tooltip",30),n.yc(43,"translate"),n.kc(),n.gc(44,"input",31),n.yc(45,"hasPermission"),n.kc(),n.lc(46,"div"),n.lc(47,"label",32),n.bd(48),n.yc(49,"translate"),n.gc(50,"vdr-help-tooltip",30),n.yc(51,"translate"),n.kc(),n.lc(52,"div",33),n.bd(53),n.kc(),n.kc(),n.lc(54,"div"),n.lc(55,"label",32),n.bd(56),n.yc(57,"translate"),n.gc(58,"vdr-help-tooltip",30),n.yc(59,"translate"),n.kc(),n.lc(60,"div",33),n.bd(61),n.kc(),n.kc(),n.kc(),n.lc(62,"div",22),n.lc(63,"div",34),n.lc(64,"label",32),n.bd(65),n.yc(66,"translate"),n.gc(67,"vdr-help-tooltip",30),n.yc(68,"translate"),n.kc(),n.lc(69,"div",35),n.lc(70,"clr-input-container"),n.gc(71,"input",36),n.yc(72,"hasPermission"),n.kc(),n.lc(73,"clr-toggle-wrapper"),n.gc(74,"input",37),n.yc(75,"hasPermission"),n.lc(76,"label"),n.bd(77),n.yc(78,"translate"),n.kc(),n.kc(),n.kc(),n.kc(),n.kc(),n.kc(),n.lc(79,"div",38),n.lc(80,"div",22),n.Zc(81,pn,2,1,"section",39),n.kc(),n.kc(),n.kc(),n.kc(),n.kc(),n.lc(82,"div",16),n.lc(83,"div",40),n.gc(84,"vdr-entity-info",41),n.Zc(85,mn,4,4,"div",42),n.gc(86,"div",43),n.lc(87,"div",44),n.Zc(88,bn,2,4,"vdr-facet-value-chip",45),n.Zc(89,hn,2,4,"vdr-facet-value-chip",45),n.Zc(90,fn,4,3,"button",46),n.kc(),n.kc(),n.kc(),n.Zc(91,kn,2,0,"ng-container",47),n.ic()}if(2&e){const e=t.ngIf,c=n.Oc(27),a=n.xc().$implicit,i=n.xc();let o=null;n.Ec("formGroup",e),n.Tb(3),n.Ec("readonly",!n.zc(4,53,i.updatePermission)),n.Tb(3),n.Ec("readonly",!n.zc(7,55,i.updatePermission))("placeholder",n.zc(8,57,"catalog.sku")),n.Tb(3),n.Ec("readonly",!n.zc(10,59,i.updatePermission)),n.Tb(3),n.Ec("readonly",!n.zc(13,61,i.updatePermission))("placeholder",n.zc(14,63,"common.name")),n.Tb(4),n.Ec("vdrIfPermissions",i.updatePermission),n.Tb(4),n.Ec("compact",!0)("assets",(null==i.pendingAssetChanges[a.id]?null:i.pendingAssetChanges[a.id].assets)||a.assets)("featuredAsset",(null==i.pendingAssetChanges[a.id]?null:i.pendingAssetChanges[a.id].featuredAsset)||a.featuredAsset),n.Tb(5),n.Ec("vdrIfPermissions",i.updatePermission)("vdrIfPermissionsElse",c),n.Tb(6),n.cd(n.zc(32,65,"catalog.price")),n.Tb(2),n.Ec("ngIf",!i.channelPriceIncludesTax),n.Tb(1),n.Ec("ngIf",i.channelPriceIncludesTax),n.Tb(1),n.Ec("price",e.get("price").value)("currencyCode",a.currencyCode)("priceIncludesTax",i.channelPriceIncludesTax)("taxCategoryId",e.get("taxCategoryId").value),n.Tb(2),n.Ec("vdrIfPermissions",i.updatePermission),n.Tb(3),n.dd("",n.zc(41,67,"catalog.stock-on-hand")," "),n.Tb(2),n.Ec("content",n.zc(43,69,"catalog.stock-on-hand-tooltip")),n.Tb(2),n.Xb("inventory-untracked",i.inventoryIsNotTracked(e)),n.Ec("readonly",!n.zc(45,71,i.updatePermission))("vdrDisabled",i.inventoryIsNotTracked(e)),n.Tb(2),n.Xb("inventory-untracked",i.inventoryIsNotTracked(e)),n.Tb(2),n.dd("",n.zc(49,73,"catalog.stock-allocated")," "),n.Tb(2),n.Ec("content",n.zc(51,75,"catalog.stock-allocated-tooltip")),n.Tb(3),n.dd(" ",a.stockAllocated," "),n.Tb(1),n.Xb("inventory-untracked",i.inventoryIsNotTracked(e)),n.Tb(2),n.dd("",n.zc(57,77,"catalog.stock-saleable")," "),n.Tb(2),n.Ec("content",n.zc(59,79,"catalog.stock-saleable-tooltip")),n.Tb(3),n.dd(" ",i.getSaleableStockLevel(a)," "),n.Tb(2),n.Xb("inventory-untracked",i.inventoryIsNotTracked(e)),n.Tb(2),n.cd(n.zc(66,81,"catalog.out-of-stock-threshold")),n.Tb(2),n.Ec("content",n.zc(68,83,"catalog.out-of-stock-threshold-tooltip")),n.Tb(4),n.Ec("formControl",e.get("outOfStockThreshold"))("readonly",!n.zc(72,85,i.updatePermission))("vdrDisabled",!1!==(null==(o=e.get("useGlobalOutOfStockThreshold"))?null:o.value)||i.inventoryIsNotTracked(e)),n.Tb(3),n.Ec("vdrDisabled",!n.zc(75,87,i.updatePermission)||i.inventoryIsNotTracked(e)),n.Tb(3),n.ed("",n.zc(78,89,"catalog.use-global-value")," (",i.globalOutOfStockThreshold,")"),n.Tb(4),n.Ec("ngIf",i.customFields.length),n.Tb(3),n.Ec("entity",a),n.Tb(1),n.Ec("ngIf",a.options.length),n.Tb(3),n.Ec("ngForOf",i.existingFacetValues(a)),n.Tb(1),n.Ec("ngForOf",i.pendingFacetValues(a)),n.Tb(1),n.Ec("vdrIfPermissions",i.updatePermission)}}function Pn(e,t){if(1&e&&(n.lc(0,"div",5),n.Zc(1,On,92,91,"ng-container",6),n.kc()),2&e){const e=t.$implicit,c=n.xc();let a=null,i=null;n.Xb("disabled",!(null!=(a=c.formGroupMap.get(e.id))&&(null!=(i=a.get("enabled"))&&i.value))),n.Tb(1),n.Ec("ngIf",c.formGroupMap.get(e.id))}}function xn(e,t){if(1&e&&(n.jc(0),n.lc(1,"vdr-dt-column"),n.bd(2),n.kc(),n.ic()),2&e){const e=t.$implicit;n.Tb(2),n.cd(e.name)}}function Tn(e,t){if(1&e&&(n.gc(0,"img",17),n.yc(1,"assetPreview")),2&e){const e=t.ngIf;n.Ec("src",n.Ac(1,1,e,"tiny"),n.Uc)}}function In(e,t){1&e&&(n.lc(0,"div",18),n.gc(1,"clr-icon",19),n.kc())}function Fn(e,t){if(1&e&&(n.jc(0),n.lc(1,"td",4),n.yc(2,"stringToColor"),n.bd(3),n.kc(),n.ic()),2&e){const e=t.$implicit,c=n.xc().ngIf,a=n.xc(2);n.Tb(1),n.Wc("color",n.zc(2,5,a.optionGroupName(e.groupId))),n.Xb("disabled",!c.get("enabled").value),n.Tb(2),n.dd(" ",e.name," ")}}function En(e,t){if(1&e&&(n.gc(0,"vdr-currency-input",20),n.yc(1,"hasPermission")),2&e){const e=n.xc(2).item,t=n.xc();n.Ec("currencyCode",e.currencyCode)("readonly",!n.zc(1,2,t.updatePermission))}}function Sn(e,t){if(1&e&&(n.gc(0,"vdr-currency-input",21),n.yc(1,"hasPermission")),2&e){const e=n.xc(2).item,t=n.xc();n.Ec("currencyCode",e.currencyCode)("readonly",!n.zc(1,2,t.updatePermission))}}function jn(e,t){if(1&e&&(n.jc(0,3),n.lc(1,"td",4),n.lc(2,"div",5),n.lc(3,"div",6),n.Zc(4,Tn,2,4,"img",7),n.Zc(5,In,2,0,"ng-template",null,8,n.ad),n.kc(),n.kc(),n.kc(),n.lc(7,"td",4),n.lc(8,"clr-input-container"),n.gc(9,"input",9),n.yc(10,"hasPermission"),n.yc(11,"translate"),n.kc(),n.kc(),n.lc(12,"td",4),n.lc(13,"clr-input-container"),n.gc(14,"input",10),n.yc(15,"hasPermission"),n.yc(16,"translate"),n.kc(),n.kc(),n.Zc(17,Fn,4,7,"ng-container",1),n.yc(18,"sort"),n.lc(19,"td",11),n.lc(20,"clr-input-container"),n.Zc(21,En,2,4,"vdr-currency-input",12),n.Zc(22,Sn,2,4,"vdr-currency-input",13),n.kc(),n.kc(),n.lc(23,"td",14),n.lc(24,"clr-input-container"),n.gc(25,"input",15),n.yc(26,"hasPermission"),n.kc(),n.kc(),n.lc(27,"td",14),n.lc(28,"clr-toggle-wrapper"),n.gc(29,"input",16),n.yc(30,"hasPermission"),n.kc(),n.kc(),n.ic()),2&e){const e=t.ngIf,c=n.Oc(6),a=n.xc().item,i=n.xc();n.Ec("formGroup",e),n.Tb(1),n.Xb("disabled",!e.get("enabled").value),n.Tb(3),n.Ec("ngIf",i.getFeaturedAsset(a))("ngIfElse",c),n.Tb(3),n.Xb("disabled",!e.get("enabled").value),n.Tb(2),n.Ec("readonly",!n.zc(10,24,i.updatePermission))("placeholder",n.zc(11,26,"common.name")),n.Tb(3),n.Xb("disabled",!e.get("enabled").value),n.Tb(2),n.Ec("readonly",!n.zc(15,28,i.updatePermission))("placeholder",n.zc(16,30,"catalog.sku")),n.Tb(3),n.Ec("ngForOf",n.Ac(18,32,a.options,"groupId")),n.Tb(2),n.Xb("disabled",!e.get("enabled").value),n.Tb(2),n.Ec("ngIf",!i.channelPriceIncludesTax),n.Tb(1),n.Ec("ngIf",i.channelPriceIncludesTax),n.Tb(1),n.Xb("disabled",!e.get("enabled").value),n.Tb(2),n.Ec("readonly",!n.zc(26,35,i.updatePermission)),n.Tb(2),n.Xb("disabled",!e.get("enabled").value),n.Tb(2),n.Ec("vdrDisabled",!n.zc(30,37,i.updatePermission))}}function Mn(e,t){if(1&e&&n.Zc(0,jn,31,39,"ng-container",2),2&e){const e=t.item,c=n.xc();n.Ec("ngIf",c.formGroupMap.get(e.id))}}const Vn=function(e){return{rate:e}};function wn(e,t){if(1&e&&(n.lc(0,"div",2),n.bd(1),n.yc(2,"translate"),n.yc(3,"async"),n.kc()),2&e){const e=n.xc();n.Tb(1),n.dd(" ",n.Ac(2,1,"catalog.price-includes-tax-at",n.Ic(6,Vn,n.zc(3,4,e.taxRate$))),"\n")}}const zn=function(e,t){return{price:e,rate:t}};function An(e,t){if(1&e&&(n.lc(0,"div",2),n.bd(1),n.yc(2,"translate"),n.yc(3,"localeCurrency"),n.yc(4,"async"),n.yc(5,"async"),n.kc()),2&e){const e=n.xc();n.Tb(1),n.dd(" ",n.Ac(2,1,"catalog.price-with-tax-in-default-zone",n.Jc(11,zn,n.Ac(3,4,n.zc(4,7,e.grossPrice$),e.currencyCode),n.zc(5,9,e.taxRate$))),"\n")}}class Dn extends i.w{constructor(e,t,c,n,a,i){super(t,e,c,a),this.notificationService=n,this.dataService=a,this.formBuilder=i,this.detailForm=new O.i({}),this.customFields=this.getCustomFieldConfig("Asset")}ngOnInit(){this.detailForm=new O.i({name:new O.f(""),tags:new O.f([]),customFields:this.formBuilder.group(this.customFields.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.name]:""}),{}))}),this.init()}ngOnDestroy(){this.destroy()}onAssetChange(e){var t,c;null===(t=this.detailForm.get("name"))||void 0===t||t.setValue(e.name),null===(c=this.detailForm.get("tags"))||void 0===c||c.setValue(e.tags),this.detailForm.markAsDirty()}save(){this.dataService.product.updateAsset({id:this.id,name:this.detailForm.value.name,tags:this.detailForm.value.tags,customFields:this.detailForm.value.customFields}).subscribe(()=>{this.notificationService.success(Object(o.a)("common.notify-update-success"),{entity:"Asset"})},e=>{this.notificationService.error(Object(o.a)("common.notify-update-error"),{entity:"Asset"})})}setFormValues(e,t){var c,n;if(null===(c=this.detailForm.get("name"))||void 0===c||c.setValue(e.name),null===(n=this.detailForm.get("tags"))||void 0===n||n.setValue(e.tags),this.customFields.length){const t=this.detailForm.get("customFields");for(const c of this.customFields){const n=c.name,a=e.customFields[n],i=t.get(n);i&&i.patchValue(a)}}}}Dn.\u0275fac=function(e){return new(e||Dn)(n.fc(a.e),n.fc(a.a),n.fc(i.Mb),n.fc(i.Eb),n.fc(i.L),n.fc(O.e))},Dn.\u0275cmp=n.Zb({type:Dn,selectors:[["vdr-asset-detail"]],features:[n.Qb],decls:9,vars:11,consts:[[3,"entity"],["locationId","asset-detail"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[3,"asset","editable","customFields","customFieldsForm","assetChange"],[1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(n.lc(0,"vdr-action-bar"),n.lc(1,"vdr-ab-left"),n.gc(2,"vdr-entity-info",0),n.yc(3,"async"),n.kc(),n.lc(4,"vdr-ab-right"),n.gc(5,"vdr-action-bar-items",1),n.Zc(6,H,3,4,"button",2),n.kc(),n.kc(),n.lc(7,"vdr-asset-preview",3),n.vc("assetChange",function(e){return t.onAssetChange(e)}),n.yc(8,"async"),n.kc()),2&e&&(n.Tb(2),n.Ec("entity",n.zc(3,6,t.entity$)),n.Tb(4),n.Ec("vdrIfPermissions",n.Hc(10,q)),n.Tb(1),n.Ec("asset",n.zc(8,8,t.entity$))("editable",!0)("customFields",t.customFields)("customFieldsForm",t.detailForm.get("customFields")))},directives:[i.c,i.e,i.ab,i.f,i.d,i.qb,i.p],pipes:[z.b,G.d],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}"],changeDetection:0}),Dn.ctorParameters=()=>[{type:a.e},{type:a.a},{type:i.Mb},{type:i.Eb},{type:i.L},{type:O.e}];class $n extends i.y{constructor(e,t,c,n,a){super(n,a),this.notificationService=e,this.modalService=t,this.dataService=c,this.searchTerm$=new P.a(void 0),this.filterByTags$=new P.a(void 0),this.uploading=!1,super.setQueryFn((...e)=>this.dataService.product.getAssetList(...e),e=>e.assets,(e,t)=>{var c;const n=this.searchTerm$.value,a=null===(c=this.filterByTags$.value)||void 0===c?void 0:c.map(e=>e.value);return{options:Object.assign(Object.assign({skip:e,take:t},n?{filter:{name:{contains:n}}}:{}),{sort:{createdAt:i.Pb.DESC},tags:a,tagsOperator:i.Cb.AND})}},{take:25,skip:0})}ngOnInit(){super.ngOnInit(),this.paginationConfig$=Object(x.a)(this.itemsPerPage$,this.currentPage$,this.totalItems$).pipe(Object(r.a)(([e,t,c])=>({itemsPerPage:e,currentPage:t,totalItems:c}))),this.searchTerm$.pipe(Object(s.a)(250),Object(l.a)(this.destroy$)).subscribe(()=>this.refresh()),this.filterByTags$.pipe(Object(l.a)(this.destroy$)).subscribe(()=>this.refresh()),this.allTags$=this.dataService.product.getTagList().mapStream(e=>e.tags.items)}filesSelected(e){e.length&&(this.uploading=!0,this.dataService.product.createAssets(e).pipe(Object(d.a)(()=>this.uploading=!1)).subscribe(({createAssets:e})=>{let t=0;for(const c of e)switch(c.__typename){case"Asset":t++;break;case"MimeTypeError":this.notificationService.error(c.message)}0<t&&(super.refresh(),this.notificationService.success(Object(o.a)("asset.notify-create-assets-success"),{count:t}))}))}deleteAssets(e){this.showModalAndDelete(e.map(e=>e.id)).pipe(Object(u.a)(t=>t.result===i.P.DELETED?[!0]:this.showModalAndDelete(e.map(e=>e.id),t.message||"").pipe(Object(r.a)(e=>e.result===i.P.DELETED)))).subscribe(()=>{this.notificationService.success(Object(o.a)("common.notify-delete-success"),{entity:"Assets"}),this.refresh()},e=>{this.notificationService.error(Object(o.a)("common.notify-delete-error"),{entity:"Assets"})})}showModalAndDelete(e,t){return this.modalService.dialog({title:Object(o.a)("catalog.confirm-delete-assets"),translationVars:{count:e.length},body:t,buttons:[{type:"secondary",label:Object(o.a)("common.cancel")},{type:"danger",label:Object(o.a)("common.delete"),returnValue:!0}]}).pipe(Object(u.a)(c=>c?this.dataService.product.deleteAssets(e,!!t):T.a),Object(r.a)(e=>e.deleteAssets))}}$n.\u0275fac=function(e){return new(e||$n)(n.fc(i.Eb),n.fc(i.Db),n.fc(i.L),n.fc(a.e),n.fc(a.a))},$n.\u0275cmp=n.Zb({type:$n,selectors:[["vdr-asset-list"]],features:[n.Qb],decls:19,vars:31,consts:[[3,"grow"],[1,"pr4","mt1",3,"tags","searchTermChange","tagsChange"],["locationId","asset-list"],["dropZoneTarget",".content-area",3,"uploading","selectFiles"],[3,"assets","multiSelect","canDelete","deleteAssets"],[1,"paging-controls"],[3,"itemsPerPage","itemsPerPageChange"],[3,"currentPage","itemsPerPage","totalItems","pageChange"]],template:function(e,t){1&e&&(n.lc(0,"vdr-action-bar"),n.lc(1,"vdr-ab-left",0),n.lc(2,"vdr-asset-search-input",1),n.vc("searchTermChange",function(e){return t.searchTerm$.next(e)})("tagsChange",function(e){return t.filterByTags$.next(e)}),n.yc(3,"async"),n.kc(),n.kc(),n.lc(4,"vdr-ab-right"),n.gc(5,"vdr-action-bar-items",2),n.lc(6,"vdr-asset-file-input",3),n.vc("selectFiles",function(e){return t.filesSelected(e)}),n.kc(),n.kc(),n.kc(),n.lc(7,"vdr-asset-gallery",4),n.vc("deleteAssets",function(e){return t.deleteAssets(e)}),n.yc(8,"paginate"),n.yc(9,"async"),n.yc(10,"async"),n.yc(11,"hasPermission"),n.kc(),n.lc(12,"div",5),n.lc(13,"vdr-items-per-page-controls",6),n.vc("itemsPerPageChange",function(e){return t.setItemsPerPage(e)}),n.yc(14,"async"),n.kc(),n.lc(15,"vdr-pagination-controls",7),n.vc("pageChange",function(e){return t.setPageNumber(e)}),n.yc(16,"async"),n.yc(17,"async"),n.yc(18,"async"),n.kc(),n.kc()),2&e&&(n.Tb(1),n.Ec("grow",!0),n.Tb(1),n.Ec("tags",n.zc(3,10,t.allTags$)),n.Tb(4),n.Ec("uploading",t.uploading),n.Tb(1),n.Ec("assets",n.Ac(8,12,n.zc(9,15,t.items$),n.zc(10,17,t.paginationConfig$)||n.Hc(29,R)))("multiSelect",!0)("canDelete",n.zc(11,19,n.Hc(30,X))),n.Tb(6),n.Ec("itemsPerPage",n.zc(14,21,t.itemsPerPage$)),n.Tb(2),n.Ec("currentPage",n.zc(16,23,t.currentPage$))("itemsPerPage",n.zc(17,25,t.itemsPerPage$))("totalItems",n.zc(18,27,t.totalItems$)))},directives:[i.c,i.e,i.s,i.f,i.d,i.m,i.n,i.rb,i.Hb],pipes:[z.b,U.b,i.ib],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}vdr-asset-gallery[_ngcontent-%COMP%]{flex:1}.paging-controls[_ngcontent-%COMP%]{padding-top:6px;border-top:1px solid var(--color-component-border-100);display:flex;justify-content:space-between}.search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}"]}),$n.ctorParameters=()=>[{type:i.Eb},{type:i.Db},{type:i.L},{type:a.e},{type:a.a}];class _n{constructor(e,t,c){this.route=e,this.router=t,this.dataService=c,this.filterTermControl=new O.f(""),this.collectionIdChange$=new P.a(""),this.refresh$=new P.a(!0),this.destroy$=new I.a}ngOnInit(){this.contentsCurrentPage$=this.route.paramMap.pipe(Object(r.a)(e=>e.get("contentsPage")),Object(r.a)(e=>e?+e:1),Object(p.a)(1),Object(g.a)()),this.contentsItemsPerPage$=this.route.paramMap.pipe(Object(r.a)(e=>e.get("contentsPerPage")),Object(r.a)(e=>e?+e:10),Object(p.a)(10),Object(g.a)());const e=this.filterTermControl.valueChanges.pipe(Object(s.a)(250),Object(m.a)(()=>this.setContentsPageNumber(1)),Object(p.a)("")),t=Object(x.a)(this.collectionIdChange$,this.contentsCurrentPage$,this.contentsItemsPerPage$,e,this.refresh$).pipe(Object(l.a)(this.destroy$),Object(u.a)(([e,t,c,n])=>{const a=c,i=(t-1)*c;return e?this.dataService.collection.getCollectionContents(e,a,i,n).mapSingle(e=>e.collection):Object(F.a)(null)}));this.contents$=t.pipe(Object(r.a)(e=>e?e.productVariants.items:[])),this.contentsTotalItems$=t.pipe(Object(r.a)(e=>e?e.productVariants.totalItems:0))}ngOnChanges(e){"collectionId"in e&&this.collectionIdChange$.next(e.collectionId.currentValue)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}setContentsPageNumber(e){this.setParam("contentsPage",e)}setContentsItemsPerPage(e){this.setParam("contentsPerPage",e)}refresh(){this.refresh$.next(!0)}setParam(e,t){this.router.navigate(["./",Object.assign(Object.assign({},this.route.snapshot.params),{[e]:t})],{relativeTo:this.route,queryParamsHandling:"merge"})}}_n.\u0275fac=function(e){return new(e||_n)(n.fc(a.a),n.fc(a.e),n.fc(i.L))},_n.\u0275cmp=n.Zb({type:_n,selectors:[["vdr-collection-contents"]],contentQueries:function(e,t,c){if(1&e&&n.Yb(c,n.bb,3),2&e){let e;n.Nc(e=n.wc())&&(t.headerTemplate=e.first)}},inputs:{collectionId:"collectionId"},features:[n.Rb],decls:12,vars:22,consts:[[1,"contents-header"],[1,"header-title-row"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["type","text",3,"placeholder","formControl"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"left","align-middle"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"]],template:function(e,t){1&e&&(n.lc(0,"div",0),n.lc(1,"div",1),n.Zc(2,W,1,0,"ng-container",2),n.yc(3,"async"),n.kc(),n.gc(4,"input",3),n.yc(5,"translate"),n.kc(),n.lc(6,"vdr-data-table",4),n.vc("pageChange",function(e){return t.setContentsPageNumber(e)})("itemsPerPageChange",function(e){return t.setContentsItemsPerPage(e)}),n.yc(7,"async"),n.yc(8,"async"),n.yc(9,"async"),n.yc(10,"async"),n.Zc(11,J,5,9,"ng-template"),n.kc()),2&e&&(n.Tb(2),n.Ec("ngTemplateOutlet",t.headerTemplate)("ngTemplateOutletContext",n.Ic(20,Y,n.zc(3,8,t.contentsTotalItems$))),n.Tb(2),n.Ec("placeholder",n.zc(5,10,"catalog.filter-by-name"))("formControl",t.filterTermControl),n.Tb(2),n.Ec("items",n.zc(7,12,t.contents$))("itemsPerPage",n.zc(8,14,t.contentsItemsPerPage$))("totalItems",n.zc(9,16,t.contentsTotalItems$))("currentPage",n.zc(10,18,t.contentsCurrentPage$)))},directives:[z.t,i.eb,O.b,O.p,O.g,i.N,i.Tb],pipes:[z.b,G.d],styles:[".contents-header[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);position:sticky;top:0;padding:6px;z-index:1;border-bottom:1px solid var(--color-component-border-200)}.contents-header[_ngcontent-%COMP%]   .header-title-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.contents-header[_ngcontent-%COMP%]   .clr-input[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]     table{margin-top:-1px}"],changeDetection:0}),_n.ctorParameters=()=>[{type:a.a},{type:a.e},{type:i.L}],_n.propDecorators={collectionId:[{type:n.E}],headerTemplate:[{type:n.o,args:[n.bb,{static:!0}]}]};class Ln extends i.w{constructor(e,t,c,n,a,o,r,s){super(t,e,c,a),this.changeDetector=n,this.dataService=a,this.formBuilder=o,this.notificationService=r,this.modalService=s,this.assetChanges={},this.filters=[],this.allFilters=[],this.updatePermission=[i.Ib.UpdateCatalog,i.Ib.UpdateCollection],this.customFields=this.getCustomFieldConfig("Collection"),this.detailForm=this.formBuilder.group({name:["",O.C.required],slug:"",description:"",visible:!1,filters:this.formBuilder.array([]),customFields:this.formBuilder.group(this.customFields.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.name]:""}),{}))})}ngOnInit(){this.init(),this.dataService.collection.getCollectionFilters().single$.subscribe(e=>{this.allFilters=e.collectionFilters})}ngOnDestroy(){this.destroy()}getFilterDefinition(e){return this.allFilters.find(t=>t.code===e.code)}customFieldIsSet(e){return!!this.detailForm.get(["customFields",e])}assetsChanged(){return!!Object.values(this.assetChanges).length}updateSlug(e){Object(x.a)(this.entity$,this.languageCode$).pipe(Object(b.a)(1)).subscribe(([t,c])=>{const n=this.detailForm.get(["slug"]),a=Object(i.ec)(t,c),o=!a||!a.slug;n&&n.pristine&&o&&n.setValue(Object(V.normalizeString)(`${e}`,"-"))})}addFilter(e){const t=this.detailForm.get("filters");if(-1===t.value.findIndex(t=>t.code===e.code)){const c=e.args.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.name]:Object(i.hc)(t.value)}),{});t.push(this.formBuilder.control({code:e.code,args:c})),this.filters.push({code:e.code,args:e.args.map(e=>({name:e.name,value:Object(i.hc)(e.value)}))})}}removeFilter(e){const t=this.detailForm.get("filters"),c=t.value.findIndex(t=>t.code===e.code);-1!==c&&(t.removeAt(c),this.filters.splice(c,1))}create(){this.detailForm.dirty&&Object(x.a)(this.entity$,this.languageCode$).pipe(Object(b.a)(1),Object(h.a)(([e,t])=>{const c=this.getUpdatedCollection(e,this.detailForm,t),n=this.route.snapshot.paramMap.get("parentId");return n&&(c.parentId=n),this.dataService.collection.createCollection(c)})).subscribe(e=>{this.notificationService.success(Object(o.a)("common.notify-create-success"),{entity:"Collection"}),this.assetChanges={},this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.router.navigate(["../",e.createCollection.id],{relativeTo:this.route})},e=>{this.notificationService.error(Object(o.a)("common.notify-create-error"),{entity:"Collection"})})}save(){Object(x.a)(this.entity$,this.languageCode$).pipe(Object(b.a)(1),Object(h.a)(([e,t])=>{const c=this.getUpdatedCollection(e,this.detailForm,t);return this.dataService.collection.updateCollection(c)})).subscribe(()=>{this.assetChanges={},this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success(Object(o.a)("common.notify-update-success"),{entity:"Collection"}),this.contentsComponent.refresh()},e=>{this.notificationService.error(Object(o.a)("common.notify-update-error"),{entity:"Collection"})})}canDeactivate(){return super.canDeactivate()&&!this.assetChanges.assets&&!this.assetChanges.featuredAsset}setFormValues(e,t){const c=Object(i.ec)(e,t);if(this.detailForm.patchValue({name:c?c.name:"",slug:c?c.slug:"",description:c?c.description:"",visible:!e.isPrivate}),e.filters.forEach(e=>this.addFilter(e)),this.customFields.length){const t=this.detailForm.get(["customFields"]);for(const n of this.customFields){const a=n.name,i="localeString"===n.type?c.customFields[a]:e.customFields[a],o=t.get(a);o&&o.patchValue(i)}}}getUpdatedCollection(e,t,c){var n,a;const o=Object(i.bc)({translatable:e,updatedFields:t.value,customFieldConfig:this.customFields,languageCode:c,defaultTranslation:{languageCode:c,name:e.name||"",slug:e.slug||"",description:e.description||""}});return Object.assign(Object.assign({},o),{assetIds:null===(n=this.assetChanges.assets)||void 0===n?void 0:n.map(e=>e.id),featuredAssetId:null===(a=this.assetChanges.featuredAsset)||void 0===a?void 0:a.id,isPrivate:!t.value.visible,filters:this.mapOperationsToInputs(this.filters,this.detailForm.value.filters)})}mapOperationsToInputs(e,t){return e.map((e,c)=>({code:e.code,arguments:Object.values(t[c].args).map((t,c)=>({name:e.args[c].name,value:Object(i.dc)(t)}))}))}}Ln.\u0275fac=function(e){return new(e||Ln)(n.fc(a.e),n.fc(a.a),n.fc(i.Mb),n.fc(n.k),n.fc(i.L),n.fc(O.e),n.fc(i.Eb),n.fc(i.Db))},Ln.\u0275cmp=n.Zb({type:Ln,selectors:[["vdr-collection-detail"]],viewQuery:function(e,t){if(1&e&&n.gd(ee,1),2&e){let e;n.Nc(e=n.wc())&&(t.contentsComponent=e.first)}},features:[n.Qb],decls:16,vars:19,consts:[[3,"entity"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","collection-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],[1,"clr-row"],[1,"clr-col"],["for","visibility",3,"label"],["type","checkbox","clrToggle","","formControlName","visible","id","visibility",3,"vdrDisabled"],[1,"visible-toggle"],[4,"ngIf","ngIfElse"],["private",""],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","slug",3,"label","errors"],["id","slug","type","text","formControlName","slug","pattern","[a-z0-9_-]+",3,"readonly"],["formControlName","description",3,"readonly","label"],["formGroupName","customFields",4,"ngIf"],[1,"clr-col-md-auto"],[3,"assets","featuredAsset","change"],["formArrayName","filters",1,"clr-row"],[4,"ngFor","ngForOf"],[4,"vdrIfPermissions"],[3,"collectionId"],["collectionContents",""],["formGroupName","customFields"],["entityName","Collection",3,"customFieldsFormGroup","customField",4,"ngIf"],["entityName","Collection",3,"customFieldsFormGroup","customField"],[3,"operation","operationDefinition","formControlName","readonly","remove"],["vdrDropdownTrigger","",1,"btn","btn-outline"],["shape","plus"],["vdrPosition","bottom-left"],["type","button","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["type","button","vdrDropdownItem","",3,"click"],[1,"contents-title"]],template:function(e,t){if(1&e&&(n.lc(0,"vdr-action-bar"),n.lc(1,"vdr-ab-left"),n.gc(2,"vdr-entity-info",0),n.yc(3,"async"),n.lc(4,"vdr-language-selector",1),n.vc("languageCodeChange",function(e){return t.setLanguage(e)}),n.yc(5,"async"),n.yc(6,"async"),n.yc(7,"async"),n.kc(),n.kc(),n.lc(8,"vdr-ab-right"),n.gc(9,"vdr-action-bar-items",2),n.Zc(10,te,3,4,"button",3),n.yc(11,"async"),n.Zc(12,ne,1,1,"ng-template",null,4,n.ad),n.kc(),n.kc(),n.Zc(14,he,38,41,"form",5),n.yc(15,"async")),2&e){const e=n.Oc(13);n.Tb(2),n.Ec("entity",n.zc(3,7,t.entity$)),n.Tb(2),n.Ec("disabled",n.zc(5,9,t.isNew$))("availableLanguageCodes",n.zc(6,11,t.availableLanguages$))("currentLanguageCode",n.zc(7,13,t.languageCode$)),n.Tb(6),n.Ec("ngIf",n.zc(11,15,t.isNew$))("ngIfElse",e),n.Tb(4),n.Ec("ngIf",n.zc(15,17,t.entity$))}},directives:function(){return[i.c,i.e,i.ab,i.wb,i.f,i.d,z.o,i.qb,O.E,O.q,O.j,i.db,B.k,i.eb,O.a,B.i,O.p,O.h,i.S,B.u,O.b,O.w,i.Kb,Ia,O.d,z.n,_n,O.k,i.I,i.E,i.T,i.W,B.o,i.V,i.U]},pipes:function(){return[z.b,G.d,i.ib]},styles:[Ze],changeDetection:0}),Ln.ctorParameters=()=>[{type:a.e},{type:a.a},{type:i.Mb},{type:n.k},{type:i.L},{type:O.e},{type:i.Eb},{type:i.Db}],Ln.propDecorators={contentsComponent:[{type:n.fb,args:["collectionContents"]}]};class Zn{constructor(e,t,c,n,a,i){this.dataService=e,this.notificationService=t,this.modalService=c,this.router=n,this.route=a,this.serverConfigService=i,this.expandAll=!1}ngOnInit(){this.queryResult=this.dataService.collection.getCollections(1e3,0).refetchOnChannelChange(),this.items$=this.queryResult.mapStream(e=>e.collections.items).pipe(Object(f.a)(1)),this.activeCollectionId$=this.route.paramMap.pipe(Object(r.a)(e=>e.get("contents")),Object(g.a)()),this.activeCollectionTitle$=Object(x.a)(this.activeCollectionId$,this.items$).pipe(Object(r.a)(([e,t])=>{if(e){const c=t.find(t=>t.id===e);return c?c.name:""}return""})),this.availableLanguages$=this.serverConfigService.getAvailableLanguages(),this.contentLanguage$=this.dataService.client.uiState().mapStream(({uiState:e})=>e.contentLanguage).pipe(Object(m.a)(()=>this.refresh()))}ngOnDestroy(){this.queryResult.completed$.next()}onRearrange(e){this.dataService.collection.moveCollection([e]).subscribe({next:()=>{this.notificationService.success(Object(o.a)("common.notify-saved-changes")),this.refresh()},error:e=>{this.notificationService.error(Object(o.a)("common.notify-save-changes-error"))}})}deleteCollection(e){this.items$.pipe(Object(b.a)(1),Object(r.a)(t=>-1<t.findIndex(t=>t.parent&&t.parent.id===e)),Object(u.a)(e=>this.modalService.dialog({title:Object(o.a)("catalog.confirm-delete-collection"),body:e?Object(o.a)("catalog.confirm-delete-collection-and-children-body"):void 0,buttons:[{type:"secondary",label:Object(o.a)("common.cancel")},{type:"danger",label:Object(o.a)("common.delete"),returnValue:!0}]})),Object(u.a)(t=>t?this.dataService.collection.deleteCollection(e):T.a)).subscribe(()=>{this.notificationService.success(Object(o.a)("common.notify-delete-success"),{entity:"Collection"}),this.refresh()},e=>{this.notificationService.error(Object(o.a)("common.notify-delete-error"),{entity:"Collection"})})}closeContents(){const e=Object.assign({},this.route.snapshot.params);delete e.contents,this.router.navigate(["./",e],{relativeTo:this.route,queryParamsHandling:"preserve"})}setLanguage(e){this.dataService.client.setContentLanguage(e).subscribe()}refresh(){this.queryResult.ref.refetch()}}Zn.\u0275fac=function(e){return new(e||Zn)(n.fc(i.L),n.fc(i.Eb),n.fc(i.Db),n.fc(a.e),n.fc(a.a),n.fc(i.Mb))},Zn.\u0275cmp=n.Zb({type:Zn,selectors:[["vdr-collection-list"]],decls:24,vars:29,consts:[[1,"flex","center","wrap"],[1,"mt2",3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],[1,"expand-all-toggle","ml3",3,"ngClass"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],["locationId","collection-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[1,"collection-wrapper"],[3,"collections","activeCollectionId","expandAll","rearrange","deleteCollection"],[1,"collection-contents"],[3,"collectionId"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"collection-title"],["type","button",1,"close-button",3,"click"],["shape","close"]],template:function(e,t){if(1&e&&(n.lc(0,"vdr-action-bar"),n.lc(1,"vdr-ab-left"),n.lc(2,"div",0),n.lc(3,"vdr-language-selector",1),n.vc("languageCodeChange",function(e){return t.setLanguage(e)}),n.yc(4,"async"),n.yc(5,"async"),n.kc(),n.lc(6,"clr-checkbox-wrapper",2),n.yc(7,"async"),n.lc(8,"input",3),n.vc("ngModelChange",function(e){return t.expandAll=e}),n.kc(),n.lc(9,"label"),n.bd(10),n.yc(11,"translate"),n.kc(),n.kc(),n.kc(),n.kc(),n.lc(12,"vdr-ab-right"),n.gc(13,"vdr-action-bar-items",4),n.Zc(14,ve,4,5,"a",5),n.kc(),n.kc(),n.lc(15,"div",6),n.lc(16,"vdr-collection-tree",7),n.vc("rearrange",function(e){return t.onRearrange(e)})("deleteCollection",function(e){return t.deleteCollection(e)}),n.yc(17,"async"),n.yc(18,"async"),n.kc(),n.lc(19,"div",8),n.yc(20,"async"),n.lc(21,"vdr-collection-contents",9),n.yc(22,"async"),n.Zc(23,ye,6,9,"ng-template"),n.kc(),n.kc(),n.kc()),2&e){let e=null;n.Tb(3),n.Ec("availableLanguageCodes",n.zc(4,12,t.availableLanguages$))("currentLanguageCode",n.zc(5,14,t.contentLanguage$)),n.Tb(3),n.Ec("ngClass",1===(null==(e=n.zc(7,16,t.availableLanguages$))?null:e.length)?"mt3":"mt1"),n.Tb(2),n.Ec("ngModel",t.expandAll),n.Tb(2),n.cd(n.zc(11,18,"catalog.expand-all-collections")),n.Tb(4),n.Ec("vdrIfPermissions",n.Hc(28,Ce)),n.Tb(2),n.Ec("collections",n.zc(17,20,t.items$))("activeCollectionId",n.zc(18,22,t.activeCollectionId$))("expandAll",t.expandAll),n.Tb(3),n.Xb("expanded",n.zc(20,24,t.activeCollectionId$)),n.Tb(2),n.Ec("collectionId",n.zc(22,26,t.activeCollectionId$))}},directives:function(){return[i.c,i.e,i.wb,B.k,z.m,i.eb,O.a,B.i,O.p,O.s,B.u,i.f,i.d,i.qb,ka,_n,a.h,B.o]},pipes:function(){return[z.b,G.d]},styles:["[_nghost-%COMP%]{height:100%;display:flex;flex-direction:column}.expand-all-toggle[_ngcontent-%COMP%]{display:block}.collection-wrapper[_ngcontent-%COMP%]{display:flex;height:calc(100% - 50px)}.collection-wrapper[_ngcontent-%COMP%]   vdr-collection-tree[_ngcontent-%COMP%]{flex:1;height:100%;overflow:auto}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents[_ngcontent-%COMP%]{height:100%;width:0;opacity:0;visibility:hidden;overflow:auto;transition:width .3s,opacity .2s .3s,visibility 0s .3s}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents.expanded[_ngcontent-%COMP%]{width:30vw;visibility:visible;opacity:1;padding-left:12px}.collection-wrapper[_ngcontent-%COMP%]   .collection-contents[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{margin:0;background:none;border:none;cursor:pointer}.paging-controls[_ngcontent-%COMP%]{padding-top:6px;border-top:1px solid var(--color-component-border-100);display:flex;justify-content:space-between}"],changeDetection:0}),Zn.ctorParameters=()=>[{type:i.L},{type:i.Eb},{type:i.Db},{type:a.e},{type:a.a},{type:i.Mb}];class Nn extends i.w{constructor(e,t,c,n,a,o,r,s){super(t,e,c,a),this.changeDetector=n,this.dataService=a,this.formBuilder=o,this.notificationService=r,this.modalService=s,this.updatePermission=[i.Ib.UpdateCatalog,i.Ib.UpdateFacet],this.customFields=this.getCustomFieldConfig("Facet"),this.customValueFields=this.getCustomFieldConfig("FacetValue"),this.detailForm=this.formBuilder.group({facet:this.formBuilder.group({code:["",O.C.required],name:"",visible:!0,customFields:this.formBuilder.group(this.customFields.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.name]:""}),{}))}),values:this.formBuilder.array([])})}ngOnInit(){this.init()}ngOnDestroy(){this.destroy()}updateCode(e,t){if(!e){const e=this.detailForm.get(["facet","code"]);e&&e.pristine&&e.setValue(Object(V.normalizeString)(t,"-"))}}updateValueCode(e,t,c){if(!e){const e=this.detailForm.get(["values",c,"code"]);e&&e.pristine&&e.setValue(Object(V.normalizeString)(t,"-"))}}customFieldIsSet(e){return!!this.detailForm.get(["facet","customFields",e])}customValueFieldIsSet(e,t){return!!this.detailForm.get(["values",e,"customFields",t])}getValuesFormArray(){return this.detailForm.get("values")}addFacetValue(){const e=this.detailForm.get("values");e&&(e.insert(e.length,this.formBuilder.group({id:"",name:["",O.C.required],code:""})),this.values.push({name:"",code:""}))}create(){const e=this.detailForm.get("facet");e&&e.dirty&&Object(x.a)(this.entity$,this.languageCode$).pipe(Object(b.a)(1),Object(h.a)(([t,c])=>{const n=this.getUpdatedFacet(t,e,c);return this.dataService.facet.createFacet(n)}),Object(u.a)(e=>this.dataService.facet.getAllFacets().single$.pipe(Object(v.a)(e)))).subscribe(e=>{this.notificationService.success(Object(o.a)("common.notify-create-success"),{entity:"Facet"}),this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.router.navigate(["../",e.createFacet.id],{relativeTo:this.route})},e=>{this.notificationService.error(Object(o.a)("common.notify-create-error"),{entity:"Facet"})})}save(){Object(x.a)(this.entity$,this.languageCode$).pipe(Object(b.a)(1),Object(h.a)(([e,t])=>{const c=this.detailForm.get("facet"),n=[];if(c&&c.dirty){const a=this.getUpdatedFacet(e,c,t);a&&n.push(this.dataService.facet.updateFacet(a))}const a=this.detailForm.get("values");if(a&&a.dirty){const c=a.controls.filter(e=>!e.value.id).map(c=>({facetId:e.id,code:c.value.code,translations:[{name:c.value.name,languageCode:t}]}));c.length&&n.push(this.dataService.facet.createFacetValues(c).pipe(Object(u.a)(()=>this.dataService.facet.getFacet(this.id).single$)));const i=this.getUpdatedFacetValues(e,a,t);i.length&&n.push(this.dataService.facet.updateFacetValues(i))}return Object(E.a)(n)}),Object(u.a)(()=>this.dataService.facet.getAllFacets().single$)).subscribe(()=>{this.detailForm.markAsPristine(),this.changeDetector.markForCheck(),this.notificationService.success(Object(o.a)("common.notify-update-success"),{entity:"Facet"})},e=>{this.notificationService.error(Object(o.a)("common.notify-update-error"),{entity:"Facet"})})}deleteFacetValue(e,t){if(!e){const e=this.detailForm.get("values");return e&&e.removeAt(t),void this.values.splice(t,1)}this.showModalAndDelete(e).pipe(Object(u.a)(t=>t.result===i.P.DELETED?[!0]:this.showModalAndDelete(e,t.message||"").pipe(Object(r.a)(e=>e.result===i.P.DELETED))),Object(u.a)(e=>e?this.dataService.facet.getFacet(this.id).single$:[])).subscribe(()=>{this.notificationService.success(Object(o.a)("common.notify-delete-success"),{entity:"FacetValue"})},e=>{this.notificationService.error(Object(o.a)("common.notify-delete-error"),{entity:"FacetValue"})})}showModalAndDelete(e,t){return this.modalService.dialog({title:Object(o.a)("catalog.confirm-delete-facet-value"),body:t,buttons:[{type:"secondary",label:Object(o.a)("common.cancel")},{type:"danger",label:Object(o.a)("common.delete"),returnValue:!0}]}).pipe(Object(u.a)(c=>c?this.dataService.facet.deleteFacetValues([e],!!t):T.a),Object(r.a)(e=>e.deleteFacetValues[0]))}setFormValues(e,t){var c;const n=Object(i.ec)(e,t);if(this.detailForm.patchValue({facet:{code:e.code,visible:!e.isPrivate,name:null!==(c=null==n?void 0:n.name)&&void 0!==c?c:""}}),this.customFields.length){const t=this.detailForm.get(["facet","customFields"]);for(const c of this.customFields){const a=c.name,i="localeString"===c.type?n.customFields[a]:e.customFields[a],o=t.get(a);o&&o.patchValue(i)}}const a=this.detailForm.get("values");this.values=[...e.values],e.values.forEach((e,c)=>{const n=Object(i.ec)(e,t),o={id:e.id,code:e.code,name:n?n.name:""},r=a.at(c);if(r?r.setValue(o):a.insert(c,this.formBuilder.group(o)),this.customValueFields.length){let t=this.detailForm.get(["values",c,"customFields"]);if(t||(t=new O.i({}),this.detailForm.get(["values",c]).addControl("customFields",t)),t)for(const c of this.customValueFields){const a=c.name,i="localeString"===c.type?n.customFields[a]:e.customFields[a],o=t.get(a);o?o.setValue(i):t.addControl(a,new O.f(i))}}})}getUpdatedFacet(e,t,c){const n=Object(i.bc)({translatable:e,updatedFields:t.value,customFieldConfig:this.customFields,languageCode:c,defaultTranslation:{languageCode:c,name:e.name||""}});return n.isPrivate=!t.value.visible,n}getUpdatedFacetValues(e,t,c){const n=e.values.filter((e,c)=>{const n=t.get(c.toString());return n&&n.dirty&&n.value.id}),a=t.controls.filter(e=>e.dirty&&e.value.id).map(e=>e.value);if(n.length!==a.length)throw new Error(Object(o.a)("error.facet-value-form-values-do-not-match"));return n.map((e,t)=>Object(i.bc)({translatable:e,updatedFields:a[t],customFieldConfig:this.customValueFields,languageCode:c,defaultTranslation:{languageCode:c,name:""}})).filter(w.notNullOrUndefined)}}Nn.\u0275fac=function(e){return new(e||Nn)(n.fc(a.e),n.fc(a.a),n.fc(i.Mb),n.fc(n.k),n.fc(i.L),n.fc(O.e),n.fc(i.Eb),n.fc(i.Db))},Nn.\u0275cmp=n.Zb({type:Nn,selectors:[["vdr-facet-detail"]],features:[n.Qb],decls:16,vars:19,consts:[[3,"entity"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","facet-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],["formGroupName","facet",1,"form-block"],["for","visibility",3,"label"],["type","checkbox","clrToggle","","formControlName","visible","id","visibility",3,"vdrDisabled"],[1,"visible-toggle"],[4,"ngIf","ngIfElse"],["private",""],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],["for","code",3,"label","readOnlyToggle"],["id","code","type","text","formControlName","code",3,"readonly"],["formGroupName","customFields",4,"ngIf"],["class","form-block",4,"ngIf"],["formGroupName","customFields"],[4,"ngFor","ngForOf"],["entityName","Facet",3,"customFieldsFormGroup","customField",4,"ngIf"],["entityName","Facet",3,"customFieldsFormGroup","customField"],[1,"form-block"],["class","facet-values-list table","formArrayName","values",4,"ngIf"],["type","button","class","btn btn-secondary",3,"click",4,"vdrIfPermissions"],["formArrayName","values",1,"facet-values-list","table"],["class","facet-value",3,"formGroupName",4,"ngFor","ngForOf"],[1,"facet-value",3,"formGroupName"],[1,"align-middle"],["type","text","formControlName","name",3,"readonly","input"],["type","text","formControlName","code","readonly",""],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],["entityName","FacetValue",3,"showLabel","customFieldsFormGroup","customField",4,"ngIf"],["entityName","FacetValue",3,"showLabel","customFieldsFormGroup","customField"],["type","button",1,"btn","btn-secondary",3,"click"],["shape","add"]],template:function(e,t){if(1&e&&(n.lc(0,"vdr-action-bar"),n.lc(1,"vdr-ab-left"),n.gc(2,"vdr-entity-info",0),n.yc(3,"async"),n.lc(4,"vdr-language-selector",1),n.vc("languageCodeChange",function(e){return t.setLanguage(e)}),n.yc(5,"async"),n.yc(6,"async"),n.yc(7,"async"),n.kc(),n.kc(),n.lc(8,"vdr-ab-right"),n.gc(9,"vdr-action-bar-items",2),n.Zc(10,ke,3,4,"button",3),n.yc(11,"async"),n.Zc(12,Pe,1,1,"ng-template",null,4,n.ad),n.kc(),n.kc(),n.Zc(14,Le,23,28,"form",5),n.yc(15,"async")),2&e){const e=n.Oc(13);n.Tb(2),n.Ec("entity",n.zc(3,7,t.entity$)),n.Tb(2),n.Ec("disabled",n.zc(5,9,t.isNew$))("availableLanguageCodes",n.zc(6,11,t.availableLanguages$))("currentLanguageCode",n.zc(7,13,t.languageCode$)),n.Tb(6),n.Ec("ngIf",n.zc(11,15,t.isNew$))("ngIfElse",e),n.Tb(4),n.Ec("ngIf",n.zc(15,17,t.entity$))}},directives:[i.c,i.e,i.ab,i.wb,i.f,i.d,z.o,i.qb,O.E,O.q,O.j,O.k,i.db,B.k,i.eb,O.a,B.i,O.p,O.h,i.S,B.u,O.b,z.n,i.I,O.d,i.T,i.W,B.o,i.V,i.U],pipes:[z.b,G.d,i.ib],styles:[Ze],changeDetection:0}),Nn.ctorParameters=()=>[{type:a.e},{type:a.a},{type:i.Mb},{type:n.k},{type:i.L},{type:O.e},{type:i.Eb},{type:i.Db}];class Gn extends i.y{constructor(e,t,c,n,a,i){super(a,i),this.dataService=e,this.modalService=t,this.notificationService=c,this.serverConfigService=n,this.initialLimit=3,this.displayLimit={},super.setQueryFn((...e)=>this.dataService.facet.getFacets(...e).refetchOnChannelChange(),e=>e.facets)}ngOnInit(){super.ngOnInit(),this.availableLanguages$=this.serverConfigService.getAvailableLanguages(),this.contentLanguage$=this.dataService.client.uiState().mapStream(({uiState:e})=>e.contentLanguage).pipe(Object(m.a)(()=>this.refresh()))}toggleDisplayLimit(e){this.displayLimit[e.id]===e.values.length?this.displayLimit[e.id]=this.initialLimit:this.displayLimit[e.id]=e.values.length}deleteFacet(e){this.showModalAndDelete(e).pipe(Object(u.a)(t=>t.result===i.P.DELETED?[!0]:this.showModalAndDelete(e,t.message||"").pipe(Object(r.a)(e=>e.result===i.P.DELETED))),Object(u.a)(()=>this.dataService.facet.getAllFacets().single$)).subscribe(()=>{this.notificationService.success(Object(o.a)("common.notify-delete-success"),{entity:"FacetValue"}),this.refresh()},e=>{this.notificationService.error(Object(o.a)("common.notify-delete-error"),{entity:"FacetValue"})})}setLanguage(e){this.dataService.client.setContentLanguage(e).subscribe()}showModalAndDelete(e,t){return this.modalService.dialog({title:Object(o.a)("catalog.confirm-delete-facet"),body:t,buttons:[{type:"secondary",label:Object(o.a)("common.cancel")},{type:"danger",label:Object(o.a)("common.delete"),returnValue:!0}]}).pipe(Object(u.a)(c=>c?this.dataService.facet.deleteFacet(e,!!t):T.a),Object(r.a)(e=>e.deleteFacet))}}function Un(e,t,c){if(!e)return"";const n=e.lastIndexOf(t);if(-1===n)return e;return e.substr(0,n)+e.substr(n).replace(t,c)}Gn.\u0275fac=function(e){return new(e||Gn)(n.fc(i.L),n.fc(i.Db),n.fc(i.Eb),n.fc(i.Mb),n.fc(a.e),n.fc(a.a))},Gn.\u0275cmp=n.Zb({type:Gn,selectors:[["vdr-facet-list"]],features:[n.Qb],decls:28,vars:33,consts:[[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","facet-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[3,"expand"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"left","align-middle"],[3,"facetValue","removable","displayFacetName",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary btn-icon",3,"click",4,"ngIf"],[4,"ngIf","ngIfElse"],["private",""],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"facetValue","removable","displayFacetName"],[1,"btn","btn-sm","btn-secondary","btn-icon",3,"click"],["collapse",""],["shape","minus"]],template:function(e,t){1&e&&(n.lc(0,"vdr-action-bar"),n.lc(1,"vdr-ab-left"),n.lc(2,"vdr-language-selector",0),n.vc("languageCodeChange",function(e){return t.setLanguage(e)}),n.yc(3,"async"),n.yc(4,"async"),n.kc(),n.kc(),n.lc(5,"vdr-ab-right"),n.gc(6,"vdr-action-bar-items",1),n.Zc(7,Ne,4,5,"a",2),n.kc(),n.kc(),n.lc(8,"vdr-data-table",3),n.vc("pageChange",function(e){return t.setPageNumber(e)})("itemsPerPageChange",function(e){return t.setItemsPerPage(e)}),n.yc(9,"async"),n.yc(10,"async"),n.yc(11,"async"),n.yc(12,"async"),n.lc(13,"vdr-dt-column"),n.bd(14),n.yc(15,"translate"),n.kc(),n.lc(16,"vdr-dt-column"),n.bd(17),n.yc(18,"translate"),n.kc(),n.lc(19,"vdr-dt-column",4),n.bd(20),n.yc(21,"translate"),n.kc(),n.lc(22,"vdr-dt-column"),n.bd(23),n.yc(24,"translate"),n.kc(),n.gc(25,"vdr-dt-column"),n.gc(26,"vdr-dt-column"),n.Zc(27,Qe,28,38,"ng-template"),n.kc()),2&e&&(n.Tb(2),n.Ec("availableLanguageCodes",n.zc(3,12,t.availableLanguages$))("currentLanguageCode",n.zc(4,14,t.contentLanguage$)),n.Tb(5),n.Ec("vdrIfPermissions",n.Hc(32,$e)),n.Tb(1),n.Ec("items",n.zc(9,16,t.items$))("itemsPerPage",n.zc(10,18,t.itemsPerPage$))("totalItems",n.zc(11,20,t.totalItems$))("currentPage",n.zc(12,22,t.currentPage$)),n.Tb(6),n.cd(n.zc(15,24,"common.code")),n.Tb(3),n.cd(n.zc(18,26,"common.name")),n.Tb(2),n.Ec("expand",!0),n.Tb(1),n.cd(n.zc(21,28,"catalog.values")),n.Tb(3),n.cd(n.zc(24,30,"catalog.visibility")))},directives:[i.c,i.e,i.wb,i.f,i.d,i.qb,i.N,i.M,a.h,B.o,z.n,z.o,i.D,i.Tb,i.T,i.W,i.V,i.U,i.bb],pipes:[z.b,G.d,z.x,i.ib],styles:["td.private[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"]}),Gn.ctorParameters=()=>[{type:i.L},{type:i.Db},{type:i.Eb},{type:i.Mb},{type:a.e},{type:a.a}];class Bn{constructor(e){this.dataService=e}getFacets(){return this.dataService.facet.getAllFacets().mapSingle(e=>e.facets.items)}getTaxCategories(){return this.dataService.settings.getTaxCategories().mapSingle(e=>e.taxCategories).pipe(Object(f.a)(1))}createProductWithVariants(e,t,c){const n=this.dataService.product.createProduct(e),a=t.groups.filter(e=>0<e.values.length),i=this.createProductOptionGroups(a,c);return Object(E.a)(n,i).pipe(Object(h.a)(([{createProduct:e},t])=>(t.length?Object(E.a)(t.map(t=>this.dataService.product.addOptionGroupToProduct({productId:e.id,optionGroupId:t.id}))):Object(F.a)([])).pipe(Object(r.a)(()=>({createProduct:e,optionGroups:t})))),Object(h.a)(({createProduct:e,optionGroups:n})=>{const a=t.variants.map(e=>{const t=n.length?e.optionValues.map((e,t)=>{const c=n[t].options.find(t=>t.name===e);if(!c)throw new Error(`Could not find a matching ProductOption "${e}" when creating variant`);return c.id}):[];return Object.assign(Object.assign({},e),{optionIds:t})}),i=n.map(e=>e.options).reduce((e,t)=>[...e,...t],[]);return this.createProductVariants(e,a,i,c)}))}createProductOptionGroups(e,t){return e.length?Object(E.a)(e.map(e=>this.dataService.product.createProductOptionGroups({code:Object(V.normalizeString)(e.name,"-"),translations:[{languageCode:t,name:e.name}],options:e.values.map(e=>({code:Object(V.normalizeString)(e,"-"),translations:[{languageCode:t,name:e}]}))}).pipe(Object(r.a)(e=>e.createProductOptionGroup)))):Object(F.a)([])}createProductVariants(e,t,c,n){const a=t.map(t=>{const a=c.length?`${e.name} ${t.optionIds.map(e=>c.find(t=>t.id===e)).filter(w.notNullOrUndefined).map(e=>e.name).join(" ")}`:e.name;return{productId:e.id,price:t.price,sku:t.sku,stockOnHand:t.stock,translations:[{languageCode:n,name:a}],optionIds:t.optionIds}});return this.dataService.product.createProductVariants(a).pipe(Object(r.a)(({createProductVariants:t})=>({createProductVariants:t,productId:e.id})))}updateProduct(e){var t,c,n,a;const{product:o,languageCode:r,autoUpdate:s,productInput:l,variantsInput:d}=e,u=[],p=d||[];if(l){u.push(this.dataService.product.updateProduct(l));const e=null!==(c=null===(t=Object(i.ec)(o,r))||void 0===t?void 0:t.name)&&void 0!==c?c:"",d=null===(n=Object(i.ec)(l,r))||void 0===n?void 0:n.name;if(d&&e!==d&&s)for(const t of o.variants){const c=(null===(a=Object(i.ec)(t,r))||void 0===a?void 0:a.name)||"";let n;const o=p.find(e=>e.id===t.id);o?n=o:(n={id:t.id,translations:[{languageCode:r,name:c}]},p.push(n));const s=Object(i.ec)(n,r);s&&(s.name?s.name=Un(s.name,e,d):s.name=[d,...t.options.map(e=>e.name)].join(" "))}}return p.length&&u.push(this.dataService.product.updateProductVariants(p)),Object(E.a)(u)}updateProductOption(e,t,c){var n,a,o;let r=Object(F.a)([]);if(e.autoUpdate){let s;const l=null===(n=Object(i.ec)(e,c))||void 0===n?void 0:n.name;l||(r=Object(F.a)([]));const d=[];for(const n of t.variants)if(n.options.map(e=>e.id).includes(e.id)){s||(s=null===(a=Object(i.ec)(n.options.find(t=>t.id===e.id),c))||void 0===a?void 0:a.name);const t=(null===(o=Object(i.ec)(n,c))||void 0===o?void 0:o.name)||"";s&&l&&t.includes(s)&&d.push({id:n.id,translations:[{languageCode:c,name:Un(t,s,l)}]})}d.length&&(r=this.dataService.product.updateProductVariants(d))}return this.dataService.product.updateProductOption(e).pipe(Object(h.a)(()=>r))}deleteProductVariant(e,t){return this.dataService.product.deleteProductVariant(e).pipe(Object(u.a)(e=>e.deleteProductVariant.result===i.P.DELETED?this.dataService.product.getProduct(t).single$:Object(S.a)(e.deleteProductVariant.message)))}}Bn.\u0275fac=function(e){return new(e||Bn)(n.sc(i.L))},Bn.\u0275prov=Object(n.bc)({factory:function(){return new Bn(Object(n.sc)(i.L))},token:Bn,providedIn:"root"}),Bn.ctorParameters=()=>[{type:i.L}];class Hn{constructor(e){this.changeDetector=e,this.selectedValues=[]}ngAfterViewInit(){setTimeout(()=>this.selector.focus(),0)}selectValues(){this.resolveWith(this.selectedValues)}cancel(){this.resolveWith()}}Hn.\u0275fac=function(e){return new(e||Hn)(n.fc(n.k))},Hn.\u0275cmp=n.Zb({type:Hn,selectors:[["vdr-apply-facet-dialog"]],viewQuery:function(e,t){if(1&e&&n.gd(i.cb,1),2&e){let e;n.Nc(e=n.wc())&&(t.selector=e.first)}},decls:3,vars:1,consts:[["vdrDialogTitle",""],[3,"facets","selectedValuesChange"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(n.Zc(0,Ke,2,3,"ng-template",0),n.lc(1,"vdr-facet-value-selector",1),n.vc("selectedValuesChange",function(e){return t.selectedValues=e}),n.kc(),n.Zc(2,Je,6,7,"ng-template",2)),2&e&&(n.Tb(1),n.Ec("facets",t.facets))},directives:[i.R,i.cb,i.Q],pipes:[G.d],styles:[""],changeDetection:0}),Hn.ctorParameters=()=>[{type:n.k}],Hn.propDecorators={selector:[{type:n.fb,args:[i.cb]}]};class qn{constructor(e,t){this.dataService=e,this.notificationService=t,this.priceFactorControl=new O.f(1),this.selectedChannelIdControl=new O.f}get isProductVariantMode(){return null!=this.productVariantIds}ngOnInit(){const e=this.dataService.client.userStatus().mapSingle(({userStatus:e})=>e.activeChannelId),t=this.dataService.settings.getChannels().mapSingle(e=>e.channels);Object(x.a)(e,t).subscribe(([e,t])=>{this.currentChannel=t.find(t=>t.id===e),this.availableChannels=t}),this.selectedChannelIdControl.valueChanges.subscribe(e=>{this.selectChannel(e)}),this.variantsPreview$=Object(x.a)(Object(j.a)(this.getTopVariants(10)),this.priceFactorControl.valueChanges.pipe(Object(p.a)(1))).pipe(Object(r.a)(([e,t])=>e.map(e=>({id:e.id,name:e.name,price:e.price,pricePreview:e.price*+t}))))}selectChannel(e){this.selectedChannel=this.availableChannels.find(t=>t.id===e[0])}assign(){const e=this.selectedChannel;e&&(this.isProductVariantMode?this.productVariantIds&&this.dataService.product.assignVariantsToChannel({channelId:e.id,productVariantIds:this.productVariantIds,priceFactor:+this.priceFactorControl.value}).subscribe(()=>{this.notificationService.success(Object(o.a)("catalog.assign-variant-to-channel-success"),{channel:e.code}),this.resolveWith(!0)}):this.dataService.product.assignProductsToChannel({channelId:e.id,productIds:this.productIds,priceFactor:+this.priceFactorControl.value}).subscribe(()=>{this.notificationService.success(Object(o.a)("catalog.assign-product-to-channel-success"),{channel:e.code}),this.resolveWith(!0)}))}cancel(){this.resolveWith()}getTopVariants(e){return Object($.b)(this,void 0,void 0,function*(){const t=[];for(let c=0;c<this.productIds.length&&t.length<e;c++){const e=yield this.dataService.product.getProduct(this.productIds[c]).mapSingle(({product:e})=>(e?e.variants:[]).filter(e=>{var t;return!this.isProductVariantMode||(null===(t=this.productVariantIds)||void 0===t?void 0:t.includes(e.id))})).toPromise();t.push(...e||[])}return t.slice(0,e)})}}qn.\u0275fac=function(e){return new(e||qn)(n.fc(i.L),n.fc(i.Eb))},qn.\u0275cmp=n.Zb({type:qn,selectors:[["vdr-assign-products-to-channel-dialog"]],decls:36,vars:32,consts:[["vdrDialogTitle",""],[1,"flex"],["clrInput","",3,"multiple","includeDefaultChannel","disableChannelIds","formControl"],[1,"flex-spacer"],["clrInput","","type","number","min","0","max","99999",3,"formControl"],[1,"channel-price-preview"],[1,"clr-control-label"],[1,"table"],[3,"ngIf","ngIfElse"],["noSelection",""],[4,"ngFor","ngForOf"],["vdrDialogButtons",""],[4,"ngIf","ngIfElse"],["productModeTitle",""],["noChannelSelected",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){if(1&e&&(n.Zc(0,tt,3,2,"ng-template",0),n.lc(1,"div",1),n.lc(2,"clr-input-container"),n.lc(3,"label"),n.bd(4),n.yc(5,"translate"),n.kc(),n.gc(6,"vdr-channel-assignment-control",2),n.kc(),n.gc(7,"div",3),n.lc(8,"clr-input-container"),n.lc(9,"label"),n.bd(10),n.yc(11,"translate"),n.kc(),n.gc(12,"input",4),n.kc(),n.kc(),n.lc(13,"div",5),n.lc(14,"label",6),n.bd(15),n.yc(16,"translate"),n.kc(),n.lc(17,"table",7),n.lc(18,"thead"),n.lc(19,"tr"),n.lc(20,"th"),n.bd(21),n.yc(22,"translate"),n.kc(),n.lc(23,"th"),n.bd(24),n.yc(25,"translate"),n.yc(26,"translate"),n.yc(27,"channelCodeToLabel"),n.kc(),n.lc(28,"th"),n.Zc(29,nt,2,6,"ng-template",8),n.Zc(30,at,2,3,"ng-template",null,9,n.ad),n.kc(),n.kc(),n.kc(),n.lc(32,"tbody"),n.Zc(33,rt,10,7,"tr",10),n.yc(34,"async"),n.kc(),n.kc(),n.kc(),n.Zc(35,ut,7,6,"ng-template",11)),2&e){const e=n.Oc(31);n.Tb(4),n.cd(n.zc(5,13,"common.channel")),n.Tb(2),n.Ec("multiple",!1)("includeDefaultChannel",!1)("disableChannelIds",t.currentChannelIds)("formControl",t.selectedChannelIdControl),n.Tb(4),n.cd(n.zc(11,15,"catalog.price-conversion-factor")),n.Tb(2),n.Ec("formControl",t.priceFactorControl),n.Tb(3),n.cd(n.zc(16,17,"catalog.channel-price-preview")),n.Tb(6),n.cd(n.zc(22,19,"common.name")),n.Tb(3),n.dd(" ",n.Ac(25,21,"catalog.price-in-channel",n.Ic(30,ct,n.zc(26,24,n.zc(27,26,null==t.currentChannel?null:t.currentChannel.code))))," "),n.Tb(5),n.Ec("ngIf",t.selectedChannel)("ngIfElse",e),n.Tb(4),n.Ec("ngForOf",n.zc(34,28,t.variantsPreview$))}},directives:[i.R,B.t,B.u,i.A,B.s,O.p,O.g,i.eb,O.v,O.b,z.o,z.n,i.Q],pipes:[G.d,i.C,z.b,i.zb],styles:["vdr-channel-assignment-control[_ngcontent-%COMP%]{min-width:200px}.channel-price-preview[_ngcontent-%COMP%]{margin-top:24px}.channel-price-preview[_ngcontent-%COMP%]   table.table[_ngcontent-%COMP%]{margin-top:6px}"],changeDetection:0}),qn.ctorParameters=()=>[{type:i.L},{type:i.Eb}];class Rn extends i.w{constructor(e,t,c,n,a,i,o,r,s,l){super(e,t,c,r),this.productDetailService=n,this.formBuilder=a,this.modalService=i,this.notificationService=o,this.dataService=r,this.location=s,this.changeDetector=l,this.filterInput=new O.f(""),this.assetChanges={},this.variantAssetChanges={},this.selectedVariantIds=[],this.variantDisplayMode="card",this.createVariantsConfig={groups:[],variants:[]},this.customFields=this.getCustomFieldConfig("Product"),this.customVariantFields=this.getCustomFieldConfig("ProductVariant"),this.customOptionGroupFields=this.getCustomFieldConfig("ProductOptionGroup"),this.customOptionFields=this.getCustomFieldConfig("ProductOption"),this.detailForm=this.formBuilder.group({product:this.formBuilder.group({enabled:!0,name:["",O.C.required],autoUpdateVariantNames:!0,slug:"",description:"",facetValueIds:[[]],customFields:this.formBuilder.group(this.customFields.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.name]:""}),{}))}),variants:this.formBuilder.array([])})}ngOnInit(){this.init(),this.product$=this.entity$;const e=this.product$.pipe(Object(r.a)(e=>e.variants)),t=this.filterInput.valueChanges.pipe(Object(p.a)(""),Object(s.a)(50),Object(f.a)());this.variants$=Object(x.a)(e,t).pipe(Object(r.a)(([e,t])=>t?e.filter(e=>{const c=t.toLocaleLowerCase();return e.name.toLocaleLowerCase().includes(c)||e.sku.toLocaleLowerCase().includes(c)}):e)),this.taxCategories$=this.productDetailService.getTaxCategories().pipe(Object(l.a)(this.destroy$)),this.activeTab$=this.route.paramMap.pipe(Object(r.a)(e=>e.get("tab"))),this.facets$=this.productDetailService.getFacets();const c=this.product$.pipe(Object(r.a)(e=>e.facetValues)),n=this.facets$.pipe(Object(r.a)(i.fc)),a=this.getProductFormGroup().valueChanges.pipe(Object(r.a)(e=>e.facetValueIds),Object(g.a)()),o=Object(x.a)(a,c,n).pipe(Object(r.a)(([e,t,c])=>{const n=[...t,...c];return e.map(e=>n.find(t=>t.id===e)).filter(w.notNullOrUndefined)}));this.facetValues$=Object(M.a)(c,o),this.productChannels$=this.product$.pipe(Object(r.a)(e=>e.channels)),this.channelPriceIncludesTax$=this.dataService.settings.getActiveChannel("cache-first").refetchOnChannelChange().mapStream(e=>e.activeChannel.pricesIncludeTax).pipe(Object(f.a)(1))}ngOnDestroy(){this.destroy()}navigateToTab(e){this.location.replaceState(this.router.createUrlTree(["./",Object.assign(Object.assign({},this.route.snapshot.params),{tab:e})],{queryParamsHandling:"merge",relativeTo:this.route}).toString())}isDefaultChannel(e){return e===A.DEFAULT_CHANNEL_CODE}assignToChannel(){this.productChannels$.pipe(Object(b.a)(1),Object(u.a)(e=>this.modalService.fromComponent(qn,{size:"lg",locals:{productIds:[this.id],currentChannelIds:e.map(e=>e.id)}}))).subscribe()}removeFromChannel(e){this.modalService.dialog({title:Object(o.a)("catalog.remove-product-from-channel"),buttons:[{type:"secondary",label:Object(o.a)("common.cancel")},{type:"danger",label:Object(o.a)("catalog.remove-from-channel"),returnValue:!0}]}).pipe(Object(u.a)(t=>t?this.dataService.product.removeProductsFromChannel({channelId:e,productIds:[this.id]}):T.a)).subscribe(()=>{this.notificationService.success(Object(o.a)("catalog.notify-remove-product-from-channel-success"))},e=>{this.notificationService.error(Object(o.a)("catalog.notify-remove-product-from-channel-error"))})}assignVariantToChannel(e){return this.modalService.fromComponent(qn,{size:"lg",locals:{productIds:[this.id],productVariantIds:[e.id],currentChannelIds:e.channels.map(e=>e.id)}}).subscribe()}removeVariantFromChannel({channelId:e,variant:t}){this.modalService.dialog({title:Object(o.a)("catalog.remove-product-variant-from-channel"),buttons:[{type:"secondary",label:Object(o.a)("common.cancel")},{type:"danger",label:Object(o.a)("catalog.remove-from-channel"),returnValue:!0}]}).pipe(Object(u.a)(c=>c?this.dataService.product.removeVariantsFromChannel({channelId:e,productVariantIds:[t.id]}):T.a)).subscribe(()=>{this.notificationService.success(Object(o.a)("catalog.notify-remove-variant-from-channel-success"))},e=>{this.notificationService.error(Object(o.a)("catalog.notify-remove-variant-from-channel-error"))})}customFieldIsSet(e){return!!this.detailForm.get(["product","customFields",e])}assetsChanged(){return!!Object.values(this.assetChanges).length}variantAssetsChanged(){return!!Object.keys(this.variantAssetChanges).length}variantAssetChange(e){this.variantAssetChanges[e.variantId]=e}updateSlug(e){Object(x.a)(this.entity$,this.languageCode$).pipe(Object(b.a)(1)).subscribe(([t,c])=>{const n=this.detailForm.get(["product","slug"]),a=Object(i.ec)(t,c),o=!a||!a.slug;n&&n.pristine&&o&&n.setValue(Object(V.normalizeString)(`${e}`,"-"))})}selectProductFacetValue(){this.displayFacetValueModal().subscribe(e=>{if(e){const t=this.getProductFormGroup(),c=t.value.facetValueIds;t.patchValue({facetValueIds:Object(D.unique)([...c,...e])}),t.markAsDirty()}})}updateProductOption(e){Object(x.a)(this.product$,this.languageCode$).pipe(Object(b.a)(1),Object(h.a)(([t,c])=>this.productDetailService.updateProductOption(e,t,c))).subscribe(()=>{this.notificationService.success(Object(o.a)("common.notify-update-success"),{entity:"ProductOption"})},e=>{this.notificationService.error(Object(o.a)("common.notify-update-error"),{entity:"ProductOption"})})}removeProductFacetValue(e){const t=this.getProductFormGroup(),c=t.value.facetValueIds;t.patchValue({facetValueIds:c.filter(t=>t!==e)}),t.markAsDirty()}selectVariantFacetValue(e){this.displayFacetValueModal().pipe(Object(y.a)(this.variants$)).subscribe(([t,c])=>{if(t){for(const n of e){const e=c.findIndex(e=>e.id===n),a=c[e],i=a?a.facetValues.map(e=>e.id):[],o=this.detailForm.get(["variants",e]);o&&(o.patchValue({facetValueIds:Object(D.unique)([...i,...t])}),o.markAsDirty())}this.changeDetector.markForCheck()}})}variantsToCreateAreValid(){return 0<this.createVariantsConfig.variants.length&&this.createVariantsConfig.variants.every(e=>""!==e.sku)}displayFacetValueModal(){return this.productDetailService.getFacets().pipe(Object(h.a)(e=>this.modalService.fromComponent(Hn,{size:"md",closable:!0,locals:{facets:e}})),Object(r.a)(e=>e&&e.map(e=>e.id)))}create(){const e=this.getProductFormGroup();e.dirty&&Object(x.a)(this.product$,this.languageCode$).pipe(Object(b.a)(1),Object(h.a)(([t,c])=>{const n=this.getUpdatedProduct(t,e,c);return this.productDetailService.createProductWithVariants(n,this.createVariantsConfig,c)})).subscribe(({createProductVariants:e,productId:t})=>{this.notificationService.success(Object(o.a)("common.notify-create-success"),{entity:"Product"}),this.assetChanges={},this.variantAssetChanges={},this.detailForm.markAsPristine(),this.router.navigate(["../",t],{relativeTo:this.route})},e=>{console.error(e),this.notificationService.error(Object(o.a)("common.notify-create-error"),{entity:"Product"})})}save(){Object(x.a)(this.product$,this.languageCode$,this.channelPriceIncludesTax$).pipe(Object(b.a)(1),Object(h.a)(([e,t,c])=>{var n,a;const i=this.getProductFormGroup();let o,r;(i.dirty||this.assetsChanged())&&(o=this.getUpdatedProduct(e,i,t));const s=this.detailForm.get("variants");return(s&&s.dirty||this.variantAssetsChanged())&&(r=this.getUpdatedProductVariants(e,s,t,c)),this.productDetailService.updateProduct({product:e,languageCode:t,autoUpdate:null!==(a=null===(n=this.detailForm.get(["product","autoUpdateVariantNames"]))||void 0===n?void 0:n.value)&&void 0!==a&&a,productInput:o,variantsInput:r})})).subscribe(e=>{this.updateSlugAfterSave(e),this.detailForm.markAsPristine(),this.assetChanges={},this.variantAssetChanges={},this.notificationService.success(Object(o.a)("common.notify-update-success"),{entity:"Product"}),this.changeDetector.markForCheck()},e=>{this.notificationService.error(Object(o.a)("common.notify-update-error"),{entity:"Product"})})}canDeactivate(){return super.canDeactivate()&&!this.assetChanges.assets&&!this.assetChanges.featuredAsset}setFormValues(e,t){const c=Object(i.ec)(e,t);if(this.detailForm.patchValue({product:{enabled:e.enabled,name:c?c.name:"",slug:c?c.slug:"",description:c?c.description:"",facetValueIds:e.facetValues.map(e=>e.id)}}),this.customFields.length){const t=this.detailForm.get(["product","customFields"]),n=c&&c.customFields||{},a=e.customFields||{};for(const e of this.customFields){const c=e.name,i="localeString"===e.type?n[c]:a[c],o=t.get(c);o&&o.patchValue(i)}}const n=this.detailForm.get("variants");e.variants.forEach((e,c)=>{const a=Object(i.ec)(e,t),o=e.facetValues.map(e=>e.id),r={id:e.id,enabled:e.enabled,sku:e.sku,name:a?a.name:"",price:e.price,priceWithTax:e.priceWithTax,taxCategoryId:e.taxCategory.id,stockOnHand:e.stockOnHand,useGlobalOutOfStockThreshold:e.useGlobalOutOfStockThreshold,outOfStockThreshold:e.outOfStockThreshold,trackInventory:e.trackInventory,facetValueIds:o};let s=n.at(c);if(s?s.patchValue(r):(s=this.formBuilder.group(Object.assign(Object.assign({},r),{facetValueIds:this.formBuilder.control(o)})),n.insert(c,s)),this.customVariantFields.length){let t=s.get(["customFields"]);t||(t=this.formBuilder.group(this.customVariantFields.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.name]:""}),{})),s.addControl("customFields",t));for(const c of this.customVariantFields){const n=c.name,i="localeString"===c.type?a.customFields[n]:e.customFields[n],o=t.get(n);o&&o.patchValue(i)}}})}getUpdatedProduct(e,t,c){var n,a;const o=Object(i.bc)({translatable:e,updatedFields:t.value,customFieldConfig:this.customFields,languageCode:c,defaultTranslation:{languageCode:c,name:e.name||"",slug:e.slug||"",description:e.description||""}});return Object.assign(Object.assign({},o),{assetIds:null===(n=this.assetChanges.assets)||void 0===n?void 0:n.map(e=>e.id),featuredAssetId:null===(a=this.assetChanges.featuredAsset)||void 0===a?void 0:a.id,facetValueIds:t.value.facetValueIds})}getUpdatedProductVariants(e,t,c,n){const a=e.variants.filter((e,c)=>{const n=t.get(c.toString());return n&&n.dirty}),r=t.controls.filter(e=>e.dirty).map(e=>e.value);if(a.length!==r.length)throw new Error(Object(o.a)("error.product-variant-form-values-do-not-match"));return a.map((e,t)=>{var a,o;const s=r[t],l=Object(i.bc)({translatable:e,updatedFields:s,customFieldConfig:this.customVariantFields,languageCode:c,defaultTranslation:{languageCode:c,name:""}});l.taxCategoryId=s.taxCategoryId,l.facetValueIds=s.facetValueIds,l.price=n?s.priceWithTax:s.price;const d=this.variantAssetChanges[e.id];return d&&(l.featuredAssetId=null===(a=d.featuredAsset)||void 0===a?void 0:a.id,l.assetIds=null===(o=d.assets)||void 0===o?void 0:o.map(e=>e.id)),l}).filter(w.notNullOrUndefined)}getProductFormGroup(){return this.detailForm.get("product")}updateSlugAfterSave(e){const t=e[0],c=this.detailForm.get(["product","slug"]);c&&t.hasOwnProperty("updateProduct")&&c.setValue(t.updateProduct.slug,{emitEvent:!1})}}Rn.\u0275fac=function(e){return new(e||Rn)(n.fc(a.a),n.fc(a.e),n.fc(i.Mb),n.fc(Bn),n.fc(O.e),n.fc(i.Db),n.fc(i.Eb),n.fc(i.L),n.fc(z.k),n.fc(n.k))},Rn.\u0275cmp=n.Zb({type:Rn,selectors:[["vdr-product-detail"]],features:[n.Qb],decls:18,vars:21,consts:[[1,"flex","clr-flex-row"],[3,"entity"],[4,"vdrIfPermissions"],[3,"disabled","availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","product-detail"],["class","btn btn-primary",3,"disabled","click",4,"ngIf","ngIfElse"],["updateButton",""],["class","form",3,"formGroup",4,"ngIf"],["type","checkbox","clrToggle","","name","enabled",3,"formControl"],[1,"btn","btn-primary",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"vdrIfPermissions"],[1,"form",3,"formGroup"],["type","submit","hidden","","x-data","prevents enter key from triggering other buttons"],["clrTabLink","",3,"click"],[4,"clrIfActive"],[4,"ngIf"],[1,"clr-row"],[1,"clr-col"],["formGroupName","product",1,"form-block"],[4,"vdrIfMultichannel"],["for","name",3,"label"],["id","name","type","text","formControlName","name",3,"readonly","input"],[1,"auto-rename-wrapper"],["clrCheckbox","","type","checkbox","id","auto-update","formControlName","autoUpdateVariantNames"],["for","slug",3,"label","errors"],["id","slug","type","text","formControlName","slug","pattern","[a-z0-9_-]+",3,"readonly"],["formControlName","description",3,"readonly","label"],["formGroupName","customFields",4,"ngIf"],[1,"facets"],[3,"facetValue","removable","remove",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary",3,"click",4,"vdrIfPermissions"],[1,"clr-col-md-auto"],[3,"assets","featuredAsset","change"],[3,"label",4,"vdrIfDefaultChannelActive"],[3,"label"],[1,"flex","channel-assignment"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm",3,"click"],["shape","layers"],["icon","times-circle",3,"iconClick",4,"ngIf"],["icon","times-circle",3,"iconClick"],[3,"channelCode"],["formGroupName","customFields"],["entityName","Product",3,"customFieldsFormGroup","customField","readonly",4,"ngIf"],["entityName","Product",3,"customFieldsFormGroup","customField","readonly"],[3,"facetValue","removable","remove"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","plus"],[3,"variantsChange"],[1,"form-block"],[1,"view-mode"],[1,"btn-group"],[1,"btn","btn-secondary-outline",3,"click"],["shape","list"],[1,"btn",3,"click"],["shape","table"],[1,"variant-filter"],[3,"formControl","placeholder"],[1,"icon-button",3,"click"],["shape","times"],[1,"flex-spacer"],["class","btn btn-secondary edit-variants-btn",3,"routerLink",4,"vdrIfPermissions"],[3,"variants","optionGroups","channelPriceIncludesTax","productVariantsFormArray","pendingAssetChanges",4,"ngIf"],[3,"variants","channelPriceIncludesTax","facets","optionGroups","productVariantsFormArray","taxCategories","customFields","customOptionFields","activeLanguage","pendingAssetChanges","assignToChannel","removeFromChannel","assetChange","updateProductOption","selectionChange","selectFacetValueClick",4,"ngIf"],[1,"btn","btn-secondary","edit-variants-btn",3,"routerLink"],["shape","add-text"],[3,"variants","optionGroups","channelPriceIncludesTax","productVariantsFormArray","pendingAssetChanges"],[3,"variants","channelPriceIncludesTax","facets","optionGroups","productVariantsFormArray","taxCategories","customFields","customOptionFields","activeLanguage","pendingAssetChanges","assignToChannel","removeFromChannel","assetChange","updateProductOption","selectionChange","selectFacetValueClick"]],template:function(e,t){if(1&e&&(n.lc(0,"vdr-action-bar"),n.lc(1,"vdr-ab-left"),n.lc(2,"div",0),n.gc(3,"vdr-entity-info",1),n.yc(4,"async"),n.Zc(5,gt,5,5,"clr-toggle-wrapper",2),n.kc(),n.lc(6,"vdr-language-selector",3),n.vc("languageCodeChange",function(e){return t.setLanguage(e)}),n.yc(7,"async"),n.yc(8,"async"),n.yc(9,"async"),n.kc(),n.kc(),n.lc(10,"vdr-ab-right"),n.gc(11,"vdr-action-bar-items",4),n.Zc(12,mt,3,4,"button",5),n.yc(13,"async"),n.Zc(14,ft,1,2,"ng-template",null,6,n.ad),n.kc(),n.kc(),n.Zc(16,$t,11,10,"form",7),n.yc(17,"async")),2&e){const e=n.Oc(15);n.Tb(3),n.Ec("entity",n.zc(4,8,t.entity$)),n.Tb(2),n.Ec("vdrIfPermissions",n.Hc(20,ht)),n.Tb(1),n.Ec("disabled",n.zc(7,10,t.isNew$))("availableLanguageCodes",n.zc(8,12,t.availableLanguages$))("currentLanguageCode",n.zc(9,14,t.languageCode$)),n.Tb(6),n.Ec("ngIf",n.zc(13,16,t.isNew$))("ngIfElse",e),n.Tb(4),n.Ec("ngIf",n.zc(17,18,t.product$))}},directives:function(){return[i.c,i.e,i.ab,i.qb,i.wb,i.f,i.d,z.o,B.k,i.eb,O.a,B.i,O.p,O.g,B.u,O.E,O.q,O.j,B.G,B.R,B.D,B.F,B.P,B.p,B.E,O.k,i.pb,i.db,O.b,O.h,O.w,i.Kb,z.n,Ia,i.ob,i.fb,B.o,i.D,i.B,i.I,i.bb,Pa,a.h,Sa,Ea]},pipes:function(){return[z.b,G.d,i.ib,i.C]},styles:["[_nghost-%COMP%]     trix-toolbar{top:24px}vdr-action-bar[_ngcontent-%COMP%]   clr-toggle-wrapper[_ngcontent-%COMP%]{margin-top:12px}.variant-filter[_ngcontent-%COMP%]{flex:1;display:flex}.variant-filter[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;max-width:none;border-radius:3px 0 0 3px!important}.variant-filter[_ngcontent-%COMP%]   .icon-button[_ngcontent-%COMP%]{border:1px solid var(--color-component-border-300);background-color:var(--color-component-bg-100);border-radius:0 3px 3px 0;border-left:none}.group-name[_ngcontent-%COMP%]{padding-right:6px}.view-mode[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center}.edit-variants-btn[_ngcontent-%COMP%]{margin-top:0}.channel-assignment[_ngcontent-%COMP%]{flex-wrap:wrap}.auto-rename-wrapper[_ngcontent-%COMP%]{overflow:hidden;max-height:0;padding-left:9.5rem;margin-bottom:0;transition:max-height .2s,margin-bottom .2s}.auto-rename-wrapper.visible[_ngcontent-%COMP%]{max-height:24px;margin-bottom:12px}"],changeDetection:0}),Rn.ctorParameters=()=>[{type:a.a},{type:a.e},{type:i.Mb},{type:Bn},{type:O.e},{type:i.Db},{type:i.Eb},{type:i.L},{type:z.k},{type:n.k}];const Xn=i.Ob;class Wn{constructor(){this.searchTermChange=new n.u,this.facetValueChange=new n.u,this.lastTerm="",this.lastFacetValueIds=[],this.filterFacetResults=(e,t)=>!!this.isFacetValueItem(t)&&(t.facetValue.name.toLowerCase().startsWith(e.toLowerCase())||t.facetValue.facet.name.toLowerCase().startsWith(e.toLowerCase())),this.isFacetValueItem=e=>"object"==typeof e&&!!e&&e.hasOwnProperty("facetValue")}setSearchTerm(e){if(e)this.selectComponent.select({label:e,value:{label:e}});else{const e=this.selectComponent.selectedItems.find(e=>!this.isFacetValueItem(e.value));e&&this.selectComponent.unselect(e)}}setFacetValues(e){const t=this.selectComponent.items;this.selectComponent.selectedItems.forEach(t=>{this.isFacetValueItem(t.value)&&!e.includes(t.value.facetValue.id)&&this.selectComponent.unselect(t)}),e.map(e=>t.find(t=>this.isFacetValueItem(t)&&t.facetValue.id===e)).filter(w.notNullOrUndefined).forEach(e=>{this.selectComponent.selectedItems.find(t=>{const c=t.value;return!!this.isFacetValueItem(c)&&c.facetValue.id===e.facetValue.id})||this.selectComponent.select({label:"",value:e})})}onSelectChange(e){Array.isArray(e)||(e=[e]);const t=e.find(e=>!this.isFacetValueItem(e)),c=t?t.label:"",n=e.filter(this.isFacetValueItem).map(e=>e.facetValue.id);c!==this.lastTerm&&(this.searchTermChange.emit(c),this.lastTerm=c),this.lastFacetValueIds.join(",")!==n.join(",")&&(this.facetValueChange.emit(n),this.lastFacetValueIds=n)}addTagFn(e){return{label:e}}isSearchHeaderSelected(){return-1===this.selectComponent.itemsList.markedIndex}}Wn.\u0275fac=function(e){return new(e||Wn)},Wn.\u0275cmp=n.Zb({type:Wn,selectors:[["vdr-product-search-input"]],viewQuery:function(e,t){if(1&e&&n.gd(_t,3),2&e){let e;n.Nc(e=n.wc())&&(t.selectComponent=e.first)}},inputs:{facetValueResults:"facetValueResults"},outputs:{searchTermChange:"searchTermChange",facetValueChange:"facetValueChange"},features:[n.Sb([{provide:_.c,useValue:Xn}])],decls:6,vars:9,consts:[[3,"addTag","placeholder","items","searchFn","hideSelected","multiple","markFirst","change"],["selectComponent",""],["ng-header-tmp",""],["ng-label-tmp",""],["ng-option-tmp",""],["class","search-header",3,"selected","click",4,"ngIf"],[1,"search-header",3,"click"],[4,"ngIf"],[3,"facetValue","removable","remove"],[3,"icon","iconClick"],[3,"facetValue","removable"]],template:function(e,t){1&e&&(n.lc(0,"ng-select",0,1),n.vc("change",function(e){return t.onSelectChange(e)}),n.yc(2,"translate"),n.Zc(3,Zt,1,1,"ng-template",2),n.Zc(4,Ut,2,2,"ng-template",3),n.Zc(5,Ht,1,1,"ng-template",4),n.kc()),2&e&&n.Ec("addTag",t.addTagFn)("placeholder",n.zc(2,7,"catalog.search-product-name-or-code"))("items",t.facetValueResults)("searchFn",t.filterFacetResults)("hideSelected",!0)("multiple",!0)("markFirst",!1)},directives:[_.a,_.f,_.e,_.d,z.o,i.bb,i.D],pipes:[G.d],styles:["[_nghost-%COMP%]{margin-top:6px;display:block;width:100%}[_nghost-%COMP%]     .ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value{background:none;margin:0}[_nghost-%COMP%]     .ng-dropdown-panel-items div.ng-option:last-child{display:none}[_nghost-%COMP%]     .ng-dropdown-panel .ng-dropdown-header{border:none;padding:0}[_nghost-%COMP%]     .ng-select.ng-select-multiple .ng-select-container .ng-value-container{padding:0}[_nghost-%COMP%]     .ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-placeholder{padding-left:8px}ng-select[_ngcontent-%COMP%]{width:100%;min-width:300px;margin-right:12px}.search-header[_ngcontent-%COMP%]{padding:8px 10px;border-bottom:1px solid var(--color-component-border-100);cursor:pointer}.search-header.selected[_ngcontent-%COMP%], .search-header[_ngcontent-%COMP%]:hover{background-color:var(--color-component-bg-200)}"],changeDetection:0}),Wn.propDecorators={facetValueResults:[{type:n.E}],searchTermChange:[{type:n.P}],facetValueChange:[{type:n.P}],selectComponent:[{type:n.fb,args:["selectComponent",{static:!0}]}]};class Qn extends i.y{constructor(e,t,c,n,a,o,r){super(o,r),this.dataService=e,this.modalService=t,this.notificationService=c,this.jobQueueService=n,this.serverConfigService=a,this.searchTerm="",this.facetValueIds=[],this.groupByProduct=!0,super.setQueryFn((...e)=>this.dataService.product.searchProducts(this.searchTerm,...e).refetchOnChannelChange(),e=>e.search,(e,t)=>({input:{skip:e,take:t,term:this.searchTerm,facetValueIds:this.facetValueIds,facetValueOperator:i.Cb.AND,groupByProduct:this.groupByProduct}}))}ngOnInit(){super.ngOnInit(),this.facetValues$=this.result$.pipe(Object(r.a)(e=>e.search.facetValues)),this.route.queryParamMap.pipe(Object(r.a)(e=>e.get("q")),Object(l.a)(this.destroy$)).subscribe(e=>{this.productSearchInput.setSearchTerm(e)});const e=this.route.queryParamMap.pipe(Object(r.a)(e=>e.getAll("fvids")));e.pipe(Object(l.a)(this.destroy$)).subscribe(e=>{this.productSearchInput.setFacetValues(e)}),this.facetValues$.pipe(Object(b.a)(1),Object(C.a)(100),Object(y.a)(e)).subscribe(([e,t])=>{this.productSearchInput.setFacetValues(t)}),this.availableLanguages$=this.serverConfigService.getAvailableLanguages(),this.contentLanguage$=this.dataService.client.uiState().mapStream(({uiState:e})=>e.contentLanguage).pipe(Object(m.a)(()=>this.refresh()))}setSearchTerm(e){this.searchTerm=e,this.setQueryParam({q:e||null,page:1}),this.refresh()}setFacetValueIds(e){this.facetValueIds=e,this.setQueryParam({fvids:e,page:1}),this.refresh()}rebuildSearchIndex(){this.dataService.product.reindex().subscribe(({reindex:e})=>{this.notificationService.info(Object(o.a)("catalog.reindexing")),this.jobQueueService.addJob(e.id,e=>{if(e.state===i.tb.COMPLETED){const t=(new Intl.NumberFormat).format(e.duration||0);this.notificationService.success(Object(o.a)("catalog.reindex-successful"),{count:e.result.indexedItemCount,time:t}),this.refresh()}else this.notificationService.error(Object(o.a)("catalog.reindex-error"))})})}deleteProduct(e){this.modalService.dialog({title:Object(o.a)("catalog.confirm-delete-product"),buttons:[{type:"secondary",label:Object(o.a)("common.cancel")},{type:"danger",label:Object(o.a)("common.delete"),returnValue:!0}]}).pipe(Object(u.a)(t=>t?this.dataService.product.deleteProduct(e):T.a),Object(C.a)(500)).subscribe(()=>{this.notificationService.success(Object(o.a)("common.notify-delete-success"),{entity:"Product"}),this.refresh()},e=>{this.notificationService.error(Object(o.a)("common.notify-delete-error"),{entity:"Product"})})}setLanguage(e){this.dataService.client.setContentLanguage(e).subscribe()}}Qn.\u0275fac=function(e){return new(e||Qn)(n.fc(i.L),n.fc(i.Db),n.fc(i.Eb),n.fc(i.sb),n.fc(i.Mb),n.fc(a.e),n.fc(a.a))},Qn.\u0275cmp=n.Zb({type:Qn,selectors:[["vdr-products-list"]],viewQuery:function(e,t){if(1&e&&n.gd(qt,3),2&e){let e;n.Nc(e=n.wc())&&(t.productSearchInput=e.first)}},features:[n.Qb],decls:32,vars:35,consts:[[3,"grow"],[1,"search-form"],[3,"facetValueResults","searchTermChange","facetValueChange"],["productSearchInputComponent",""],[1,"search-settings-menu","mr3"],["type","button","vdrDropdownTrigger","",1,"icon-button"],["shape","cog"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"disabled","click"],[1,"flex","wrap"],[1,"mt2"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],[3,"availableLanguageCodes","currentLanguageCode","languageCodeChange"],["locationId","product-list"],["class","btn btn-primary",3,"routerLink",4,"vdrIfPermissions"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"btn","btn-primary",3,"routerLink"],["shape","plus"],[1,"full-label"],[1,"left","align-middle"],[1,"image-placeholder"],[3,"src",4,"ngIf","ngIfElse"],["imagePlaceholder",""],[1,"align-middle"],[4,"ngIf"],[1,"right","align-middle"],["iconShape","edit",3,"label","linkTo"],["type","button","vdrDropdownTrigger","",1,"btn","btn-link","btn-sm"],["shape","caret down"],["type","button","vdrDropdownItem","",1,"delete-button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"src"],[1,"placeholder"],["shape","image","size","48"]],template:function(e,t){1&e&&(n.lc(0,"vdr-action-bar"),n.lc(1,"vdr-ab-left",0),n.lc(2,"div",1),n.lc(3,"vdr-product-search-input",2,3),n.vc("searchTermChange",function(e){return t.setSearchTerm(e)})("facetValueChange",function(e){return t.setFacetValueIds(e)}),n.yc(5,"async"),n.kc(),n.lc(6,"vdr-dropdown",4),n.lc(7,"button",5),n.gc(8,"clr-icon",6),n.kc(),n.lc(9,"vdr-dropdown-menu",7),n.lc(10,"button",8),n.vc("click",function(){return t.rebuildSearchIndex()}),n.yc(11,"hasPermission"),n.bd(12),n.yc(13,"translate"),n.kc(),n.kc(),n.kc(),n.kc(),n.lc(14,"div",9),n.lc(15,"clr-checkbox-wrapper",10),n.lc(16,"input",11),n.vc("ngModelChange",function(e){return t.groupByProduct=e}),n.kc(),n.lc(17,"label"),n.bd(18),n.yc(19,"translate"),n.kc(),n.kc(),n.lc(20,"vdr-language-selector",12),n.vc("languageCodeChange",function(e){return t.setLanguage(e)}),n.yc(21,"async"),n.yc(22,"async"),n.kc(),n.kc(),n.kc(),n.lc(23,"vdr-ab-right"),n.gc(24,"vdr-action-bar-items",13),n.Zc(25,Rt,5,5,"a",14),n.kc(),n.kc(),n.lc(26,"vdr-data-table",15),n.vc("pageChange",function(e){return t.setPageNumber(e)})("itemsPerPageChange",function(e){return t.setItemsPerPage(e)}),n.yc(27,"async"),n.yc(28,"async"),n.yc(29,"async"),n.yc(30,"async"),n.Zc(31,Jt,24,30,"ng-template"),n.kc()),2&e&&(n.Tb(1),n.Ec("grow",!0),n.Tb(2),n.Ec("facetValueResults",n.zc(5,13,t.facetValues$)),n.Tb(7),n.Ec("disabled",!n.zc(11,15,n.Hc(33,ht))),n.Tb(2),n.dd(" ",n.zc(13,17,"catalog.rebuild-search-index")," "),n.Tb(4),n.Ec("ngModel",t.groupByProduct),n.Tb(2),n.cd(n.zc(19,19,"catalog.group-by-product")),n.Tb(2),n.Ec("availableLanguageCodes",n.zc(21,21,t.availableLanguages$))("currentLanguageCode",n.zc(22,23,t.contentLanguage$)),n.Tb(5),n.Ec("vdrIfPermissions",n.Hc(34,Yt)),n.Tb(1),n.Ec("items",n.zc(27,25,t.items$))("itemsPerPage",n.zc(28,27,t.itemsPerPage$))("totalItems",n.zc(29,29,t.totalItems$))("currentPage",n.zc(30,31,t.currentPage$)))},directives:[i.c,i.e,Wn,i.T,i.W,B.o,i.V,i.U,B.k,i.eb,O.a,B.i,O.p,O.s,B.u,i.wb,i.f,i.d,i.qb,i.N,a.h,z.o,i.Tb,i.D],pipes:[z.b,i.ib,G.d,i.r],styles:[".image-placeholder[_ngcontent-%COMP%]{width:50px;height:50px;background-color:var(--color-component-bg-200)}.image-placeholder[_ngcontent-%COMP%]   .placeholder[_ngcontent-%COMP%]{text-align:center;color:var(--color-grey-300)}.search-form[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%;margin-bottom:6px}.search-input[_ngcontent-%COMP%]{min-width:300px}@media screen and (max-width:768px){.search-input[_ngcontent-%COMP%]{min-width:100px}}.search-settings-menu[_ngcontent-%COMP%]{margin:0 12px}td.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"]}),Qn.ctorParameters=()=>[{type:i.L},{type:i.Db},{type:i.Eb},{type:i.sb},{type:i.Mb},{type:a.e},{type:a.a}],Qn.propDecorators={productSearchInput:[{type:n.fb,args:["productSearchInputComponent",{static:!0}]}]};class Kn{constructor(){this.variants=[]}confirm(){this.resolveWith(!0)}cancel(){this.resolveWith()}}Kn.\u0275fac=function(e){return new(e||Kn)},Kn.\u0275cmp=n.Zb({type:Kn,selectors:[["vdr-confirm-variant-deletion-dialog"]],decls:6,vars:4,consts:[["vdrDialogTitle",""],[4,"ngFor","ngForOf"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"click"]],template:function(e,t){1&e&&(n.Zc(0,ec,2,3,"ng-template",0),n.bd(1),n.yc(2,"translate"),n.lc(3,"ul"),n.Zc(4,tc,2,2,"li",1),n.kc(),n.Zc(5,cc,6,6,"ng-template",2)),2&e&&(n.Tb(1),n.dd("\n",n.zc(2,2,"catalog.confirm-deletion-of-unused-variants-body"),"\n"),n.Tb(3),n.Ec("ngForOf",t.variants))},directives:[i.R,z.n,i.Q],pipes:[G.d],styles:[""],changeDetection:0});class Jn{constructor(e){for(const t of Object.keys(e))this[t]=e[t]}}class Yn{constructor(e,t,c,n,a){this.route=e,this.dataService=t,this.productDetailService=c,this.notificationService=n,this.modalService=a,this.formValueChanged=!1,this.generatedVariants=[]}ngOnInit(){this.initOptionsAndVariants(),this.languageCode=this.route.snapshot.paramMap.get("lang")||Object(i.jc)(),this.dataService.settings.getActiveChannel().single$.subscribe(e=>{this.currencyCode=e.activeChannel.currencyCode})}onFormChanged(e){this.formValueChanged=!0,e.enabled=!0}canDeactivate(){return!this.formValueChanged}getVariantsToAdd(){return this.generatedVariants.filter(e=>!e.existing&&e.enabled)}getVariantName(e){return 0===e.options.length?Object(o.a)("catalog.default-variant"):e.options.map(e=>e.name).join(" ")}addOption(){this.optionGroups.push({isNew:!0,name:"",values:[]})}generateVariants(){const e=this.optionGroups.map(e=>e.values),t=this.generatedVariants,c=(e,c,n,a)=>{var i,o,r,s,l,d;const u=this.getVariantPrototype(c,t);return new Jn({enabled:!0,existing:!!n,productVariantId:null==n?void 0:n.id,isDefault:e,options:c,price:null!==(o=null!==(i=null==n?void 0:n.price)&&void 0!==i?i:null==a?void 0:a.price)&&void 0!==o?o:u.price,sku:null!==(s=null!==(r=null==n?void 0:n.sku)&&void 0!==r?r:null==a?void 0:a.sku)&&void 0!==s?s:u.sku,stock:null!==(d=null!==(l=null==n?void 0:n.stockOnHand)&&void 0!==l?l:null==a?void 0:a.stockOnHand)&&void 0!==d?d:u.stock})};this.generatedVariants=e.length?Object(w.generateAllCombinations)(e).map(e=>{const t=this.product.variants.find(t=>this.optionsAreEqual(t.options,e)),n=this.product.variants.find(t=>this.optionsAreSubset(t.options,e));return c(!1,e,t,n)}):[c(!0,[],this.product.variants[0])]}getVariantPrototype(e,t){return t.filter(t=>e.map(e=>e.name).filter(e=>t.options.map(e=>e.name).includes(e))).length?Object(L.pick)(t[0],["sku","price","stock"]):{sku:"",price:0,stock:0}}deleteVariant(e){this.modalService.dialog({title:Object(o.a)("catalog.confirm-delete-product-variant"),buttons:[{type:"secondary",label:Object(o.a)("common.cancel")},{type:"danger",label:Object(o.a)("common.delete"),returnValue:!0}]}).pipe(Object(u.a)(t=>t?this.productDetailService.deleteProductVariant(e,this.product.id):T.a),Object(u.a)(()=>this.reFetchProduct(null))).subscribe(()=>{this.notificationService.success(Object(o.a)("common.notify-delete-success"),{entity:"ProductVariant"}),this.initOptionsAndVariants()},e=>{this.notificationService.error(Object(o.a)("common.notify-delete-error"),{entity:"ProductVariant"})})}save(){const e=this.optionGroups.filter(e=>e.isNew).map(e=>({name:e.name,values:[]}));this.checkUniqueSkus().pipe(Object(h.a)(()=>this.confirmDeletionOfObsoleteVariants()),Object(h.a)(()=>this.productDetailService.createProductOptionGroups(e,this.languageCode)),Object(h.a)(e=>this.addOptionGroupsToProduct(e)),Object(h.a)(e=>this.addNewOptionsToGroups(e)),Object(h.a)(e=>this.fetchOptionGroups(e)),Object(h.a)(e=>this.createNewProductVariants(e)),Object(h.a)(e=>this.deleteObsoleteVariants(e.createProductVariants)),Object(h.a)(e=>this.reFetchProduct(e))).subscribe({next:e=>{this.formValueChanged=!1,this.notificationService.success(Object(o.a)("catalog.created-new-variants-success"),{count:e.length}),this.initOptionsAndVariants()}})}checkUniqueSkus(){const e=this.generatedVariants.filter((e,t)=>this.generatedVariants.find(t=>t.sku.trim()===e.sku.trim()&&t!==e));return e.length?this.modalService.dialog({title:Object(o.a)("catalog.duplicate-sku-warning"),body:Object(D.unique)(e.map(e=>`${e.sku}`)).join(", "),buttons:[{label:Object(o.a)("common.close"),returnValue:!1,type:"primary"}]}).pipe(Object(h.a)(e=>T.a)):Object(F.a)(!0)}confirmDeletionOfObsoleteVariants(){const e=this.getObsoleteVariants();return e.length?this.modalService.fromComponent(Kn,{locals:{variants:e}}).pipe(Object(h.a)(e=>!0===e?Object(F.a)(!0):T.a)):Object(F.a)(!0)}getObsoleteVariants(){return this.product.variants.filter(e=>!this.generatedVariants.find(t=>t.productVariantId===e.id))}hasOnlyDefaultVariant(e){return 1===e.variants.length&&0===e.optionGroups.length}addOptionGroupsToProduct(e){return e.length?Object(E.a)(e.map(e=>this.dataService.product.addOptionGroupToProduct({productId:this.product.id,optionGroupId:e.id}))).pipe(Object(r.a)(()=>e)):Object(F.a)([])}addNewOptionsToGroups(e){const t=this.optionGroups.map(t=>{const c=e.find(e=>e.name===t.name),n=c?c.id:t.id;if(!n)throw new Error("Could not get a productOptionGroupId");return t.values.filter(e=>!e.locked).map(e=>({productOptionGroupId:n,code:Object(V.normalizeString)(e.name,"-"),translations:[{name:e.name,languageCode:this.languageCode}]}))}).reduce((e,t)=>[...e,...t],[]),c=[...e.map(e=>e.id),...this.optionGroups.map(e=>e.id).filter(w.notNullOrUndefined)];return t.length?Object(E.a)(t.map(e=>this.dataService.product.addOptionToGroup(e))).pipe(Object(r.a)(()=>c)):Object(F.a)(c)}fetchOptionGroups(e){return Object(E.a)(e.map(e=>this.dataService.product.getProductOptionGroup(e).mapSingle(e=>e.productOptionGroup).pipe(Object(k.a)(w.notNullOrUndefined))))}createNewProductVariants(e){const t=e.filter(w.notNullOrUndefined).map(e=>e.options).reduce((e,t)=>[...e,...t],[]),c=this.generatedVariants.filter(e=>e.enabled&&!e.existing).map(e=>({price:e.price,sku:e.sku,stock:e.stock,optionIds:e.options.map(e=>t.find(t=>t.name===e.name)).filter(w.notNullOrUndefined).map(e=>e.id)}));return this.productDetailService.createProductVariants(this.product,c,t,this.languageCode)}deleteObsoleteVariants(e){const t=this.getObsoleteVariants();if(t.length){const c=t.map(t=>this.dataService.product.deleteProductVariant(t.id).pipe(Object(r.a)(()=>e)));return Object(E.a)(...c)}return Object(F.a)(e)}reFetchProduct(e){const t=this.route.snapshot.paramMap.get("id");return t?this.dataService.product.getProduct(t).single$.pipe(Object(r.a)(()=>e)):Object(F.a)(e)}initOptionsAndVariants(){this.dataService.product.getProductVariantsOptions(this.route.snapshot.paramMap.get("id")).mapSingle(({product:e})=>e).subscribe(e=>{this.product=e,this.optionGroups=e.optionGroups.map(e=>({id:e.id,isNew:!1,name:e.name,values:e.options.map(e=>({id:e.id,name:e.name,locked:!0}))})),this.generateVariants()})}optionsAreEqual(e,t){return this.toOptionString(e)===this.toOptionString(t)}optionsAreSubset(e,t){return this.toOptionString(t).includes(this.toOptionString(e))}toOptionString(e){return e.map(e=>e.name).sort().join("|")}}Yn.\u0275fac=function(e){return new(e||Yn)(n.fc(a.a),n.fc(i.L),n.fc(Bn),n.fc(i.Eb),n.fc(i.Db))},Yn.\u0275cmp=n.Zb({type:Yn,selectors:[["vdr-product-variants-editor"]],decls:31,vars:27,consts:[[1,"btn","btn-primary",3,"disabled","click"],["class","option-groups",4,"ngFor","ngForOf"],[1,"btn","btn-primary-outline","btn-sm",3,"click"],["shape","plus"],[1,"variants-preview"],[1,"table"],[3,"disabled",4,"ngFor","ngForOf"],[1,"option-groups"],[1,"name"],["clrInput","","name","name",3,"ngModel","readonly","ngModelChange"],[1,"values"],[3,"ngModel","groupName","disabled","ngModelChange"],["optionValueInputComponent",""],["type","checkbox","name","enabled","clrCheckbox","",3,"ngModel","ngModelChange",4,"ngIf"],[4,"ngIf"],["type","checkbox","name","enabled","clrCheckbox","",3,"ngModel","ngModelChange"],["clrInput","","type","text","name","sku","required","",3,"ngModel","placeholder","ngModelChange"],["clrInput","","name","price",3,"ngModel","currencyCode","ngModelChange"],["clrInput","","type","number","name","stock","min","0","step","1",3,"ngModel","ngModelChange"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"delete-button",3,"click"],["shape","trash",1,"is-danger"]],template:function(e,t){1&e&&(n.lc(0,"vdr-action-bar"),n.lc(1,"vdr-ab-right"),n.lc(2,"button",0),n.vc("click",function(){return t.save()}),n.bd(3),n.yc(4,"translate"),n.kc(),n.kc(),n.kc(),n.Zc(5,nc,12,11,"div",1),n.lc(6,"button",2),n.vc("click",function(){return t.addOption()}),n.gc(7,"clr-icon",3),n.bd(8),n.yc(9,"translate"),n.kc(),n.lc(10,"div",4),n.lc(11,"table",5),n.lc(12,"thead"),n.lc(13,"tr"),n.lc(14,"th"),n.bd(15),n.yc(16,"translate"),n.kc(),n.lc(17,"th"),n.bd(18),n.yc(19,"translate"),n.kc(),n.lc(20,"th"),n.bd(21),n.yc(22,"translate"),n.kc(),n.lc(23,"th"),n.bd(24),n.yc(25,"translate"),n.kc(),n.lc(26,"th"),n.bd(27),n.yc(28,"translate"),n.kc(),n.gc(29,"th"),n.kc(),n.kc(),n.Zc(30,pc,17,13,"tr",6),n.kc(),n.kc()),2&e&&(n.Tb(2),n.Ec("disabled",!t.formValueChanged||0===t.getVariantsToAdd().length),n.Tb(1),n.dd(" ",n.Ac(4,10,"common.add-new-variants",n.Ic(25,ge,t.getVariantsToAdd().length))," "),n.Tb(2),n.Ec("ngForOf",t.optionGroups),n.Tb(3),n.dd(" ",n.zc(9,13,"catalog.add-option"),"\n"),n.Tb(7),n.cd(n.zc(16,15,"common.create")),n.Tb(3),n.cd(n.zc(19,17,"catalog.variant")),n.Tb(3),n.cd(n.zc(22,19,"catalog.sku")),n.Tb(3),n.cd(n.zc(25,21,"catalog.price")),n.Tb(3),n.cd(n.zc(28,23,"catalog.stock-on-hand")),n.Tb(3),n.Ec("ngForOf",t.generatedVariants))},directives:function(){return[i.c,i.f,z.n,B.o,B.u,i.eb,O.b,B.s,O.p,O.s,Ta,z.o,O.a,B.i,B.t,O.z,i.H,O.v,i.T,i.W,i.V,i.U]},pipes:function(){return[G.d,i.zb]},styles:[".option-groups[_ngcontent-%COMP%]{display:flex}.option-groups[_ngcontent-%COMP%]:first-of-type{margin-top:24px}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}"]}),Yn.ctorParameters=()=>[{type:a.a},{type:i.L},{type:Bn},{type:i.Eb},{type:i.Db}];class ea extends i.x{constructor(e,t){super(e,{__typename:"Asset",id:"",createdAt:"",updatedAt:"",name:"",type:i.t.IMAGE,fileSize:0,mimeType:"",width:0,height:0,source:"",preview:"",focalPoint:null},e=>t.product.getAsset(e).mapStream(e=>e.asset))}}ea.\u0275fac=function(e){return new(e||ea)(n.sc(a.e),n.sc(i.L))},ea.\u0275prov=Object(n.bc)({factory:function(){return new ea(Object(n.sc)(a.e),Object(n.sc)(i.L))},token:ea,providedIn:"root"}),ea.ctorParameters=()=>[{type:a.e},{type:i.L}];class ta extends i.x{constructor(e,t){super(e,{__typename:"Collection",id:"",createdAt:"",updatedAt:"",languageCode:Object(i.jc)(),name:"",slug:"",isPrivate:!1,description:"",featuredAsset:null,assets:[],translations:[],filters:[],parent:{},children:null},e=>t.collection.getCollection(e).mapStream(e=>e.collection))}}ta.\u0275fac=function(e){return new(e||ta)(n.sc(a.e),n.sc(i.L))},ta.\u0275prov=Object(n.bc)({factory:function(){return new ta(Object(n.sc)(a.e),Object(n.sc)(i.L))},token:ta,providedIn:"root"}),ta.ctorParameters=()=>[{type:a.e},{type:i.L}];class ca extends i.x{constructor(e,t){super(e,{__typename:"Facet",id:"",createdAt:"",updatedAt:"",isPrivate:!1,languageCode:Object(i.jc)(),name:"",code:"",translations:[],values:[]},e=>t.facet.getFacet(e).mapStream(e=>e.facet))}}ca.\u0275fac=function(e){return new(e||ca)(n.sc(a.e),n.sc(i.L))},ca.\u0275prov=Object(n.bc)({factory:function(){return new ca(Object(n.sc)(a.e),Object(n.sc)(i.L))},token:ca,providedIn:"root"}),ca.ctorParameters=()=>[{type:a.e},{type:i.L}];class na extends i.x{constructor(e,t){super(t,{__typename:"Product",id:"",createdAt:"",updatedAt:"",enabled:!0,languageCode:Object(i.jc)(),name:"",slug:"",featuredAsset:null,assets:[],description:"",translations:[],optionGroups:[],facetValues:[],variants:[],channels:[]},t=>e.product.getProduct(t).refetchOnChannelChange().mapStream(e=>e.product))}}na.\u0275fac=function(e){return new(e||na)(n.sc(i.L),n.sc(a.e))},na.\u0275prov=Object(n.bc)({factory:function(){return new na(Object(n.sc)(i.L),Object(n.sc)(a.e))},token:na,providedIn:"root"}),na.ctorParameters=()=>[{type:i.L},{type:a.e}];class aa extends i.x{constructor(e,t){super(e,{__typename:"Product",id:"",createdAt:"",updatedAt:"",name:"",optionGroups:[],variants:[]},e=>t.product.getProductVariantsOptions(e).mapStream(e=>e.product))}}aa.\u0275fac=function(e){return new(e||aa)(n.sc(a.e),n.sc(i.L))},aa.\u0275prov=Object(n.bc)({factory:function(){return new aa(Object(n.sc)(a.e),Object(n.sc)(i.L))},token:aa,providedIn:"root"}),aa.ctorParameters=()=>[{type:a.e},{type:i.L}];const ia={breadcrumb:Object(o.a)("breadcrumb.products")},oa={breadcrumb:ba},ra={breadcrumb:ha},sa={breadcrumb:Object(o.a)("breadcrumb.facets")},la={breadcrumb:fa},da={breadcrumb:Object(o.a)("breadcrumb.collections")},ua={breadcrumb:va},pa={breadcrumb:Object(o.a)("breadcrumb.assets")},ga={breadcrumb:ya},ma=[{path:"products",component:Qn,data:ia},{path:"products/:id",component:Rn,resolve:Object(i.ac)(na),canDeactivate:[i.z],data:oa},{path:"products/:id/manage-variants",component:Yn,resolve:Object(i.ac)(aa),canDeactivate:[i.z],data:ra},{path:"facets",component:Gn,data:sa},{path:"facets/:id",component:Nn,resolve:Object(i.ac)(ca),canDeactivate:[i.z],data:la},{path:"collections",component:Zn,data:da},{path:"collections/:id",component:Ln,resolve:Object(i.ac)(ta),canDeactivate:[i.z],data:ua},{path:"assets",component:$n,data:pa},{path:"assets/:id",component:Dn,resolve:Object(i.ac)(ea),data:ga}];function ba(e,t){return Object(i.cc)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.products",getName:e=>e.name,route:"products"})}function ha(e,t){return e.entity.pipe(Object(r.a)(e=>[{label:Object(o.a)("breadcrumb.products"),link:["../","products"]},{label:`${e.name}`,link:["../","products",t.id,{tab:"variants"}]},{label:Object(o.a)("breadcrumb.manage-variants"),link:["manage-variants"]}]))}function fa(e,t){return Object(i.cc)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.facets",getName:e=>e.name,route:"facets"})}function va(e,t){return Object(i.cc)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.collections",getName:e=>e.name,route:"collections"})}function ya(e,t){return Object(i.cc)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.assets",getName:e=>e.name,route:"assets"})}function Ca(e,t){var c,n;const a=[],i={},o=function(e){const t=new Map;function c(e){t.set(e.id,e),e.children.forEach(c)}e&&c(e);return t}(t);for(const r of e)i[r.id]=Object.assign(Object.assign({},r),{children:[]});for(const r of e.map(e=>e.id))if(i.hasOwnProperty(r)){const e=i[r];e.expanded=null!==(n=null===(c=o.get(r))||void 0===c?void 0:c.expanded)&&void 0!==n&&n;const t=e.parent;if(!t)continue;!i[t.id]?a.push(e):i[t.id]?i[t.id].children.push(e):i[t.id]={children:[e]}}return{id:a.length?a[0].parent.id:void 0,children:a}}class ka{constructor(){this.expandAll=!1,this.rearrange=new n.u,this.deleteCollection=new n.u}ngOnChanges(e){"collections"in e&&this.collections&&(this.collectionTree=Ca(this.collections,this.collectionTree))}onDrop(e){const t=e.item.data,c=e.container.data.id;if(null==c)throw new Error("Could not determine the ID of the root Collection");this.rearrange.emit({collectionId:t.id,parentId:c,index:e.currentIndex})}onMove(e){this.rearrange.emit(e)}onDelete(e){this.deleteCollection.emit(e)}isRootNode(e){return!e.hasOwnProperty("parent")}}ka.\u0275fac=function(e){return new(e||ka)},ka.\u0275cmp=n.Zb({type:ka,selectors:[["vdr-collection-tree"]],inputs:{expandAll:"expandAll",collections:"collections",activeCollectionId:"activeCollectionId"},outputs:{rearrange:"rearrange",deleteCollection:"deleteCollection"},features:[n.Rb],decls:1,vars:1,consts:[["cdkDropListGroup","",3,"expandAll","collectionTree","activeCollectionId",4,"ngIf"],["cdkDropListGroup","",3,"expandAll","collectionTree","activeCollectionId"]],template:function(e,t){1&e&&n.Zc(0,gc,1,3,"vdr-collection-tree-node",0),2&e&&n.Ec("ngIf",t.collectionTree)},directives:function(){return[z.o,Oa,Z.d]},styles:[""],changeDetection:0}),ka.propDecorators={collections:[{type:n.E}],activeCollectionId:[{type:n.E}],expandAll:[{type:n.E}],rearrange:[{type:n.P}],deleteCollection:[{type:n.P}]};class Oa{constructor(e,t,c){this.parent=e,this.root=t,this.dataService=c,this.depth=0,this.expandAll=!1,e&&(this.depth=e.depth+1)}ngOnInit(){this.parentName=this.collectionTree.name||"<root>";const e=this.dataService.client.userStatus().mapStream(e=>e.userStatus.permissions).pipe(Object(f.a)(1));this.hasUpdatePermission$=e.pipe(Object(r.a)(e=>e.includes(i.Ib.UpdateCatalog)||e.includes(i.Ib.UpdateCollection))),this.hasDeletePermission$=e.pipe(Object(r.a)(e=>e.includes(i.Ib.DeleteCatalog)||e.includes(i.Ib.DeleteCollection)))}ngOnChanges(e){const t=e.expandAll;t&&!0===t.previousValue&&!1===t.currentValue&&this.collectionTree.children.forEach(e=>e.expanded=!1)}trackByFn(e,t){return t.id}getMoveListItems(e){const t=(c,n,a)=>{if(c.id!==e.id){const i=n.concat(c.name),o=e.parent&&e.parent.id;c.id!==o&&a.push({path:i.slice(1).join(" / ")||"root",id:c.id}),c.children.forEach(e=>t(e,i,a))}return a};return t(this.root.collectionTree,[],[])}move(e,t){this.root.onMove({index:0,parentId:t,collectionId:e.id})}moveUp(e,t){e.parent&&this.root.onMove({index:t-1,parentId:e.parent.id,collectionId:e.id})}moveDown(e,t){e.parent&&this.root.onMove({index:t+1,parentId:e.parent.id,collectionId:e.id})}drop(e){Object(Z.f)(this.collectionTree.children,e.previousIndex,e.currentIndex),this.root.onDrop(e)}delete(e){this.root.onDelete(e)}}Oa.\u0275fac=function(e){return new(e||Oa)(n.fc(Oa,12),n.fc(ka),n.fc(i.L))},Oa.\u0275cmp=n.Zb({type:Oa,selectors:[["vdr-collection-tree-node"]],inputs:{expandAll:"expandAll",collectionTree:"collectionTree",activeCollectionId:"activeCollectionId"},features:[n.Rb],decls:4,vars:6,consts:[["cdkDropList","",1,"tree-node",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped"],["dropList",""],["class","collection","cdkDrag","",3,"private","cdkDragData",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",1,"collection",3,"cdkDragData"],[1,"collection-detail",3,"ngClass"],[1,"name"],["class","icon-button folder-button",3,"disabled","click",4,"ngIf","ngIfElse"],["folderSpacer",""],[1,"flex-spacer"],[4,"ngIf"],["queryParamsHandling","preserve",1,"btn","btn-link","btn-sm",3,"routerLink"],["shape","view-list"],[1,"btn","btn-link","btn-sm",3,"routerLink"],["shape","edit"],["class","drag-handle","cdkDragHandle","",4,"vdrIfPermissions"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["class","dropdown-item",3,"routerLink",4,"vdrIfPermissions"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",3,"disabled","click"],["shape","caret up"],["shape","caret down"],[1,"dropdown-header"],["type","button","vdrDropdownItem","",3,"disabled","click",4,"ngFor","ngForOf"],["vdrDropdownItem","",1,"button",3,"disabled","click"],["shape","trash",1,"is-danger"],[3,"expandAll","collectionTree","activeCollectionId",4,"ngIf"],[1,"icon-button","folder-button",3,"disabled","click"],["shape","folder",4,"ngIf"],["shape","folder-open",4,"ngIf"],["shape","folder"],["shape","folder-open"],[1,"folder-button-spacer"],["cdkDragHandle","",1,"drag-handle"],["shape","drag-handle","size","24"],[1,"dropdown-item",3,"routerLink"],["shape","plus"],[1,"move-to-item"],[1,"move-icon"],["shape","child-arrow"],[1,"path"],[3,"expandAll","collectionTree","activeCollectionId"]],template:function(e,t){1&e&&(n.lc(0,"div",0,1),n.vc("cdkDropListDropped",function(e){return t.drop(e)}),n.yc(2,"async"),n.Zc(3,Ec,45,51,"div",2),n.kc()),2&e&&(n.Ec("cdkDropListData",t.collectionTree)("cdkDropListDisabled",!n.zc(2,4,t.hasUpdatePermission$)),n.Tb(3),n.Ec("ngForOf",t.collectionTree.children)("ngForTrackBy",t.trackByFn))},directives:[Z.c,z.n,B.l,Z.a,z.m,z.o,a.h,B.o,i.qb,i.T,i.W,i.V,i.U,i.D,Z.b,Oa],pipes:[z.b,G.d],styles:["[_nghost-%COMP%]{display:block}.collection[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);font-size:.65rem;transition:transform .25s cubic-bezier(0,0,.2,1);margin-bottom:2px;border-left:2px solid transparent;transition:border-left-color .2s}.collection.private[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]{padding:6px 12px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--color-component-border-100)}.collection[_ngcontent-%COMP%]   .collection-detail.active[_ngcontent-%COMP%]{background-color:var(--clr-global-selection-color)}.collection[_ngcontent-%COMP%]   .collection-detail.depth-1[_ngcontent-%COMP%]{padding-left:36px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-2[_ngcontent-%COMP%]{padding-left:60px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-3[_ngcontent-%COMP%]{padding-left:84px}.collection[_ngcontent-%COMP%]   .collection-detail.depth-4[_ngcontent-%COMP%]{padding-left:108px}.collection[_ngcontent-%COMP%]   .collection-detail[_ngcontent-%COMP%]   .folder-button-spacer[_ngcontent-%COMP%]{display:inline-block;width:28px}.tree-node[_ngcontent-%COMP%]{display:block;background:var(--color-component-bg-100);overflow:hidden}.tree-node.cdk-drop-list-dragging[_ngcontent-%COMP%] > .collection[_ngcontent-%COMP%]{border-left-color:var(--color-primary-300)}.drag-placeholder[_ngcontent-%COMP%]{min-height:120px;background-color:var(--color-component-bg-300);transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%], .example-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .tree-node[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.move-to-item[_ngcontent-%COMP%]{display:flex;white-space:normal;align-items:baseline}.move-to-item[_ngcontent-%COMP%]   .move-icon[_ngcontent-%COMP%]{flex:none;margin-right:3px}.move-to-item[_ngcontent-%COMP%]   .path[_ngcontent-%COMP%]{line-height:18px}"],changeDetection:0}),Oa.ctorParameters=()=>[{type:Oa,decorators:[{type:n.Z},{type:n.O}]},{type:ka},{type:i.L}],Oa.propDecorators={collectionTree:[{type:n.E}],activeCollectionId:[{type:n.E}],expandAll:[{type:n.E}]};class Pa{constructor(e){this.dataService=e,this.variantsChange=new n.u,this.optionGroups=[],this.variantFormValues={}}ngOnInit(){this.dataService.settings.getActiveChannel().single$.subscribe(e=>{this.currencyCode=e.activeChannel.currencyCode}),this.generateVariants()}addOption(){this.optionGroups.push({name:"",values:[]})}removeOption(e){this.optionGroups=this.optionGroups.filter(t=>t.name!==e),this.generateVariants()}generateVariants(){const e=this.optionGroups.reduce((e,t)=>e+t.values.length,0)?this.optionGroups.map(e=>e.values.map(e=>e.name)):[["__DEFAULT_VARIANT__"]];this.variants=Object(w.generateAllCombinations)(e).map(e=>({id:e.join("|"),values:e})),this.variants.forEach(e=>{this.variantFormValues[e.id]||(this.variantFormValues[e.id]={optionValues:e.values,enabled:!0,price:this.copyFromDefault(e.id,"price",0),sku:this.copyFromDefault(e.id,"sku",""),stock:this.copyFromDefault(e.id,"stock",0)})}),this.onFormChange()}trackByFn(e,t){return t.values.join("|")}handleEnter(e,t){e.preventDefault(),e.stopPropagation(),t.focus()}onFormChange(){const e=this.variants.map(e=>this.variantFormValues[e.id]).filter(e=>e.enabled);this.variantsChange.emit({groups:this.optionGroups.map(e=>({name:e.name,values:e.values.map(e=>e.name)})),variants:e})}copyFromDefault(e,t,c){return"__DEFAULT_VARIANT__"!==e?this.variantFormValues.__DEFAULT_VARIANT__[t]:c}}Pa.\u0275fac=function(e){return new(e||Pa)(n.fc(i.L))},Pa.\u0275cmp=n.Zb({type:Pa,selectors:[["vdr-generate-product-variants"]],outputs:{variantsChange:"variantsChange"},decls:21,vars:17,consts:[["class","option-groups",4,"ngFor","ngForOf"],[1,"btn","btn-primary-outline","btn-sm",3,"click"],["shape","plus"],[1,"variants-preview"],[1,"table"],[4,"ngIf"],[3,"disabled",4,"ngFor","ngForOf","ngForTrackBy"],[1,"option-groups"],[1,"name"],["placeholder","e.g. Size","clrInput","","name","name","required","",3,"ngModel","ngModelChange","keydown.enter"],[1,"values"],[3,"ngModel","groupName","disabled","ngModelChange"],["optionValueInputComponent",""],[1,"remove-group"],[1,"btn","btn-icon","btn-warning-outline",3,"title","click"],["shape","trash"],["clrInput","","type","text",3,"ngModel","placeholder","change","ngModelChange"],["clrInput","",3,"ngModel","currencyCode","ngModelChange"],["clrInput","","type","number","min","0","step","1",3,"ngModel","ngModelChange","change"],["type","checkbox","clrCheckbox","",3,"ngModel","change","ngModelChange"]],template:function(e,t){1&e&&(n.Zc(0,Sc,16,13,"div",0),n.lc(1,"button",1),n.vc("click",function(){return t.addOption()}),n.gc(2,"clr-icon",2),n.bd(3),n.yc(4,"translate"),n.kc(),n.lc(5,"div",3),n.lc(6,"table",4),n.lc(7,"thead"),n.lc(8,"tr"),n.Zc(9,jc,3,3,"th",5),n.Zc(10,Mc,3,3,"th",5),n.lc(11,"th"),n.bd(12),n.yc(13,"translate"),n.kc(),n.lc(14,"th"),n.bd(15),n.yc(16,"translate"),n.kc(),n.lc(17,"th"),n.bd(18),n.yc(19,"translate"),n.kc(),n.kc(),n.kc(),n.Zc(20,zc,13,11,"tr",6),n.kc(),n.kc()),2&e&&(n.Ec("ngForOf",t.optionGroups),n.Tb(3),n.dd(" ",n.zc(4,9,"catalog.add-option"),"\n"),n.Tb(6),n.Ec("ngIf",1<t.variants.length),n.Tb(1),n.Ec("ngIf",1<t.variants.length),n.Tb(2),n.cd(n.zc(13,11,"catalog.sku")),n.Tb(3),n.cd(n.zc(16,13,"catalog.price")),n.Tb(3),n.cd(n.zc(19,15,"catalog.stock-on-hand")),n.Tb(2),n.Ec("ngForOf",t.variants)("ngForTrackBy",t.trackByFn))},directives:function(){return[z.n,B.o,z.o,B.l,B.u,i.eb,O.b,B.s,O.z,O.p,O.s,Ta,B.t,i.H,O.v,O.a,B.i]},pipes:function(){return[G.d]},styles:["[_nghost-%COMP%]{display:block;margin-bottom:120px}.option-groups[_ngcontent-%COMP%]{display:flex}.values[_ngcontent-%COMP%]{flex:1;margin:0 6px}.remove-group[_ngcontent-%COMP%]{padding-top:18px}.variants-preview[_ngcontent-%COMP%]   tr.disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100);color:var(--color-grey-400)}"]}),Pa.ctorParameters=()=>[{type:i.L}],Pa.propDecorators={variantsChange:[{type:n.P}]};const xa={provide:O.n,useExisting:Object(n.lb)(()=>Ta),multi:!0};class Ta{constructor(e){this.changeDetector=e,this.groupName="",this.disabled=!1,this.input="",this.isFocussed=!1,this.lastSelected=!1}registerOnChange(e){this.onChangeFn=e}registerOnTouched(e){this.onTouchFn=e}setDisabledState(e){this.disabled=e,this.changeDetector.markForCheck()}writeValue(e){this.options=e||[]}focus(){this.textArea.nativeElement.focus()}removeOption(e){e.locked||(this.options=this.options.filter(t=>t.name!==e.name),this.onChangeFn(this.options))}handleKey(e){switch(e.key){case",":case"Enter":this.addOptionValue(),e.preventDefault();break;case"Backspace":this.lastSelected?(this.removeLastOption(),this.lastSelected=!1):""===this.input&&(this.lastSelected=!0);break;default:this.lastSelected=!1}}handleBlur(){this.isFocussed=!1,this.addOptionValue()}addOptionValue(){this.options=Object(D.unique)([...this.options,...this.parseInputIntoOptions(this.input)]),this.input="",this.onChangeFn(this.options)}parseInputIntoOptions(e){return e.split(/[,\n]/).map(e=>e.trim()).filter(e=>""!==e).map(e=>({name:e,locked:!1}))}removeLastOption(){this.options[this.options.length-1].locked||(this.options=this.options.slice(0,this.options.length-1))}}Ta.\u0275fac=function(e){return new(e||Ta)(n.fc(n.k))},Ta.\u0275cmp=n.Zb({type:Ta,selectors:[["vdr-option-value-input"]],viewQuery:function(e,t){if(1&e&&n.gd(Ac,3),2&e){let e;n.Nc(e=n.wc())&&(t.textArea=e.first)}},inputs:{groupName:"groupName"},features:[n.Sb([xa])],decls:4,vars:5,consts:[[1,"input-wrapper",3,"click"],["class","chips",4,"ngIf"],[3,"ngModel","disabled","keyup","focus","blur","ngModelChange"],["textArea",""],[1,"chips"],[3,"icon","selected","locked","colorFrom","iconClick",4,"ngFor","ngForOf"],[3,"icon","colorFrom","iconClick"]],template:function(e,t){if(1&e){const e=n.mc();n.lc(0,"div",0),n.vc("click",function(){n.Sc(e);return n.Oc(3).focus()}),n.Zc(1,$c,2,1,"div",1),n.lc(2,"textarea",2,3),n.vc("keyup",function(e){return t.handleKey(e)})("focus",function(){return t.isFocussed=!0})("blur",function(){return t.handleBlur()})("ngModelChange",function(e){return t.input=e}),n.kc(),n.kc()}2&e&&(n.Xb("focus",t.isFocussed),n.Tb(1),n.Ec("ngIf",0<t.options.length),n.Tb(1),n.Ec("ngModel",t.input)("disabled",t.disabled))},directives:[z.o,i.eb,O.b,O.p,O.s,z.n,i.D],styles:[".input-wrapper[_ngcontent-%COMP%]{background-color:#fff;border-radius:3px!important;border:1px solid var(--color-grey-300)!important;cursor:text}.input-wrapper.focus[_ngcontent-%COMP%]{border-color:var(--color-primary-500)!important;box-shadow:0 0 1px 1px var(--color-primary-100)}.input-wrapper[_ngcontent-%COMP%]   .chips[_ngcontent-%COMP%]{padding:5px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:none;width:100%;height:24px;margin-top:3px;padding:0 6px}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none}.input-wrapper[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:disabled{background-color:var(--color-component-bg-100)}vdr-chip[_ngcontent-%COMP%]     .wrapper{margin:0 3px}vdr-chip.locked[_ngcontent-%COMP%]{opacity:.8}vdr-chip.selected[_ngcontent-%COMP%]     .wrapper{border-color:var(--color-warning-500)!important;box-shadow:0 0 1px 1px var(--color-warning-400);opacity:.6}"]}),Ta.ctorParameters=()=>[{type:n.k}],Ta.propDecorators={groupName:[{type:n.E}],textArea:[{type:n.fb,args:["textArea",{static:!0}]}]};class Ia{constructor(e,t,c,a){this.modalService=e,this.changeDetector=t,this.viewportRuler=c,this.collectionDetailComponent=a,this.compact=!1,this.change=new n.u,this.assets=[],this.updateCollectionPermissions=[i.Ib.UpdateCatalog,i.Ib.UpdateCollection],this.updateProductPermissions=[i.Ib.UpdateCatalog,i.Ib.UpdateProduct]}set assetsSetter(e){this.assets=e.slice()}get updatePermissions(){return this.collectionDetailComponent?this.updateCollectionPermissions:this.updateProductPermissions}selectAssets(){this.modalService.fromComponent(i.o,{size:"xl"}).subscribe(e=>{e&&e.length&&(this.assets=Object(D.unique)(this.assets.concat(e),"id"),this.featuredAsset||(this.featuredAsset=e[0]),this.emitChangeEvent(this.assets,this.featuredAsset),this.changeDetector.markForCheck())})}setAsFeatured(e){this.featuredAsset=e,this.emitChangeEvent(this.assets,e)}isFeatured(e){return!!this.featuredAsset&&this.featuredAsset.id===e.id}previewAsset(e){this.modalService.fromComponent(i.q,{size:"xl",closable:!0,locals:{asset:e}}).subscribe()}removeAsset(e){this.assets=this.assets.filter(t=>t.id!==e.id),this.featuredAsset&&this.featuredAsset.id===e.id&&(this.featuredAsset=this.assets.length>0?this.assets[0]:void 0),this.emitChangeEvent(this.assets,this.featuredAsset)}emitChangeEvent(e,t){this.change.emit({assets:e,featuredAsset:t})}dropListDropped(e){Object(Z.f)(this.assets,e.previousContainer.data,e.container.data),this.emitChangeEvent(this.assets,this.featuredAsset)}}Ia.\u0275fac=function(e){return new(e||Ia)(n.fc(i.Db),n.fc(n.k),n.fc(N.d),n.fc(Ln,8))},Ia.\u0275cmp=n.Zb({type:Ia,selectors:[["vdr-product-assets"]],hostVars:2,hostBindings:function(e,t){2&e&&n.Xb("compact",t.compact)},inputs:{compact:"compact",assetsSetter:["assets","assetsSetter"],featuredAsset:"featuredAsset"},outputs:{change:"change"},decls:5,vars:2,consts:[["class","card",4,"ngIf","ngIfElse"],["compactView",""],["assetList",""],[1,"card"],[1,"card-img"],[1,"featured-asset"],[3,"src","click",4,"ngIf"],["class","placeholder",3,"click",4,"ngIf"],[1,"card-block"],[4,"ngTemplateOutlet"],["class","card-footer",4,"vdrIfPermissions"],[3,"src","click"],[1,"placeholder",3,"click"],["shape","image","size","128"],[1,"card-footer"],[1,"btn",3,"click"],["shape","attachment"],[1,"featured-asset","compact"],["class","compact-select btn btn-icon btn-sm btn-block",3,"title","click",4,"vdrIfPermissions"],["shape","image","size","150"],[1,"compact-select","btn","btn-icon","btn-sm","btn-block",3,"title","click"],["cdkDropListGroup","",1,"all-assets"],["class","drop-list","cdkDropList","","cdkDropListOrientation","horizontal",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped",4,"ngFor","ngForOf"],["cdkDropList","","cdkDropListOrientation","horizontal",1,"drop-list",3,"cdkDropListData","cdkDropListDisabled","cdkDropListDropped"],["cdkDrag",""],["vdrDropdownTrigger","","tabindex","0",1,"asset-thumb",3,"title"],[3,"src"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"click"],["type","button","vdrDropdownItem","",3,"disabled","click"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",1,"remove-asset",3,"disabled","click"]],template:function(e,t){if(1&e&&(n.Zc(0,Gc,8,4,"div",0),n.Zc(1,Rc,5,4,"ng-template",null,1,n.ad),n.Zc(3,Wc,2,3,"ng-template",null,2,n.ad)),2&e){const e=n.Oc(2);n.Ec("ngIf",!t.compact)("ngIfElse",e)}},directives:[z.o,z.t,i.qb,B.o,Z.d,z.n,Z.c,i.T,Z.a,i.W,i.V,i.U],pipes:[i.r,G.d,i.ib],styles:["[_nghost-%COMP%]{width:340px;display:block}.compact[_nghost-%COMP%]{width:162px}.placeholder[_ngcontent-%COMP%]{text-align:center;color:var(--color-grey-300)}.featured-asset[_ngcontent-%COMP%]{text-align:center;background:var(--color-component-bg-200);padding:6px;cursor:pointer}.featured-asset.compact[_ngcontent-%COMP%]{width:100%;min-height:40px;position:relative;padding:6px}.featured-asset[_ngcontent-%COMP%]   .compact-select[_ngcontent-%COMP%]{position:absolute;bottom:6px;right:6px;margin:0}.all-assets[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.all-assets[_ngcontent-%COMP%]   .drop-list[_ngcontent-%COMP%]{min-width:60px}.all-assets[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:3px;padding:0;border:2px solid var(--color-component-border-100);cursor:pointer}.all-assets[_ngcontent-%COMP%]   .asset-thumb.featured[_ngcontent-%COMP%]{border-color:var(--color-primary-500)}.all-assets[_ngcontent-%COMP%]   .remove-asset[_ngcontent-%COMP%]{color:var(--color-warning-500)}.all-assets.compact[_ngcontent-%COMP%]   .drop-list[_ngcontent-%COMP%]{min-width:54px}.all-assets.compact[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{margin:1px;border-width:1px}.all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%], .all-assets.compact[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]   .asset-thumb[_ngcontent-%COMP%]{width:50px}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-box[_ngcontent-%COMP%]:last-child{border:none}.all-assets.cdk-drop-list-dragging[_ngcontent-%COMP%]   vdr-dropdown[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(.cdk-drag-placeholder){display:none}"],changeDetection:0}),Ia.ctorParameters=()=>[{type:i.Db},{type:n.k},{type:N.d},{type:Ln,decorators:[{type:n.O}]}],Ia.propDecorators={assetsSetter:[{type:n.E,args:["assets"]}],featuredAsset:[{type:n.E}],compact:[{type:n.w,args:["class.compact"]},{type:n.E}],change:[{type:n.P}]};class Fa{constructor(){this.updateVariantName=!0,this.codeInputTouched=!1}ngOnInit(){var e;const t=this.productOption.translations.find(e=>e.languageCode===this.activeLanguage);if(this.name=null!==(e=null==t?void 0:t.name)&&void 0!==e?e:"",this.code=this.productOption.code,this.customFieldsForm=new O.i({}),this.customFields){const e=t&&t.customFields||{};for(const t of this.customFields){const c=t.name,n="localeString"===t.type?e[c]:this.productOption.customFields[c];this.customFieldsForm.addControl(t.name,new O.f(n))}}}update(){const e=Object(i.bc)({translatable:this.productOption,languageCode:this.activeLanguage,updatedFields:{code:this.code,name:this.name,customFields:this.customFieldsForm.value},customFieldConfig:this.customFields,defaultTranslation:{languageCode:this.activeLanguage,name:""}});this.resolveWith(Object.assign(Object.assign({},e),{autoUpdate:this.updateVariantName}))}cancel(){this.resolveWith()}updateCode(e){this.codeInputTouched||this.productOption.code||(this.code=Object(V.normalizeString)(e,"-"))}}Fa.\u0275fac=function(e){return new(e||Fa)},Fa.\u0275cmp=n.Zb({type:Fa,selectors:[["vdr-update-product-option-dialog"]],decls:16,vars:13,consts:[["vdrDialogTitle",""],["for","name",3,"label"],["id","name","type","text","required","",3,"ngModel","ngModelChange","input"],["nameInput","ngModel"],["for","code",3,"label"],["id","code","type","text","required","","pattern","[a-z0-9_-]+",3,"ngModel","ngModelChange"],["codeInput","ngModel"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],[4,"ngIf"],["vdrDialogButtons",""],[4,"ngFor","ngForOf"],["entityName","ProductOption",3,"customFieldsFormGroup","customField","readonly",4,"ngIf"],["entityName","ProductOption",3,"customFieldsFormGroup","customField","readonly"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(n.Zc(0,Qc,2,3,"ng-template",0),n.lc(1,"vdr-form-field",1),n.yc(2,"translate"),n.lc(3,"input",2,3),n.vc("ngModelChange",function(e){return t.name=e})("input",function(e){return t.updateCode(e.target.value)}),n.kc(),n.kc(),n.lc(5,"vdr-form-field",4),n.yc(6,"translate"),n.lc(7,"input",5,6),n.vc("ngModelChange",function(e){return t.code=e}),n.kc(),n.kc(),n.lc(9,"clr-checkbox-wrapper"),n.lc(10,"input",7),n.vc("ngModelChange",function(e){return t.updateVariantName=e}),n.kc(),n.lc(11,"label"),n.bd(12),n.yc(13,"translate"),n.kc(),n.kc(),n.Zc(14,Yc,5,4,"section",8),n.Zc(15,en,6,7,"ng-template",9)),2&e&&(n.Tb(1),n.Ec("label",n.zc(2,7,"catalog.option-name")),n.Tb(2),n.Ec("ngModel",t.name),n.Tb(2),n.Ec("label",n.zc(6,9,"common.code")),n.Tb(2),n.Ec("ngModel",t.code),n.Tb(3),n.Ec("ngModel",t.updateVariantName),n.Tb(2),n.cd(n.zc(13,11,"catalog.auto-update-option-variant-name")),n.Tb(2),n.Ec("ngIf",t.customFields.length))},directives:[i.R,i.db,i.eb,O.b,O.z,O.p,O.s,O.w,B.k,O.a,B.i,B.u,z.o,i.Q,z.n,i.I],pipes:[G.d,i.ib],styles:[""],changeDetection:0});class Ea{constructor(e,t,c){this.changeDetector=e,this.modalService=t,this.dataService=c,this.assignToChannel=new n.u,this.removeFromChannel=new n.u,this.assetChange=new n.u,this.selectionChange=new n.u,this.selectFacetValueClick=new n.u,this.updateProductOption=new n.u,this.selectedVariantIds=[],this.pagination={currentPage:1,itemsPerPage:10},this.formGroupMap=new Map,this.GlobalFlag=i.hb,this.updatePermission=[i.Ib.UpdateCatalog,i.Ib.UpdateProduct]}ngOnInit(){this.dataService.settings.getGlobalSettings("cache-first").single$.subscribe(({globalSettings:e})=>{this.globalTrackInventory=e.trackInventory,this.globalOutOfStockThreshold=e.outOfStockThreshold,this.changeDetector.markForCheck()}),this.subscription=this.formArray.valueChanges.subscribe(()=>this.changeDetector.markForCheck()),this.subscription.add(this.formArray.valueChanges.pipe(Object(r.a)(e=>e.length),Object(s.a)(1),Object(g.a)()).subscribe(()=>{this.buildFormGroupMap()})),this.buildFormGroupMap()}ngOnChanges(e){var t,c;"facets"in e&&e.facets.currentValue&&(this.facetValues=Object(i.fc)(this.facets)),"variants"in e&&(null===(t=e.variants.currentValue)||void 0===t?void 0:t.length)!==(null===(c=e.variants.previousValue)||void 0===c?void 0:c.length)&&(this.pagination.currentPage=1)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}isDefaultChannel(e){return e===A.DEFAULT_CHANNEL_CODE}trackById(e,t){return t.id}inventoryIsNotTracked(e){var t;const c=null===(t=e.get("trackInventory"))||void 0===t?void 0:t.value;return c===i.hb.FALSE||c===i.hb.INHERIT&&!1===this.globalTrackInventory}getTaxCategoryName(e){const t=e.get(["taxCategoryId"]);if(t&&this.taxCategories){const e=this.taxCategories.find(e=>e.id===t.value);return e?e.name:""}return""}getSaleableStockLevel(e){const t=e.useGlobalOutOfStockThreshold?this.globalOutOfStockThreshold:e.outOfStockThreshold;return e.stockOnHand-e.stockAllocated-t}areAllSelected(){return!!this.variants&&this.selectedVariantIds.length===this.variants.length}onAssetChange(e,t){this.assetChange.emit(Object.assign({variantId:e},t));const c=this.variants.findIndex(t=>t.id===e);this.formArray.at(c).markAsDirty()}toggleSelectAll(){this.areAllSelected()?this.selectedVariantIds=[]:this.selectedVariantIds=this.variants.map(e=>e.id),this.selectionChange.emit(this.selectedVariantIds)}toggleSelectVariant(e){const t=this.selectedVariantIds.indexOf(e);-1<t?this.selectedVariantIds.splice(t,1):this.selectedVariantIds.push(e),this.selectionChange.emit(this.selectedVariantIds)}optionGroupName(e){var t;const c=this.optionGroups.find(t=>t.id===e);if(c){return(null!==(t=null==c?void 0:c.translations.find(e=>e.languageCode===this.activeLanguage))&&void 0!==t?t:c.translations[0]).name}}optionName(e){var t;return(null!==(t=e.translations.find(e=>e.languageCode===this.activeLanguage))&&void 0!==t?t:e.translations[0]).name}pendingFacetValues(e){if(this.facets){const t=this.getFacetValueIds(e.id),c=e.facetValues.map(e=>e.id);return t.filter(e=>!c.includes(e)).map(e=>this.facetValues.find(t=>t.id===e)).filter(w.notNullOrUndefined)}return[]}existingFacetValues(e){return[...this.getFacetValueIds(e.id)].filter(t=>e.facetValues.map(e=>e.id).includes(t)).map(t=>e.facetValues.find(e=>e.id===t)).filter(w.notNullOrUndefined)}removeFacetValue(e,t){const c=this.formGroupMap.get(e.id);if(c){const e=c.value.facetValueIds.filter(e=>e!==t);c.patchValue({facetValueIds:e}),c.markAsDirty()}}isVariantSelected(e){return-1<this.selectedVariantIds.indexOf(e)}editOption(e){this.modalService.fromComponent(Fa,{size:"md",locals:{productOption:e,activeLanguage:this.activeLanguage,customFields:this.customOptionFields}}).subscribe(e=>{e&&this.updateProductOption.emit(e)})}buildFormGroupMap(){this.formGroupMap.clear();for(const e of this.formArray.controls)this.formGroupMap.set(e.value.id,e);this.changeDetector.markForCheck()}getFacetValueIds(e){var t;return(null===(t=this.formGroupMap.get(e))||void 0===t?void 0:t.value).facetValueIds}}Ea.\u0275fac=function(e){return new(e||Ea)(n.fc(n.k),n.fc(i.Db),n.fc(i.L))},Ea.\u0275cmp=n.Zb({type:Ea,selectors:[["vdr-product-variants-list"]],inputs:{formArray:["productVariantsFormArray","formArray"],variants:"variants",channelPriceIncludesTax:"channelPriceIncludesTax",taxCategories:"taxCategories",facets:"facets",optionGroups:"optionGroups",customFields:"customFields",customOptionFields:"customOptionFields",activeLanguage:"activeLanguage",pendingAssetChanges:"pendingAssetChanges"},outputs:{assignToChannel:"assignToChannel",removeFromChannel:"removeFromChannel",assetChange:"assetChange",selectionChange:"selectionChange",selectFacetValueClick:"selectFacetValueClick",updateProductOption:"updateProductOption"},features:[n.Rb],decls:6,vars:8,consts:[[1,"variants-list"],["class","variant-container card",3,"disabled",4,"ngFor","ngForOf","ngForTrackBy"],[1,"table-footer"],[3,"itemsPerPage","itemsPerPageChange"],[3,"currentPage","itemsPerPage","pageChange"],[1,"variant-container","card"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"card-block","header-row"],[1,"details"],[1,"sku",3,"readonly"],["clrInput","","type","text","formControlName","sku",3,"readonly","placeholder"],[1,"name",3,"readonly"],["clrInput","","type","text","formControlName","name",3,"readonly","placeholder"],[1,"right-controls"],[4,"vdrIfPermissions"],[1,"card-block"],[1,"variant-body"],[1,"assets"],[3,"compact","assets","featuredAsset","change"],[1,"variant-form-inputs"],[1,"standard-fields"],[1,"variant-form-input-row"],[1,"tax-category"],[4,"vdrIfPermissions","vdrIfPermissionsElse"],["taxCategoryLabel",""],[1,"price"],["clrInput","","formControlName","price",3,"currencyCode","readonly",4,"ngIf"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly",4,"ngIf"],[3,"price","currencyCode","priceIncludesTax","taxCategoryId"],[3,"content"],["clrInput","","type","number","min","0","step","1","formControlName","stockOnHand",3,"readonly","vdrDisabled"],[1,"clr-control-label"],[1,"value"],[1,"out-of-stock-threshold-wrapper"],[1,"flex"],["clrInput","","type","number",3,"formControl","readonly","vdrDisabled"],["type","checkbox","clrToggle","","name","useGlobalOutOfStockThreshold","formControlName","useGlobalOutOfStockThreshold",3,"vdrDisabled"],[1,"custom-fields"],["formGroupName","customFields",4,"ngIf"],[1,"options-facets"],[3,"entity"],[4,"ngIf"],[1,"flex-spacer"],[1,"facets"],[3,"facetValue","removable","remove",4,"ngFor","ngForOf"],["class","btn btn-sm btn-secondary",3,"click",4,"vdrIfPermissions"],[4,"vdrIfMultichannel"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled"],["clrSelect","","name","options","formControlName","taxCategoryId"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"tax-category-label"],["clrInput","","formControlName","price",3,"currencyCode","readonly"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly"],["clrSelect","","name","options","formControlName","trackInventory"],["formGroupName","customFields"],[4,"ngFor","ngForOf"],["entityName","ProductVariant",3,"compact","customFieldsFormGroup","readonly","customField",4,"ngIf"],["entityName","ProductVariant",3,"compact","customFieldsFormGroup","readonly","customField"],[1,"options"],[3,"colorFrom","invert","icon","iconClick",4,"ngFor","ngForOf"],[3,"colorFrom","invert","icon","iconClick"],[1,"option-group-name"],[3,"facetValue","removable","remove"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","plus"],["class","card-block",4,"vdrIfDefaultChannelActive"],[1,"flex","channel-assignment"],[1,"btn","btn-sm",3,"click"],["shape","layers"],["icon","times-circle",3,"title","iconClick",4,"ngIf"],["icon","times-circle",3,"title","iconClick"],[3,"channelCode"]],template:function(e,t){1&e&&(n.lc(0,"div",0),n.Zc(1,Pn,2,3,"div",1),n.yc(2,"paginate"),n.lc(3,"div",2),n.lc(4,"vdr-items-per-page-controls",3),n.vc("itemsPerPageChange",function(e){return t.pagination.itemsPerPage=e}),n.kc(),n.lc(5,"vdr-pagination-controls",4),n.vc("pageChange",function(e){return t.pagination.currentPage=e}),n.kc(),n.kc(),n.kc()),2&e&&(n.Tb(1),n.Ec("ngForOf",n.Ac(2,5,t.variants,t.pagination))("ngForTrackBy",t.trackById),n.Tb(3),n.Ec("itemsPerPage",t.pagination.itemsPerPage),n.Tb(1),n.Ec("currentPage",t.pagination.currentPage)("itemsPerPage",t.pagination.itemsPerPage))},directives:function(){return[z.n,B.l,i.rb,i.Hb,z.o,O.q,O.j,i.Wb,B.t,i.eb,O.b,B.s,O.p,O.h,i.qb,Ia,B.u,ja,i.kb,O.v,i.S,O.g,B.k,O.a,B.i,i.ab,i.pb,B.B,O.A,B.A,O.u,O.D,i.H,O.k,i.I,i.D,i.bb,B.o,i.ob,i.B]},pipes:function(){return[U.b,i.ib,G.d,i.Qb,i.C]},styles:[".with-selected[_ngcontent-%COMP%]{display:flex;min-height:52px;align-items:center;border:1px solid var(--color-component-border-100);border-radius:3px;padding:6px 18px}.with-selected[_ngcontent-%COMP%] > label[_ngcontent-%COMP%], .with-selected[_ngcontent-%COMP%]   vdr-select-toggle[_ngcontent-%COMP%]{margin-right:12px}.variant-container[_ngcontent-%COMP%]{transition:background-color .2s;min-height:330px}.variant-container.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}.variant-container[_ngcontent-%COMP%]   .header-row[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}.variant-container[_ngcontent-%COMP%]   .variant-body[_ngcontent-%COMP%]{display:flex;flex-direction:column}@media screen and (min-width:768px){.variant-container[_ngcontent-%COMP%]   .variant-body[_ngcontent-%COMP%]{flex-direction:row}}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;margin-right:12px}@media screen and (min-width:768px){.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{flex-direction:row;height:36px}}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{flex:1}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]     .clr-control-container{width:100%}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]     .clr-control-container input.clr-input{min-width:100%}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .sku[_ngcontent-%COMP%]{width:160px;margin-right:20px;flex:0}.variant-container[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]     .name input{min-width:300px}.variant-container[_ngcontent-%COMP%]   .right-controls[_ngcontent-%COMP%]{display:flex}.variant-container[_ngcontent-%COMP%]   .tax-category-label[_ngcontent-%COMP%]{margin-top:3px}.variant-container[_ngcontent-%COMP%]   .variant-form-inputs[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}@media screen and (min-width:768px){.variant-container[_ngcontent-%COMP%]   .variant-form-inputs[_ngcontent-%COMP%]{flex-direction:row}}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}@media screen and (min-width:768px){.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%]{margin:0 6px 8px 24px}}.variant-container[_ngcontent-%COMP%]   .variant-form-input-row[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-right:24px;margin-bottom:24px}.variant-container[_ngcontent-%COMP%]   .track-inventory-toggle[_ngcontent-%COMP%]{margin-top:22px}.variant-container[_ngcontent-%COMP%]   .clr-form-control[_ngcontent-%COMP%]{margin-top:0}.variant-container[_ngcontent-%COMP%]   .facets[_ngcontent-%COMP%]{display:flex;align-items:center}.variant-container[_ngcontent-%COMP%]   .pricing[_ngcontent-%COMP%]{display:flex}.variant-container[_ngcontent-%COMP%]   .pricing[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-right:12px}.variant-container[_ngcontent-%COMP%]   .option-group-name[_ngcontent-%COMP%]{color:var(--color-text-200);text-transform:uppercase;font-size:10px;margin-right:3px;height:11px}.variant-container[_ngcontent-%COMP%]   .options-facets[_ngcontent-%COMP%]{display:flex;color:var(--color-grey-400)}.channel-assignment[_ngcontent-%COMP%]{justify-content:flex-end}.channel-assignment[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin:6px 12px 6px 0}.out-of-stock-threshold-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column}.out-of-stock-threshold-wrapper[_ngcontent-%COMP%]   clr-toggle-wrapper[_ngcontent-%COMP%]{margin-left:24px}.inventory-untracked[_ngcontent-%COMP%]{opacity:.5}.table-footer[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:space-between;margin-top:6px}"],changeDetection:0}),Ea.ctorParameters=()=>[{type:n.k},{type:i.Db},{type:i.L}],Ea.propDecorators={formArray:[{type:n.E,args:["productVariantsFormArray"]}],variants:[{type:n.E}],channelPriceIncludesTax:[{type:n.E}],taxCategories:[{type:n.E}],facets:[{type:n.E}],optionGroups:[{type:n.E}],customFields:[{type:n.E}],customOptionFields:[{type:n.E}],activeLanguage:[{type:n.E}],pendingAssetChanges:[{type:n.E}],assignToChannel:[{type:n.P}],removeFromChannel:[{type:n.P}],assetChange:[{type:n.P}],selectionChange:[{type:n.P}],selectFacetValueClick:[{type:n.P}],updateProductOption:[{type:n.P}]};class Sa{constructor(e){this.changeDetector=e,this.formGroupMap=new Map,this.updatePermission=[i.Ib.UpdateCatalog,i.Ib.UpdateProduct]}ngOnInit(){this.subscription=this.formArray.valueChanges.pipe(Object(r.a)(e=>e.length),Object(s.a)(1),Object(g.a)()).subscribe(()=>{this.buildFormGroupMap()}),this.buildFormGroupMap()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}getFeaturedAsset(e){var t;return(null===(t=this.pendingAssetChanges[e.id])||void 0===t?void 0:t.featuredAsset)||e.featuredAsset}optionGroupName(e){const t=this.optionGroups.find(t=>t.id===e);return t&&t.name}buildFormGroupMap(){this.formGroupMap.clear();for(const e of this.formArray.controls)this.formGroupMap.set(e.value.id,e);this.changeDetector.markForCheck()}}Sa.\u0275fac=function(e){return new(e||Sa)(n.fc(n.k))},Sa.\u0275cmp=n.Zb({type:Sa,selectors:[["vdr-product-variants-table"]],inputs:{formArray:["productVariantsFormArray","formArray"],variants:"variants",channelPriceIncludesTax:"channelPriceIncludesTax",optionGroups:"optionGroups",pendingAssetChanges:"pendingAssetChanges"},decls:20,vars:20,consts:[[3,"items"],[4,"ngFor","ngForOf"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"left","align-middle"],[1,"card-img"],[1,"featured-asset"],[3,"src",4,"ngIf","ngIfElse"],["placeholder",""],["clrInput","","type","text","formControlName","name",3,"readonly","placeholder"],["clrInput","","type","text","formControlName","sku",3,"readonly","placeholder"],[1,"left","align-middle","price"],["clrInput","","formControlName","price",3,"currencyCode","readonly",4,"ngIf"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly",4,"ngIf"],[1,"left","align-middle","stock"],["clrInput","","type","number","min","0","step","1","formControlName","stockOnHand",3,"readonly"],["type","checkbox","clrToggle","","name","enabled","formControlName","enabled",3,"vdrDisabled"],[3,"src"],[1,"placeholder"],["shape","image","size","48"],["clrInput","","formControlName","price",3,"currencyCode","readonly"],["clrInput","","formControlName","priceWithTax",3,"currencyCode","readonly"]],template:function(e,t){1&e&&(n.lc(0,"vdr-data-table",0),n.gc(1,"vdr-dt-column"),n.lc(2,"vdr-dt-column"),n.bd(3),n.yc(4,"translate"),n.kc(),n.lc(5,"vdr-dt-column"),n.bd(6),n.yc(7,"translate"),n.kc(),n.Zc(8,xn,3,1,"ng-container",1),n.yc(9,"sort"),n.lc(10,"vdr-dt-column"),n.bd(11),n.yc(12,"translate"),n.kc(),n.lc(13,"vdr-dt-column"),n.bd(14),n.yc(15,"translate"),n.kc(),n.lc(16,"vdr-dt-column"),n.bd(17),n.yc(18,"translate"),n.kc(),n.Zc(19,Mn,1,1,"ng-template"),n.kc()),2&e&&(n.Ec("items",t.variants),n.Tb(3),n.cd(n.zc(4,7,"common.name")),n.Tb(3),n.cd(n.zc(7,9,"catalog.sku")),n.Tb(2),n.Ec("ngForOf",n.Ac(9,11,t.optionGroups,"id")),n.Tb(3),n.cd(n.zc(12,14,"catalog.price")),n.Tb(3),n.cd(n.zc(15,16,"catalog.stock-on-hand")),n.Tb(3),n.cd(n.zc(18,18,"common.enabled")))},directives:[i.N,i.M,z.n,z.o,O.q,O.j,B.t,i.eb,O.b,B.s,O.p,O.h,O.v,B.k,O.a,B.i,i.S,B.o,i.H],pipes:[G.d,i.Qb,i.ib,i.r,i.Sb],styles:[".placeholder[_ngcontent-%COMP%]{color:var(--color-grey-300)}.price[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .stock[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:96px}td[_ngcontent-%COMP%]{transition:background-color .2s}td.disabled[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}"],changeDetection:0}),Sa.ctorParameters=()=>[{type:n.k}],Sa.propDecorators={formArray:[{type:n.E,args:["productVariantsFormArray"]}],variants:[{type:n.E}],channelPriceIncludesTax:[{type:n.E}],optionGroups:[{type:n.E}],pendingAssetChanges:[{type:n.E}]};class ja{constructor(e){this.dataService=e,this.priceChange$=new P.a(0),this.taxCategoryIdChange$=new P.a("")}ngOnInit(){const e=this.dataService.settings.getTaxRates(999,0,"cache-first").mapStream(e=>e.taxRates.items),t=this.dataService.settings.getActiveChannel("cache-first").refetchOnChannelChange().mapStream(e=>e.activeChannel);this.taxRate$=Object(x.a)(t,e,this.taxCategoryIdChange$).pipe(Object(r.a)(([e,t,c])=>{const n=e.defaultTaxZone;if(!n)return 0;const a=t.find(e=>e.zone.id===n.id&&e.category.id===c);return a?a.value:0})),this.grossPrice$=Object(x.a)(this.taxRate$,this.priceChange$).pipe(Object(r.a)(([e,t])=>Math.round(t*((100+e)/100))))}ngOnChanges(e){"price"in e&&this.priceChange$.next(e.price.currentValue),"taxCategoryId"in e&&this.taxCategoryIdChange$.next(e.taxCategoryId.currentValue)}}ja.\u0275fac=function(e){return new(e||ja)(n.fc(i.L))},ja.\u0275cmp=n.Zb({type:ja,selectors:[["vdr-variant-price-detail"]],inputs:{priceIncludesTax:"priceIncludesTax",price:"price",currencyCode:"currencyCode",taxCategoryId:"taxCategoryId"},features:[n.Rb],decls:5,vars:5,consts:[[1,"clr-control-label"],["class","value",4,"ngIf"],[1,"value"]],template:function(e,t){1&e&&(n.lc(0,"label",0),n.bd(1),n.yc(2,"translate"),n.kc(),n.Zc(3,wn,4,8,"div",1),n.Zc(4,An,6,14,"div",1)),2&e&&(n.Tb(1),n.cd(n.zc(2,3,"catalog.taxes")),n.Tb(2),n.Ec("ngIf",t.priceIncludesTax),n.Tb(1),n.Ec("ngIf",!t.priceIncludesTax))},directives:[B.u,z.o],pipes:[G.d,z.b,i.zb],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}.value[_ngcontent-%COMP%]{margin-top:3px}"],changeDetection:0}),ja.ctorParameters=()=>[{type:i.L}],ja.propDecorators={priceIncludesTax:[{type:n.E}],price:[{type:n.E}],currencyCode:[{type:n.E}],taxCategoryId:[{type:n.E}]};class Ma{}Ma.\u0275fac=function(e){return new(e||Ma)},Ma.\u0275mod=n.dc({type:Ma}),Ma.\u0275inj=n.cc({imports:[[i.Nb,a.i.forChild(ma)]]})}}]);
//# sourceMappingURL=7-es2015.84704182a0c853150954.js.map